<div id="markdown" class="mui-46nw7a"><div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Deep Dives</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Consistent Hashing</h1><p class="MuiTypography-root MuiTypography-body2 mui-45a2r">What problem does consistent hashing solve, how does it work, and how can you use it in an interview.</p></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<div class="mb-4"><iframe class="w-full aspect-video" src="https://www.youtube.com/embed/vccwdhfqIrI" title="Consistent Hashing: Easy Explanation" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="intro">Intro</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">While preparing for system design interviews I'm sure you've come across consistent hashing. It's a foundational algorithm in distributed systems that is used to distribute data across a cluster of servers.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">There are quite literally thousands of resources online that explain it, yet somehow I find the majority are overly academic.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">In this deep dive, we'll give a hyper focused overview of consistent hashing, including the problem it solves, how it works, and how you can use it in your interviews.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="consistent-hashing-via-an-example">Consistent Hashing via an Example</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Let's build up our intuition via a motivating example.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Imagine you're designing a ticketing system like TicketMaster. Initially, your system is simple:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">One database storing all event data</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Clients making requests to fetch event information</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Everything works smoothly at first</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/2377fa643168deb32245369a93310a3f.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Client Server Database</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">But success brings challenges. As your platform grows popular and hosts more events, a single database can no longer handle the load. You need to distribute your data across multiple databases â€“ a process called sharding.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/1a58bc4898891321bc10e74040240b8d.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Sharding</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">The question we need to answer is: <strong>How do we know which events to store on which database instance?</strong></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="first-attempt-simple-modulo-hashing">First Attempt: Simple Modulo Hashing</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">The most straightforward approach to distribute data across multiple databases is modulo hashing.</div>
<ol style="list-style:decimal outside;color:text.secondary">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">First, we take the event ID and run it through a hash function, which converts it into a number</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Then, we take that number and perform the modulo operation (%) with the number of databases</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The result tells us which database should store that event</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/6d2135bd5e7483f62bd8312b0d80f784.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Modulo Hashing</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">In code, it looks like this:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.375rem;border:none"><code font-size="18" style="white-space:pre"><span>database_id </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">hash</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>event_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">%</span><span> number_of_databases</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">For a concrete example with 3 databases:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.375rem;border:none"><code font-size="18" style="white-space:pre"><span>Event </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">#1234 â†’ hash(1234) % 3 = 1 â†’ Database 1</span><span>
</span><span>Event </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">#5678 â†’ hash(5678) % 3 = 0 â†’ Database 0</span><span>
</span><span>Event </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">#9012 â†’ hash(9012) % 3 = 2 â†’ Database 2</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Great! This works well, until you run into a few problems.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">The first problem comes when you want to add a fourth database instance. To do so, you naively think that all you need to do is run the modulo operation with 4 instead of 3.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0;overflow:auto;border-radius:0.375rem;border:none"><code font-size="18" style="white-space:pre"><span>database_id </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">hash</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>event_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">%</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">4</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">You change the code, and push to production but then your database activity goes through the roof! Not just for the fourth database instance either, but for all of them.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">What happened was the change in the hash function did not only impact data that should be stored on the new instance, but it changed which database instance almost <em>every</em> event was stored on.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/4dd7e8af01180314ff888a2792ef6b52.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Issue adding a Node</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">For example, event #1234 used to map to database 1, but now, <span class="MuiBox-root mui-1vu004u">hash(1234) % 4 = 0</span> so that data instead needs to be moved to database 0.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">This means the data needs to be moved from database 1 to database 0. This isn't an isolated case - most of your data needs to be redistributed across all database instances, causing massive unnecessary data movement. This causes huge spikes in database load and means users are either unable to access data or they experience slow response times.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Let's look at another problem with simple modulo hashing.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Imagine a database went down. This could be due to anything from a hardware failure to a software bug. In any case, we need to remove it from the pool of databases and redistribute the data across the remaining instances until we can pull a new one online.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Our hash function now changes from <span class="MuiBox-root mui-1vu004u">database_id = hash(event_id) % 3</span> to <span class="MuiBox-root mui-1vu004u">database_id = hash(event_id) % 2</span> and we run into the exact same redistribution problem we had before.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/fa82ee480678dbacb996c0c60be1003c.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Issue removing a Node</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Clearly simple modulo hashing isn't cutting it. Enter, <strong>Consistent Hashing</strong>.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="consistent-hashing">Consistent Hashing</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Consistent hashing is a technique that solves the problem of data redistribution when adding or removing a instance in a distributed system. The key insight is to arrange both our data and our databases in a circular space, often called a "hash ring."</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Here's how it works:</div>
<ol style="list-style:decimal outside;color:text.secondary">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We first create a hash ring with a fixed number of points. To keep it simple, let's say 100.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We then evenly distribute our data across the hash ring. In the case where we have 4 databases, then we could put them at points 0, 25, 50, and 75.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">In order to know which database an event should be stored on, we first hash the event ID like we did before, but instead of using modulo, we just find the hash value on the ring and then move clockwise until we find a database instance.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/cc014afe6b510999d3b6febe6c844e40.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Hash Ring</span></div></div></div></div>
<div class="my-6"><div class="MuiBox-root mui-1cdyrx9"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow:hidden;max-height:300px"><div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">In reality, a hash ring usually has a hash space of 0 to 2^32 - 1 not 0-100, but the concept is the same.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">How did this solve our problem? Let's look at what happens when we add or remove a database:</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><strong>Adding a Database (Database 5)</strong>
Let's say we add a fifth database at position 90 on our ring. Now:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Only events that hash to positions between 75 and 90 need to move</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">These events were previously going to DB1 (at position 0)</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">All other events stay exactly where they are!</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/ba09de370fc43bfaaad4fe458de0419e.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Hash Ring with DB5 added</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Whereas before almost all data needed to be redistributed, with consistent hashing, we're only moving about 1/4 of the events that were on DB4, or roughly 1/16th of all our events.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><strong>Removing a Database</strong>
Similarly, if Database 2 (at position 25) fails:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Only events that were mapped to Database 2 need to move</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">These events will now map to Database 3 (at position 50)</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Everything else stays put</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/9ea0c390aa607916db34986bf45c0d8c.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Hash Ring with DB2 removed</span></div></div></div></div>
<h4 class="MuiTypography-root MuiTypography-h5 mui-1jefea8" id="virtual-nodes">Virtual Nodes</h4>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">We've made good progress, but there is still just one problem. In our example above where we removed database 2, we had to move all events that were stored on database 2 to database 3. Now database 3 has 2x the load of database 1 and database 4. We'd much prefer if we could spread the load more evenly so database 3 wasn't overloaded.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">The solution is to use what are called "virtual nodes". Instead of putting each database at just one point on the ring, we put it at multiple points by hashing different variations of the database name.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c"><div class="MuiBox-root mui-10khgmf" style="cursor:pointer"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><object data="/_next/static/69e17e6cd34ab1340477cfd652d4ee5f.svg" type="image/svg+xml"></object></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Hash Ring with Virtual Nodes</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">For example, instead of just hashing "DB1" to get position 0, we hash "DB1-vn1", "DB1-vn2", "DB1-vn3", etc., which might give us positions 15, 25, 40 and so on. We do this for each database, which results in the virtual nodes being naturally intermixed around the ring.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Now when Database 2 fails:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The events that were mapped to "DB2-vn1" will be redistributed to Database 1</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The events that were mapped to "DB2-vn2" will go to Database 3</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The events that were mapped to "DB2-vn3" will go to Database 4</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">And so on...</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">This means the load from the failed database gets distributed much more evenly across all remaining databases instead of overwhelming just one neighbor. The more virtual nodes you use per database, the more evenly distributed the load becomes.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="consistent-hashing-in-the-real-world">Consistent Hashing in the Real World</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">While our example focused on scaling a database, note that consistent hashing applies to any scenarios where you need to distribute data across a cluster of servers. This cluster could be databases, sure, but they could also be caches, message brokers, or even just a set of application servers.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">We see consistent hashing used in many heavily relied on, scaled, systems. For example:</div>
<ol style="list-style:decimal outside;color:text.secondary">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/deep-dives/redis" target="_blank" rel="noopener noreferrer" style="color:#637381;&amp;:hover:[object Object];cursor:pointer;font-weight:600;text-decoration:underline" linkcomponent="next/link">Redis</a> Cluster: Uses consistent hashing to distribute keys across nodes</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/deep-dives/cassandra" target="_blank" rel="noopener noreferrer" style="color:#637381;&amp;:hover:[object Object];cursor:pointer;font-weight:600;text-decoration:underline" linkcomponent="next/link">Apache Cassandra</a>: Uses consistent hashing to distribute data across the ring</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/deep-dives/dynamodb" target="_blank" rel="noopener noreferrer" style="color:#637381;&amp;:hover:[object Object];cursor:pointer;font-weight:600;text-decoration:underline" linkcomponent="next/link">Amazon's DynamoDB</a>: Uses consistent hashing under the hood</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Content_delivery_network" target="_blank" rel="noopener noreferrer" style="color:#637381;&amp;:hover:[object Object];cursor:pointer;font-weight:600;text-decoration:underline" linkcomponent="next/link">Content Delivery Networks (CDNs)</a>: Use consistent hashing to determine which edge server should cache specific content</div></li>
</ol>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="when-to-use-consistent-hashing-in-an-interview">When to use Consistent Hashing in an Interview</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Most modern distributed systems handle sharding and data distribution for you. When designing a system using Redis, DynamoDB, or Cassandra, you typically just need to mention that these systems use consistent hashing under the hood to handle scaling.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">However, consistent hashing becomes a crucial topic in infrastructure-focused interviews where you're asked to design distributed systems from scratch. Here are the common scenarios:</div>
<ol style="list-style:decimal outside;color:text.secondary">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Design a distributed database</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Design a distributed cache</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Design a distributed message broker</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">In these deep infrastructure interviews, you should be prepared to explain several key concepts. You'll need to articulate why consistent hashing provides advantages over simple modulo-based sharding approaches. You should also be ready to discuss how virtual nodes help achieve better load distribution across the system. Additionally, be prepared to explain strategies for handling node failures and additions to the cluster. Finally, you'll want to demonstrate your understanding of how to address hot spots and implement effective data rebalancing strategies.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">The key is recognizing when to go deep versus when to simply acknowledge that existing solutions handle this complexity for you. Most system design interviews fall into the latter category!</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="conclusion">Conclusion</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">Consistent hashing is one of those algorithms that revolutionized distributed systems by solving a seemingly simple problem: how to distribute data across servers while minimizing redistribution when the number of servers changes.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">While the implementation details can get complex, the core concept is beautifully simple - arrange everything in a circle and walk clockwise. This elegant solution is now built into many of the distributed systems we use daily, from Redis to DynamoDB.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1qj780c">In your next system design interview, remember: you usually don't need to implement consistent hashing yourself. Just know when it's being used under the hood, and save the deep dive for those infrastructure-heavy questions where it really matters.</div></div>
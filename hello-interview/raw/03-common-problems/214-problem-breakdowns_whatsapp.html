<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whatsapp or Messenger Design Interview Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Common Problems</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Design Whatsapp or Messenger</h1></div><div class="flex flex-col md:flex-row gap-2 md:items-center justify-between"><div class="flex flex-col lg:flex-row gap-4 md:items-center"><a target="_blank" rel="noopener noreferrer" class="flex flex-row gap-2 items-center" href="https://www.linkedin.com/in/stefanmai/" style="text-decoration: none;"><img class="rounded-full" src="https://hellointerview-files.s3.us-west-2.amazonaws.com/public-media/stefan-headshot.png" alt="Stefan Mai" width="40" height="40"><div class="flex flex-col"><div class="flex flex-row gap-2 items-center"><p class="MuiTypography-root MuiTypography-body2 mui-ltrqv0">Stefan Mai</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeInherit mui-70s7oy" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></div><span class="MuiTypography-root MuiTypography-caption mui-1eozzb8">Ex-Meta &amp; Amazon Sr. Manager</span></div></a><div class="flex flex-row gap-4 md:gap-8 items-center"><div class="flex flex-row gap-1 items-center" aria-label="Difficulty"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-su24yt">medium</p></div><div class="flex flex-row gap-1 items-center" aria-label="Average time allowed in interview"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-1pb8xyp">35 min</p></div></div></div><a class="MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation mui-1c7cv5a" tabindex="0" href="/practice/system-design/start/whatsapp" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"></path></svg>Practice this problem<span class="MuiTouchRipple-root mui-w0pj6f"></span></a></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<div class="mb-4"><iframe class="w-full aspect-video" src="https://www.youtube.com/embed/cr6p0n0N-VA?si=7POvoFw9y9ke8CCc" title="System Design Interview: Design Whatsapp w/ a Ex-Meta Senior Manager" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="understanding-the-problem">Understanding the Problem</h2>
<div class="my-6"><div class="MuiBox-root mui-1fz7ihe"><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>🚗 What is <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.whatsapp.com/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Whatsapp</a>?</strong>
Whatsapp is a messaging service that allows users to send and receive encrypted messages and calls from their phones and computers. Whatsapp was famously originally built on Erlang (no longer!) and renowned for handling high scale with limited engineering and infrastructure outlay.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#1-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Apps like WhatsApp and Messenger have tons of features, but your interviewer doesn't want you to cover them all. The most obvious capabilities are almost definitely in-scope but it's good to ask your interviewer if they want you to move beyond. Spending too much time in requirements will make it harder for you to give detail in the rest of the interview, so we won't dawdle too long here!</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to start group chats with multiple participants (limit 100).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to send/receive messages.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to receive messages sent while they are not online (up to 30 days).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to send/receive media in their messages.</div></li>
</ol>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">That third requirement isn't obvious to everyone (but it's interesting to design) and If I'm your interviewer I'll probably guide you to it.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope)</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Audio/Video calling.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Interactions with businesses.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Registration and profile management.</div></li>
</ol>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="non-functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#2-non-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Non-Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Messages should be delivered to available users with low latency, &lt; 500ms.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We should guarantee deliverability of messages - they should make their way to users.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should be able to handle billions of users with high throughput (we'll estimate later).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Messages should be stored on centralized servers no longer than necessary.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should be resilient against failures of individual components.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope)</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Exhaustive treatment of security concerns.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Spam and scraping prevention systems.</div></li>
</ol>
<div class="mt-6"><div class="MuiBox-root mui-o9fqh4"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Adding features that are out of scope is a "nice to have". It shows product thinking and gives your interviewer a chance to help you reprioritize based on what they want to see in the interview. That said, it's very much a nice to have. If additional features are not coming to you quickly (or you've already burned some time), don't waste your time and move on. It's easy to use precious time defining features that are out of scope, which provides negligible value for a hiring decision.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 843.3291015625 234.86328125">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="843.3291015625" height="234.86328125" fill="#ffffff"></rect><g transform="translate(10 74.86328125) rotate(0 215.13980102539062 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Functional</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Start group chats (limit 100 users)</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Send-receive messages</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Send/receive media</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Access messages after they've been offline</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g transform="translate(480.109375 10) rotate(0 176.60986328125 100)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Non-Functional</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Delivered with low-latency, &lt; 500ms</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Guarantee delivery of messages</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Billions of users, high throughput</text><text x="0" y="150" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Messages not stored unnecessarily</text><text x="0" y="175" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Fault-tolerant</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Requirements</span></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="the-set-up">The Set Up</h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="planning-the-approach">Planning the Approach</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Before you move on to designing the system, it's important to start by taking a moment to plan your strategy for the session. For this problem, we might first recognize that 1:1 messages are simply a special case of larger chats (with 2 participants), so we'll solve for that general case.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">After this, we should be able to start our design by walking through our core requirements and solving them as simply as possible. This will get us started with a system that is probably slow and not scalable, but a good starting point for us to optimize in the deep dives.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In our deep dives we'll address scaling, optimizations, and any additional features/functionality the interviewer might want to throw on the fire.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="defining-the-core-entities"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#core-entities-2-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Defining the Core Entities</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In the core entities section, we'll think through the main "nouns" of our system. The intent here is to give us the right language to reason through the problem and set the stage for our API and data model.</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Interviewers aren't evaluating you on what you list for core entitites, they're an intermediate step to help you reason through the problem. That doesn't mean they don't matter though! Getting the entities wrong is a great way to start building on a broken foundation - so spend a few moments to get them right and keep moving.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can walk through our functional requirements to get an idea of what the core entities are. We need:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Chats (2-100 users)</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Messages</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Clients (a user might have multiple devices)</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll use this language to reason through the problem.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="api-or-system-interface"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#system-interface-2-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">API or System Interface</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Next, we'll want to think through the API of our system. Unlike a lot of other products where a REST API is probably appropriate, for a chat app, we're going to have high-frequency updates being both sent and received. This is a perfect use case for a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/deep-dives/realtime-updates" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">bi-directional socket connection</a>!</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For this interview, we'll just use websockets although a simple TLS connection would do. The idea will be that users will open the app and connect to the server, opening this socket which will be used to send and receive commands which represent our API.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Just knowing that we have a websocket connection is useful, but we'll need to know what commands we want to exchange on the socket.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">First, let's be able to create a chat.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// -&gt; createChat</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"participants"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"name"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span class="token" style="color: rgb(64, 120, 242);">&gt;</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"chatId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now we should be able to send messages on the chat.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// -&gt; sendMessage</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"chatId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"message"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"attachments"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span class="token" style="color: rgb(64, 120, 242);">&gt;</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"SUCCESS"</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">|</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"FAILURE"</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We need a way to create attachments (note: I'm going to amend this later in the writeup).</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// -&gt; createAttachment</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"body"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token spread" style="color: rgb(64, 120, 242);">...</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"hash"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> 
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span class="token" style="color: rgb(64, 120, 242);">&gt;</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"attachmentId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">And we need a way to add/remove users to the chat.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// -&gt; modifyChatParticipants</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"chatId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"userId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"operation"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"ADD"</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">|</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"REMOVE"</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span class="token" style="color: rgb(64, 120, 242);">&gt;</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"SUCCESS"</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">|</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"FAILURE"</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Each of these commands will have a parallel commands that is sent to other clients. When the command has been received by clients, they'll send an <span class="MuiBox-root mui-1vu004u">ack</span> command back to the server letting it know the command has been received (and it doesn't have to be sent again)!</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The message receipt acknowledgement is a bit non-obvious but crucial to making sure we don't lose messages. By forcing clients to ack, we can know for certain that the message has been delivered all the way to the client.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a chat is created or updated ...</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// &lt;- chatUpdate</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"chatId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"participants"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span class="token" style="color: rgb(64, 120, 242);">&gt;</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"RECEIVED"</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a message is received ...</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// &lt;- newMessage</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"chatId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"userId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"message"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">""</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token string-property" style="color: rgb(228, 86, 73);">"attachments"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span class="token" style="color: rgb(64, 120, 242);">&gt;</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"RECEIVED"</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Etc ...</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Note that enumerating all of these APIs can take time! In the actual interview, I might shortcut by only writing the command names and not the full API. It's also usually a good idea to summarize the API initially before you build out the high-level design in case things need to change. "I'll come back to this as I learn more" is completely acceptable!</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our whiteboard might look like this:</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 505.5703125 174.86328125">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="505.5703125" height="174.86328125" fill="#ffffff"></rect><g transform="translate(10 14.86328125) rotate(0 99.43990325927734 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commands Sent</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* createChat</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* sendMessage</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* createAttachment</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* modifyParticipants</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g transform="translate(308.73046875 10) rotate(0 93.419921875 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commands Received</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* newMessage</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* chatUpdate</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Commands Exchanged</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now that we have a base to work with let's figure out how we can make them real while we satisfy our requirements.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="high-level-design"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#high-level-design-10-15-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">High-Level Design</a></h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-users-should-be-able-to-start-group-chats-with-multiple-participants-limit-100">1) Users should be able to start group chats with multiple participants (limit 100)</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For our first requirement, we need a way for a user to create a chat. We'll start with a simple service behind an L4 load balancer (to support Websockets!) which can write <span class="MuiBox-root mui-1vu004u">Chat</span> metadata to a database. Let's use <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/deep-dives/dynamodb" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">DynamoDB</a> for fast key/value performance and scalability here, although we have lots of other options.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1144.7467956542969 251.5390625">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1144.7467956542969" height="251.5390625" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 78.099609375) rotate(0 79.794921875 79.705078125)"><path d="M93.41 1.12 C103.51 1.67, 114.12 7.14, 123.18 12.98 C132.23 18.82, 141.67 27.12, 147.74 36.18 C153.81 45.25, 158.16 56.46, 159.59 67.37 C161.02 78.27, 159.32 91.15, 156.32 101.62 C153.32 112.09, 148.5 121.91, 141.6 130.18 C134.69 138.45, 124.54 146.34, 114.89 151.24 C105.24 156.13, 94.43 159.28, 83.69 159.55 C72.96 159.82, 60.69 156.96, 50.48 152.87 C40.27 148.77, 30.15 142.57, 22.45 134.96 C14.75 127.35, 8.02 117.23, 4.27 107.22 C0.53 97.21, -0.66 85.76, 0 74.89 C0.65 64.03, 3.11 51.64, 8.21 42.05 C13.32 32.46, 21.99 23.88, 30.64 17.35 C39.29 10.82, 48.82 5.6, 60.12 2.89 C71.42 0.18, 91.43 0.75, 98.42 1.1 C105.42 1.45, 102.58 3.55, 102.11 5 M45.58 8.4 C54.56 2.74, 68.31 -0.23, 78.98 -0.76 C89.66 -1.3, 99.79 0.89, 109.63 5.19 C119.48 9.49, 130.32 17.33, 138.06 25.06 C145.79 32.79, 152.53 41.58, 156.04 51.56 C159.56 61.54, 159.92 73.8, 159.14 84.96 C158.35 96.12, 156.21 108.76, 151.32 118.52 C146.44 128.28, 138.72 137.31, 129.84 143.53 C120.97 149.75, 108.95 153.48, 98.07 155.85 C87.18 158.22, 75.18 159.4, 64.55 157.74 C53.91 156.08, 43.3 151.93, 34.27 145.87 C25.24 139.82, 16.02 130.86, 10.36 121.43 C4.7 112, 1.54 99.8, 0.32 89.31 C-0.91 78.82, -0.03 68.6, 3 58.48 C6.03 48.37, 11.52 37.01, 18.5 28.64 C25.47 20.27, 40.4 11.27, 44.83 8.27 C49.26 5.27, 44.19 9.68, 45.08 10.64" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(62.82141897875704 145.44468626280894) rotate(0 27.049972534179688 12.5)"><text x="27.049972534179688" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g stroke-linecap="round" transform="translate(509.203125 97.466796875) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C60.87 -1.38, 89.29 -1.15, 124.82 0 M32 0 C56.52 -0.66, 81.9 0.28, 124.82 0 M124.82 0 C146.57 0.22, 154.97 10.07, 156.82 32 M124.82 0 C145.06 -1.64, 156.32 10.29, 156.82 32 M156.82 32 C156.96 54.31, 156.46 76.85, 156.82 99.82 M156.82 32 C156.52 57.49, 156.27 82.6, 156.82 99.82 M156.82 99.82 C156.8 121.16, 146.51 132.59, 124.82 131.82 M156.82 99.82 C158.99 119.94, 145.28 130.56, 124.82 131.82 M124.82 131.82 C92.15 132.2, 62.09 134.27, 32 131.82 M124.82 131.82 C91.03 131.36, 57.33 132, 32 131.82 M32 131.82 C10.08 132.36, -1.96 121.11, 0 99.82 M32 131.82 C10.08 130.39, -0.38 123.12, 0 99.82 M0 99.82 C0.33 80.65, 1.57 65.82, 0 32 M0 99.82 C-0.38 83.08, 0.77 67.02, 0 32 M0 32 C0.8 10.94, 10.61 -1.84, 32 0 M0 32 C-1.28 12.17, 10.55 -1.4, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(528.0652847290039 150.87890625) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(777.6328125 94.998046875) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C54.92 1.71, 80.81 0.12, 145.65 0 M31.01 0 C61.73 -0.59, 91.12 -1, 145.65 0 M145.65 0 C165.37 -1.42, 176.21 10.01, 176.66 31.01 M145.65 0 C166.89 -2.05, 175.09 11.19, 176.66 31.01 M176.66 31.01 C178.32 48.66, 177.75 70.6, 176.66 93.02 M176.66 31.01 C176.68 48.04, 176.87 65.46, 176.66 93.02 M176.66 93.02 C178.54 112.63, 165.56 122.93, 145.65 124.03 M176.66 93.02 C177.39 114.18, 167.97 121.87, 145.65 124.03 M145.65 124.03 C114.14 126.86, 81.12 124.39, 31.01 124.03 M145.65 124.03 C121.09 124.02, 96.14 123.73, 31.01 124.03 M31.01 124.03 C9.82 122.78, -0.33 115.4, 0 93.02 M31.01 124.03 C9.52 124.93, -0.74 114.38, 0 93.02 M0 93.02 C-1.87 78.31, -2.21 62.74, 0 31.01 M0 93.02 C-0.1 79.59, -0.53 64.97, 0 31.01 M0 31.01 C-1.12 11.64, 10.24 -1.22, 31.01 0 M0 31.01 C-0.91 11.13, 10.94 1.83, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(807.6609802246094 132.01171875) rotate(0 58.299957275390625 25)"><text x="58.299957275390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text><text x="58.299957275390625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(678.90234375 164.019732804338) rotate(0 39.77734375 -1.605671975993829)"><path d="M0.25 0.13 C13.3 -0.59, 65.32 -2.87, 78.44 -3.57 M-1.08 -0.85 C12.31 -1.46, 67.4 -1.83, 80.57 -2.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(678.90234375 164.019732804338) rotate(0 39.77734375 -1.605671975993829)"><path d="M52.56 8.52 C61.44 3.26, 69.35 0.82, 80.57 -2.22 M52.56 8.52 C59.24 5.21, 64.72 4.02, 80.57 -2.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(678.90234375 164.019732804338) rotate(0 39.77734375 -1.605671975993829)"><path d="M52.21 -12 C61.32 -10.87, 69.35 -6.91, 80.57 -2.22 M52.21 -12 C58.92 -10.61, 64.49 -7.11, 80.57 -2.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(979.68359375 10) rotate(0 58.799964904785156 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  name</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  metadata</text></g><g transform="translate(162.07421875 61.8515625) rotate(0 49.859954833984375 25)"><text x="49.859954833984375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">WS </text><text x="49.859954833984375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Connection</text></g><g transform="translate(978.2469329833984 166.5390625) rotate(0 78.24993133544922 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">ChatParticipant</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  chatId</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  participantId</text></g><g stroke-linecap="round" transform="translate(259.68394470214844 94.3916015625) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C69.25 0.9, 101.07 0.3, 124.82 0 M32 0 C64.86 0.44, 96.74 -0.09, 124.82 0 M124.82 0 C145.26 -1.72, 158.09 10.5, 156.82 32 M124.82 0 C144.52 0.37, 156.56 11.73, 156.82 32 M156.82 32 C156.95 58.73, 158.08 81.06, 156.82 99.82 M156.82 32 C155.63 48.95, 156.91 66.43, 156.82 99.82 M156.82 99.82 C156.6 121.44, 146.11 133.56, 124.82 131.82 M156.82 99.82 C157.5 122.45, 148.08 130.22, 124.82 131.82 M124.82 131.82 C103.38 131.82, 81.45 130.02, 32 131.82 M124.82 131.82 C90.06 133.23, 55.53 133.3, 32 131.82 M32 131.82 C10.86 131.42, 1.84 121.74, 0 99.82 M32 131.82 C12.59 130.49, 1.66 120.02, 0 99.82 M0 99.82 C0.42 72.58, 1.32 48.97, 0 32 M0 99.82 C0.05 73.22, -0.73 47.04, 0 32 M0 32 C-1.94 12.52, 9.45 0.14, 32 0 M0 32 C-0.76 10.5, 12.66 -0.44, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(307.4460678100586 147.8037109375) rotate(0 30.649986267089844 12.5)"><text x="30.649986267089844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">L4 LB</text></g><g stroke-linecap="round"><g transform="translate(177.67808532714844 152.6005859375) rotate(0 34.798828125 -0.796875)"><path d="M-1 -0.17 C10.82 -0.34, 57.98 -1.19, 69.78 -1.57 M0.68 -1.3 C12.46 -1.21, 57.51 0.03, 68.93 -0.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(177.67808532714844 152.6005859375) rotate(0 34.798828125 -0.796875)"><path d="M40.61 9.85 C46.19 8.37, 52.33 6.44, 68.93 -0.02 M40.61 9.85 C47.29 7.32, 54.22 5.61, 68.93 -0.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(177.67808532714844 152.6005859375) rotate(0 34.798828125 -0.796875)"><path d="M40.89 -10.67 C46.32 -7.94, 52.4 -5.65, 68.93 -0.02 M40.89 -10.67 C47.45 -8.49, 54.32 -5.5, 68.93 -0.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(428.55308532714844 166.9287109375) rotate(0 33.478515625 0.19140625)"><path d="M-0.97 -0.57 C10.02 -0.36, 54.99 0.42, 66.51 0.66 M0.72 1.74 C11.46 1.63, 54.12 -0.82, 65.33 -1.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(428.55308532714844 166.9287109375) rotate(0 33.478515625 0.19140625)"><path d="M37.7 10.37 C46.46 5.76, 57.53 4.37, 65.33 -1.32 M37.7 10.37 C46.8 6.56, 56.45 2.26, 65.33 -1.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(428.55308532714844 166.9287109375) rotate(0 33.478515625 0.19140625)"><path d="M36.65 -10.13 C45.67 -7.56, 57.1 -1.79, 65.33 -1.32 M36.65 -10.13 C46.16 -7.05, 56.17 -4.46, 65.33 -1.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Create a Chat</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The steps here are:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User connects to the service and sends a <span class="MuiBox-root mui-1vu004u">createChat</span> message.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The service, inside a transaction, creates a <span class="MuiBox-root mui-1vu004u">Chat</span> record in the database and creates a <span class="MuiBox-root mui-1vu004u">ChatParticipant</span> record for each user in the chat.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The service returns the <span class="MuiBox-root mui-1vu004u">chatId</span> to the user.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">On the chat table, we'll usually just want to look up the details by the chat's ID. Having a simple primary key on the chat <span class="MuiBox-root mui-1vu004u">id</span> is good enough for this.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For the <span class="MuiBox-root mui-1vu004u">ChatParticipant</span> table, we'll want to be able to (1) look up all participants for a given chat and (2) look up all chats for a given user.</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We can do this with a composite primary key on the <span class="MuiBox-root mui-1vu004u">chatId</span> and <span class="MuiBox-root mui-1vu004u">participantId</span> fields. A range lookup on the <span class="MuiBox-root mui-1vu004u">chatId</span> will give us all participants for a given chat.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We'll need a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/deep-dives/dynamodb#global-secondary-indexes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Global Secondary Index (GSI)</a> with <span class="MuiBox-root mui-1vu004u">participantId</span> as the partition key and <span class="MuiBox-root mui-1vu004u">chatId</span> as the sort key. This will allow us to efficiently query all chats for a given user. The GSI will automatically be kept in sync with the base table by DynamoDB.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Great! We got some chats. How about messages?</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-users-should-be-able-to-sendreceive-messages">2) Users should be able to send/receive messages.</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To allow users to send/receive messages, we're going to need to start taking advantage of the websocket connection that we established. To keep things simple while we get off the ground, let's assume we have a single host for our Chat Server.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This is obviously a terrible solution for scale (and you might say so to your interviewer to keep them from itching), but it's a good starting point that will allow us to incrementally solve those problems as we go.</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For infrastructure-style interviews, I highly recommend reasoning about a solution on a single host first. Oftentimes the path to scale is straightforward from there. On the other hand if you solve scale first without thinking about how the actual mechanics of your solution work underneath, you're likely to back yourself into a corner.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When users make Websocket connections to our Chat Server, we'll want to keep track of their connection with a simple hash map which will map a user id to a websocket connection. This way we know which users are connected and can send them messages.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To send a message:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User sends a <span class="MuiBox-root mui-1vu004u">sendMessage</span> message to the Chat Server.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Chat Server looks up all participants in the chat via the <span class="MuiBox-root mui-1vu004u">ChatParticipant</span> table.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Chat Server looks up the websocket connection for each participant in its internal hash table and sends the message via each connection.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We're making some really strong assumptions here! We're assuming all users are online, connected to the same Chat Server, and that we have a websocket connection for each of them. But under those conditions we're moving, so let's keep going.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-users-should-be-able-to-receive-messages-sent-while-they-are-not-online-up-to-30-days">3) Users should be able to receive messages sent while they are not online (up to 30 days).</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With our next requirement, we're forced to undo some of those assumptions. We're going to need to start storing messages in our database so that we can deliver them to users even when they're offline. We'll take this as an opportunity to add some robustness to our system.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's keep an "Inbox" for each user which will contain all undelivered messages. When messages are sent, we'll write them to the inbox of each recipient user. If they're already online, we can go ahead and try to deliver the message immediately. If they're not online, we'll store the message and wait for them to come back later.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1264.8235931396484 729.353515625">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1264.8235931396484" height="729.353515625" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(496.6611328125 243.7724609375) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C66.25 1.13, 105.15 -0.1, 124.82 0 M32 0 C61.28 -0.02, 89.41 0.21, 124.82 0 M124.82 0 C145.35 0.23, 155.05 10.36, 156.82 32 M124.82 0 C147.46 -1.38, 156.1 8.38, 156.82 32 M156.82 32 C157.81 48.31, 158.08 66.14, 156.82 99.82 M156.82 32 C156.18 51.02, 155.88 69.17, 156.82 99.82 M156.82 99.82 C158.5 120.09, 148.1 130.05, 124.82 131.82 M156.82 99.82 C156.91 122.57, 147.96 132.46, 124.82 131.82 M124.82 131.82 C92.75 130.53, 59.07 131.68, 32 131.82 M124.82 131.82 C89.36 133.53, 54.51 133.64, 32 131.82 M32 131.82 C9.23 132.82, -0.55 122.83, 0 99.82 M32 131.82 C9.56 133.36, 2.01 123.3, 0 99.82 M0 99.82 C0.64 78.11, 0.49 61.26, 0 32 M0 99.82 C-0.47 76.07, -1.32 53.35, 0 32 M0 32 C0.11 12.56, 11.12 -1.27, 32 0 M0 32 C0.93 12.32, 12.27 -1.99, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(515.5232925415039 297.1845703125) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(778.0048828125 254.1044921875) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C70.58 1.01, 111.15 1.01, 145.65 0 M31.01 0 C72.44 -0.89, 113.79 -1.16, 145.65 0 M145.65 0 C167.45 -1.2, 176.02 8.35, 176.66 31.01 M145.65 0 C165.19 1.99, 177.43 10.8, 176.66 31.01 M176.66 31.01 C176.35 45.9, 175.09 63.59, 176.66 93.02 M176.66 31.01 C177.23 51.65, 177.37 72.47, 176.66 93.02 M176.66 93.02 C176.73 114.92, 167.89 124.58, 145.65 124.03 M176.66 93.02 C178.01 113.81, 164.92 125.45, 145.65 124.03 M145.65 124.03 C116.99 125, 86.94 123.63, 31.01 124.03 M145.65 124.03 C100.38 125.67, 56.27 126, 31.01 124.03 M31.01 124.03 C9.38 125.36, 1.75 115.56, 0 93.02 M31.01 124.03 C10.19 123.82, 1.68 114.36, 0 93.02 M0 93.02 C0.61 81.23, -2.07 66.88, 0 31.01 M0 93.02 C0.61 80.8, 0.79 66.05, 0 31.01 M0 31.01 C0.81 11.77, 11.73 -1.73, 31.01 0 M0 31.01 C1.04 9.83, 10.86 -0.19, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(808.0330505371094 291.1181640625) rotate(0 58.299957275390625 25)"><text x="58.299957275390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text><text x="58.299957275390625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(666.3603515625 314.4453248125696) rotate(0 46.234375 0.267096791421487)"><path d="M-0.41 1.05 C14.85 1.04, 76.68 0.79, 91.98 0.67 M1.58 0.56 C16.59 0.69, 75.42 2.11, 90.78 2.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(666.3603515625 314.4453248125696) rotate(0 46.234375 0.267096791421487)"><path d="M62.41 12.03 C73.75 8, 81.87 3.72, 90.78 2.28 M62.41 12.03 C70.12 8.43, 78.02 7.51, 90.78 2.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(666.3603515625 314.4453248125696) rotate(0 46.234375 0.267096791421487)"><path d="M62.78 -8.49 C74.13 -5.54, 82.13 -2.84, 90.78 2.28 M62.78 -8.49 C70.5 -6.25, 78.3 -1.32, 90.78 2.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(1054.8447265625 87.3251953125) rotate(0 58.799964904785156 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  name</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  metadata</text></g><g transform="translate(1053.4080657958984 243.8642578125) rotate(0 78.24993133544922 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">ChatParticipant</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  chatId</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  participantId</text></g><g stroke-linecap="round" transform="translate(1007.3587493896484 10) rotate(0 123.732421875 159.720703125)"><path d="M32 0 C101.66 -1.28, 172.25 -1.12, 215.46 0 M215.46 0 C238.12 1.9, 247.77 11.29, 247.46 32 M247.46 32 C249.61 99.43, 248.92 168.2, 247.46 287.44 M247.46 287.44 C245.8 308.06, 235.13 319.36, 215.46 319.44 M215.46 319.44 C176 319.36, 133.54 320.93, 32 319.44 M32 319.44 C12.59 319.02, 0.91 310.57, 0 287.44 M0 287.44 C-3.07 211.05, -0.62 132.18, 0 32 M0 32 C1.72 11.91, 11.42 1.95, 32 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(1103.7532806396484 31.7109375) rotate(0 33.17998504638672 17.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat</text></g><g transform="translate(1045.6865234375 437.8623046875) rotate(0 61.029945373535156 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Inbox</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  recipientId</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  messageId</text></g><g transform="translate(1035.2459564208984 563.8896484375) rotate(0 58.64994812011719 62.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Message</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  contents</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  creatorId</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text></g><g stroke-linecap="round" transform="translate(998.2005462646484 360.130859375) rotate(0 127.10546875 179.611328125)"><path d="M32 0 C89.02 0.51, 144.21 0.47, 222.21 0 M222.21 0 C241.61 -0.06, 252.41 9.09, 254.21 32 M254.21 32 C254.11 126.54, 254.54 222.48, 254.21 327.22 M254.21 327.22 C255.86 349.7, 243.01 361.04, 222.21 359.22 M222.21 359.22 C172.59 359.21, 125.26 361.45, 32 359.22 M32 359.22 C12.28 359.83, -0.94 347.66, 0 327.22 M0 327.22 C0.04 239.82, 0.37 155.3, 0 32 M0 32 C-0.4 10.18, 9.99 -0.2, 32 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(1055.9661712646484 381.005859375) rotate(0 72.79998016357422 17.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Messsages</text></g><g stroke-linecap="round" transform="translate(10 233.974609375) rotate(0 79.794921875 79.705078125)"><path d="M99.03 2.18 C109.39 3.12, 120.36 9.21, 128.77 15.81 C137.18 22.4, 144.34 32.1, 149.51 41.73 C154.68 51.37, 159 62.74, 159.77 73.63 C160.54 84.53, 157.84 96.94, 154.1 107.1 C150.37 117.27, 144.62 127.05, 137.38 134.62 C130.14 142.18, 120.45 148.3, 110.66 152.5 C100.88 156.69, 89.62 160.07, 78.67 159.78 C67.73 159.49, 54.92 155.52, 44.99 150.75 C35.06 145.98, 26.02 139.29, 19.07 131.15 C12.12 123.02, 6.44 112.35, 3.29 101.93 C0.13 91.51, -1.28 79.2, 0.13 68.65 C1.54 58.09, 6.13 47.74, 11.75 38.61 C17.38 29.48, 24.81 19.92, 33.87 13.87 C42.92 7.83, 54.41 3.9, 66.09 2.32 C77.77 0.74, 96.78 3.46, 103.96 4.4 C111.15 5.33, 109.63 6.71, 109.2 7.94 M49.72 6.52 C58.95 1.59, 71.28 0.01, 81.84 0.41 C92.41 0.81, 103.21 4.61, 113.12 8.91 C123.02 13.21, 134.35 18.32, 141.28 26.22 C148.2 34.12, 151.54 45.77, 154.66 56.31 C157.78 66.85, 161.3 78.66, 160.01 89.48 C158.71 100.3, 152.42 112.09, 146.92 121.23 C141.41 130.36, 135.72 138.07, 126.97 144.28 C118.21 150.49, 105.31 156.43, 94.36 158.47 C83.42 160.51, 71.52 159.2, 61.28 156.52 C51.04 153.83, 41.55 148.58, 32.93 142.36 C24.32 136.13, 14.96 128.57, 9.59 119.17 C4.22 109.77, 1.76 96.69, 0.69 85.95 C-0.38 75.21, -0.41 64.78, 3.17 54.74 C6.75 44.69, 14.84 33.63, 22.18 25.69 C29.52 17.75, 42.46 10.17, 47.21 7.1 C51.96 4.04, 50.09 6.25, 50.66 7.31" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(62.82141897875704 301.31968626280894) rotate(0 27.049972534179688 12.499999999999998)"><text x="27.049972534179688" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g transform="translate(162.07421875 217.7265625) rotate(0 49.859954833984375 25)"><text x="49.859954833984375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">WS </text><text x="49.859954833984375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Connection</text></g><g stroke-linecap="round" transform="translate(259.68394470214844 250.2666015625) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C69.96 -1.22, 105.33 0.27, 124.82 0 M32 0 C64.73 0.52, 95.84 1.13, 124.82 0 M124.82 0 C144.53 1.77, 157.62 9.61, 156.82 32 M124.82 0 C144.02 -0.23, 155.95 10.62, 156.82 32 M156.82 32 C156.53 49.97, 155.13 65.64, 156.82 99.82 M156.82 32 C158.23 59.45, 158.45 85.21, 156.82 99.82 M156.82 99.82 C157.92 119.55, 145.06 130.79, 124.82 131.82 M156.82 99.82 C158.45 121.46, 147.09 132.43, 124.82 131.82 M124.82 131.82 C98.06 130.65, 74.4 133.94, 32 131.82 M124.82 131.82 C97.86 131.6, 68.56 132.44, 32 131.82 M32 131.82 C9.97 130.7, 1.59 119.86, 0 99.82 M32 131.82 C10.07 133.15, 0.6 120.15, 0 99.82 M0 99.82 C0.04 82.94, 0.58 71.75, 0 32 M0 99.82 C0.61 80.75, 1.26 62.9, 0 32 M0 32 C-1.13 12.33, 9.76 -1.8, 32 0 M0 32 C-1.21 10.86, 12.22 -1.07, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(307.4460678100586 303.6787109375) rotate(0 30.649986267089844 12.5)"><text x="30.649986267089844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">L4 LB</text></g><g stroke-linecap="round"><g transform="translate(177.67808532714844 308.4755859375) rotate(0 34.798828125 -0.796875)"><path d="M0.16 0.52 C11.93 0.14, 58.17 -2.29, 69.91 -2.72 M-1.22 -0.25 C10.49 -0.49, 57.19 -1.66, 69.13 -1.77" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(177.67808532714844 308.4755859375) rotate(0 34.798828125 -0.796875)"><path d="M41.13 9 C48.72 6.92, 52.66 5.56, 69.13 -1.77 M41.13 9 C47.73 6.96, 56.36 2.69, 69.13 -1.77" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(177.67808532714844 308.4755859375) rotate(0 34.798828125 -0.796875)"><path d="M40.76 -11.51 C48.36 -8.7, 52.39 -5.16, 69.13 -1.77 M40.76 -11.51 C47.48 -8.12, 56.21 -6.95, 69.13 -1.77" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(429.8673629760742 312.4736328125) rotate(0 26.9296875 -0.751953125)"><path d="M0.9 0.34 C9.9 0.31, 45.09 -0.51, 54.03 -0.72 M-0.08 -0.53 C8.77 -0.85, 44.13 -2.03, 53.17 -2.43" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(429.8673629760742 312.4736328125) rotate(0 26.9296875 -0.751953125)"><path d="M28.23 7.74 C36.37 4.77, 44.63 2.6, 53.17 -2.43 M28.23 7.74 C36.57 3.81, 45.95 0.75, 53.17 -2.43" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(429.8673629760742 312.4736328125) rotate(0 26.9296875 -0.751953125)"><path d="M27.52 -10.67 C35.79 -8.09, 44.28 -4.71, 53.17 -2.43 M27.52 -10.67 C36.03 -8.18, 45.65 -4.82, 53.17 -2.43" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Send a Message</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">So, to send a message:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User sends a <span class="MuiBox-root mui-1vu004u">sendMessage</span> message to the Chat Server.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Chat Server looks up all participants in the chat via the <span class="MuiBox-root mui-1vu004u">ChatParticipant</span> table.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Chat Server creates a transaction which both (a) writes the message to our <span class="MuiBox-root mui-1vu004u">Message</span> table and (b) creates an entry in our <span class="MuiBox-root mui-1vu004u">Inbox</span> table for each recipient.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Chat Server returns a <span class="MuiBox-root mui-1vu004u">SUCCESS</span> or <span class="MuiBox-root mui-1vu004u">FAILURE</span> to the user with the final message id.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Chat Server looks up the websocket connection for each participant and attempts to deliver the message to each of them via <span class="MuiBox-root mui-1vu004u">newMessage</span>.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">(For connected clients) Upon receipt, the client will send an <span class="MuiBox-root mui-1vu004u">ack</span> message to the Chat Server to indicate they've received the message. The Chat Server will then delete the message from the <span class="MuiBox-root mui-1vu004u">Inbox</span> table.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For clients who aren't connected, we'll keep the messages in the <span class="MuiBox-root mui-1vu004u">Inbox</span> table. Once the client connects to our service later, we'll:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Look up the user's <span class="MuiBox-root mui-1vu004u">Inbox</span> and find any undelivered message IDs.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For each message ID, look up the message in the <span class="MuiBox-root mui-1vu004u">Message</span> table.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Write those messages to the client's connection via the <span class="MuiBox-root mui-1vu004u">newMessage</span> message.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Upon receipt, the client will send an <span class="MuiBox-root mui-1vu004u">ack</span> message to the Chat Server to indicate they've received the message.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Chat Server will then delete the message from the <span class="MuiBox-root mui-1vu004u">Inbox</span> table.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Finally, we'll need to periodically clean up the old messages in the <span class="MuiBox-root mui-1vu004u">Inbox</span> and messages tables. We can do this with a simple cron job which will delete messages older than 30 days.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Great! We knocked out some of the durability issues of our initial solution and enabled offline delivery. Our solution still doesn't scale and we've got a lot more work to do, so let's keep moving.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="4-users-should-be-able-to-sendreceive-media-in-their-messages">4) Users should be able to send/receive media in their messages.</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our final requirement is that users should be able to send/receive media in their messages.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Users sending and receiving media is annoying. It's bandwidth- and storage- intensive. While we could potentially do this with our Chat Server and database, it's better to use purpose-built technologies for this. This is in fact how Whatsapp actually works: attachments are uploaded via a separate HTTP service.</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Keep attachments in DB</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The worst approach is to have the Chat Server accept the attachment media over our websocket connection and save it in our database. Then we'll need to add an additional message type for users to retrieve attachments.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 669.828125 179.41015625">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="669.828125" height="179.41015625" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 10) rotate(0 79.794921875 79.705078125)"><path d="M108.05 5.32 C118.1 7.66, 128.92 14.24, 136.43 21.75 C143.94 29.26, 149.35 40.2, 153.1 50.38 C156.85 60.57, 159.09 71.97, 158.94 82.85 C158.79 93.74, 156.87 105.99, 152.19 115.67 C147.5 125.35, 139.42 134.04, 130.81 140.95 C122.2 147.85, 110.93 154.02, 100.55 157.1 C90.17 160.18, 79.19 161.23, 68.54 159.41 C57.88 157.59, 45.94 151.99, 36.65 146.19 C27.35 140.39, 18.86 133.63, 12.79 124.63 C6.72 115.63, 1.84 103.01, 0.22 92.18 C-1.4 81.35, 0.06 70.02, 3.06 59.65 C6.06 49.27, 11.45 38.4, 18.21 29.96 C24.97 21.51, 34.15 13.91, 43.61 8.98 C53.07 4.04, 63.91 0.86, 74.97 0.35 C86.04 -0.16, 103.66 4.44, 110.01 5.9 C116.36 7.37, 113.41 7.93, 113.1 9.12 M91.66 1.53 C101.79 2.1, 113.35 6.98, 122.43 12.86 C131.51 18.74, 140.33 27.91, 146.15 36.81 C151.96 45.71, 155.51 55.9, 157.3 66.25 C159.09 76.6, 159.2 88.33, 156.87 98.89 C154.55 109.45, 150.28 120.79, 143.35 129.61 C136.41 138.43, 124.92 146.97, 115.26 151.82 C105.61 156.67, 95.85 158.47, 85.43 158.7 C75.01 158.94, 62.83 156.89, 52.74 153.24 C42.65 149.6, 32.85 144.13, 24.9 136.86 C16.94 129.58, 9.26 119.74, 5 109.61 C0.75 99.48, -1.05 86.86, -0.61 76.07 C-0.17 65.27, 2.86 54.35, 7.67 44.84 C12.47 35.33, 19.81 26.23, 28.2 18.99 C36.59 11.76, 47.21 4.51, 57.99 1.44 C68.77 -1.64, 87.42 0.45, 92.9 0.54 C98.38 0.64, 91.17 0.85, 90.88 2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(65.42803213793673 77.34507688780894) rotate(0 24.443359375 12.5)"><text x="24.443359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g stroke-linecap="round" transform="translate(262.59765625 19.96484375) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C61.4 1.08, 93.05 0.68, 124.82 0 M32 0 C67.88 -0.86, 104.65 0.23, 124.82 0 M124.82 0 C147.84 -0.93, 155.1 9.49, 156.82 32 M124.82 0 C147.87 -2.1, 154.76 11.99, 156.82 32 M156.82 32 C159.23 49.9, 158.05 68.71, 156.82 99.82 M156.82 32 C156.58 47.51, 156.07 62.41, 156.82 99.82 M156.82 99.82 C158.1 119.69, 146.11 132.68, 124.82 131.82 M156.82 99.82 C156.31 121.64, 145.77 133.37, 124.82 131.82 M124.82 131.82 C103.32 133.3, 84.43 130.03, 32 131.82 M124.82 131.82 C89.19 130.76, 52.97 131.73, 32 131.82 M32 131.82 C9.99 132.88, -0.92 121.09, 0 99.82 M32 131.82 C9.49 133.05, -1.42 122.48, 0 99.82 M0 99.82 C0.19 81.36, 0.03 65.33, 0 32 M0 99.82 C-0.37 85.53, 0.8 70.4, 0 32 M0 32 C-0.65 10.45, 12.15 1.65, 32 0 M0 32 C-1.88 10.27, 12.3 -0.51, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(293.5244140625 73.376953125) rotate(0 47.4853515625 12.5)"><text x="47.4853515625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(483.171875 21.671875) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C68.28 1.33, 102.22 -0.12, 145.65 0 M31.01 0 C57.24 -0.82, 80.94 -0.95, 145.65 0 M145.65 0 C167.81 -1.83, 174.86 11.48, 176.66 31.01 M145.65 0 C165.58 2.3, 175.95 12.32, 176.66 31.01 M176.66 31.01 C175.27 48.07, 176.41 66.53, 176.66 93.02 M176.66 31.01 C176.97 51.72, 176.31 74.32, 176.66 93.02 M176.66 93.02 C176.21 114.11, 165.99 125.37, 145.65 124.03 M176.66 93.02 C174.79 113.07, 166.1 122.69, 145.65 124.03 M145.65 124.03 C104.12 124.21, 58.19 124.37, 31.01 124.03 M145.65 124.03 C119.17 124.85, 92.9 124.28, 31.01 124.03 M31.01 124.03 C9.31 125.09, -1.23 114.84, 0 93.02 M31.01 124.03 C9.44 121.83, 1.85 113.16, 0 93.02 M0 93.02 C-1.58 75.25, 0.13 58.79, 0 31.01 M0 93.02 C-0.5 73.99, 0.57 56, 0 31.01 M0 31.01 C-1.63 9.99, 11.76 -0.44, 31.01 0 M0 31.01 C1.82 12.46, 11.25 -2.02, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(534.8544921875 71.185546875) rotate(0 36.6455078125 12.5)"><text x="36.6455078125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text></g><g stroke-linecap="round"><g transform="translate(176.4226481908961 90.15518253783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M-0.14 -0.94 C10.1 -0.88, 51.73 0.41, 62.15 0.49 M-1.68 1.18 C8.41 0.86, 50.98 -1.33, 61.61 -1.43" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.4226481908961 90.15518253783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M33.78 9.76 C42.23 7.06, 54.46 3.41, 61.61 -1.43 M33.78 9.76 C41.67 6.18, 47.08 4.83, 61.61 -1.43" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.4226481908961 90.15518253783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M33.1 -10.75 C41.82 -6.05, 54.29 -2.31, 61.61 -1.43 M33.1 -10.75 C40.99 -9.13, 46.57 -5.29, 61.61 -1.43" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(432.296875 87.03826022181852) rotate(0 15.849609375000057 -0.4425150242687721)"><path d="M0.46 -0.26 C5.61 -0.49, 25.95 -1.02, 31.23 -1.21 M0.04 0.8 C5.32 0.62, 26.89 -0.37, 32.22 -0.68" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(432.296875 87.03826022181852) rotate(0 15.849609375000057 -0.4425150242687721)"><path d="M17.61 5.49 C22.56 2.5, 27.8 1.52, 32.22 -0.68 M17.61 5.49 C20.56 4.56, 23.61 3.22, 32.22 -0.68" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(432.296875 87.03826022181852) rotate(0 15.849609375000057 -0.4425150242687721)"><path d="M17.06 -5.34 C22.23 -4.38, 27.67 -1.41, 32.22 -0.68 M17.06 -5.34 C20.08 -4.01, 23.24 -3.09, 32.22 -0.68" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Attachments in DB</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This is not a good solution. First, most databases (including DynamoDB) aren't optimized for handling large binary blobs. Second, we're crippling the bandwidth available to our Chat Servers by occupying them with comparitively dumb storage and retrieval. There are better solutions!</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Send attachments via chat server</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-1">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A straightforward approach is to have the Chat Server accept the attachment media, then push it off to blob storage with a TTL of 30 days (remember we don't need to keep messages forever!).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Users who want to retrieve a particular attachment can then query the blob storage directly (via a pre-signed URL for authorization). Ideally, we'd find a way to expire the media once it had been received by all recipients. While we could put a CDN in front of our blob storage, since we're capped at 100 participants the cache benefits are going to be relatively small.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 669.828125 346.54296875">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="669.828125" height="346.54296875" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 177.1328125) rotate(0 79.794921875 79.705078125)"><path d="M67.35 1.77 C77.46 -1.1, 89.79 0.69, 100.01 3.32 C110.24 5.95, 120.13 10.88, 128.68 17.54 C137.23 24.2, 146.15 33.78, 151.31 43.26 C156.48 52.74, 159.29 63.87, 159.69 74.41 C160.09 84.96, 157.59 96.51, 153.72 106.52 C149.85 116.53, 143.8 126.68, 136.46 134.48 C129.13 142.27, 119.76 149.08, 109.7 153.29 C99.64 157.49, 87.03 160.15, 76.11 159.69 C65.19 159.22, 53.87 155.18, 44.16 150.48 C34.46 145.78, 24.64 139.72, 17.87 131.49 C11.1 123.26, 6.23 111.6, 3.53 101.08 C0.84 90.55, 0.22 78.85, 1.7 68.32 C3.18 57.8, 6.71 46.98, 12.4 37.93 C18.08 28.88, 25.3 20.35, 35.81 14.02 C46.32 7.68, 67.25 1.81, 75.46 -0.07 C83.67 -1.95, 85 1.22, 85.04 2.71 M51.19 6.23 C60.24 1.38, 74.21 -1.86, 85.17 -1.33 C96.12 -0.81, 107.4 4, 116.92 9.38 C126.44 14.77, 135.46 22.38, 142.3 30.99 C149.14 39.59, 155.46 50.66, 157.94 61.02 C160.43 71.38, 159.32 82.46, 157.22 93.15 C155.12 103.85, 151.12 116.11, 145.33 125.18 C139.55 134.25, 131.35 142.19, 122.52 147.56 C113.7 152.94, 102.92 156.05, 92.4 157.44 C81.88 158.84, 70.22 158.75, 59.4 155.91 C48.58 153.07, 35.82 147.02, 27.49 140.42 C19.16 133.82, 13.76 125.97, 9.42 116.31 C5.09 106.65, 2.2 93.33, 1.46 82.44 C0.71 71.54, 1.4 60.79, 4.96 50.96 C8.51 41.13, 15 31.19, 22.8 23.45 C30.59 15.71, 46.63 7.54, 51.71 4.53 C56.78 1.52, 52.67 4.22, 53.23 5.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(62.82141897875704 244.47788938780894) rotate(0 27.049972534179688 12.5)"><text x="27.049972534179688" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g stroke-linecap="round" transform="translate(262.59765625 187.09765625) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C64.55 -0.06, 101.19 0.38, 124.82 0 M32 0 C61.4 0.42, 91.61 1.28, 124.82 0 M124.82 0 C145.18 -0.9, 157.51 10.17, 156.82 32 M124.82 0 C144.63 -1.18, 158.89 11.97, 156.82 32 M156.82 32 C157.47 52.92, 157.93 71.73, 156.82 99.82 M156.82 32 C157.67 51.76, 157.5 71.29, 156.82 99.82 M156.82 99.82 C158.6 120.23, 145.1 133.47, 124.82 131.82 M156.82 99.82 C157.38 118.87, 146.39 132.3, 124.82 131.82 M124.82 131.82 C98.69 130.69, 69.75 131.13, 32 131.82 M124.82 131.82 C89.17 131.43, 52.95 131.79, 32 131.82 M32 131.82 C8.75 130.89, 1.47 122.71, 0 99.82 M32 131.82 C12.8 130.9, -0.99 122.07, 0 99.82 M0 99.82 C-0.94 85.7, -1.75 70.13, 0 32 M0 99.82 C0.69 82.2, 0.14 66.03, 0 32 M0 32 C1.63 11.17, 11.56 0.12, 32 0 M0 32 C0.07 10.87, 10.88 0, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(281.4598159790039 240.509765625) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(483.171875 188.8046875) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C70.08 -1.03, 106.31 -2.4, 145.65 0 M31.01 0 C60.13 -0.95, 90.56 -0.75, 145.65 0 M145.65 0 C164.99 -1.02, 178.45 11.47, 176.66 31.01 M145.65 0 C165.94 1.97, 177.02 10.41, 176.66 31.01 M176.66 31.01 C176.72 54.49, 177.7 80.65, 176.66 93.02 M176.66 31.01 C178.04 47.64, 176.63 66.02, 176.66 93.02 M176.66 93.02 C177.14 111.7, 166.52 124.44, 145.65 124.03 M176.66 93.02 C176.6 114.9, 167.64 125.76, 145.65 124.03 M145.65 124.03 C122.62 123.29, 96.7 124.59, 31.01 124.03 M145.65 124.03 C118.79 123.13, 94.58 124.37, 31.01 124.03 M31.01 124.03 C12.19 123.22, -0.86 114.49, 0 93.02 M31.01 124.03 C8.54 125.09, -0.42 112.98, 0 93.02 M0 93.02 C-0.56 71.16, 1.13 51.19, 0 31.01 M0 93.02 C0.81 78.95, 0.44 64.44, 0 31.01 M0 31.01 C0.06 10.52, 10.52 0, 31.01 0 M0 31.01 C-1.47 10.87, 11.57 1.73, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(522.0600357055664 238.318359375) rotate(0 49.439964294433594 12.5)"><text x="49.439964294433594" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text></g><g stroke-linecap="round"><g transform="translate(176.4226481908961 257.28799503783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M-1.04 -0.5 C9.04 -0.21, 49.96 0.63, 60.27 0.64 M0.61 -1.81 C11.07 -1.79, 52.55 -1.61, 62.4 -1.21" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.4226481908961 257.28799503783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M34.02 8.51 C41.27 4.18, 50.97 2.3, 62.4 -1.21 M34.02 8.51 C40.56 5.59, 49.36 4.19, 62.4 -1.21" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.4226481908961 257.28799503783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M34.41 -12.01 C41.37 -10.56, 50.96 -6.65, 62.4 -1.21 M34.41 -12.01 C40.93 -9.7, 49.63 -5.86, 62.4 -1.21" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(432.296875 254.17107272181852) rotate(0 15.849609375000057 -0.4425150242687721)"><path d="M-0.27 -0.25 C5.13 -0.46, 26.62 -0.87, 31.89 -1.02 M0.59 0.82 C5.98 0.67, 26.24 -0.14, 31.55 -0.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(432.296875 254.17107272181852) rotate(0 15.849609375000057 -0.4425150242687721)"><path d="M16.9 5.67 C19.58 4.71, 22.79 2.65, 31.55 -0.39 M16.9 5.67 C20.45 4.46, 24.23 2.62, 31.55 -0.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(432.296875 254.17107272181852) rotate(0 15.849609375000057 -0.4425150242687721)"><path d="M16.43 -5.17 C19.23 -3.87, 22.54 -3.67, 31.55 -0.39 M16.43 -5.17 C20.15 -3.68, 24.04 -2.82, 31.55 -0.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(264.5859375 10) rotate(0 76.556640625 38.82421875)"><path d="M19.41 0 C47.63 -1.72, 75.81 1.4, 133.7 0 M19.41 0 C60.32 -0.95, 101.76 -0.72, 133.7 0 M133.7 0 C147.92 -0.1, 152.75 7.36, 153.11 19.41 M133.7 0 C148.88 -0.56, 154.96 4.83, 153.11 19.41 M153.11 19.41 C154.57 34.99, 150.94 49.82, 153.11 58.24 M153.11 19.41 C153.68 32.62, 152.27 44.42, 153.11 58.24 M153.11 58.24 C151.88 73, 146.61 78.4, 133.7 77.65 M153.11 58.24 C154.58 69.47, 148.27 76.78, 133.7 77.65 M133.7 77.65 C111.91 80.34, 86.21 77.63, 19.41 77.65 M133.7 77.65 C94.69 77.87, 56.52 77.46, 19.41 77.65 M19.41 77.65 C6.88 76.64, -0.39 71.86, 0 58.24 M19.41 77.65 C7.75 76.06, 0.03 71.36, 0 58.24 M0 58.24 C0.02 43.49, 0.08 28.8, 0 19.41 M0 58.24 C0.78 47.34, -0.68 35.68, 0 19.41 M0 19.41 C1.95 5.09, 5.57 -1.45, 19.41 0 M0 19.41 C-1.81 6.02, 7.09 0.43, 19.41 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(276.9026336669922 36.32421875) rotate(0 64.23994445800781 12.5)"><text x="64.23994445800781" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Blob Storage</text></g><g stroke-linecap="round"><g transform="translate(334.3698334014357 173.20703125) rotate(0 0.9609166007068097 -36.927734375)"><path d="M-0.2 1.03 C-0.03 -11.39, 1.59 -61.39, 2.11 -73.82 M-1.76 0.52 C-1.82 -11.74, 0.52 -60.16, 1.26 -72.26" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334.3698334014357 173.20703125) rotate(0 0.9609166007068097 -36.927734375)"><path d="M10.02 -43.57 C8.16 -54.45, 3.09 -64.25, 1.26 -72.26 M10.02 -43.57 C6.79 -52.49, 5.09 -62.53, 1.26 -72.26" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334.3698334014357 173.20703125) rotate(0 0.9609166007068097 -36.927734375)"><path d="M-10.48 -44.65 C-4.34 -55.08, -1.42 -64.46, 1.26 -72.26 M-10.48 -44.65 C-7.01 -53.21, -2.03 -62.9, 1.26 -72.26" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(135.8686274082857 171.14290103641878) rotate(0 55.22584254585715 -44.25432041708774)"><path d="M0.19 0.04 C18.8 -14.83, 92.96 -73.43, 111.47 -88.2 M-1.17 -0.99 C17.39 -15.72, 92.38 -75.77, 111.05 -90.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(135.8686274082857 171.14290103641878) rotate(0 55.22584254585715 -44.25432041708774)"><path d="M95.26 -64.65 C99.58 -70.21, 104.52 -77.85, 111.05 -90.15 M95.26 -64.65 C100.93 -72.48, 105.42 -80.47, 111.05 -90.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(135.8686274082857 171.14290103641878) rotate(0 55.22584254585715 -44.25432041708774)"><path d="M82.56 -80.77 C90.62 -81.78, 99.15 -84.85, 111.05 -90.15 M82.56 -80.77 C91.95 -83.91, 100.18 -87.14, 111.05 -90.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(81.171875 92.81640625) rotate(0 57.28996276855469 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Read Media</text></g><g transform="translate(353.73828125 130.1328125) rotate(0 57.74995422363281 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write Media</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Use Blob Storage"</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-1">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Unfortunately, our Chat Servers still have to handle the incoming media and forward it to the blob storage (a wasted step). Expiring attachments once they've been downloaded by all recipients isn't handled. Managing encryption and security will require extra steps.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Manage attachments separately</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-2">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">An ideal approach is that we give our users permission (e.g. via pre-signed URLs) to upload directly to the blob storage. As an example, they might send a <span class="MuiBox-root mui-1vu004u">getAttachmentTarget</span> message to the Chat Server which returns a pre-signed URL. Once uploaded, the user will have a URL for the attachment which they can send to the Chat Server as an opaque URL.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Then, our solution works much like the "Good" solution. Users who want to retrieve a particular attachment can then query the blob storage directly (via a pre-signed URL for authorization). Ideally, we'd find a way to expire the media once it had been received by all recipients. While we could put a CDN in front of our blob storage, since we're capped at 100 participants the cache benefits are going to be relatively small.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 669.828125 341.8125">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="669.828125" height="341.8125" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 130.23046875) rotate(0 79.794921875 79.705078125)"><path d="M101.7 3.06 C111.92 4.97, 123.43 13.1, 131.68 20 C139.94 26.91, 146.57 35, 151.24 44.5 C155.92 53.99, 159.49 66.17, 159.72 76.98 C159.95 87.8, 156.73 99.16, 152.63 109.38 C148.53 119.6, 142.9 130.64, 135.14 138.3 C127.37 145.95, 116.49 151.69, 106.05 155.32 C95.61 158.96, 83.3 160.97, 72.51 160.11 C61.73 159.25, 50.56 155.64, 41.36 150.17 C32.17 144.7, 23.85 135.9, 17.36 127.3 C10.88 118.69, 4.98 108.77, 2.48 98.54 C-0.03 88.3, 0.41 76.53, 2.33 65.86 C4.25 55.2, 8.18 43.45, 14 34.54 C19.81 25.63, 28.06 18.13, 37.22 12.42 C46.38 6.72, 57.08 1.51, 68.95 0.32 C80.83 -0.87, 101.42 3.93, 108.46 5.28 C115.5 6.63, 111.65 7.22, 111.2 8.43 M75.75 -0.85 C86.12 -2.19, 99.84 2.54, 110 6.78 C120.16 11.03, 129 16.79, 136.71 24.63 C144.41 32.46, 152.37 43.68, 156.24 53.8 C160.12 63.93, 160.89 74.67, 159.95 85.38 C159.01 96.09, 155.94 108.71, 150.59 118.04 C145.25 127.38, 136.46 134.95, 127.9 141.4 C119.34 147.85, 109.32 154.12, 99.22 156.75 C89.13 159.39, 78.14 159.18, 67.34 157.2 C56.54 155.23, 43.9 150.71, 34.44 144.91 C24.99 139.12, 16.39 131.39, 10.61 122.44 C4.83 113.49, 1.13 102.1, -0.23 91.22 C-1.58 80.35, -0.47 67.62, 2.48 57.19 C5.43 46.76, 10.36 37.07, 17.47 28.64 C24.58 20.21, 35.05 11.25, 45.14 6.6 C55.22 1.96, 72.47 1.7, 77.96 0.78 C83.46 -0.14, 78.18 -0.08, 78.08 1.09" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(62.82141897875704 197.575545637809) rotate(0 27.049972534179688 12.5)"><text x="27.049972534179688" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g stroke-linecap="round" transform="translate(262.59765625 140.1953125) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C56.56 -2.67, 83.77 -2.15, 124.82 0 M32 0 C52.48 -0.76, 71.93 -1.39, 124.82 0 M124.82 0 C148.06 -0.66, 157.69 12.45, 156.82 32 M124.82 0 C144.07 0.64, 157.4 12.94, 156.82 32 M156.82 32 C154.97 58.55, 155.88 81.6, 156.82 99.82 M156.82 32 C156.99 59.31, 157.14 84.64, 156.82 99.82 M156.82 99.82 C156.09 120.65, 144.4 130.63, 124.82 131.82 M156.82 99.82 C157.22 122.63, 145.35 132.21, 124.82 131.82 M124.82 131.82 C88.11 132.66, 52.39 130.86, 32 131.82 M124.82 131.82 C105.07 130.98, 82.92 131.08, 32 131.82 M32 131.82 C8.68 132.55, -1.33 121.8, 0 99.82 M32 131.82 C9.71 131.07, -1.9 121.48, 0 99.82 M0 99.82 C1.63 79.53, -0.09 56.69, 0 32 M0 99.82 C-0.46 81.08, 0.2 61.23, 0 32 M0 32 C1.28 10.65, 10.68 0.43, 32 0 M0 32 C-0.08 8.8, 11.87 0.29, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(281.4598159790039 193.607421875) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(483.171875 141.90234375) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C53.1 -0.95, 79.55 2.27, 145.65 0 M31.01 0 C62.29 0.81, 92.1 2.03, 145.65 0 M145.65 0 C164.5 0.56, 177.16 12.31, 176.66 31.01 M145.65 0 C167.95 -0.12, 176.67 8.24, 176.66 31.01 M176.66 31.01 C178.15 54.5, 175.03 76.75, 176.66 93.02 M176.66 31.01 C176.36 55.25, 175.85 79.4, 176.66 93.02 M176.66 93.02 C177 114.97, 165.62 124.36, 145.65 124.03 M176.66 93.02 C178.87 115.69, 167.18 124.12, 145.65 124.03 M145.65 124.03 C106.9 123.52, 70.81 125.22, 31.01 124.03 M145.65 124.03 C117.79 123.75, 91.25 123.71, 31.01 124.03 M31.01 124.03 C9.5 123.37, -1.65 113.97, 0 93.02 M31.01 124.03 C10.75 121.82, 1.38 114.82, 0 93.02 M0 93.02 C-0.07 70.77, 2.22 47.16, 0 31.01 M0 93.02 C0.45 70.7, -0.19 48.61, 0 31.01 M0 31.01 C-0.07 8.71, 11.39 0.25, 31.01 0 M0 31.01 C-1.27 10.87, 11.5 2.13, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(522.0600357055664 191.416015625) rotate(0 49.439964294433594 12.5)"><text x="49.439964294433594" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text></g><g stroke-linecap="round"><g transform="translate(176.4226481908961 210.38565128783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M0.91 -0.43 C11.4 -0.69, 51.67 -1.09, 61.94 -1.07 M-0.08 -1.69 C10.4 -1.9, 50.89 -0.58, 61.29 -0.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.4226481908961 210.38565128783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M32.76 9.11 C38.13 7.86, 42.98 6.82, 61.29 -0.16 M32.76 9.11 C39.42 6.66, 48.2 4.9, 61.29 -0.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.4226481908961 210.38565128783785) rotate(0 30.68516027955195 0.060688685384945984)"><path d="M33.48 -11.4 C38.79 -8.25, 43.48 -4.89, 61.29 -0.16 M33.48 -11.4 C40.04 -8.37, 48.62 -4.66, 61.29 -0.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(432.296875 207.26872897181852) rotate(0 15.849609375000057 -0.4425150242688005)"><path d="M0.52 -0.18 C5.8 -0.16, 26.83 -0.3, 31.94 -0.39 M0.13 -0.75 C5.33 -0.82, 26.27 -1.22, 31.63 -1.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(432.296875 207.26872897181852) rotate(0 15.849609375000057 -0.4425150242688005)"><path d="M16.74 4.34 C21.68 2.72, 27.82 -0.24, 31.63 -1.11 M16.74 4.34 C21.9 2.46, 26.5 0.33, 31.63 -1.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(432.296875 207.26872897181852) rotate(0 15.849609375000057 -0.4425150242688005)"><path d="M16.72 -6.51 C21.61 -4.36, 27.76 -3.55, 31.63 -1.11 M16.72 -6.51 C21.9 -4.83, 26.51 -3.4, 31.63 -1.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(262.6875 10) rotate(0 76.556640625 38.82421875)"><path d="M19.41 0 C66.33 -2.32, 110.24 0, 133.7 0 M19.41 0 C64.99 -0.85, 111.25 -0.4, 133.7 0 M133.7 0 C145.92 1.77, 153.7 5.12, 153.11 19.41 M133.7 0 C146.56 2.18, 153.37 6.31, 153.11 19.41 M153.11 19.41 C151.82 29.98, 154.29 39.16, 153.11 58.24 M153.11 19.41 C153.86 31.74, 153.73 44.58, 153.11 58.24 M153.11 58.24 C151.81 69.64, 146.88 77.24, 133.7 77.65 M153.11 58.24 C155.34 69.67, 145.59 76.36, 133.7 77.65 M133.7 77.65 C111.4 76.06, 87.15 75.24, 19.41 77.65 M133.7 77.65 C98.41 77.04, 62.55 76.18, 19.41 77.65 M19.41 77.65 C6.48 77.35, 0.33 73.17, 0 58.24 M19.41 77.65 C5.66 79.02, 0.72 71.36, 0 58.24 M0 58.24 C0.43 44.03, -1.62 31.02, 0 19.41 M0 58.24 C0.72 47.03, 1 33.02, 0 19.41 M0 19.41 C1.9 4.72, 7.54 0.99, 19.41 0 M0 19.41 C0.49 5.59, 4.4 -1.72, 19.41 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(275.0041961669922 36.32421875) rotate(0 64.23994445800781 12.5)"><text x="64.23994445800781" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Blob Storage</text></g><g stroke-linecap="round"><g transform="translate(146.1484375 130.609375) rotate(0 49.13671875 -29.974609375)"><path d="M0.01 -1.09 C16.38 -11.16, 82.8 -50.86, 99.11 -60.49 M-1.45 0.95 C14.76 -8.96, 82.21 -48.97, 98.6 -59.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(146.1484375 130.609375) rotate(0 49.13671875 -29.974609375)"><path d="M79.83 -35.83 C84.98 -43.13, 92.86 -53.92, 98.6 -59.24 M79.83 -35.83 C87.02 -43.85, 94.46 -53.97, 98.6 -59.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(146.1484375 130.609375) rotate(0 49.13671875 -29.974609375)"><path d="M69.17 -53.37 C78.27 -54.16, 90.1 -58.45, 98.6 -59.24 M69.17 -53.37 C80.55 -54.5, 92.14 -57.8, 98.6 -59.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(256.55078125 90.43359375) rotate(0 -48.71484375 26.724609375)"><path d="M0.83 -0.54 C-15.48 8.72, -81.54 45.65, -97.86 54.51 M-0.19 1.78 C-16.7 10.83, -82.79 44.32, -99.03 52.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(256.55078125 90.43359375) rotate(0 -48.71484375 26.724609375)"><path d="M-78.72 30.88 C-85.93 36.93, -89.35 44.86, -99.03 52.95 M-78.72 30.88 C-83.33 36.13, -88.54 41.08, -99.03 52.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(256.55078125 90.43359375) rotate(0 -48.71484375 26.724609375)"><path d="M-69.28 49.1 C-79.16 49.75, -85.42 52.2, -99.03 52.95 M-69.28 49.1 C-76.09 50.21, -83.49 50.92, -99.03 52.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(241.15625 192.3203125) rotate(0 -30.9140625 -0.919921875)"><path d="M-0.43 1.06 C-10.82 0.71, -51.24 -2.36, -61.48 -2.65 M1.54 0.58 C-9.04 0.41, -51.54 -1.03, -62.24 -1.54" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(241.15625 192.3203125) rotate(0 -30.9140625 -0.919921875)"><path d="M-33.67 -10.69 C-42.49 -6.82, -56.17 -4.1, -62.24 -1.54 M-33.67 -10.69 C-45.31 -7.34, -57.11 -4.08, -62.24 -1.54" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(241.15625 192.3203125) rotate(0 -30.9140625 -0.919921875)"><path d="M-34.47 9.82 C-42.91 6.11, -56.29 1.26, -62.24 -1.54 M-34.47 9.82 C-45.82 5.06, -57.3 0.23, -62.24 -1.54" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(339.47265625 97.80859375) rotate(0 -0.919921875 15.7890625)"><path d="M0.16 -0.37 C-0.12 4.9, -1.54 26.78, -1.86 32.1 M-0.42 0.63 C-0.75 5.99, -2.02 26.15, -2.3 31.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(339.47265625 97.80859375) rotate(0 -0.919921875 15.7890625)"><path d="M-6.83 16.25 C-6.1 20.22, -3.62 24.34, -2.3 31.4 M-6.83 16.25 C-5.88 20.46, -4.13 25.39, -2.3 31.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(339.47265625 97.80859375) rotate(0 -0.919921875 15.7890625)"><path d="M3.97 16.88 C1.84 20.7, 1.47 24.65, -2.3 31.4 M3.97 16.88 C1.76 20.9, 0.33 25.64, -2.3 31.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(363.828125 121.890625) rotate(0 -0.001953125 -12.23828125)"><path d="M-0.02 0.52 C-0.04 -3.5, 0.09 -20.32, 0.06 -24.51 M-0.69 0.31 C-0.79 -3.59, -0.35 -19.77, -0.34 -23.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(363.828125 121.890625) rotate(0 -0.001953125 -12.23828125)"><path d="M3.67 -12.27 C2.97 -16.01, 1.02 -20.11, -0.34 -23.83 M3.67 -12.27 C2.67 -15.26, 1.41 -18.59, -0.34 -23.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(363.828125 121.890625) rotate(0 -0.001953125 -12.23828125)"><path d="M-4.7 -12.4 C-2.65 -16.09, -1.83 -20.15, -0.34 -23.83 M-4.7 -12.4 C-3.4 -15.33, -2.36 -18.62, -0.34 -23.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(136.73828125 281.8125) rotate(0 78.1599349975586 25)"><text x="78.1599349975586" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Retrieve Upload</text><text x="78.1599349975586" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Target</text></g><g transform="translate(87.34738159179688 30.6875) rotate(0 54.679962158203125 25)"><text x="54.679962158203125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Read/Write</text><text x="54.679962158203125" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Media</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Use Presigned URLs</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-2">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Expiring attachments once they've been downloaded by all recipients isn't handled. Managing encryption and security will require extra steps.</div></div></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Ok awesome, so we have a system which has real-time delivery of messages, persistence to handle offline use-cases, and attachments.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="potential-deep-dives"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#deep-dives-10-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Potential Deep Dives</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With the core functional requirements met, it's time to dig into the non-functional requirements via deep dives and solve some of the issues we've earmarked to this point. This includes solving obvious scalability issues as well as auxillary questions which demonstrate your command of system design.</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The degree to which a candidate should proactively lead the deep dives is a function of their seniority. In this problem, all levels should be quick to point out that my single-host solution isn't going to scale. But beyond these bottlenecks, it's reasonable in a mid-level interview for the interviewer to drive the majority of the deep dives. However, in senior and staff+ interviews, the level of agency and ownership expected of the candidate increases. They should be able to proactively look around corners and identify potential issues with their design, proposing solutions to address them.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-how-can-we-handle-billons-of-simultaneous-users">1) How can we handle billons of simultaneous users?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our single-host system is convenient but unrealistic. Serving billions of users via a single machine isn't possible and it would make deployments and failures a nightmare. So what can we do? The obvious answer is to try to scale out the number of Chat Servers we have.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">If we have 1b users, we might expect 200m of them to be connected at any one time. Whatsapp famously served 1-2m users per host, but this will require us to have hundreds of chat servers. That's a lot of simultaneous connections (!).</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Note that I've included some back-of-the-envelope calculations here. Your interviewer will likely expect them, but you'll get more mileage from your calculations by doing them just-in-time: when you need to figure out a scaling bottleneck.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Adding more chat servers also introduces some new problems: now the sending and receiving users might be connected to different hosts. If User A is trying to send a message to User B and C, but User B and C are connected to different Chat Servers, we're going to have a problem.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 738.6116333007812 612.71484375">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="738.6116333007812" height="612.71484375" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 91.01171875) rotate(0 60.849609375 67.8359375)"><path d="M30.42 0 C50.36 -0.04, 68.74 -0.3, 91.27 0 M30.42 0 C42.81 1.04, 56.44 1.38, 91.27 0 M91.27 0 C112.46 0.74, 120.66 8.61, 121.7 30.42 M91.27 0 C111.74 1.63, 123.22 11.24, 121.7 30.42 M121.7 30.42 C119.86 57, 122.83 83.25, 121.7 105.25 M121.7 30.42 C121.2 54.43, 122.06 76.62, 121.7 105.25 M121.7 105.25 C122.38 126.89, 112.47 134.32, 91.27 135.67 M121.7 105.25 C122.26 125.55, 111.85 134.05, 91.27 135.67 M91.27 135.67 C74.99 134.78, 59.79 135.11, 30.42 135.67 M91.27 135.67 C66.63 135, 42.1 135.32, 30.42 135.67 M30.42 135.67 C8.94 135.98, 1.26 124.66, 0 105.25 M30.42 135.67 C8.54 136.59, 1.34 124.06, 0 105.25 M0 105.25 C-1.36 90.06, 1.14 74.42, 0 30.42 M0 105.25 C0.37 77.59, 0.81 48.28, 0 30.42 M0 30.42 C-1.6 9.61, 8.38 -1.57, 30.42 0 M0 30.42 C0.4 8.35, 7.87 -0.39, 30.42 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(36.94963073730469 146.34765625) rotate(0 33.89997863769531 12.5)"><text x="33.89997863769531" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User A</text></g><g stroke-linecap="round" transform="translate(13.572265625 272.21875) rotate(0 60.849609375 67.8359375)"><path d="M30.42 0 C52.28 0.66, 72.84 1.54, 91.27 0 M30.42 0 C49.85 -0.62, 71.2 -0.62, 91.27 0 M91.27 0 C109.58 -0.34, 121.73 10.18, 121.7 30.42 M91.27 0 C111.62 2.12, 119.7 7.98, 121.7 30.42 M121.7 30.42 C120.7 48.11, 120.19 68.01, 121.7 105.25 M121.7 30.42 C122.45 49.4, 121.93 67.33, 121.7 105.25 M121.7 105.25 C120.68 124.29, 110.75 135.36, 91.27 135.67 M121.7 105.25 C121.81 127.2, 111.35 136.66, 91.27 135.67 M91.27 135.67 C68.49 136.86, 49.05 136.86, 30.42 135.67 M91.27 135.67 C73.33 136.09, 54.88 136.02, 30.42 135.67 M30.42 135.67 C9.02 135.61, -1.82 125.09, 0 105.25 M30.42 135.67 C8.01 137.24, 0.47 126.01, 0 105.25 M0 105.25 C-1.43 85.02, -0.64 65.53, 0 30.42 M0 105.25 C-1.5 75.33, -1.04 47.37, 0 30.42 M0 30.42 C-0.22 11.26, 10.28 0.25, 30.42 0 M0 30.42 C-1.17 10.5, 8.89 1.32, 30.42 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(39.81189727783203 327.5546875) rotate(0 34.60997772216797 12.5)"><text x="34.60997772216797" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User B</text></g><g stroke-linecap="round" transform="translate(10.216796875 457.80078125) rotate(0 60.849609375 67.8359375)"><path d="M30.42 0 C51.75 1.79, 71.24 -0.54, 91.27 0 M30.42 0 C48.29 0.02, 66.71 -0.56, 91.27 0 M91.27 0 C109.9 -1.58, 120.74 10.01, 121.7 30.42 M91.27 0 C110.87 0.07, 121.75 11.11, 121.7 30.42 M121.7 30.42 C122.7 49.8, 122.82 68.05, 121.7 105.25 M121.7 30.42 C121.18 53.29, 120.56 78.01, 121.7 105.25 M121.7 105.25 C122.74 123.84, 110 134.81, 91.27 135.67 M121.7 105.25 C123.6 125.97, 113.59 134.72, 91.27 135.67 M91.27 135.67 C74.31 136.56, 56.11 136.81, 30.42 135.67 M91.27 135.67 C74.37 136.76, 55.61 137.12, 30.42 135.67 M30.42 135.67 C10.31 137.23, 0.97 126.88, 0 105.25 M30.42 135.67 C10.77 135.28, 2.28 124.81, 0 105.25 M0 105.25 C-0.3 85.29, 1.37 70.54, 0 30.42 M0 105.25 C-0.12 81.75, -0.26 58.41, 0 30.42 M0 30.42 C0.39 9.41, 11.03 -0.26, 30.42 0 M0 30.42 C0.53 11.01, 9.77 1.68, 30.42 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(37.28643035888672 513.13671875) rotate(0 33.77997589111328 12.5)"><text x="33.77997589111328" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User C</text></g><g stroke-linecap="round" transform="translate(225.5625 153.66796875) rotate(0 83.466796875 70.19140625)"><path d="M32 0 C65.6 1.39, 94.66 0.55, 134.93 0 M32 0 C72.78 0.09, 111.71 -1.43, 134.93 0 M134.93 0 C156.82 1.33, 167.59 9.96, 166.93 32 M134.93 0 C154.15 -0.49, 168.27 8.71, 166.93 32 M166.93 32 C165.02 52.21, 165.23 77.53, 166.93 108.38 M166.93 32 C165.95 53.61, 166.56 77.31, 166.93 108.38 M166.93 108.38 C166.98 130.55, 154.34 140.11, 134.93 140.38 M166.93 108.38 C168.63 129.76, 154.34 139.99, 134.93 140.38 M134.93 140.38 C109.21 139.78, 79.94 138.79, 32 140.38 M134.93 140.38 C108.18 140.72, 81.34 141.41, 32 140.38 M32 140.38 C12.13 139.83, -1.28 129.7, 0 108.38 M32 140.38 C11.42 141.51, 0.94 130.36, 0 108.38 M0 108.38 C-1.6 86.15, 2.13 66.58, 0 32 M0 108.38 C0.46 83.44, 0.78 56.79, 0 32 M0 32 C1.69 11.98, 9.26 0.86, 32 0 M0 32 C-0.82 9.87, 11.04 1.79, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(241.76934814453125 211.359375) rotate(0 67.25994873046875 12.5)"><text x="67.25994873046875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server 1</text></g><g stroke-linecap="round" transform="translate(221.095703125 365.36328125) rotate(0 83.466796875 70.19140625)"><path d="M32 0 C56.65 1.05, 82.98 -0.02, 134.93 0 M32 0 C57.38 -1.22, 82.42 0.22, 134.93 0 M134.93 0 C155.49 0.35, 165.75 11.04, 166.93 32 M134.93 0 C157.91 -1.55, 167.38 12.7, 166.93 32 M166.93 32 C167.63 59, 165.63 84.46, 166.93 108.38 M166.93 32 C166.84 56.51, 167.43 82.66, 166.93 108.38 M166.93 108.38 C165.78 129.34, 157.51 140.2, 134.93 140.38 M166.93 108.38 C165.59 130.18, 156.52 139.14, 134.93 140.38 M134.93 140.38 C96.01 142.09, 58.01 140.27, 32 140.38 M134.93 140.38 C106.26 141.38, 75.56 140.63, 32 140.38 M32 140.38 C11.64 139.51, 1.26 131.23, 0 108.38 M32 140.38 C12.19 138.94, -0.5 130.69, 0 108.38 M0 108.38 C0.38 81.14, 0.34 54.01, 0 32 M0 108.38 C0.25 83.85, 1.26 58.03, 0 32 M0 32 C-0.8 9.29, 9.25 -0.66, 32 0 M0 32 C-1.97 8.57, 11.74 -0.98, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(232.8925552368164 423.0546875) rotate(0 71.6699447631836 12.5)"><text x="71.6699447631836" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server 2</text></g><g stroke-linecap="round"><g transform="translate(139.2421875 517.62890625) rotate(0 34.111328125 -27.982421875)"><path d="M-1.07 -0.64 C10.38 -9.97, 56.28 -47.55, 67.64 -56.67 M0.56 1.63 C12.51 -7.49, 58.57 -45.67, 70.05 -55.5" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(139.2421875 517.62890625) rotate(0 34.111328125 -27.982421875)"><path d="M14.27 -26.42 C9.81 -22.09, 6.47 -17.55, -1.07 -0.64 M14.27 -26.42 C8.2 -18.09, 4.18 -8.77, -1.07 -0.64" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(139.2421875 517.62890625) rotate(0 34.111328125 -27.982421875)"><path d="M27.25 -10.53 C20.14 -9.67, 14.07 -8.48, -1.07 -0.64 M27.25 -10.53 C16.67 -7.85, 8.09 -4.1, -1.07 -0.64" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(147.9375 337.60546875) rotate(0 29.267578125 -28.7421875)"><path d="M-0.81 0.74 C9.21 -9.08, 49.41 -48.34, 59.32 -58.08 M0.97 0.08 C10.96 -9.65, 49.29 -47.42, 58.78 -56.86" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(147.9375 337.60546875) rotate(0 29.267578125 -28.7421875)"><path d="M12.17 -26.31 C10.54 -18.76, 5.27 -13.57, -0.81 0.74 M12.17 -26.31 C8.97 -17.84, 5.83 -11.63, -0.81 0.74" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(147.9375 337.60546875) rotate(0 29.267578125 -28.7421875)"><path d="M26.52 -11.63 C21.43 -7.62, 12.8 -5.87, -0.81 0.74 M26.52 -11.63 C19.36 -7.27, 12.24 -5.13, -0.81 0.74" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(142.46875 162.21484375) rotate(0 31.830078125 17.96875)"><path d="M0.38 -0.97 C11.07 5.05, 54.11 29.41, 64.58 35.66 M-0.89 1.14 C9.7 7.38, 53.6 31.49, 64.12 37.05" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(142.46875 162.21484375) rotate(0 31.830078125 17.96875)"><path d="M34.44 32.65 C42.72 35.57, 53.77 34.77, 64.12 37.05 M34.44 32.65 C44.65 34.46, 55.43 35.05, 64.12 37.05" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(142.46875 162.21484375) rotate(0 31.830078125 17.96875)"><path d="M44.21 14.61 C49.16 23.57, 56.95 28.8, 64.12 37.05 M44.21 14.61 C51.1 22.73, 58.48 29.61, 64.12 37.05" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(91.34765625 10) rotate(0 233.2498779296875 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">1. User A tries to send a message to B and C</text></g><g stroke-linecap="round"><g transform="translate(227.796875 44.55859375) rotate(0 -31.8203125 48.9296875)"><path d="M-0.88 0.66 C-10.22 5.92, -45.17 15.16, -55.53 31.46 C-65.89 47.76, -61.88 87.38, -63.05 98.47" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(227.796875 44.55859375) rotate(0 -31.8203125 48.9296875)"><path d="M-73 70.17 C-68.49 78.36, -64.39 90.71, -63.05 98.47" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(227.796875 44.55859375) rotate(0 -31.8203125 48.9296875)"><path d="M-52.48 70.39 C-55.03 78.35, -57.99 90.63, -63.05 98.47" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(489.09375 286.41796875) rotate(0 -149.3046875 24.05078125)"><path d="M-0.03 0.86 C-18.01 9.07, -58.66 42.99, -108.32 48.23 C-157.99 53.47, -266.26 34.94, -298.03 32.29" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(489.09375 286.41796875) rotate(0 -149.3046875 24.05078125)"><path d="M-268.8 25.55 C-275.11 25.59, -284 30.05, -298.03 32.29" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(489.09375 286.41796875) rotate(0 -149.3046875 24.05078125)"><path d="M-271.3 45.91 C-276.77 40.61, -285.01 39.72, -298.03 32.29" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(440.171875 246.38671875) rotate(0 144.21987915039062 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">2. Message is delivered to B</text></g><g transform="translate(252.296875 552.71484375) rotate(0 176.62985229492188 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">3. Message can't be delivered to C</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"> because not connected to Server 1</text></g><g stroke-linecap="round"><g transform="translate(241.640625 562.63671875) rotate(0 -29.79296875 -27.783203125)"><path d="M-0.8 -0.96 C-7.71 -1.08, -31.57 7.53, -41.2 -1.38 C-50.83 -10.29, -55.49 -45.46, -58.57 -54.42" stroke="#e03131" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(241.640625 562.63671875) rotate(0 -29.79296875 -27.783203125)"><path d="M-43.01 -30.9 C-49.49 -37.32, -51.89 -44.44, -58.57 -54.42" stroke="#e03131" stroke-width="2.5" fill="none"></path></g><g transform="translate(241.640625 562.63671875) rotate(0 -29.79296875 -27.783203125)"><path d="M-61.77 -26.4 C-62.19 -34.14, -58.55 -42.71, -58.57 -54.42" stroke="#e03131" stroke-width="2.5" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Host Confusion</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The issue is one of of routing: we're going to need to route messages to the right Chat Servers in order to deliver them. We have a few options here which are discussed in greatest depth in the <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/deep-dives/realtime-updates" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Realtime Updates Deep Dive</a>.</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Naively horizontally scale</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-3">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The most naive (broken) solution is to put a load balancer in front of our Chat Servers and scale horizontally.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-3">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This won't work. A given server might accept a message to be sent to a Chat, but we're no longer guaranteed it will have the connections to each of the clients who needs to receive it. We won't be able to deliver the events and messages!</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Keep a kafka topic per user</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-4">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Many candidates instinctively reach for a queue or stream in order to solve the scaling problem. One example solution would be to create a Kafka topic for every user in the system. The idea here would be that we could keep our <span class="MuiBox-root mui-1vu004u">Inbox</span> table as a Kafka topic. Then our Chat Servers will subscribe to the topic and deliver messages to the user.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Under this proposal, when a user connects to our Chat Server, they'd subscribe to the topic for their user ID. When we need to send a message to a given user we'd publish the message to the topic for that user. This message would be received by all the chat servers that have subscribed to that topic, and then the message could be passed on to the websocket connection for that user.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-4">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This unfortunately doesn't work - Kafka is not built for billions of topics and carries significant overhead for each one (order of 50kb per topic).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">There are potential fixes that you might conceive, like creating "super topics" which group together all of the users on a given Chat Server, but you'll quickly find yourself reinventing the good aspects for alternative solutions below with little of the benefit.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Consistent Hashing of Chat Servers</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-5">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Another approach for us to use is to always assign users to a specific Chat Server based on their user ID. If we do this correctly, we'll always know which Chat Server is responsible for a given user so, when we need to send them messages, we can do so directly.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To do this we'll need to keep a central registry of how many Chat Servers we have, their addresses, and the which segments of a consistent hash space they own. We might use a service like Zookeeper or Etcd to do this.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a request comes in, we'll connect them to the Chat Server they are assigned to based on their user id. When a new event is created, Chat Servers will connect directly with the Chat Server that "owns" that user id, then call an API which delivers a notification the connected user (if they're connected).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 847.02734375 536.4716796875">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="847.02734375" height="536.4716796875" fill="#ffffff"></rect><g stroke-linecap="round"><g transform="translate(496.04296875 109.3203125) rotate(0 -128.310546875 133.59375)"><path d="M-0.52 0.52 C-43.45 45.07, -214.72 222.78, -257.43 267.17 M1.4 -0.25 C-41.15 44.51, -211.97 223.98, -255.15 268.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(496.04296875 109.3203125) rotate(0 -128.310546875 133.59375)"><path d="M-12.7 27.94 C-8.04 18.16, -5.17 10.7, -0.52 0.52 M-12.7 27.94 C-8.39 21.37, -5.2 13.54, -0.52 0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(496.04296875 109.3203125) rotate(0 -128.310546875 133.59375)"><path d="M-27.47 13.7 C-18.25 8.39, -10.82 5.34, -0.52 0.52 M-27.47 13.7 C-19.18 11.01, -11.96 7.07, -0.52 0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(496.04296875 109.3203125) rotate(0 -128.310546875 133.59375)"><path d="M-243.06 241.24 C-245.96 248.32, -250.6 257.84, -255.15 268.69 M-243.06 241.24 C-245.57 249.66, -249.02 256.82, -255.15 268.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(496.04296875 109.3203125) rotate(0 -128.310546875 133.59375)"><path d="M-228.24 255.43 C-235.71 258.06, -244.93 263.19, -255.15 268.69 M-228.24 255.43 C-234.75 259.98, -242.24 263.27, -255.15 268.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(10 119.8583984375) rotate(0 79.794921875 79.705078125)"><path d="M81.49 0.62 C91.62 -0.27, 104.18 2.58, 114.01 7.21 C123.85 11.83, 133.54 19.98, 140.51 28.38 C147.49 36.79, 152.72 47.44, 155.84 57.65 C158.97 67.86, 160.5 79, 159.26 89.64 C158.01 100.27, 154.13 112.03, 148.38 121.48 C142.63 130.92, 133.98 140.11, 124.77 146.31 C115.56 152.51, 103.91 156.78, 93.11 158.7 C82.32 160.62, 70.43 160.55, 59.99 157.84 C49.55 155.13, 39.04 149.22, 30.49 142.46 C21.95 135.7, 13.74 126.84, 8.72 117.26 C3.71 107.69, 0.9 95.84, 0.4 85.01 C-0.1 74.18, 2.02 62.28, 5.71 52.27 C9.4 42.26, 15.15 32.69, 22.55 24.94 C29.96 17.19, 38.94 9.85, 50.14 5.8 C61.34 1.74, 82.39 1.1, 89.75 0.62 C97.12 0.14, 94.74 1.47, 94.35 2.91 M49.17 7.03 C57.9 2.46, 70.74 1.16, 81.7 1.51 C92.66 1.87, 104.85 4.66, 114.93 9.16 C125.01 13.66, 135.49 20.56, 142.19 28.5 C148.89 36.45, 152.13 46.58, 155.14 56.82 C158.14 67.07, 161.59 79.03, 160.24 89.98 C158.88 100.93, 152.91 113.36, 147.02 122.52 C141.13 131.69, 133.81 138.89, 124.89 144.96 C115.97 151.03, 104.18 157.07, 93.52 158.94 C82.86 160.8, 71.3 158.97, 60.94 156.17 C50.58 153.36, 40.2 148.6, 31.36 142.08 C22.52 135.57, 12.88 126.71, 7.9 117.06 C2.93 107.42, 2.16 94.74, 1.51 84.21 C0.86 73.68, 0.66 63.93, 4.01 53.89 C7.36 43.85, 14.15 32.1, 21.61 23.99 C29.07 15.87, 44.14 7.74, 48.79 5.2 C53.44 2.65, 48.6 7.3, 49.5 8.72" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(62.82141897875704 187.20347532530894) rotate(0 27.049972534179688 12.5)"><text x="27.049972534179688" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g stroke-linecap="round" transform="translate(660.37109375 172.0224609375) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C71.57 1.11, 111.87 1.22, 145.65 0 M31.01 0 C69.81 -0.75, 109.75 -1.69, 145.65 0 M145.65 0 C167.42 -1.55, 178.11 9.54, 176.66 31.01 M145.65 0 C165.79 -1.72, 176.4 10.76, 176.66 31.01 M176.66 31.01 C177.98 47.08, 178.28 61.33, 176.66 93.02 M176.66 31.01 C176.48 53.78, 177.53 77.05, 176.66 93.02 M176.66 93.02 C178.34 112.28, 165.5 125.59, 145.65 124.03 M176.66 93.02 C175.52 115.95, 166.75 125.79, 145.65 124.03 M145.65 124.03 C99.83 124.89, 55.17 122.33, 31.01 124.03 M145.65 124.03 C105.78 123.97, 66.48 122.85, 31.01 124.03 M31.01 124.03 C11.11 123.34, -2 113.45, 0 93.02 M31.01 124.03 C12.34 122.21, -1.16 115.71, 0 93.02 M0 93.02 C-0.69 76.1, 2.04 63.4, 0 31.01 M0 93.02 C-0.74 73.18, 0.44 50.57, 0 31.01 M0 31.01 C1.38 10.59, 9.76 -0.61, 31.01 0 M0 31.01 C-1.41 10.83, 9.42 1.81, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(690.3992614746094 209.0361328125) rotate(0 58.299957275390625 25)"><text x="58.299957275390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text><text x="58.299957275390625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(175.82256973128608 209.74161848677434) rotate(0 67.33090263435696 8.01566981021638)"><path d="M0.23 0.48 C22.47 3.42, 111.24 14.33, 133.61 16.95 M-1.11 -0.31 C21.47 2.37, 113.33 12.33, 135.76 15.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(175.82256973128608 209.74161848677434) rotate(0 67.33090263435696 8.01566981021638)"><path d="M106.56 22.17 C116.55 18.2, 126.41 17.37, 135.76 15.3 M106.56 22.17 C116.18 19.49, 125.48 17.72, 135.76 15.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(175.82256973128608 209.74161848677434) rotate(0 67.33090263435696 8.01566981021638)"><path d="M108.98 1.79 C118.1 4.21, 127.2 9.76, 135.76 15.3 M108.98 1.79 C117.98 5.45, 126.52 10.05, 135.76 15.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(504.9882812500001 236.09910915306364) rotate(0 68.10351562499994 -0.722110488436627)"><path d="M-1.06 0.92 C21.56 0.62, 112.93 -0.74, 135.94 -1.3 M0.59 0.35 C23.01 0.23, 112.17 0.65, 134.85 0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(504.9882812500001 236.09910915306364) rotate(0 68.10351562499994 -0.722110488436627)"><path d="M106.7 10.68 C117.16 7.18, 124.86 5.69, 134.85 0.32 M106.7 10.68 C113.51 8.24, 118.7 5.63, 134.85 0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(504.9882812500001 236.09910915306364) rotate(0 68.10351562499994 -0.722110488436627)"><path d="M106.62 -9.84 C117.19 -6.8, 124.91 -1.74, 134.85 0.32 M106.62 -9.84 C113.57 -7.8, 118.77 -5.94, 134.85 0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(185.890625 169.5595703125) rotate(0 68.39994812011719 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">WS Connection</text></g><g stroke-linecap="round" transform="translate(478.337890625 394.6474609375) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C61.14 0.12, 91.84 0.75, 124.82 0 M32 0 C52.12 -0.66, 71.1 0.64, 124.82 0 M124.82 0 C148.13 1.56, 158.4 12.4, 156.82 32 M124.82 0 C146.44 1.43, 158.68 9.77, 156.82 32 M156.82 32 C155.76 49.07, 158.46 61.15, 156.82 99.82 M156.82 32 C156.86 47.41, 157.7 64.72, 156.82 99.82 M156.82 99.82 C156.58 120.04, 144.74 132.19, 124.82 131.82 M156.82 99.82 C155.93 119.64, 145.06 130.39, 124.82 131.82 M124.82 131.82 C88.24 133.27, 56.4 131.67, 32 131.82 M124.82 131.82 C95.66 131.58, 66.64 130.18, 32 131.82 M32 131.82 C8.95 133.15, -1.8 122.81, 0 99.82 M32 131.82 C11.37 132.87, -0.48 119.8, 0 99.82 M0 99.82 C-0.37 76.37, 2.14 57.03, 0 32 M0 99.82 C-1.34 76.32, -1.05 52.03, 0 32 M0 32 C-1.94 10.18, 9.6 1.76, 32 0 M0 32 C2.13 11.4, 11.39 -0.42, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(497.2000503540039 448.0595703125) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(185.826171875 389.8115234375) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C66.56 -1.39, 105.45 1.74, 124.82 0 M32 0 C50.66 -0.78, 69.64 -1.47, 124.82 0 M124.82 0 C147.3 -1.51, 155.91 11.44, 156.82 32 M124.82 0 C148.26 -0.23, 158.55 9.94, 156.82 32 M156.82 32 C155.8 52.84, 156.42 70.65, 156.82 99.82 M156.82 32 C156.61 51.03, 157.21 71.04, 156.82 99.82 M156.82 99.82 C156.5 119.23, 144.24 133.5, 124.82 131.82 M156.82 99.82 C158.88 120.59, 146.99 129.6, 124.82 131.82 M124.82 131.82 C91.93 130.54, 57.23 131.53, 32 131.82 M124.82 131.82 C88.48 130.66, 53.64 131.47, 32 131.82 M32 131.82 C9.72 131.88, 0.46 120.93, 0 99.82 M32 131.82 C10.97 131.93, -0.94 122.6, 0 99.82 M0 99.82 C0.31 77.02, -1.96 48.69, 0 32 M0 99.82 C0.73 74.35, 0.42 46.71, 0 32 M0 32 C0.89 10.6, 12.04 1.51, 32 0 M0 32 C1.1 10.64, 10.81 0.34, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(204.6883316040039 443.2236328125) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round"><g transform="translate(398.41649372324684 307.4541015625) rotate(0 -54.454775050838066 36.76953125)"><path d="M-0.71 -0.36 C-18.76 11.91, -89.98 61.54, -108 74.03 M1.11 -1.6 C-17.04 10.28, -90.02 59.77, -108.47 72.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(398.41649372324684 307.4541015625) rotate(0 -54.454775050838066 36.76953125)"><path d="M-18.04 24.13 C-13.11 17.82, -6.08 8.46, -0.71 -0.36 M-18.04 24.13 C-11.04 14.73, -4.46 5.59, -0.71 -0.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(398.41649372324684 307.4541015625) rotate(0 -54.454775050838066 36.76953125)"><path d="M-29.73 7.26 C-20.96 6.48, -10.14 2.59, -0.71 -0.36 M-29.73 7.26 C-18.18 4.45, -7.06 1.85, -0.71 -0.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(398.41649372324684 307.4541015625) rotate(0 -54.454775050838066 36.76953125)"><path d="M-90.85 47.89 C-97.07 57.17, -101.36 63.61, -108.47 72.17 M-90.85 47.89 C-97.36 57.3, -104.34 67.08, -108.47 72.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(398.41649372324684 307.4541015625) rotate(0 -54.454775050838066 36.76953125)"><path d="M-79.36 64.9 C-89.37 68.6, -97.37 69.53, -108.47 72.17 M-79.36 64.9 C-90.35 67.67, -101.78 70.86, -108.47 72.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(467.7468052285602 313.2822265625) rotate(0 36.626299958398874 34.404296875)"><path d="M-0.6 -1.15 C11.7 10.36, 60.5 58.07, 72.87 69.65 M1.28 0.86 C13.47 11.98, 59.76 56.55, 71.73 67.97" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(467.7468052285602 313.2822265625) rotate(0 36.626299958398874 34.404296875)"><path d="M26.81 11.04 C18.73 7.56, 15.96 6.11, -0.6 -1.15 M26.81 11.04 C20.59 7.53, 12.89 3.9, -0.6 -1.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(467.7468052285602 313.2822265625) rotate(0 36.626299958398874 34.404296875)"><path d="M12.56 25.81 C7.58 19.12, 7.97 14.38, -0.6 -1.15 M12.56 25.81 C10.04 18.61, 6.03 11.14, -0.6 -1.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(467.7468052285602 313.2822265625) rotate(0 36.626299958398874 34.404296875)"><path d="M44.27 55.87 C48.52 58.07, 57.94 62.01, 71.73 67.97 M44.27 55.87 C52.29 59.2, 58.82 61.87, 71.73 67.97" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(467.7468052285602 313.2822265625) rotate(0 36.626299958398874 34.404296875)"><path d="M58.47 41.05 C59.63 46.47, 65.9 53.71, 71.73 67.97 M58.47 41.05 C62.8 48.09, 65.65 54.61, 71.73 67.97" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(346.46875 447.6497823400473) rotate(0 62.638671875 1.3363666295285839)"><path d="M0.13 0.49 C20.99 0.68, 103.5 1.76, 124.19 2.18 M-1.27 -0.3 C20.04 0.57, 105.01 3.27, 126.33 3.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(346.46875 447.6497823400473) rotate(0 62.638671875 1.3363666295285839)"><path d="M28.45 -9.41 C23.21 -9.05, 15.44 -6.73, 0.13 0.49 M28.45 -9.41 C19.44 -5.67, 9.05 -2.85, 0.13 0.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(346.46875 447.6497823400473) rotate(0 62.638671875 1.3363666295285839)"><path d="M28.18 11.11 C22.82 7.02, 15.11 4.89, 0.13 0.49 M28.18 11.11 C19.06 8.1, 8.76 4.17, 0.13 0.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(346.46875 447.6497823400473) rotate(0 62.638671875 1.3363666295285839)"><path d="M97.92 13.1 C104.81 9.17, 109.34 7.25, 126.33 3.47 M97.92 13.1 C107.38 10.4, 115.65 6.8, 126.33 3.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(346.46875 447.6497823400473) rotate(0 62.638671875 1.3363666295285839)"><path d="M98.38 -7.42 C105.34 -6.9, 109.78 -4.37, 126.33 3.47 M98.38 -7.42 C107.89 -3.37, 116.01 -0.22, 126.33 3.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(513.53125 44.0205078125) rotate(0 65.90625 48.291015625)"><path d="M24.15 0 C56.08 2.07, 91.29 2.16, 107.67 0 M24.15 0 C43.44 -0.07, 63.23 0.76, 107.67 0 M107.67 0 C122.48 0.3, 132.83 9.2, 131.81 24.15 M107.67 0 C123.14 -1.25, 133.41 9.99, 131.81 24.15 M131.81 24.15 C133.37 38.84, 130.26 54.02, 131.81 72.44 M131.81 24.15 C132.17 34.06, 131.91 43.63, 131.81 72.44 M131.81 72.44 C133.64 86.84, 123.09 97.5, 107.67 96.58 M131.81 72.44 C131.66 86.24, 123.31 98.19, 107.67 96.58 M107.67 96.58 C80.61 98.54, 57.16 98.36, 24.15 96.58 M107.67 96.58 C88.92 97.44, 70.45 96.04, 24.15 96.58 M24.15 96.58 C7.26 98.24, 1.93 89.37, 0 72.44 M24.15 96.58 C8.26 96.56, -0.09 90.4, 0 72.44 M0 72.44 C-1.08 57.8, -2.25 47.52, 0 24.15 M0 72.44 C-0.77 60.62, 0.69 48.79, 0 24.15 M0 24.15 C1.69 7.22, 8.2 1.71, 24.15 0 M0 24.15 C-0.85 6.44, 7.75 -2.21, 24.15 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(556.337516784668 79.8115234375) rotate(0 23.09998321533203 12.5)"><text x="23.09998321533203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Etcd</text></g><g stroke-linecap="round" transform="translate(305.6328125 10.6298828125) rotate(0 57.09765625 36.625)"><path d="M18.31 0 C48.47 -1.64, 79.01 -2.02, 95.88 0 M18.31 0 C44.92 0.36, 70.47 0.29, 95.88 0 M95.88 0 C107.86 -1.92, 115.06 4.63, 114.2 18.31 M95.88 0 C109.83 2.07, 115.76 5, 114.2 18.31 M114.2 18.31 C113.7 31.58, 114.17 46.14, 114.2 54.94 M114.2 18.31 C114.46 26.52, 114.3 36.04, 114.2 54.94 M114.2 54.94 C115.57 65.98, 107.28 72.33, 95.88 73.25 M114.2 54.94 C113.41 66.75, 107.08 74.97, 95.88 73.25 M95.88 73.25 C79.19 74.37, 62.73 74.74, 18.31 73.25 M95.88 73.25 C69.57 72.6, 41.92 72.34, 18.31 73.25 M18.31 73.25 C6.34 73.44, 0.64 68.93, 0 54.94 M18.31 73.25 C6.14 75.33, 0.56 67.12, 0 54.94 M0 54.94 C-0.59 43.81, 0.69 35.92, 0 18.31 M0 54.94 C-0.99 47.6, -0.21 39.74, 0 18.31 M0 18.31 C0.84 6.9, 5.8 -1.19, 18.31 0 M0 18.31 C1.27 7.21, 4.8 -1.48, 18.31 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(323.21051025390625 22.2548828125) rotate(0 39.51995849609375 25)"><text x="39.51995849609375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat </text><text x="39.51995849609375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Registry</text></g><g stroke-linecap="round"><g transform="translate(161.85546875 145.8203125) rotate(0 64.267578125 -38.85546875)"><path d="M-0.79 1.17 C21 -11.91, 108.13 -64.33, 129.61 -77.42 M1 0.75 C22.82 -12.21, 108.21 -66.62, 129.23 -79.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(161.85546875 145.8203125) rotate(0 64.267578125 -38.85546875)"><path d="M18.07 -22.16 C16.34 -15.67, 10.97 -13.35, -0.79 1.17 M18.07 -22.16 C10.98 -14.96, 5.89 -7.46, -0.79 1.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(161.85546875 145.8203125) rotate(0 64.267578125 -38.85546875)"><path d="M28.65 -4.57 C24.58 -1.79, 17.02 -3.11, -0.79 1.17 M28.65 -4.57 C18.27 -3.14, 9.73 -1.35, -0.79 1.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(161.85546875 145.8203125) rotate(0 64.267578125 -38.85546875)"><path d="M110.74 -55.76 C116.31 -58.74, 118.65 -66.13, 129.23 -79.39 M110.74 -55.76 C116.19 -63.72, 123.25 -71.49, 129.23 -79.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(161.85546875 145.8203125) rotate(0 64.267578125 -38.85546875)"><path d="M99.88 -73.17 C107.84 -72.48, 112.43 -76.27, 129.23 -79.39 M99.88 -73.17 C108.72 -75.43, 119.31 -77.54, 129.23 -79.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(116.0390625 10) rotate(0 59.549949645996094 37.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Look Up</text><text x="59.549949645996094" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text><text x="59.549949645996094" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Address</text></g><g stroke-linecap="round"><g transform="translate(570.01171875 148.5234375) rotate(0 -31.21875 28.61328125)"><path d="M-0.09 -0.47 C-10.42 8.83, -51.38 47.11, -61.95 56.8 M-1.6 -1.76 C-12.04 8.23, -52.72 48.56, -62.64 58.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.01171875 148.5234375) rotate(0 -31.21875 28.61328125)"><path d="M-13.81 26.21 C-10.7 19.04, -6.51 8.52, -0.09 -0.47 M-13.81 26.21 C-8.38 16.5, -3.83 7.33, -0.09 -0.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.01171875 148.5234375) rotate(0 -31.21875 28.61328125)"><path d="M-27.75 11.15 C-20.33 8.51, -11.97 2.5, -0.09 -0.47 M-27.75 11.15 C-17.43 6.64, -8.13 2.6, -0.09 -0.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.01171875 148.5234375) rotate(0 -31.21875 28.61328125)"><path d="M-49.68 31.06 C-54.11 39.99, -57.92 45.57, -62.64 58.12 M-49.68 31.06 C-52.86 39.54, -57.4 48.69, -62.64 58.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.01171875 148.5234375) rotate(0 -31.21875 28.61328125)"><path d="M-35.32 45.73 C-44.18 50.24, -52.3 51.43, -62.64 58.12 M-35.32 45.73 C-43.52 49.14, -52.96 53.29, -62.64 58.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(427.58984375 46.5078125) rotate(0 37.193359375 11.751953125)"><path d="M-1.03 0.65 C11.36 4.7, 60.83 19.57, 73.3 23.33 M0.62 -0.06 C13.48 4.26, 63.42 20.71, 75.44 24.78" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(427.58984375 46.5078125) rotate(0 37.193359375 11.751953125)"><path d="M28.93 -0.9 C23.72 -2.64, 16.08 -1.46, -1.03 0.65 M28.93 -0.9 C21.66 0.7, 12.96 0.44, -1.03 0.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(427.58984375 46.5078125) rotate(0 37.193359375 11.751953125)"><path d="M22.91 18.72 C19.13 12.92, 12.75 10, -1.03 0.65 M22.91 18.72 C17.28 14.9, 10.22 9.27, -1.03 0.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(427.58984375 46.5078125) rotate(0 37.193359375 11.751953125)"><path d="M45.46 25.6 C52.82 23.88, 57.72 24.56, 75.44 24.78 M45.46 25.6 C54.58 25.99, 62.26 25.08, 75.44 24.78" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(427.58984375 46.5078125) rotate(0 37.193359375 11.751953125)"><path d="M51.94 6.13 C57.79 8.43, 61.34 13.19, 75.44 24.78 M51.94 6.13 C59.3 11.9, 65.21 16.32, 75.44 24.78" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(611.88671875 147.7734375) rotate(0 -27.212890625 115.083984375)"><path d="M-0.5 -0.36 C-9.72 37.81, -45.56 191.79, -54.58 230.09 M1.44 -1.59 C-8.01 37.29, -46.12 192.93, -55.61 231.59" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(611.88671875 147.7734375) rotate(0 -27.212890625 115.083984375)"><path d="M3.04 29.43 C0.9 18.49, 0.11 7.73, -0.5 -0.36 M3.04 29.43 C1.04 22.71, 1.66 15.56, -0.5 -0.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(611.88671875 147.7734375) rotate(0 -27.212890625 115.083984375)"><path d="M-16.94 24.74 C-11.87 15.56, -5.51 6.48, -0.5 -0.36 M-16.94 24.74 C-14.12 19.14, -8.74 13.11, -0.5 -0.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(611.88671875 147.7734375) rotate(0 -27.212890625 115.083984375)"><path d="M-58.86 201.77 C-58.03 212.21, -56.39 222.81, -55.61 231.59 M-58.86 201.77 C-58.7 209.28, -56.46 216.36, -55.61 231.59" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(611.88671875 147.7734375) rotate(0 -27.212890625 115.083984375)"><path d="M-38.93 206.65 C-45.28 215.26, -50.78 224.11, -55.61 231.59 M-38.93 206.65 C-43.57 212.99, -46.09 218.91, -55.61 231.59" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(335.2890625 166.9052734375) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C57.01 3.95, 78.43 -2.76, 124.82 0 C147.36 -2.13, 156.39 9.11, 156.82 32 C154.48 46.86, 155.23 68.33, 156.82 99.82 C155.57 124.19, 144.02 134.88, 124.82 131.82 C95.45 128.63, 68.33 132.14, 32 131.82 C8.36 131.59, 3.4 118.74, 0 99.82 C-2.21 76.94, 0.38 56.62, 0 32 C-3.2 13.45, 11.32 1.08, 32 0" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M32 0 C58.82 1.87, 87.85 -0.76, 124.82 0 M32 0 C57.96 0.94, 82.66 1.3, 124.82 0 M124.82 0 C145.71 0.24, 158.2 9.03, 156.82 32 M124.82 0 C147.42 -1.79, 158.5 9.75, 156.82 32 M156.82 32 C156.69 49.71, 158.31 68.69, 156.82 99.82 M156.82 32 C156.98 55.52, 157.19 76.56, 156.82 99.82 M156.82 99.82 C156.35 119.89, 147.79 130.28, 124.82 131.82 M156.82 99.82 C158.76 119.54, 145.22 133.62, 124.82 131.82 M124.82 131.82 C103.1 133.81, 78.49 130.23, 32 131.82 M124.82 131.82 C101.47 131.86, 79.03 130.9, 32 131.82 M32 131.82 C10.32 132.84, 0.43 119.94, 0 99.82 M32 131.82 C11.56 131.04, -2.3 120.88, 0 99.82 M0 99.82 C2.29 72.65, -0.06 46, 0 32 M0 99.82 C1.33 82.8, 0.66 65.02, 0 32 M0 32 C-1.16 12.45, 11.88 -1.99, 32 0 M0 32 C1.58 10.96, 10 -0.7, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(354.1512222290039 220.3173828125) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Consistently Hashed Chat Servers</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-5">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Each Chat Server will need to maintain connections with each other Chat Server which will require that we keep our Chat Servers big in size and small in number.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Increasing the number of Chat Servers requires careful orchestration of dropping connections so that users reconnect to other servers without triggering a thundering herd (we need to be able to support users moving between servers). During scaling we need to ensure that events are sent to both servers to prevent dropping messages.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">All of these are solvable problems but your interviewer will expect you to talk about them and how to pull it off.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Offload to Pub/Sub</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-6">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The last approach is to use a purpose-built system for the bouncing messages between servers.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Redis Pub/Sub is a good example which uses a very lightweight hashmap of socket connections to allow you to ferry messages to arbitrary destinations. With Pub/Sub you can create a subscription for a given user ID and then publish messages to that subscription which are received "at most once" by the subscribers.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">On connection:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When users connect to our Chat Server, we're connect to Pub/Sub to subscribe to the topic for that user ID.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Any messages received on that subscription are then forwarded on to the websocket connection for that user.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a message needs to be sent:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We publish the message to the Pub/Sub topic for the relevant user ID.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The message is received by all subscribing Chat Servers.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Those Chat Servers then forward the message to the user's websocket connection.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Pub/Sub is "at most once" which means it doesn't guarantee delivery. If there's no subscribers listening, that pub/sub message is lost. But this is ok in our design, because we already manage the durability of our messages with our <span class="MuiBox-root mui-1vu004u">Inbox</span> table. If clients aren't connected, they'll receive the message when they connect later and retrieve all of the undelivered messages (we can also periodically poll for undelivered messages for transient failures in between).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850.8203125 396.735595703125">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="850.8203125" height="396.735595703125" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 11.615234375) rotate(0 79.794921875 79.705078125)"><path d="M65 2.05 C74.98 -1.25, 87.83 -1.22, 98.3 1.11 C108.76 3.45, 119.26 9.39, 127.78 16.07 C136.31 22.74, 144.19 31.66, 149.47 41.16 C154.75 50.66, 158.56 62.1, 159.47 73.06 C160.38 84.02, 158.59 96.84, 154.91 106.93 C151.23 117.02, 144.69 125.78, 137.39 133.61 C130.1 141.44, 121.09 149.56, 111.12 153.91 C101.16 158.26, 88.61 160.06, 77.59 159.72 C66.57 159.39, 54.85 156.41, 44.99 151.9 C35.14 147.39, 25.41 140.86, 18.46 132.67 C11.52 124.48, 6.15 113.37, 3.33 102.76 C0.51 92.14, 0.2 79.65, 1.56 68.99 C2.91 58.32, 5.9 48.04, 11.45 38.77 C17 29.5, 24.63 19.62, 34.85 13.35 C45.06 7.08, 65.43 3.05, 72.74 1.14 C80.06 -0.77, 78.8 0.76, 78.72 1.91 M82.66 0.89 C93.07 0.18, 106.47 3.43, 116.18 8.12 C125.9 12.8, 134.11 20.76, 140.95 29 C147.78 37.24, 154.43 47.24, 157.18 57.54 C159.93 67.83, 158.89 80.19, 157.46 90.78 C156.02 101.36, 154.23 112.05, 148.59 121.05 C142.95 130.04, 133.07 138.65, 123.62 144.76 C114.16 150.87, 102.6 155.57, 91.87 157.69 C81.13 159.8, 69.43 160.19, 59.2 157.47 C48.97 154.74, 39.1 148.09, 30.5 141.32 C21.89 134.54, 12.54 126.41, 7.59 116.82 C2.64 107.24, 1.02 94.88, 0.8 83.8 C0.57 72.73, 2.37 60.46, 6.22 50.4 C10.07 40.34, 16.46 30.79, 23.9 23.43 C31.33 16.07, 41.16 9.94, 50.86 6.24 C60.55 2.54, 76.55 2.03, 82.09 1.22 C87.63 0.41, 83.81 0.08, 84.1 1.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(62.82141897875704 78.96031126280894) rotate(0 27.049972534179688 12.5)"><text x="27.049972534179688" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g stroke-linecap="round" transform="translate(664.1640625 27.505859375) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C61.37 1.13, 91.68 -2.16, 145.65 0 M31.01 0 C62.13 0.46, 93.59 0.06, 145.65 0 M145.65 0 C168.31 -1.11, 175.32 11.18, 176.66 31.01 M145.65 0 C167.97 -1.18, 177.42 8.48, 176.66 31.01 M176.66 31.01 C175.96 50.18, 177.94 67.81, 176.66 93.02 M176.66 31.01 C175.99 49.75, 177.65 66.51, 176.66 93.02 M176.66 93.02 C177.28 112.69, 165.77 124.2, 145.65 124.03 M176.66 93.02 C177.2 112.76, 165.49 125.28, 145.65 124.03 M145.65 124.03 C104.86 124.42, 62.88 122.05, 31.01 124.03 M145.65 124.03 C115.98 122.02, 85.9 122.52, 31.01 124.03 M31.01 124.03 C9.43 124.8, 0.43 112.61, 0 93.02 M31.01 124.03 C8.1 124.41, 0.98 112.41, 0 93.02 M0 93.02 C-0.01 69.98, 1.5 44.47, 0 31.01 M0 93.02 C0.24 70.27, -0.31 45.67, 0 31.01 M0 31.01 C1.51 9.41, 11.47 -1.52, 31.01 0 M0 31.01 C-0.21 8.71, 12.43 1.22, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(694.1922302246094 64.51953125) rotate(0 58.299957275390625 25)"><text x="58.299957275390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text><text x="58.299957275390625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(176.42301733987142 91.6928301006522) rotate(0 68.92716320506429 0.3513224763621423)"><path d="M-1.2 -0.32 C21.62 -0.31, 114.52 0.18, 137.66 0.39 M0.37 -1.54 C22.94 -1.38, 113.87 1.12, 136.61 1.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.42301733987142 91.6928301006522) rotate(0 68.92716320506429 0.3513224763621423)"><path d="M108.14 11.24 C117.95 7.74, 128.34 4.28, 136.61 1.76 M108.14 11.24 C118.13 7.76, 125.45 5.74, 136.61 1.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(176.42301733987142 91.6928301006522) rotate(0 68.92716320506429 0.3513224763621423)"><path d="M108.71 -9.27 C118.36 -5.3, 128.55 -1.29, 136.61 1.76 M108.71 -9.27 C118.52 -6.28, 125.66 -1.81, 136.61 1.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(508.78125 91.58250759056364) rotate(0 68.10351562499994 -0.722110488436627)"><path d="M-0.2 -0.31 C22.67 -0.47, 113.27 -1.02, 136.01 -1.25 M-1.76 -1.53 C21.04 -1.43, 112.08 0.22, 134.95 0.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(508.78125 91.58250759056364) rotate(0 68.10351562499994 -0.722110488436627)"><path d="M106.63 10.27 C111.8 8, 118.31 6.38, 134.95 0.38 M106.63 10.27 C113.69 8.12, 122.91 4.45, 134.95 0.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(508.78125 91.58250759056364) rotate(0 68.10351562499994 -0.722110488436627)"><path d="M106.9 -10.25 C111.96 -8.41, 118.41 -5.93, 134.95 0.38 M106.9 -10.25 C114.09 -6.73, 123.23 -4.73, 134.95 0.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(189.27734375 10) rotate(0 68.39994812011719 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">WS Connection</text></g><g stroke-linecap="round" transform="translate(339.08203125 22.388671875) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C57.67 -3.21, 82.72 -1.53, 124.82 0 C148.09 2.59, 158.27 9.99, 156.82 32 C157.92 50.73, 159.77 70.53, 156.82 99.82 C153.82 122.79, 145.08 129.12, 124.82 131.82 C99.2 130.12, 73.99 131.68, 32 131.82 C8.57 134.33, -0.59 123.38, 0 99.82 C0.14 86, -1.93 73.05, 0 32 C0.18 8.87, 7.68 -1.32, 32 0" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M32 0 C56.19 -1.02, 81.06 0.16, 124.82 0 M32 0 C55.86 -0.55, 77.59 -0.52, 124.82 0 M124.82 0 C144.6 -0.83, 155.91 11.44, 156.82 32 M124.82 0 C146.65 -1.24, 154.58 11.05, 156.82 32 M156.82 32 C154.5 56.67, 155.83 79, 156.82 99.82 M156.82 32 C156.96 55.18, 156.95 79.37, 156.82 99.82 M156.82 99.82 C157 119.85, 147.67 130.9, 124.82 131.82 M156.82 99.82 C158.13 119.41, 145.95 130.2, 124.82 131.82 M124.82 131.82 C88.5 131.2, 52.51 131.99, 32 131.82 M124.82 131.82 C105.78 132.36, 84.67 131.32, 32 131.82 M32 131.82 C12.59 131.25, -0.6 120.54, 0 99.82 M32 131.82 C10.73 132.1, -0.1 122.98, 0 99.82 M0 99.82 C-0.09 83.35, -1.59 68.24, 0 32 M0 99.82 C0.32 84.05, -0.64 67.72, 0 32 M0 32 C-0.07 8.85, 11.49 -0.44, 32 0 M0 32 C2.07 12.31, 8.59 -2.04, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(357.9441909790039 75.80078125) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(340.951171875 252.493408203125) rotate(0 87.173828125 62.2578125)"><path d="M31.13 0 C58.3 -1.64, 84.25 -0.9, 143.22 0 M31.13 0 C66.77 0.17, 104.11 0.01, 143.22 0 M143.22 0 C165.51 0.92, 175.23 10.63, 174.35 31.13 M143.22 0 C166.06 -1.77, 172.16 9.84, 174.35 31.13 M174.35 31.13 C174.54 54.16, 173.66 72.56, 174.35 93.39 M174.35 31.13 C173.71 48.87, 174.94 66.17, 174.35 93.39 M174.35 93.39 C173.69 113.26, 165.87 126.25, 143.22 124.52 M174.35 93.39 C174.86 112.73, 166.01 125.15, 143.22 124.52 M143.22 124.52 C103.05 125.82, 67.69 122.3, 31.13 124.52 M143.22 124.52 C117.82 123.7, 89.89 124.75, 31.13 124.52 M31.13 124.52 C10.14 124.01, 1.04 114.45, 0 93.39 M31.13 124.52 C11.3 123.14, -0.19 116.03, 0 93.39 M0 93.39 C1.24 74.69, 2.36 58.46, 0 31.13 M0 93.39 C0.37 75.24, -0.93 55.52, 0 31.13 M0 31.13 C1.41 11.64, 9.92 -0.81, 31.13 0 M0 31.13 C-1.06 8.55, 12.31 -2.27, 31.13 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(353.5859375 262.219970703125) rotate(0 87.173828125 62.2578125)"><path d="M31.13 0 C73.66 0.55, 113.88 0.57, 143.22 0 M31.13 0 C65.01 0.54, 97.21 -0.03, 143.22 0 M143.22 0 C162.16 1.91, 173.82 9.64, 174.35 31.13 M143.22 0 C163.19 0.15, 176.34 9.01, 174.35 31.13 M174.35 31.13 C173.81 49.44, 174.49 68.16, 174.35 93.39 M174.35 31.13 C175.24 47.95, 175.11 63.09, 174.35 93.39 M174.35 93.39 C175.62 113.78, 163.73 125.41, 143.22 124.52 M174.35 93.39 C175.64 113.56, 165.17 123.84, 143.22 124.52 M143.22 124.52 C114.44 123.83, 83.45 124.25, 31.13 124.52 M143.22 124.52 C109.6 123.76, 75.3 122.77, 31.13 124.52 M31.13 124.52 C9.89 124.62, 0.19 112.92, 0 93.39 M31.13 124.52 C11.57 126.17, -1.92 113.91, 0 93.39 M0 93.39 C-0.68 72.11, 1.64 47.28, 0 31.13 M0 93.39 C-1.37 69.3, 0.4 46.79, 0 31.13 M0 31.13 C-0.13 11.27, 10.35 -1.13, 31.13 0 M0 31.13 C-1.36 11.47, 10.62 -1.52, 31.13 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(370.98983001708984 311.977783203125) rotate(0 69.76993560791016 12.5)"><text x="69.76993560791016" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Redis Pub/Sub</text></g><g stroke-linecap="round" transform="translate(349.5390625 34.186767578125) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C50.12 0.06, 67.68 2.14, 124.82 0 C146.99 -1.12, 157.02 11.08, 156.82 32 C153.58 44.88, 159.06 62.35, 156.82 99.82 C159.05 124, 148.97 131.51, 124.82 131.82 C92.56 132.12, 54.66 130.12, 32 131.82 C13.74 130.74, 3.3 122.58, 0 99.82 C-0.77 83.45, 2.95 72.36, 0 32 C-2.62 14.03, 11.71 1.41, 32 0" stroke="none" stroke-width="0" fill="#ffffff"></path><path d="M32 0 C60.95 0.18, 93.59 -1, 124.82 0 M32 0 C53.01 0.3, 73.62 0.74, 124.82 0 M124.82 0 C146.12 -1.93, 155.01 8.72, 156.82 32 M124.82 0 C148.17 1.6, 154.92 10.98, 156.82 32 M156.82 32 C156.61 47.96, 154.49 63.27, 156.82 99.82 M156.82 32 C155.49 52.81, 155.19 71.41, 156.82 99.82 M156.82 99.82 C157.93 122.59, 146.48 133.63, 124.82 131.82 M156.82 99.82 C154.92 120.37, 146.89 130.12, 124.82 131.82 M124.82 131.82 C107.36 133.03, 85.57 130.69, 32 131.82 M124.82 131.82 C104.96 132.1, 84.08 131.53, 32 131.82 M32 131.82 C11.51 133.48, 1.28 120.63, 0 99.82 M32 131.82 C10.85 130.4, -1.36 120.42, 0 99.82 M0 99.82 C0.88 78.4, -0.16 58.1, 0 32 M0 99.82 C-0.49 82.97, 1.1 64.68, 0 32 M0 32 C-1.84 9.13, 10.2 -1.78, 32 0 M0 32 C2.13 11.38, 8.8 2, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(368.4012222290039 87.598876953125) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round"><g transform="translate(379.04287688432805 173.161376953125) rotate(0 -0.4108125559287714 36.939453125)"><path d="M-0.51 -0.56 C-0.55 11.63, 0.33 60.44, 0.21 72.96 M1.42 1.75 C1.27 14.09, 0.41 62.22, -0.19 74.01" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(379.04287688432805 173.161376953125) rotate(0 -0.4108125559287714 36.939453125)"><path d="M10.07 27.51 C5.6 19.7, 1.42 7.85, -0.51 -0.56 M10.07 27.51 C6.45 16.96, 1.51 7.59, -0.51 -0.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(379.04287688432805 173.161376953125) rotate(0 -0.4108125559287714 36.939453125)"><path d="M-10.45 27.74 C-7.99 19.94, -5.22 8.01, -0.51 -0.56 M-10.45 27.74 C-6.82 17.07, -4.5 7.62, -0.51 -0.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(379.04287688432805 173.161376953125) rotate(0 -0.4108125559287714 36.939453125)"><path d="M-9.55 45.51 C-7.38 56.91, -4.81 64.19, -0.19 74.01 M-9.55 45.51 C-5.93 54.93, -3.82 65.58, -0.19 74.01" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(379.04287688432805 173.161376953125) rotate(0 -0.4108125559287714 36.939453125)"><path d="M10.96 46.16 C6.2 57.25, 1.84 64.31, -0.19 74.01 M10.96 46.16 C7.32 55.39, 2.18 65.81, -0.19 74.01" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(415.978515625 177.415283203125) rotate(0 0.4609375 33.478515625)"><path d="M-0.36 -0.2 C-0.05 10.97, 1.41 55.72, 1.76 66.89 M1.65 -1.35 C1.88 10.03, 1.29 56.82, 1.26 68.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(415.978515625 177.415283203125) rotate(0 0.4609375 33.478515625)"><path d="M10.78 27.66 C7.21 20.87, 4.17 12.74, -0.36 -0.2 M10.78 27.66 C6.69 19.07, 4.83 11.76, -0.36 -0.2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(415.978515625 177.415283203125) rotate(0 0.4609375 33.478515625)"><path d="M-9.73 28.3 C-7.29 21.38, -4.32 13.07, -0.36 -0.2 M-9.73 28.3 C-7.8 19.38, -3.64 11.89, -0.36 -0.2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(415.978515625 177.415283203125) rotate(0 0.4609375 33.478515625)"><path d="M-8.78 40.13 C-6.19 49.84, -3.03 58.16, 1.26 68.4 M-8.78 40.13 C-6.34 47.86, -1.99 57.03, 1.26 68.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(415.978515625 177.415283203125) rotate(0 0.4609375 33.478515625)"><path d="M11.74 40.29 C8.32 49.9, 5.47 58.16, 1.26 68.4 M11.74 40.29 C8.16 48.12, 6.49 57.24, 1.26 68.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(466.744140625 178.446533203125) rotate(0 0.900390625 33.75390625)"><path d="M-1.1 0.16 C-0.76 11.43, 1.59 55.59, 1.88 66.8 M0.53 -0.81 C0.73 10.69, 0.57 56.39, 0.98 67.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(466.744140625 178.446533203125) rotate(0 0.900390625 33.75390625)"><path d="M10.45 27.85 C7.56 19.86, 2.77 9.86, -1.1 0.16 M10.45 27.85 C7.16 19.96, 3.51 11.34, -1.1 0.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(466.744140625 178.446533203125) rotate(0 0.900390625 33.75390625)"><path d="M-10.05 28.79 C-6.99 20.72, -5.84 10.44, -1.1 0.16 M-10.05 28.79 C-7.4 20.54, -5.12 11.65, -1.1 0.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(466.744140625 178.446533203125) rotate(0 0.900390625 33.75390625)"><path d="M-9.66 39.91 C-6.52 48.27, -4.88 54.41, 0.98 67.96 M-9.66 39.91 C-7.08 48.05, -4.31 55.55, 0.98 67.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(466.744140625 178.446533203125) rotate(0 0.900390625 33.75390625)"><path d="M10.86 39.63 C8.05 47.89, 3.75 54.11, 0.98 67.96 M10.86 39.63 C7.51 47.93, 4.34 55.52, 0.98 67.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(512.486328125 199.223876953125) rotate(0 154.849853515625 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Subscribe to Topics for UserId</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Redis Pub/Sub</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-6">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The Pub/Sub implementation introduces additional latency because we need to ferry messages via Redis. This is small (single-digit milliseconds) but it's still a cost.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We also have all-to-all relationship between Chat Servers and Redis cluster servers - we'll need to have connections between each Chat Server and each Redis server.</div></div></div></div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-what-do-we-do-to-handle-multiple-clients-for-a-given-user">2) What do we do to handle multiple clients for a given user?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To this point we've assumed a user has a single device, but many users have multiple devices: a phone, a tablet, a desktop or laptop - maybe even a work computer. Imagine my phone had received the latest message but my laptop was off. When I wake it up, I want to make sure that all of the latest messages are delivered to my laptop so that it's in sync. We can no longer rely on the user-level "Inbox" table to keep track of delivery!</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Having multiple clients/devices introduces some new problems:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">First, we'll need to add a way for our design to resolve a user to 1 or more clients that may be active at any one time.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Second, we need a way to deactivate clients so that we're not unncessarily storing messages for a client which does not exist any longer.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Lastly, we need to update our message delivery system so that it can handle multiple clients.</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's see if we can account for this with minimal changes to our design.</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We'll need to create a new <span class="MuiBox-root mui-1vu004u">Clients</span> table to keep track of clients by user id.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When we look up participants for a chat, we'll need to look up all of the clients for that user.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Chat servers will subscribe to a topic with the <span class="MuiBox-root mui-1vu004u">clientId</span> vs the <span class="MuiBox-root mui-1vu004u">userId</span>.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When we send a message, we'll need to send it to all of the clients for that user.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We'll need to update our <span class="MuiBox-root mui-1vu004u">Inbox</span> table to be per-client rather than per-user.</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll probably want to introduce some limits (3 clients per account) to avoid blowing up our storage and throughput.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1263.1939739376012 729.353515625">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1263.1939739376012" height="729.353515625" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(495.03151361045263 243.7724609375) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C58.15 -0.12, 78.55 1.4, 124.82 0 M32 0 C53.8 0.4, 74.9 -1.13, 124.82 0 M124.82 0 C145.32 -0.76, 157.49 9.19, 156.82 32 M124.82 0 C143.87 -0.86, 158.31 12.35, 156.82 32 M156.82 32 C155.16 50.47, 156.13 70.66, 156.82 99.82 M156.82 32 C155.8 55.3, 155.98 78.05, 156.82 99.82 M156.82 99.82 C155.25 121.29, 147.15 133.43, 124.82 131.82 M156.82 99.82 C158.81 120.43, 147.16 131.89, 124.82 131.82 M124.82 131.82 C92.05 130.82, 62.49 131.47, 32 131.82 M124.82 131.82 C93.49 132.19, 64.16 133.43, 32 131.82 M32 131.82 C9.48 130.36, -0.58 121.13, 0 99.82 M32 131.82 C10.48 130.48, 0.87 120.07, 0 99.82 M0 99.82 C1.28 85.33, 0.8 72.01, 0 32 M0 99.82 C0.79 84.38, 0.4 69.57, 0 32 M0 32 C-1.61 10.09, 10.22 1.63, 32 0 M0 32 C1.01 10.91, 10.53 1.34, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(513.8936733394565 297.1845703125) rotate(0 59.549949645996094 12.5)"><text x="59.549949645996094" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat Server</text></g><g stroke-linecap="round" transform="translate(776.3752636104526 254.1044921875) rotate(0 88.328125 62.013671875)"><path d="M31.01 0 C62.97 -0.54, 98.29 -0.15, 145.65 0 M31.01 0 C72.8 0.59, 115.76 0.23, 145.65 0 M145.65 0 C164.33 -0.74, 177.95 11.8, 176.66 31.01 M145.65 0 C166.1 0.35, 175.4 8.31, 176.66 31.01 M176.66 31.01 C177.25 44.57, 177.06 59.43, 176.66 93.02 M176.66 31.01 C175.61 50.3, 176.89 70.26, 176.66 93.02 M176.66 93.02 C178.38 113.06, 167.19 124.09, 145.65 124.03 M176.66 93.02 C177.62 115.46, 167.48 122.86, 145.65 124.03 M145.65 124.03 C120.29 121.7, 95.44 122.35, 31.01 124.03 M145.65 124.03 C115.72 124.21, 86.69 124.93, 31.01 124.03 M31.01 124.03 C10.17 122.85, 0.76 112.75, 0 93.02 M31.01 124.03 C8.05 126.18, -0.78 115.89, 0 93.02 M0 93.02 C-1.93 77.66, 0.76 63.2, 0 31.01 M0 93.02 C-1.16 74.88, -0.58 58.12, 0 31.01 M0 31.01 C0.88 10.55, 10.22 1.16, 31.01 0 M0 31.01 C0.09 10.03, 12.48 -1.51, 31.01 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(806.403431335062 291.1181640625) rotate(0 58.299957275390625 25)"><text x="58.299957275390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text><text x="58.299957275390625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(664.7307323604526 314.4453248125696) rotate(0 46.234375 0.2670967914214941)"><path d="M-0.1 -1.02 C15.17 -1.14, 76.47 -0.03, 91.97 0.08 M-1.61 1.06 C13.43 1.03, 75.1 1.47, 90.76 1.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(664.7307323604526 314.4453248125696) rotate(0 46.234375 0.2670967914214941)"><path d="M62.55 11.6 C70.12 7.4, 80.39 5.52, 90.76 1.38 M62.55 11.6 C69.68 10.13, 75.32 7.23, 90.76 1.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(664.7307323604526 314.4453248125696) rotate(0 46.234375 0.2670967914214941)"><path d="M62.58 -8.92 C70.28 -6.33, 80.54 -1.42, 90.76 1.38 M62.58 -8.92 C69.5 -5.75, 75.13 -4, 90.76 1.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(1053.2151073604527 87.3251953125) rotate(0 58.799964904785156 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  name</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  metadata</text></g><g transform="translate(1051.7784465938512 243.8642578125) rotate(0 78.24993133544922 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">ChatParticipant</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  chatId</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  participantId</text></g><g stroke-linecap="round" transform="translate(1005.7291301876011 10) rotate(0 123.732421875 159.720703125)"><path d="M32 0 C70.28 -1.38, 105.93 -2.28, 215.46 0 M215.46 0 C235.03 -1.22, 246.67 9.95, 247.46 32 M247.46 32 C245.21 119.55, 245.49 206.19, 247.46 287.44 M247.46 287.44 C245.89 308.91, 237.79 321.05, 215.46 319.44 M215.46 319.44 C144.67 321.09, 75.29 321.25, 32 319.44 M32 319.44 C9.65 317.97, 1.18 307.96, 0 287.44 M0 287.44 C0.95 202.17, 3.21 119.6, 0 32 M0 32 C-1.18 9.2, 10.09 -0.03, 32 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(1102.1236614376012 31.7109375) rotate(0 33.17998504638672 17.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Chat</text></g><g transform="translate(1044.0569042354527 437.8623046875) rotate(0 88.07991790771484 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Inbox</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  recipientClientId</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  messageId</text></g><g transform="translate(1033.6163372188512 563.8896484375) rotate(0 58.64994812011719 62.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Message</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  contents</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  creatorId</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text></g><g stroke-linecap="round" transform="translate(996.5709270626011 360.130859375) rotate(0 127.10546875 179.611328125)"><path d="M32 0 C78.28 -0.57, 123.52 -0.52, 222.21 0 M222.21 0 C243.74 -0.85, 253.49 9.1, 254.21 32 M254.21 32 C256.57 122.03, 255.94 213.05, 254.21 327.22 M254.21 327.22 C255.05 350.09, 244.55 358.21, 222.21 359.22 M222.21 359.22 C179.73 356.58, 137.75 357.24, 32 359.22 M32 359.22 C9.78 360.81, 1.59 347.37, 0 327.22 M0 327.22 C0.51 259.45, 1.19 192.71, 0 32 M0 32 C-1.99 12.54, 9.98 1.91, 32 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(1054.3365520626012 381.005859375) rotate(0 72.79998016357422 17.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Messsages</text></g><g stroke-linecap="round" transform="translate(708.6869625240269 431.9912109375) rotate(0 127.10546874999994 85.47265625)"><path d="M32 0 C79.86 -2.14, 127.08 0.08, 222.21 0 M222.21 0 C242.85 -0.52, 254.42 10.28, 254.21 32 M254.21 32 C255.07 66.35, 252.45 102.98, 254.21 138.95 M254.21 138.95 C255.1 159.54, 242.09 172.17, 222.21 170.95 M222.21 170.95 C145.31 172.84, 73.69 172.49, 32 170.95 M32 170.95 C10.99 172.6, 1.91 158.37, 0 138.95 M0 138.95 C0.75 106.15, -1.12 74.28, 0 32 M0 32 C-0.35 9.95, 11.38 0.64, 32 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(790.0002636104526 453.2822265625) rotate(0 45.47197723388672 17.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Clients</text></g><g transform="translate(740.802357116312 512.6416015625) rotate(0 42.01996612548828 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Clients</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  userId</text></g><g stroke-linecap="round" transform="translate(487.32856408652685 473.85148219373076) rotate(0 87.173828125 62.2578125)"><path d="M31.13 0 C58.23 -0.09, 84.67 1.2, 143.22 0 M31.13 0 C57.08 1.6, 84.47 1.53, 143.22 0 M143.22 0 C164.39 1.94, 172.47 11.04, 174.35 31.13 M143.22 0 C164.88 -0.01, 173.26 8.9, 174.35 31.13 M174.35 31.13 C173.28 54.01, 173.34 75.42, 174.35 93.39 M174.35 31.13 C174.74 54.37, 175.7 76.94, 174.35 93.39 M174.35 93.39 C176.26 112.32, 163.08 124.35, 143.22 124.52 M174.35 93.39 C174.68 112.62, 164.38 124.52, 143.22 124.52 M143.22 124.52 C116.01 125.57, 90.84 123.3, 31.13 124.52 M143.22 124.52 C119.3 125.43, 96.69 124.56, 31.13 124.52 M31.13 124.52 C9.95 124.37, 1.66 112.77, 0 93.39 M31.13 124.52 C11.99 124.62, 0.37 112.69, 0 93.39 M0 93.39 C-2.59 70.58, -1.93 47.95, 0 31.13 M0 93.39 C0.63 77.46, -0.51 62.39, 0 31.13 M0 31.13 C1.45 11.29, 10.82 -1.12, 31.13 0 M0 31.13 C1.03 12.15, 9.5 1.41, 31.13 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(499.96332971152685 483.57804469373076) rotate(0 87.173828125 62.2578125)"><path d="M31.13 0 C63.34 1.18, 94.16 1.81, 143.22 0 M31.13 0 C57.3 -0.18, 83.85 0, 143.22 0 M143.22 0 C162.1 0.66, 175.14 10.37, 174.35 31.13 M143.22 0 C162.88 -1.48, 175.67 8.51, 174.35 31.13 M174.35 31.13 C173.67 54.94, 175.61 81.13, 174.35 93.39 M174.35 31.13 C174.96 48.24, 175.17 65.39, 174.35 93.39 M174.35 93.39 C173.46 113.97, 164.26 123.19, 143.22 124.52 M174.35 93.39 C174.76 114.15, 162.55 124.42, 143.22 124.52 M143.22 124.52 C120.02 125.36, 92.91 126.86, 31.13 124.52 M143.22 124.52 C109.29 125.48, 74.84 125.42, 31.13 124.52 M31.13 124.52 C12.04 123.14, 1.4 114.23, 0 93.39 M31.13 124.52 C10.75 123.07, 1.62 116.33, 0 93.39 M0 93.39 C-0.71 69.4, -0.4 44.26, 0 31.13 M0 93.39 C-0.87 75.83, 0.3 58.72, 0 31.13 M0 31.13 C0.44 9.26, 11.27 1.54, 31.13 0 M0 31.13 C-0.88 11.79, 10.71 -0.88, 31.13 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(517.3672222286167 533.3358571937308) rotate(0 69.76993560791016 12.5)"><text x="69.76993560791016" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Redis Pub/Sub</text></g><g stroke-linecap="round"><g transform="translate(525.4202690958549 394.51945094373076) rotate(0 -0.4108125559287714 36.939453125)"><path d="M1.01 -0.79 C0.62 11.82, -1.41 62.31, -1.73 74.92 M0.08 1.41 C0 13.77, 0.81 61.41, 0.51 73.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(525.4202690958549 394.51945094373076) rotate(0 -0.4108125559287714 36.939453125)"><path d="M10.22 27.76 C5.84 16.27, 5.63 7.55, 1.01 -0.79 M10.22 27.76 C5.73 17.36, 3.57 6.2, 1.01 -0.79" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(525.4202690958549 394.51945094373076) rotate(0 -0.4108125559287714 36.939453125)"><path d="M-10.29 27 C-7.45 15.61, -0.43 7.16, 1.01 -0.79 M-10.29 27 C-7 16.69, -1.38 5.81, 1.01 -0.79" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(525.4202690958549 394.51945094373076) rotate(0 -0.4108125559287714 36.939453125)"><path d="M-9.71 45.13 C-7.6 53.47, -0.96 64.75, 0.51 73.34 M-9.71 45.13 C-6.71 56.06, -1.51 66.42, 0.51 73.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(525.4202690958549 394.51945094373076) rotate(0 -0.4108125559287714 36.939453125)"><path d="M10.81 45.16 C5.69 53.66, 5.1 64.93, 0.51 73.34 M10.81 45.16 C6.03 56.28, 3.45 66.62, 0.51 73.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(562.3559078365269 398.77335719373076) rotate(0 0.4609375 33.478515625)"><path d="M-0.91 1.04 C-0.94 12.49, 0.48 56.73, 0.82 67.91 M0.82 0.53 C0.53 11.73, -0.13 55.31, -0.18 66.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(562.3559078365269 398.77335719373076) rotate(0 0.4609375 33.478515625)"><path d="M10.03 28.97 C7.74 17.99, 3.4 7.85, -0.91 1.04 M10.03 28.97 C6.35 17.91, 1.14 6.19, -0.91 1.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(562.3559078365269 398.77335719373076) rotate(0 0.4609375 33.478515625)"><path d="M-10.49 29.47 C-4.89 18.45, -1.36 8.12, -0.91 1.04 M-10.49 29.47 C-6.02 18.14, -3.09 6.22, -0.91 1.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(562.3559078365269 398.77335719373076) rotate(0 0.4609375 33.478515625)"><path d="M-10.14 37.98 C-4.77 48.76, -1.09 60.22, -0.18 66.28 M-10.14 37.98 C-6.05 49.18, -2.97 59.78, -0.18 66.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(562.3559078365269 398.77335719373076) rotate(0 0.4609375 33.478515625)"><path d="M10.38 38.2 C7.87 48.74, 3.67 60.11, -0.18 66.28 M10.38 38.2 C6.32 49.38, 1.26 59.89, -0.18 66.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(613.1215328365269 399.80460719373076) rotate(0 0.900390625 33.75390625)"><path d="M-0.1 0.95 C0.39 12.22, 1.92 57.51, 2.05 68.67 M-1.61 0.4 C-1.18 11.89, 0.47 56.27, 1.24 67.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(613.1215328365269 399.80460719373076) rotate(0 0.900390625 33.75390625)"><path d="M11.12 28.77 C9.94 22.94, 7.78 14.4, -0.1 0.95 M11.12 28.77 C6.8 18.86, 4.11 9.42, -0.1 0.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(613.1215328365269 399.80460719373076) rotate(0 0.900390625 33.75390625)"><path d="M-9.39 29.48 C-5.97 23.5, -3.53 14.8, -0.1 0.95 M-9.39 29.48 C-6.88 19.33, -2.74 9.66, -0.1 0.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(613.1215328365269 399.80460719373076) rotate(0 0.900390625 33.75390625)"><path d="M-10.45 39.53 C-6 46.16, -3.02 50.07, 1.24 67.16 M-10.45 39.53 C-6.92 48.09, -1.98 57.13, 1.24 67.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(613.1215328365269 399.80460719373076) rotate(0 0.900390625 33.75390625)"><path d="M10.05 38.48 C9.9 45.33, 8.28 49.48, 1.24 67.16 M10.05 38.48 C6.75 47.4, 4.86 56.78, 1.24 67.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(483.3638840076377 232.54125224179847) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C67.84 2.33, 99.22 1.86, 124.82 0 M32 0 C67.37 1.59, 102.79 0.02, 124.82 0 M124.82 0 C144.81 0.93, 155.03 9.35, 156.82 32 M124.82 0 C148.11 -2.12, 155.7 9.71, 156.82 32 M156.82 32 C156.35 51.22, 157.08 74.45, 156.82 99.82 M156.82 32 C157.93 57.93, 156.27 83.08, 156.82 99.82 M156.82 99.82 C158.13 121.28, 144.5 131.01, 124.82 131.82 M156.82 99.82 C158.2 121.4, 147.67 132.01, 124.82 131.82 M124.82 131.82 C95.7 133.07, 69.44 131.34, 32 131.82 M124.82 131.82 C96.41 131.83, 68.17 131.47, 32 131.82 M32 131.82 C11.94 130.89, -1.5 119.55, 0 99.82 M32 131.82 C10.7 132.08, -0.54 122.29, 0 99.82 M0 99.82 C-2.08 77.69, 1.11 53.02, 0 32 M0 99.82 C-0.36 76.87, 0.17 54.9, 0 32 M0 32 C-1.07 11.14, 12.18 -0.45, 32 0 M0 32 C1.18 12.27, 10.78 -2.03, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(10 215.27540169199233) rotate(0 79.794921875 79.705078125)"><path d="M98.69 1.76 C108.9 3.08, 119.62 9.78, 128.37 16.52 C137.12 23.25, 146 32.56, 151.18 42.19 C156.37 51.82, 158.75 63.57, 159.48 74.29 C160.21 85.01, 159.41 96.27, 155.57 106.53 C151.73 116.78, 144.19 127.84, 136.41 135.83 C128.63 143.81, 118.68 150.6, 108.89 154.44 C99.1 158.28, 88.18 159.36, 77.67 158.86 C67.16 158.37, 55.72 156.15, 45.81 151.47 C35.9 146.8, 25.17 138.99, 18.18 130.82 C11.2 122.66, 6.94 112.86, 3.91 102.47 C0.88 92.08, -1.39 79.29, 0 68.48 C1.39 57.67, 6.32 46.61, 12.27 37.61 C18.22 28.62, 26.72 20.48, 35.7 14.48 C44.68 8.49, 54.19 3.16, 66.16 1.67 C78.13 0.18, 99.69 4.25, 107.52 5.56 C115.35 6.86, 113.81 8.21, 113.16 9.49 M103.49 3.06 C113.51 5.06, 124.22 12.49, 132.61 19.86 C141 27.22, 149.18 37.01, 153.82 47.25 C158.47 57.49, 160.91 70.67, 160.49 81.3 C160.07 91.94, 156.03 101.59, 151.29 111.08 C146.55 120.57, 139.99 130.73, 132.07 138.25 C124.15 145.76, 113.71 152.49, 103.77 156.16 C93.84 159.83, 83.15 161.67, 72.47 160.25 C61.79 158.83, 49.27 153.21, 39.69 147.64 C30.12 142.07, 21.58 135.52, 15.02 126.85 C8.46 118.17, 2.38 106.44, 0.33 95.58 C-1.73 84.73, 0.06 72.23, 2.68 61.71 C5.3 51.18, 9.67 40.89, 16.06 32.41 C22.45 23.94, 31.49 16.2, 41.02 10.86 C50.55 5.52, 62.43 1.45, 73.23 0.38 C84.04 -0.7, 100.66 3.78, 105.88 4.41 C111.09 5.03, 105.15 3.03, 104.52 4.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(62.82141897875704 282.6204785798013) rotate(0 27.049972534179688 12.5)"><text x="27.049972534179688" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g transform="translate(162.07421875 199.02735481699233) rotate(0 49.859954833984375 25)"><text x="49.859954833984375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">WS </text><text x="49.859954833984375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Connection</text></g><g stroke-linecap="round" transform="translate(259.68394470214844 231.56739387949233) rotate(0 78.412109375 65.912109375)"><path d="M32 0 C54.53 -0.16, 81.06 0.43, 124.82 0 M32 0 C60.25 -1.53, 90.08 -1.56, 124.82 0 M124.82 0 C147.85 1.24, 155.82 12.59, 156.82 32 M124.82 0 C146.42 -1.17, 156.49 12.53, 156.82 32 M156.82 32 C156.63 57.72, 157.41 84.65, 156.82 99.82 M156.82 32 C157.9 53.27, 157.14 75.58, 156.82 99.82 M156.82 99.82 C158.73 122.43, 146.1 131.17, 124.82 131.82 M156.82 99.82 C154.93 119.73, 144.94 130.58, 124.82 131.82 M124.82 131.82 C92.45 130.67, 54.84 131.18, 32 131.82 M124.82 131.82 C103.33 133.04, 80.13 131.54, 32 131.82 M32 131.82 C10.6 132.53, -1.81 120.61, 0 99.82 M32 131.82 C12.01 130.07, 0.99 120.84, 0 99.82 M0 99.82 C-0.19 77.08, 0.4 51.67, 0 32 M0 99.82 C0.97 85.63, -0.23 70.47, 0 32 M0 32 C0.84 11.28, 10.35 0.4, 32 0 M0 32 C-1.08 9.31, 12.82 -1.52, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(307.4460678100586 284.97950325449233) rotate(0 30.649986267089844 12.5)"><text x="30.649986267089844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">L4 LB</text></g><g stroke-linecap="round"><g transform="translate(177.67808532714844 289.77637825449233) rotate(0 34.798828125 -0.796875)"><path d="M-0.07 0.1 C11.63 -0.2, 58.29 -0.21, 69.82 -0.66 M-1.57 -0.89 C10.03 -1, 57.38 -2.15, 68.99 -2.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(177.67808532714844 289.77637825449233) rotate(0 34.798828125 -0.796875)"><path d="M41 8.5 C48.47 6.04, 57.25 2.01, 68.99 -2.29 M41 8.5 C47.9 6.99, 52.68 4.97, 68.99 -2.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(177.67808532714844 289.77637825449233) rotate(0 34.798828125 -0.796875)"><path d="M40.61 -12.01 C48.38 -9.05, 57.26 -7.66, 68.99 -2.29 M40.61 -12.01 C47.75 -9.03, 52.62 -6.56, 68.99 -2.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(427.6145978069418 300.2844519174258) rotate(0 21.8940437384355 0.4369148319242413)"><path d="M0.38 -0.21 C7.59 0.03, 36.08 1.1, 43.29 1.27 M-0.08 -0.8 C7.29 -0.68, 37.05 0.15, 44.26 0.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(427.6145978069418 300.2844519174258) rotate(0 21.8940437384355 0.4369148319242413)"><path d="M23.42 7.24 C29.43 4.19, 36.93 2.72, 44.26 0.51 M23.42 7.24 C29.14 5.31, 34.94 3.62, 44.26 0.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(427.6145978069418 300.2844519174258) rotate(0 21.8940437384355 0.4369148319242413)"><path d="M23.98 -7.73 C29.79 -6.19, 37.11 -3.07, 44.26 0.51 M23.98 -7.73 C29.58 -5.35, 35.21 -2.74, 44.26 0.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Adding clients</span></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="what-is-expected-at-each-level"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/blog/the-system-design-interview-what-is-expected-at-each-level" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">What is Expected at Each Level?</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Ok, that was a lot. You may be thinking, “how much of that is actually required from me in an interview?” Let’s break it down.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="mid-level">Mid-level</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Breadth vs. Depth:</strong> A mid-level candidate will be mostly focused on breadth (80% vs 20%). You should be able to craft a high-level design that meets the functional requirements you've defined, but many of the components will be abstractions with which you only have surface-level familiarity.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Probing the Basics:</strong> Your interviewer will spend some time probing the basics to confirm that you know what each component in your system does. For example, if you use websockets, expect that they may ask you what it does and how they work (at a high level). In short, the interviewer is not taking anything for granted with respect to your knowledge.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Mixture of Driving and Taking the Backseat:</strong> You should drive the early stages of the interview in particular, but the interviewer doesn’t expect that you are able to proactively recognize problems in your design with high precision. Because of this, it’s reasonable that they will take over and drive the later stages of the interview while probing your design.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Whatsapp:</strong> For this question, an E4 candidate will have clearly defined the API, landed on a high-level design that is functional and meets the requirements. Their scaling solution will have rough edges but they'll have some knowledge of its flaws.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="senior">Senior</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Depth of Expertise</strong>: As a senior candidate, expectations shift towards more in-depth knowledge — about 60% breadth and 40% depth. This means you should be able to go into technical details in areas where you have hands-on experience. It's crucial that you demonstrate a deep understanding of key concepts and technologies relevant to the task at hand.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design</strong>: You should be familiar with advanced system design principles. For example, knowing about the consistent hashing for this problem is essential. You’re also expected to understand the mechanics of long-running sockets. Your ability to navigate these advanced topics with confidence and clarity is key.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Articulating Architectural Decisions</strong>: You should be able to clearly articulate the pros and cons of different architectural choices, especially how they impact scalability, performance, and maintainability. You justify your decisions and explain the trade-offs involved in your design choices.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Problem-Solving and Proactivity</strong>: You should demonstrate strong problem-solving skills and a proactive approach. This includes anticipating potential challenges in your designs and suggesting improvements. You need to be adept at identifying and addressing bottlenecks, optimizing performance, and ensuring system reliability.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Whatsapp:</strong> For this question, E5 candidates are expected to speed through the initial high level design so you can spend time discussing, in detail, scaling and robustness issues in the design. You should also be able to discuss the pros and cons of different architectural choices, especially how they impact scalability, performance, and maintainability.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="staff">Staff+</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Emphasis on Depth</strong>: As a staff+ candidate, the expectation is a deep dive into the nuances of system design — I'm looking for about 40% breadth and 60% depth in your understanding. This level is all about demonstrating that, while you may not have solved this particular problem before, you have solved enough problems in the real world to be able to confidently design a solution backed by your experience.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You should know which technologies to use, not just in theory but in practice, and be able to draw from your past experiences to explain how they’d be applied to solve specific problems effectively. The interviewer knows you know the small stuff so you can breeze through that at a high level so you have time to get into what is interesting.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>High Degree of Proactivity</strong>: At this level, an exceptional degree of proactivity is expected. You should be able to identify and solve issues independently, demonstrating a strong ability to recognize and address the core challenges in system design. This involves not just responding to problems as they arise but anticipating them and implementing preemptive solutions. Your interviewer should intervene only to focus, not to steer.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Practical Application of Technology</strong>: You should be well-versed in the practical application of various technologies. Your experience should guide the conversation, showing a clear understanding of how different tools and systems can be configured in real-world scenarios to meet specific requirements.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Complex Problem-Solving and Decision-Making</strong>: Your problem-solving skills should be top-notch. This means not only being able to tackle complex technical challenges but also making informed decisions that consider various factors such as scalability, performance, reliability, and maintenance.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design and Scalability</strong>: Your approach to system design should be advanced, focusing on scalability and reliability, especially under high load conditions. This includes a thorough understanding of distributed systems, load balancing, caching strategies, and other advanced concepts necessary for building robust, scalable systems.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Whatsapp:</strong> For a staff+ candidate, expectations are high regarding depth and quality of solutions, particularly for the complex scenarios discussed earlier. Great candidates are going 2 or 3 levels deep to discuss failure modes, bottlenecks, and other issues with their design. There's ample discussion to be had around fault tolerance, database optimization, regionalization and cell-based architecture and more.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="references">References</h2>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.davidreis.me/2024/what-happens-when-you-make-a-move-in-lichess" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">What Happens When You Make a Move in Lichess</a></div></li>
</ul>
</body>
</html>
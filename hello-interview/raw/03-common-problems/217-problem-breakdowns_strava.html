<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strava System Design Interview Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Common Problems</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Design a Fitness Tracking App Like Strava</h1></div><div class="flex flex-col md:flex-row gap-2 md:items-center justify-between"><div class="flex flex-col lg:flex-row gap-4 md:items-center"><a target="_blank" rel="noopener noreferrer" class="flex flex-row gap-2 items-center" href="https://www.linkedin.com/in/evan-king-40072280/" style="text-decoration: none;"><img class="rounded-full" src="https://hellointerview-files.s3.us-west-2.amazonaws.com/public-media/evan-headshot.png" alt="Evan King" width="40" height="40"><div class="flex flex-col"><div class="flex flex-row gap-2 items-center"><p class="MuiTypography-root MuiTypography-body2 mui-ltrqv0">Evan King</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeInherit mui-70s7oy" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></div><span class="MuiTypography-root MuiTypography-caption mui-1eozzb8">Ex-Meta Staff Engineer</span></div></a><div class="flex flex-row gap-4 md:gap-8 items-center"><div class="flex flex-row gap-1 items-center" aria-label="Difficulty"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-aj99kn">easy</p></div><div class="flex flex-row gap-1 items-center" aria-label="Average time allowed in interview"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-1pb8xyp">35 min</p></div></div></div><a class="MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation mui-1c7cv5a" tabindex="0" href="/practice/system-design/start/strava" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"></path></svg>Practice this problem<span class="MuiTouchRipple-root mui-w0pj6f"></span></a></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="understanding-the-problem">Understanding the Problem</h2>
<div class="my-6"><div class="MuiBox-root mui-1fz7ihe"><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>üèÉ‚Äç‚ôÇÔ∏èüö¥‚Äç‚ôÄÔ∏è What is <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.strava.com/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Strava</a>?</strong>
Strava is a fitness tracking application that allows users to record and share their physical activities, primarily focusing on running and cycling, with their network. It provides detailed analytics on performance, routes, and allows social interactions among users.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While Strava supports a wide variety of activities, we'll focus on running and cycling for this question.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#1-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to start, pause, stop, and save their runs and rides.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">While running or cycling, users should be able to view activity data, including route, distance, and time.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to view details about their own completed activities as well as the activities of their friends.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the Line (Out of Scope)</strong></div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Adding or deleting friends (friend management).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Authentication and authorization.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Commenting or liking runs.</div></li>
</ul>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="non-functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#2-non-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Non-Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should be highly available (availability &gt;&gt; consistency).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The app should function in remote areas without network connectivity.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The app should provide the athlete with accurate and up-to-date local statistics during the run/ride.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should scale to support 10 million concurrent activities.</div></li>
</ol>
<div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the Line (Out of Scope)</strong></div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Compliance with data privacy regulations like GDPR.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Advanced security measures</div></li>
</ul><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here is how it might look on the whiteboard:</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/e83cd9bb06fdaaaef8d22c9ca0aea6e4" alt="Strava Non-Functional Requirements"></div></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Strava Non-Functional Requirements</span></div></div></div></div><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="the-set-up">The Set Up</h2><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="planning-the-approach">Planning the Approach</h3><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="defining-the-core-entities"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#core-entities-2-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Defining the Core Entities</a></h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's begin by outlining the main entities of our system. At this point, we don't need to delve into every specific detail or column. We'll address the finer points, such as individual fields, once we have a better overall picture. For now, identifying these key entities will help shape our thinking and provide a solid foundation as we move towards defining the API.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To satisfy our key functional requirements, we'll identify the following core entities:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>User</strong>: Represents a person using the app. Contains profile information and settings.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Activity</strong>: Represents an individual running or cycling activity. Includes activity type (run/ride), start time, end time, route data (GPS coordinates), distance, and duration.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Route</strong>: A collection of GPS coordinates recorded during the activity (this could also just be a field on the Activity entity).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Friend</strong>: Represents a connection between users for sharing activities (note: friend management is out of scope, but the concept is necessary for sharing).</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In the actual interview, this can be as simple as a short list like this. Just make sure you talk through the entities with your interviewer to ensure you are on the same page.</div><div class="my-4 flex-col w-full max-w-[200px]"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/45143ef78138d86d9c71b915f306af05" alt="Strava Entities"></div></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Strava Entities</span></div></div></div></div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="the-api"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#4-api-or-system-interface" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">The API</a></h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll define the APIs that allow the mobile app to interact with the backend services.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our goal is to simply go one-by-one through the core requirements and define the APIs that are necessary to satisfy them. Usually, these map 1:1 to the functional requirements, but there are times when multiple endpoints are needed to satisfy an individual functional requirement or where a single endpoint meets the needs of multiple functional requirements (as is the case with our activity state update endpoint below).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">First, we'll define an endpoint that can be used to create a new activity.</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>// Create a new activity
</span>POST /activities -&gt; Activity
{
    type: "RUN" | "RIDE"
}
</code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Next, we'll add an endpoint that can be used to update the state of that activity.</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>// Update the state of an activity
</span>PATCH /activities/:activityId -&gt; Activity
{
    state: "STARTED" | "PAUSED" 
}
</code></div></div></pre><div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We use PATCH here because we only want to update a subset of the activity's fields. Whereas PUT would require sending the entire resource, with PATCH we only send the fields that are being updated -- a, albeit minor, improvement in efficiency.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In your interview, PUT and PATCH are functionally equivalent. However, you will come across some interviewers who are RESTful API hawks and will argue this point with you, so it's best to be prepared.</div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When it comes to tracking activity data, we'll add a POST endpoint that is used to update the activity's route and distance.</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>// Add a new location to the activity's route
</span>POST /activities/:activityId/routes -&gt; Activity
{
    location: GPSCoordinate,
}
</code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When it comes to sharing activities with friends, we'll say that this happens automatically when an activity is saved, so instead of a endpoint for sharing, we can just update our existing endpoint that updates the activity state to include a "COMPLETE" state.</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>// Mark an activity as complete using the same endpoint we use to update the activity state
</span>PATCH /activities/:activityId -&gt; Activity
{
    state: "COMPLETE"
}
</code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To view activities, we'll need a list view that shows either our activities or the activities of our friends. This list will just show basic information about the activity, such as the distance, duration, and date.</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>// Get a list of activities for a user
</span>GET /activities?mode={USER|FRIENDS}&amp;page={page}&amp;pageSize={pageSize} -&gt; Partial&lt;Activity&gt;[]
</code></div></div></pre><div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The <span class="MuiBox-root mui-1vu004u">Partial&lt;Activity&gt;</span> type simply means that we are returning a subset of the activity fields. This is done to limit the amount of data we send over the network. This notation is what I use and is derived from TypeScript, but you can use whatever notation you'd like. This is just a personal preference.</div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When we click on an activity, we'll want to see more details about like the maps with the route and any additional metrics or details (that are out of scope for this question).</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>// Get an activity by id
</span>GET /activities/:activityId -&gt; Activity
</code></div></div></pre><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="high-level-design"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#high-level-design-10-15-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">High-Level Design</a></h2><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's address each functional requirement and design components to satisfy them. The best strategy here, especially if it's a question you've never seen before, is to start with the simplest possible system that satisfies the functional requirements and then layer on complexity to satisfy the non-functional requirements during your deep dives.</div><div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">I often get asked, "If I already know the more complex design, should I still start simple?" The answer is nuanced. If you have a well-thought-out, more sophisticated solution in mind, it's perfectly acceptable to present it during the high-level design. That said, it's crucial to strike a balance. Going deep too early can result in you running out of time before you've met all the functional requirements and, thus, not answered the question.</div></div></div></div></div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-users-should-be-able-to-start-pause-stop-and-save-their-runs-and-rides">1) Users should be able to start, pause, stop, and save their runs and rides.</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We need to design a system that correctly handles both our create activity endpoint and our update activity state endpoint.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can start by sketching out a very basic client-server architecture:</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/68f919a47bc25b47a14ab313e9d6f841"></div></div></div></div></div></div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Client App</strong>: Users interact with the system through a mobile app.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Activity Service</strong>: Handles incoming requests for creating and updating activities.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Database</strong>: Stores information about activities, including route, distance, and time.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A user is going to start by opening the app and clicking the "Start Activity" button:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The client app will make a POST request to <span class="MuiBox-root mui-1vu004u">/activities</span> to create a new activity, specifying whether it's a run or a ride.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Activity Service will create the activity in the database and return the activity object to the client.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">If the user opts to pause or resume their activity, they'll make a PATCH request to <span class="MuiBox-root mui-1vu004u">/activities/:activityId</span> with the updated state and the Activity Service will update the activity in the database accordingly.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When the activity is over, the user will click the "Save Activity" button. This will trigger a PATCH request to <span class="MuiBox-root mui-1vu004u">/activities/:activityId</span> with the state set to "COMPLETE".</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One interesting part of the design is how to handle the activity time when a user pauses their activity. A naive approach to handling the amount of time elapsed in an activity would be to manage time based on a <span class="MuiBox-root mui-1vu004u">startTimeStamp</span> and then, when an activity is ended, calculate the elapsed time by subtracting the <span class="MuiBox-root mui-1vu004u">startTimeStamp</span> from the current time.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">However, this approach would be problematic if a user pauses their activity. The <span class="MuiBox-root mui-1vu004u">startTimeStamp</span> would remain unchanged and the elapsed time would continue to increment, which would be inaccurate.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One common way we could handle this, we can maintain time via a log of status update and timestamp pairs. For example, we could have the following log:</div><pre><span class="MuiBox-root mui-1vu004u">[
    { status: "STARTED", timestamp: "2021-01-01T00:00:00Z" },
    { status: "PAUSED", timestamp: "2021-01-01T00:10:00Z" },
    { status: "RESUMED", timestamp: "2021-01-01T00:15:00Z" },
    { status: "STOPPED", timestamp: "2021-01-01T00:20:00Z" }
]
</span></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When the user clicks "Stop Activity", we can calculate the elapsed time by summing the durations between each pair of timestamps, excluding pauses. In the example above, the elapsed time would be 15 minutes (10 minutes + 5 minutes).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This may seem like overkill for our simple requirement, but it would allow for natural expansions into a feature that shows athletes when they were paused and for how long, as well as a breakdown of "total time" vs "active time."</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-while-running-or-cycling-users-should-be-able-to-view-activity-data-including-route-distance-and-time">2) While running or cycling, users should be able to view activity data, including route, distance, and time.</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When the activity is in progress we need to both update the state and display the activity data to the user.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The first, and most important, part of this is to accurately track the distance and route of the activity. We can do this by recording the user's GPS coordinates at a constant interval. We make the assumption that they are using a modern smartphone with GPS capabilities, so we can use the GPS coordinates to calculate the distance using the <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Haversine_formula" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Haversine formula</a>.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/ca71991ae584db97ffd5087ff454e25a"></div></div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here is how this would work:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The client app will record the user's GPS coordinates at a constant interval, let's say 2 seconds for a bike ride and 5 seconds for a run. To do this, we'll utilize the built-in location services provided by both iOS and Android:
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For iOS: We'll use the Core Location framework, specifically the <span class="MuiBox-root mui-1vu004u">CLLocationManager</span> class. We can set up location updates using <span class="MuiBox-root mui-1vu004u">startUpdatingLocation()</span> method and implement the <span class="MuiBox-root mui-1vu004u">locationManager(_:didUpdateLocations:)</span> delegate method to receive location updates.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For Android: We'll use the Google Location Services API, part of Google Play Services. We can use the <span class="MuiBox-root mui-1vu004u">FusedLocationProviderClient</span> class and call <span class="MuiBox-root mui-1vu004u">requestLocationUpdates()</span> method to receive periodic location updates.</div></li>
</ul>
</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The client app will then send these new coordinates to our <span class="MuiBox-root mui-1vu004u">/activities/:activityId</span> endpoint.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Activity Service will update the Route table in the database for this activity with the new coordinates and the time the coordinates were recorded.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We will also update the distance field by calculating the distance between the new coordinate and the previous one using the Haversine formula.</div></li>
</ol><div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You absolutely do not need to know the libraries and frameworks to use here to get GPS coordinates. The point of this question is to test your knowledge of system design, not mobile development. However, it is important to understand that most modern smartphones have built-in GPS capabilities and that most mobile apps use the relevant libraries and frameworks to access this data. I've just included them here to give you an idea of how it works in practice.</div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Astute readers are likely already yelling at their screen as they've realized that we don't need to send these updates to the server, instead handling the logic locally on the client. You're right. We'll get into this in the deep dive. The reality is most of the time I ask this question, candidates overlook this optimization and we get to it later in the interview.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-users-should-be-able-to-view-details-about-their-own-completed-activities-as-well-as-the-activities-of-their-friends">3) Users should be able to view details about their own completed activities as well as the activities of their friends.</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Once activities are completed, we should have them already saved in the database and all we needed to do was update their state to "COMPLETE" using the same endpoint we used to update the activity state.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When it comes to viewing activities, we only need to query the DB for the activities with this "COMPLETE" state, while also filtering on the <span class="MuiBox-root mui-1vu004u">mode</span> query param to either show the user's activities or their friends' activities which can be done with a simple WHERE clause.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Example query:</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">SELECT</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">*</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">FROM</span><span> activities 
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">WHERE</span><span> state </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"COMPLETE"</span><span>
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> userId </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> :userId </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- if mode is USER</span><span>
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> userId </span><span class="token" style="color: rgb(64, 120, 242);">IN</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(166, 38, 164);">SELECT</span><span> friendId </span><span class="token" style="color: rgb(166, 38, 164);">FROM</span><span> friends </span><span class="token" style="color: rgb(166, 38, 164);">WHERE</span><span> userId </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> :userId</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- if mode is FRIENDS</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">LIMIT</span><span> :pageSize </span><span class="token" style="color: rgb(166, 38, 164);">OFFSET</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>:page </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">1</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">*</span><span> :pageSize</span></code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our friends table will have two columns, <span class="MuiBox-root mui-1vu004u">userId</span> and <span class="MuiBox-root mui-1vu004u">friendId</span>. We'll consider relationships to be bi-directional, so for each new friendship we will add two entries to the table, one with the <span class="MuiBox-root mui-1vu004u">userId</span> and <span class="MuiBox-root mui-1vu004u">friendId</span> and the other with the <span class="MuiBox-root mui-1vu004u">userId</span> and <span class="MuiBox-root mui-1vu004u">friendId</span> reversed. By making the first column the primary key, we can ensure querying for a user's friends is efficient.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This initial GET request returns a list of activities with just the basic information and the <span class="MuiBox-root mui-1vu004u">activityId</span> for each activity. When the user clicks on an activity, we can make a second, more detailed GET request using the <span class="MuiBox-root mui-1vu004u">activityId</span> to get the full activity details.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/0a66d7bdfe14a18a08c6ee11f5267225"></div></div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The full flow is thus,</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User navigates to the activities list page on the app.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Client makes a GET request to <span class="MuiBox-root mui-1vu004u">/activities?mode={USER|FRIENDS}&amp;page={page}&amp;pageSize={pageSize}</span> to get the list of activities.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The list of activities is rendered in the UI and the user clicks on an activity to view details.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Client makes a GET request to <span class="MuiBox-root mui-1vu004u">/activities/:activityId</span> to get the full activity details to render on a new details page.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For showing the map, we can use a combination of the route data and the Google Maps API. We can pass the array of coordinates to the Google Maps API and it will draw a line connecting all the points.</div><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="potential-deep-dives"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#deep-dives-10-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Potential Deep Dives</a></h2><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">At this point, we have a basic, functioning system that satisfies the functional requirements. However, there are a number of areas we could dive deeper into to improve efficiency, offline functionality, scalability, and realtime-sharing.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This list of deep dives is, of course, not exhaustive. It is instead an accumulation of some of the most popular directions I've seen this interview take.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-how-can-we-support-tracking-activities-while-offline">1) How can we support tracking activities while offline?</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Many athletes will opt to workout in remote areas with no network connectivity, but they still want to be able to track their activities. This brings us to an impactful realization that re-shapes the entire system.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The key insight is that, so long as we don't support realtime-sharing of activities, we can record activity data locally, directly on the clients device and only sync activity data back to the server when the activity completes and/or the user is back online.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Importantly, this actually solves several problems for us:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We can track activities without worrying about network reliability on the client side.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Even when the client has a fine network connection, we save network bandwidth by avoiding pinging location updates to the server every few seconds (instead, only sending on run completion or pause).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Showing accurate and up-to-date activity data to the user is easy as it all happens synchronously on their device.</div></li>
</ol><div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This question highlights an important, often overlooked aspect of system design: the client as an active participant. Modern smartphones and browsers have access to a wide variety of sensors, substantial memory and processing power, and significant local storage. Many candidates overlook the client's capabilities, focusing solely on server-side solutions. However, for systems like Strava, Dropbox, or Spotify, the client often plays a critical role in the overall design, enabling features like offline functionality, reducing server load, and improving user experience.</div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">So how does this work in practice?</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Just like in our high-level design, we use on-device location services to record the user's GPS coordinates at a constant interval.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We record this event data locally on the device in an in-memory buffer (e.g., an array of GPS coordinate and timestamp pairs).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">To prevent data loss in case of device shutdown or battery depletion, we'll periodically persist this buffer to the device's local storage every ~10 seconds:
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For iOS: We can use Core Data for larger, structured datasets, or UserDefaults for smaller amounts of simple key-value data.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For Android: We can use Room database for larger, structured datasets, or SharedPreferences for smaller amounts of simple key-value data.</div></li>
</ul>
</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When the app is reopened or the activity is resumed, we first check local storage for any saved data and load it into our in-memory buffer before continuing to record new data.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Once the activity is complete and the device is online, we send all the accumulated data to our server in a single request. For very long activities, we might need to implement a chunking strategy to handle large amounts of data efficiently.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We can also implement a background sync mechanism that attempts to upload data periodically when a connection becomes available, even if the activity isn't complete yet. This balances efficiency with data durability.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Upon confirmation that the data was saved to our remote database, we can delete the local buffer and are ready to go again.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach ensures that even if the device unexpectedly shuts down, we'll only lose a maximum of 10 seconds of activity data (or whatever interval we choose for our periodic saves). However, it's important to balance the frequency of GPS tracking and data persistence with battery life considerations.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/79b05234cb022fbf8c97f9699ca3742d"></div></div></div></div></div></div><div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The exact implementation details may vary depending on the mobile platform and the size of the data being stored. For larger datasets, using a local SQLite database
might be more appropriate than options like UserDefaults or SharedPreferences. But the details of this are reserved more for Mobile System Design interviews, not a
general SWE interview.</div></div></div></div></div><div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We're done with our first deep dive, and we still have a simple client-server architecture. Why? Especially when most of our other breakdowns use microservices? The truth is, there is no one right answer here. But in this case, we offloaded so much of the write load to the client that we don't have a ton for our backend to do. What we do have still needs to scale, and we will get to that in a bit, but we don't need separate microservices to scale independently given no significant read/write skew across different paths. It could be argued that this will make it harder for the engineering team to grow, with everyone touching the same codebase, but if Meta can famously manage it, so can we.</div></div></div></div></div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-how-can-we-scale-to-support-10-million-concurrent-activities">2) How can we scale to support 10 million concurrent activities?</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now that we track activities locally, scaling our backend became pretty easy! We cut down on the number of requests our backend services receive by a factor of 100x since we only send data once a run completes now. Our production engineering team is going to be thrilled, so too the finance team.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We do still have some potential bottlenecks that are worth addressing.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's start by looking at our database. With ~100M DAU doing an activity each day we add up to ~100M new activities each day. Over a year, that's ~36500M activities or ~36.5B activities.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To estimate the amount of storage we need for each activity, we can break it down as follows:</div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Basic metadata like status, userID, start/end time, etc should be pretty cheap. Let's say ~100 bytes per activity.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The route is the most expensive part. If the average activity is 30 minutes and we take GPS coordinates, on average, every ~3 seconds, then we'll have about 600 points per activity. Each route row needs a latitude and longitude field as well as a timestamp. This is an additional <span class="MuiBox-root mui-1vu004u">(8bytes + 8bytes + 8bytes) * 600 = ~15KB</span>.</div></li>
</ul><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><span class="MuiBox-root mui-1vu004u">15KB * 36.5B = 547.5TB of data each year</span></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This is a good amount of data, but it's far from unmanageable. Here are some things we could do to handle this:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We can shard our database to split the data across multiple database instances. We can shard by the time that the activity was completed since the majority of our queries will want to see recent activities.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We could introduce data tiering. The chances that someone wants to view a run from several years ago are pretty low. To reduce storage costs, we could move older data to cheaper storage tiers:
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Hot data (recent activities) stays in fast, expensive storage</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Warm data (3-12 months old) moves to slower, cheaper storage</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Cold data (&gt;1 year old) moves to archival storage like S3</div></li>
</ul>
</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We can introduce caching if needed. If we find that we are frequently querying the same activities, we can introduce caching to reduce the read load on our database. This would not be a priority for me, as read throughput should be pretty low. but its the first thing we would do if load times become unacceptable.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">What database should we choose?</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Hot take. It doesn't really matter. This is a large but totally manageable amount of data; there is no crazy read or write throughput, and data is relational but not heavily so. Realistically, all popular major database technologies would work great here.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For the Activity Service, given both read and write throughput should be pretty low, I see no reason to break this into microservices that scale independently. Instead, when we run into issues with memory, cpu, or network limitation we can just scale the service horizontally.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/00f754dcb52f786fff6b2c052072d6b7"></div></div></div></div></div></div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-how-can-we-support-realtime-sharing-of-activities-with-friends">3) How can we support realtime sharing of activities with friends?</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One common follow up question in this interview is, w"hat happens when you want to allow friends to follow along with activities in real-times". In this case, friends don't just see activity statistics once completed, but they can watch you mid run/bike ride -- seeing your stats and routes update in near real-time.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This moves the design closer to other popular realtime systems like <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/problem-breakdowns/fb-live-comments" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">FB Live Comments</a> or <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/problem-breakdowns/whatsapp" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Whatsapp</a>.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To enable real-time sharing with friends, we'll reintroduce periodic server updates during activities. While maintaining local device logic for user-facing data, we'll send location updates to the server every 2-5 seconds. As the server gets these updates, they'll be persisted in the database and broadcast to all of the user's friends.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now, I know what you're likely thinking, "Websockets!" This isn't wrong per se, you could absolutely implement this with websockets or SSE, but I'd strongly argue it's over-engineering the problem.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While you could introduce a real-time tracking service which connects to friends clients via Websocket or SSE and use pub-sub to broadcast updates to friends, this introduces a lot of unecessary complexity.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Instead, there are two key insights that suggest a simpler, polling mechanism will be more effective:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Updates are predictable: Unlike with Messenger or Live Comments, we know that the next update should come in the next 2-5 seconds. This predictability allows for efficient polling intervals.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Real-time precision isn't critical: Friends don't need to see up-to-the-second information. A slight delay of a few seconds is acceptable and won't significantly impact the user experience.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Informed by these insights, we can implement a simple polling mechanism where friends' clients periodically request updates at the same interval that the athlete's device is sending updates to the server (offset by a few seconds to account for latency).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can further enhance the user experience by implementing a smart buffering system. This approach involves intentionally lagging the displayed location data by one or two update intervals (e.g., 5-10 seconds). By buffering the data, we can create a smoother, more continuous animation of the athlete's movement. This eliminates the jarring effect of sudden position changes that can occur with real-time updates. To friends viewing the activity, the athlete will appear to be in constant motion, creating a more engaging, "live-stream-like" experience. While this approach sacrifices absolute real-time accuracy, it provides a significantly improved visual experience that better matches users' expectations of how a live tracking feature should look and feel. The intentional lag also helps compensate for any network latency, ensuring a more consistent experience across different network conditions.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="4-how-can-we-expose-a-leaderboard-of-top-athletes">4) How can we expose a leaderboard of top athletes?</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Another natural extension to this problem could be to expose a leader board of the top athletes by activity type and distance. We could filter by country, region, city, etc.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here are some approaches we could take:</div><div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Naive Approach</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The simplest thing we can do is to query the DB for all activities and then group them by user and sum the distance. We can assume we have some user table with basic information like name, email, country, etc.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This would look something like this:</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">SELECT</span><span>
</span><span>    u</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>name</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(64, 120, 242);">SUM</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>distance</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">as</span><span> total_distance
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">FROM</span><span> activities a
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">JOIN</span><span> users u </span><span class="token" style="color: rgb(166, 38, 164);">ON</span><span> a</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>userId </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> u</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>userId
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">WHERE</span><span> a</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>state </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"COMPLETE"</span><span>
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> a</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span class="token" style="color: rgb(166, 38, 164);">type</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"RUN"</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">GROUP</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">BY</span><span> u</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>userId
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">ORDER</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">BY</span><span> total_distance </span><span class="token" style="color: rgb(166, 38, 164);">DESC</span></code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Naturally, this query will be pretty slow given it is running an aggregation over millions of activities. There are several ways we can optimize this.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach faces significant scalability issues. As the number of activities increases, query performance will degrade rapidly. The system would need to scan and aggregate millions of records for each leaderboard request, leading to high latency and increased database load. Additionally, this method doesn't account for the dynamic nature of leaderboards, where rankings can change frequently as new activities are logged.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Periodic Aggregation</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-1">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To improve on the naive approach, we can implement a periodic aggregation system. This involves creating a separate leaderboard table that stores pre-calculated totals for each user. A background job would run at regular intervals (e.g., daily) to update these aggregates based on new activities. The leaderboard query then becomes a simple SELECT from this pre-aggregated table, sorted by total distance.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/c748faadfbc1dc5ba3c0717328af9d9a"></div></div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-1">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While this method significantly reduces query time for leaderboard requests, it introduces eventual consistency. The leaderboard won't reflect real-time changes, potentially leading to user confusion if their latest activity isn't immediately reflected in their ranking. In addition, determining the optimal frequency for updates can be tricky ‚Äì too frequent updates could strain system resources, while infrequent updates lead to stale data.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Real-time Leaderboard with Redis</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-2">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For a more scalable and real-time solution, we can leverage <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/deep-dives/redis" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Redis</a>, an in-memory data structure store. We'll use Redis Sorted Sets to maintain leaderboards, with user IDs as members and their total distances as scores. When a new activity is logged, we increment the user's score in the sorted set. To query the leaderboard, we simply retrieve the top N members from the sorted set, which Redis can do extremely efficiently.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">What happens when we want to filter by country or time range?</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To handle filtering by country or time range, we can extend our Redis-based approach:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For country filtering:
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We can create separate sorted sets for each country, e.g., "leaderboard:run:USA", "leaderboard:run:Canada", etc.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When an activity is logged, we update both the global leaderboard and the country-specific leaderboard.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">To query a country-specific leaderboard, we simply use the appropriate country-specific sorted set.</div></li>
</ul>
</div></li>
</ol><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Add an activity to the leaderboard</span><span>
</span><span>redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>zadd</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"leaderboard:run:global"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>user_id</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span> timestamp</span><span class="token" style="color: rgb(56, 58, 66);">}</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>zadd</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"leaderboard:run:USA"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>user_id</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span> timestamp</span><span class="token" style="color: rgb(56, 58, 66);">}</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Query the leaderboard</span><span>
</span><span>redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>zrange</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"leaderboard:run:global"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">0</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span class="token" style="color: rgb(183, 107, 1);">1</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> desc</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(183, 107, 1);">True</span><span class="token" style="color: rgb(56, 58, 66);">)</span></code></div></div></pre><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For time range filtering, we have a more sophisticated approach that combines both sorted sets and hashes:
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We'll use a combination of Redis sorted sets and hashes to store both timestamp and distance information.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For each activity, we'll store:
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">A sorted set entry with the activity ID as the member and timestamp as the score.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">A hash entry with the activity ID as the key, containing fields for user ID and distance.</div></li>
</ol>
</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When querying the leaderboard for a specific time range:
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Use ZRANGEBYSCORE to get activity IDs within the desired time range.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">For these activity IDs, retrieve the corresponding user IDs and distances from the hash.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Aggregate the distances by user ID in-memory.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Sort the aggregated results to produce the final leaderboard.</div></li>
</ol>
</div></li>
</ul>
</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here's a pseudo-code example of how this might work:</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># When logging a new activity</span><span>
</span><span>activity_id </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> generate_unique_id</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>zadd</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(80, 161, 79);">"activities:timestamps"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>activity_id</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span> timestamp</span><span class="token" style="color: rgb(56, 58, 66);">}</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>hset</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"activity:</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">activity_id</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> mapping</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(56, 58, 66);">{</span><span class="token" style="color: rgb(80, 161, 79);">"user_id"</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span> user_id</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"distance"</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span> distance</span><span class="token" style="color: rgb(56, 58, 66);">}</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Querying the leaderboard for last 24 hours</span><span>
</span><span>now </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> current_timestamp</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>day_ago </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> now </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">24</span><span class="token" style="color: rgb(64, 120, 242);">*</span><span class="token" style="color: rgb(183, 107, 1);">60</span><span class="token" style="color: rgb(64, 120, 242);">*</span><span class="token" style="color: rgb(183, 107, 1);">60</span><span>
</span><span>activity_ids </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>zrangebyscore</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(80, 161, 79);">"activities:timestamps"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> day_ago</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> now</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span>
<span>user_distances </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span class="token" style="color: rgb(56, 58, 66);">}</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">for</span><span> activity_id </span><span class="token" style="color: rgb(166, 38, 164);">in</span><span> activity_ids</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span>
</span><span>    activity_data </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>hgetall</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"activity:</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">activity_id</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">"</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>    user_id </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> activity_data</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(80, 161, 79);">"user_id"</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span>
</span><span>    distance </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">float</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>activity_data</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(80, 161, 79);">"distance"</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>    user_distances</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span>user_id</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> user_distances</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>get</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>user_id</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">0</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">+</span><span> distance
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Sort users by total distance</span><span>
</span><span>leaderboard </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">sorted</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>user_distances</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span>items</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> key</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(166, 38, 164);">lambda</span><span> x</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span> x</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(183, 107, 1);">1</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> reverse</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(183, 107, 1);">True</span><span class="token" style="color: rgb(56, 58, 66);">)</span></code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach allows us to efficiently filter by time range and aggregate distances, providing a real-time leaderboard that can be customized for different time periods. We can cache the results with a short TTL to limit the in-memory aggregation while still ensuring freshness.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1311.8718797904983 507.53477705126306">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1311.8718797904983" height="507.53477705126306" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 132.0535446714257) rotate(0 101.69001069646082 123.44484721677651)"><path d="M7.86 8.16 C7.86 8.16, 7.86 8.16, 7.86 8.16 M7.86 8.16 C7.86 8.16, 7.86 8.16, 7.86 8.16 M2.35 20.59 C5.02 14.18, 11.96 12.66, 18.1 2.48 M2.35 20.59 C6.6 15.18, 12.4 8.57, 18.1 2.48 M1.43 27.75 C7.15 22, 10.57 17, 24.4 1.33 M1.43 27.75 C8.88 20.13, 16.14 12.05, 24.4 1.33 M1.17 34.14 C9.43 22.52, 20.88 11.35, 30.7 0.18 M1.17 34.14 C11.93 22.48, 24.19 8.43, 30.7 0.18 M0.91 40.54 C10.45 31.41, 16.59 22.05, 36.34 -0.21 M0.91 40.54 C9.8 28.96, 21.27 18.03, 36.34 -0.21 M1.31 46.19 C14.99 33.44, 26.25 19.28, 41.33 0.15 M1.31 46.19 C13.3 32.52, 25.91 19.03, 41.33 0.15 M1.04 52.58 C12.34 43.86, 18.26 29.29, 46.31 0.51 M1.04 52.58 C15.91 35.89, 31.89 17.48, 46.31 0.51 M0.78 58.98 C17.52 41.51, 30.47 24.52, 51.96 0.11 M0.78 58.98 C20.23 37.35, 40.21 15.4, 51.96 0.11 M1.18 64.62 C19.83 45.57, 36.01 22.66, 56.94 0.47 M1.18 64.62 C14.19 49.99, 26.83 34.81, 56.94 0.47 M0.92 71.02 C17.23 52.67, 29.69 38.38, 62.59 0.08 M0.92 71.02 C24.37 44.1, 47.78 16.53, 62.59 0.08 M1.31 76.67 C17.67 59.58, 32.91 37.82, 67.57 0.44 M1.31 76.67 C25.15 50.34, 47.77 22.62, 67.57 0.44 M1.05 83.06 C19.24 66.71, 32.15 48.88, 73.22 0.04 M1.05 83.06 C20.27 58.54, 40.32 35.85, 73.22 0.04 M0.79 89.46 C20.55 69.91, 36.11 49.03, 78.2 0.41 M0.79 89.46 C24.62 62.29, 49.74 34.13, 78.2 0.41 M1.18 95.1 C20.73 72.49, 39.47 53.15, 83.85 0.01 M1.18 95.1 C25.4 68.4, 48.75 40.91, 83.85 0.01 M0.92 101.5 C18.99 81.05, 39.86 57.99, 88.83 0.37 M0.92 101.5 C33.18 63.82, 64.84 27.27, 88.83 0.37 M0.66 107.9 C25.92 81.43, 47.58 51.33, 94.48 -0.02 M0.66 107.9 C35.89 67.64, 72.38 24.06, 94.48 -0.02 M1.05 113.54 C29.68 80.57, 57.65 50.73, 99.46 0.34 M1.05 113.54 C35.64 74.74, 69.83 35.43, 99.46 0.34 M0.79 119.94 C33.28 81.99, 66.59 44.45, 104.45 0.7 M0.79 119.94 C27.42 86.43, 55.94 54.66, 104.45 0.7 M1.19 125.58 C29.17 96.46, 54.45 66, 110.09 0.3 M1.19 125.58 C38.14 83.86, 73.62 41.41, 110.09 0.3 M0.93 131.98 C30.63 99.3, 60.18 64.62, 115.08 0.66 M0.93 131.98 C39.73 88.6, 78.19 43.1, 115.08 0.66 M0.66 138.38 C27.9 103.53, 58.52 71.34, 120.72 0.27 M0.66 138.38 C27.04 105.98, 54.49 73.63, 120.72 0.27 M1.06 144.02 C47.04 92.72, 93.63 38.9, 125.71 0.63 M1.06 144.02 C44.92 94.25, 87.08 43.48, 125.71 0.63 M0.8 150.42 C44.86 99.19, 88.64 51.46, 131.35 0.23 M0.8 150.42 C47.11 95.08, 94.29 42.86, 131.35 0.23 M0.54 156.82 C45.85 103.66, 91.3 49.57, 136.34 0.59 M0.54 156.82 C46.96 104.71, 94.08 52.3, 136.34 0.59 M0.93 162.46 C46.1 112.11, 89.68 60.75, 141.98 0.2 M0.93 162.46 C37.59 120.14, 74.69 77.98, 141.98 0.2 M0.67 168.86 C45.38 115.87, 91.35 62.32, 146.97 0.56 M0.67 168.86 C42.45 118.79, 85.3 69.78, 146.97 0.56 M1.06 174.5 C46.85 120.17, 94.06 65.7, 152.61 0.16 M1.06 174.5 C45.39 121.54, 91.32 69.25, 152.61 0.16 M0.8 180.9 C39.97 137.32, 78.18 92.85, 157.6 0.52 M0.8 180.9 C49.88 124.27, 99.57 68.19, 157.6 0.52 M0.54 187.3 C59.92 118.44, 120.04 47.84, 162.59 0.88 M0.54 187.3 C41.95 137.79, 84.91 89.9, 162.59 0.88 M0.94 192.94 C55.03 128.1, 108.93 68.66, 168.23 0.49 M0.94 192.94 C37.45 150.69, 74.91 107.78, 168.23 0.49 M0.67 199.34 C49.54 142.85, 97.65 89.73, 173.22 0.85 M0.67 199.34 C61.8 128.43, 124.03 58.49, 173.22 0.85 M0.41 205.74 C66.39 129.82, 131.49 54.16, 178.86 0.45 M0.41 205.74 C65.62 128.81, 131.39 54.05, 178.86 0.45 M0.81 211.38 C57.48 144.04, 116.53 74.12, 182.54 2.32 M0.81 211.38 C41.3 165.57, 80.9 120.77, 182.54 2.32 M0.55 217.78 C42.72 169.6, 84.36 121.42, 186.87 3.44 M0.55 217.78 C39.18 173.49, 78.68 127.8, 186.87 3.44 M1.6 222.66 C69.27 144.33, 136.72 66, 191.2 4.55 M1.6 222.66 C56.68 158.68, 111.93 93.9, 191.2 4.55 M1.99 228.31 C72.71 145.48, 143.67 64.97, 194.22 7.18 M1.99 228.31 C65.88 153.22, 131.74 77.14, 194.22 7.18 M3.7 232.44 C68.21 161.61, 132.91 87.29, 196.58 10.56 M3.7 232.44 C52.18 176.45, 102.48 118.76, 196.58 10.56 M6.06 235.82 C65.58 169.05, 122.41 101.22, 199.6 13.18 M6.06 235.82 C59.76 175.94, 112.85 115.4, 199.6 13.18 M9.08 238.44 C73.08 162.66, 140.16 86.31, 201.3 17.31 M9.08 238.44 C49.33 190.76, 89.36 143.06, 201.3 17.31 M11.44 241.82 C77.11 166.06, 142.12 92.97, 202.36 22.2 M11.44 241.82 C55.28 191.48, 99.46 141.07, 202.36 22.2 M15.12 243.69 C55.03 200.58, 95.86 155.48, 202.75 27.85 M15.12 243.69 C66.73 185.89, 116.5 128.09, 202.75 27.85 M19.45 244.81 C67.79 189.71, 115.36 133.74, 203.8 32.73 M19.45 244.81 C88.87 165.3, 157.34 87.28, 203.8 32.73 M23.78 245.92 C75.02 189.13, 122.82 134.08, 204.2 38.38 M23.78 245.92 C88.52 170.97, 154.54 93.7, 204.2 38.38 M28.77 246.28 C69.53 199.84, 112.84 148.41, 203.93 44.78 M28.77 246.28 C93.71 172.79, 158.47 98.1, 203.93 44.78 M33.75 246.64 C72.77 204.46, 109.97 161.55, 203.67 51.17 M33.75 246.64 C78.44 192.15, 124.22 139.86, 203.67 51.17 M38.74 247 C88.29 191.33, 136.89 132.7, 204.07 56.82 M38.74 247 C77.47 202.81, 115.21 158.38, 204.07 56.82 M43.73 247.36 C83.66 203.65, 119.22 156.72, 203.81 63.21 M43.73 247.36 C101.16 179.15, 160.61 112.34, 203.81 63.21 M49.37 246.97 C91.42 200.18, 130.8 154.4, 204.2 68.86 M49.37 246.97 C90.92 201.6, 132.36 153.73, 204.2 68.86 M54.36 247.33 C93.27 198.87, 133.31 153.57, 203.94 75.26 M54.36 247.33 C90.99 204.57, 129.06 160.52, 203.94 75.26 M60 246.93 C93.06 211.75, 122.82 173.21, 203.68 81.65 M60 246.93 C104.4 193.92, 149.28 142.34, 203.68 81.65 M64.99 247.29 C118.44 186.63, 169.36 127.6, 204.07 87.3 M64.99 247.29 C115.26 189.26, 166.73 132.06, 204.07 87.3 M70.63 246.9 C104.1 207.13, 140.97 165.17, 203.81 93.69 M70.63 246.9 C118.27 195.09, 164.62 139.95, 203.81 93.69 M75.62 247.26 C117.45 195.82, 159.92 148.62, 204.2 99.34 M75.62 247.26 C120.61 194.91, 166.1 143.58, 204.2 99.34 M81.26 246.87 C121.52 202.73, 161.15 159.9, 203.94 105.73 M81.26 246.87 C111.72 211.48, 141.17 176.4, 203.94 105.73 M86.25 247.23 C118.37 213.94, 149.89 177.37, 203.68 112.13 M86.25 247.23 C119.31 210.38, 149.95 172.54, 203.68 112.13 M91.89 246.83 C130.76 204.27, 165.96 158.6, 204.08 117.78 M91.89 246.83 C116.81 218.05, 142.43 189.51, 204.08 117.78 M96.88 247.19 C118.29 219.72, 142.69 193.81, 203.82 124.17 M96.88 247.19 C122.77 218.08, 145.45 189.74, 203.82 124.17 M102.52 246.8 C135.56 209.63, 164.17 174.74, 204.21 129.82 M102.52 246.8 C143.86 199.42, 184.45 154.05, 204.21 129.82 M107.51 247.16 C142.74 206.21, 174.23 170.74, 203.95 136.21 M107.51 247.16 C140.56 208.35, 172.41 171.58, 203.95 136.21 M113.15 246.76 C135.54 221.5, 157.38 197.18, 203.69 142.61 M113.15 246.76 C134.18 223.3, 153.94 198.62, 203.69 142.61 M118.14 247.12 C149.7 208.75, 183.27 171.99, 204.08 148.25 M118.14 247.12 C146.47 215.4, 174.77 181.98, 204.08 148.25 M123.78 246.73 C155.5 212.78, 184.67 177.9, 203.82 154.65 M123.78 246.73 C145.64 220.53, 169.15 196.77, 203.82 154.65 M128.77 247.09 C154.13 218.1, 176.93 191.8, 204.21 160.3 M128.77 247.09 C156.06 215.32, 184.09 182.42, 204.21 160.3 M134.41 246.69 C159.99 219.41, 184.52 187.89, 203.95 166.69 M134.41 246.69 C151.24 226.96, 168.47 205.05, 203.95 166.69 M139.4 247.05 C161.29 223.54, 185.54 197.02, 203.69 173.09 M139.4 247.05 C154.44 230.38, 169.17 213.64, 203.69 173.09 M145.04 246.66 C163.44 224.62, 182.7 202.05, 204.09 178.73 M145.04 246.66 C166.46 221.33, 187.65 197.34, 204.09 178.73 M150.03 247.02 C168.23 225.85, 184.53 207.75, 203.82 185.13 M150.03 247.02 C167.21 227.91, 183.72 206.43, 203.82 185.13 M155.67 246.62 C174 224.91, 190.08 205.57, 204.22 190.78 M155.67 246.62 C172.35 228.01, 188.75 207.32, 204.22 190.78 M160.66 246.98 C170.72 235.64, 183.87 220.66, 203.96 197.17 M160.66 246.98 C173.13 233.27, 184.33 219.66, 203.96 197.17 M165.65 247.34 C175.94 234.59, 184.31 225.71, 203.7 203.57 M165.65 247.34 C174.52 236.18, 184.58 223.78, 203.7 203.57 M171.29 246.95 C181.12 234.61, 191.99 221.06, 204.09 209.21 M171.29 246.95 C182.01 234.69, 192 224.16, 204.09 209.21 M176.93 246.55 C185.7 236.85, 196.74 224.96, 203.83 215.61 M176.93 246.55 C184.26 237.14, 193.32 227.86, 203.83 215.61 M182.57 246.16 C189.22 236.16, 196.08 230.52, 202.91 222.76 M182.57 246.16 C189.02 238.92, 194.78 230.58, 202.91 222.76 M190.84 242.75 C194.17 239.21, 196.75 238.23, 200.03 232.18 M190.84 242.75 C193.79 239.52, 196.78 235.64, 200.03 232.18" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M32 0 C87.72 -0.4, 139.03 -0.3, 171.38 0 M32 0 C80.84 0.84, 131.85 1.42, 171.38 0 M171.38 0 C192.94 1.71, 204.35 10.09, 203.38 32 M171.38 0 C191.96 0.8, 205.21 10.42, 203.38 32 M203.38 32 C205.57 79.52, 204.73 127.74, 203.38 214.89 M203.38 32 C204.77 98.85, 205.23 163.69, 203.38 214.89 M203.38 214.89 C203.56 236.72, 192.49 248.65, 171.38 246.89 M203.38 214.89 C202.76 236.46, 192 248.62, 171.38 246.89 M171.38 246.89 C135.59 248.01, 95.22 246.43, 32 246.89 M171.38 246.89 C124.73 247.95, 79.95 248.84, 32 246.89 M32 246.89 C10.34 246.21, -1.15 234.74, 0 214.89 M32 246.89 C11.08 248.23, 0.48 236.45, 0 214.89 M0 214.89 C0.9 147.58, 0.03 80.9, 0 32 M0 214.89 C0.34 145.61, 0.26 75.1, 0 32 M0 32 C-1.29 9.14, 11.61 -1.96, 32 0 M0 32 C-1.21 9.05, 9.66 0.19, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(351.4138013514363 172.169950573214) rotate(0 104.8671875 73.154296875)"><path d="M7.86 8.16 C7.86 8.16, 7.86 8.16, 7.86 8.16 M7.86 8.16 C7.86 8.16, 7.86 8.16, 7.86 8.16 M2.35 20.59 C7.35 17.95, 9.66 12.73, 18.1 2.48 M2.35 20.59 C6.15 15.75, 8.52 12.86, 18.1 2.48 M1.43 27.75 C9.58 18.26, 19.49 7.84, 24.4 1.33 M1.43 27.75 C8.52 20.65, 14.34 11.76, 24.4 1.33 M1.17 34.14 C11.12 22.57, 20.09 14.63, 30.7 0.18 M1.17 34.14 C8.11 26.55, 12.73 20.2, 30.7 0.18 M0.91 40.54 C9.44 29.91, 19.52 19.05, 36.34 -0.21 M0.91 40.54 C12.27 29.01, 22.28 15.43, 36.34 -0.21 M1.31 46.19 C11.08 35.46, 19.86 25.68, 41.33 0.15 M1.31 46.19 C15.57 31.17, 27.8 14.48, 41.33 0.15 M1.04 52.58 C9.47 38.15, 22.74 27.4, 46.97 -0.25 M1.04 52.58 C15.67 35.97, 28.85 20.91, 46.97 -0.25 M0.78 58.98 C13.74 43.39, 30.45 24.91, 51.96 0.11 M0.78 58.98 C21.72 36.33, 41 13.08, 51.96 0.11 M1.18 64.62 C20.3 40.5, 38.51 19.08, 57.6 -0.28 M1.18 64.62 C23.47 38.69, 44.4 12.72, 57.6 -0.28 M0.92 71.02 C23.9 44.7, 49.42 18.37, 62.59 0.08 M0.92 71.02 C20.67 47.96, 41.32 23.46, 62.59 0.08 M0.65 77.42 C20.15 51.93, 42.96 29.99, 67.57 0.44 M0.65 77.42 C25.92 47.2, 50.57 16.69, 67.57 0.44 M1.05 83.06 C15.94 64.85, 32.88 45.4, 73.22 0.04 M1.05 83.06 C27.13 53.07, 53.35 22.78, 73.22 0.04 M0.79 89.46 C18.11 67.76, 37.42 47, 78.2 0.41 M0.79 89.46 C17.83 70.62, 34.26 50.74, 78.2 0.41 M0.53 95.86 C20.25 75.08, 37.9 51.15, 83.85 0.01 M0.53 95.86 C26.18 65.84, 52.28 34.61, 83.85 0.01 M0.92 101.5 C28.22 71, 53.87 41.83, 88.83 0.37 M0.92 101.5 C31.13 66.58, 61.82 30.55, 88.83 0.37 M0.66 107.9 C29.56 70.45, 62.84 37.68, 94.48 -0.02 M0.66 107.9 C22.2 81.66, 44.17 58.19, 94.48 -0.02 M0.4 114.3 C25.36 87.62, 49.03 57.77, 99.46 0.34 M0.4 114.3 C36.78 72.5, 72.73 31.47, 99.46 0.34 M0.79 119.94 C42.04 73.81, 79.9 27.9, 105.11 -0.06 M0.79 119.94 C40.54 75.49, 78.9 31.65, 105.11 -0.06 M1.84 124.83 C34.27 87.54, 68.01 46.02, 110.09 0.3 M1.84 124.83 C40.57 78.64, 80.42 32.89, 110.09 0.3 M2.89 129.72 C25.71 102.62, 50.73 77.84, 115.74 -0.09 M2.89 129.72 C28.86 98.18, 54.86 66.66, 115.74 -0.09 M5.26 133.1 C42.77 91.56, 77.87 51.11, 120.72 0.27 M5.26 133.1 C48.76 82.48, 93.71 33.09, 120.72 0.27 M7.62 136.47 C45.8 93.14, 82.58 49.65, 126.37 -0.13 M7.62 136.47 C46.41 89.33, 87.29 44.35, 126.37 -0.13 M9.98 139.85 C50.98 95.35, 90.98 47.93, 131.35 0.23 M9.98 139.85 C52.75 93.02, 95.07 44.62, 131.35 0.23 M13.66 141.72 C57.2 89.91, 103.22 37.14, 137 -0.16 M13.66 141.72 C40.36 113.55, 64.56 85.93, 137 -0.16 M17.33 143.59 C47.82 107.73, 77.99 70.16, 141.98 0.2 M17.33 143.59 C61.79 93.4, 105.42 43.56, 141.98 0.2 M21.66 144.71 C63.04 96, 104.72 51.46, 147.63 -0.2 M21.66 144.71 C70.54 88.63, 119.36 31.91, 147.63 -0.2 M25.99 145.82 C74.8 89.58, 126.28 31.25, 152.61 0.16 M25.99 145.82 C73.87 91.69, 119.41 39.11, 152.61 0.16 M30.98 146.18 C72.89 98.21, 112.8 49.71, 158.26 -0.23 M30.98 146.18 C66.74 106.88, 102.73 66.75, 158.26 -0.23 M35.97 146.54 C73.85 101.37, 112.58 57.87, 163.24 0.13 M35.97 146.54 C78.13 100.41, 119.18 52.21, 163.24 0.13 M41.61 146.15 C90.58 91.92, 140.74 33.59, 168.89 -0.27 M41.61 146.15 C74.52 108.63, 107.78 69.42, 168.89 -0.27 M46.6 146.51 C93.58 95.02, 138.87 41.9, 173.87 0.09 M46.6 146.51 C78.76 112.16, 110.54 76.88, 173.87 0.09 M52.24 146.11 C88.21 104.29, 125.59 62.28, 178.86 0.45 M52.24 146.11 C98.15 94.7, 144.21 42.63, 178.86 0.45 M57.23 146.47 C104.1 90.37, 149.95 36.75, 183.85 0.81 M57.23 146.47 C94.17 104.84, 129.92 61.74, 183.85 0.81 M62.87 146.08 C101.2 101.84, 140.64 55.29, 188.18 1.93 M62.87 146.08 C91.5 112.85, 120.2 80.37, 188.18 1.93 M67.86 146.44 C113.25 93.07, 159.13 42.46, 192.51 3.04 M67.86 146.44 C110.34 95.7, 154.55 46.91, 192.51 3.04 M73.5 146.04 C109.05 106.28, 145.21 66.42, 196.18 4.91 M73.5 146.04 C113.2 100.09, 153.19 53.84, 196.18 4.91 M78.49 146.4 C104.06 117.41, 128.23 89.57, 199.86 6.78 M78.49 146.4 C103.61 117.92, 128.31 89.43, 199.86 6.78 M83.48 146.76 C126.14 95.43, 168.77 44.12, 202.88 9.41 M83.48 146.76 C123.44 101.4, 161.69 57.3, 202.88 9.41 M89.12 146.37 C134.65 95.48, 175.91 45.25, 205.24 12.79 M89.12 146.37 C133.05 93.25, 178.54 43.06, 205.24 12.79 M94.11 146.73 C118.03 121.26, 140.57 91.02, 206.95 16.92 M94.11 146.73 C134.86 100.4, 173.29 53.33, 206.95 16.92 M99.75 146.34 C124.38 120.48, 144.41 92.45, 208.65 21.05 M99.75 146.34 C136.8 102.98, 174.59 59.63, 208.65 21.05 M104.74 146.7 C130 116.3, 158.59 84.18, 209.71 25.94 M104.74 146.7 C140.19 106.99, 174.96 66.41, 209.71 25.94 M110.38 146.3 C131.67 121.98, 156.46 95.49, 209.44 32.34 M110.38 146.3 C134.01 117.53, 158.22 91.47, 209.44 32.34 M115.37 146.66 C135.04 122.06, 156.2 101.79, 209.84 37.98 M115.37 146.66 C135.77 122.94, 155.89 97.77, 209.84 37.98 M121.01 146.27 C141.9 122.14, 159.78 102.48, 209.58 44.38 M121.01 146.27 C152.53 110.41, 185.58 73.27, 209.58 44.38 M126 146.63 C154.5 112.25, 180.23 80.82, 209.32 50.78 M126 146.63 C157.84 108.91, 188.86 71.99, 209.32 50.78 M131.64 146.23 C159.89 108.48, 193.54 76.57, 209.71 56.42 M131.64 146.23 C157.73 117.99, 181.66 89.15, 209.71 56.42 M136.63 146.59 C153.09 128.04, 170.68 104.96, 209.45 62.82 M136.63 146.59 C153.63 127, 169.07 108.89, 209.45 62.82 M142.27 146.2 C165.48 118.86, 190.65 91.61, 209.84 68.46 M142.27 146.2 C158.94 126.72, 175.84 107.16, 209.84 68.46 M147.26 146.56 C160.53 128.16, 176.73 113.91, 209.58 74.86 M147.26 146.56 C168.93 121.77, 192.35 95.37, 209.58 74.86 M152.9 146.16 C175.06 121.75, 197.72 95.26, 209.32 81.26 M152.9 146.16 C164.78 134.11, 175.64 121.05, 209.32 81.26 M157.89 146.52 C177.98 124.18, 197.67 101.68, 209.71 86.9 M157.89 146.52 C169.57 131.99, 180.77 119.51, 209.71 86.9 M163.53 146.13 C179.35 127.89, 198.32 106.89, 209.45 93.3 M163.53 146.13 C180.51 127.27, 195.95 108.9, 209.45 93.3 M168.52 146.49 C178.25 138.34, 184.82 127.81, 209.19 99.7 M168.52 146.49 C179.3 133.16, 190.88 119.64, 209.19 99.7 M174.16 146.09 C181.72 138.56, 187.8 128.56, 209.59 105.34 M174.16 146.09 C187.71 128.95, 202.2 113.95, 209.59 105.34 M179.15 146.45 C185.69 135.7, 193.89 126.77, 209.33 111.74 M179.15 146.45 C186.26 138.24, 191.84 131.8, 209.33 111.74 M185.45 145.31 C191.34 138.21, 195.47 131.18, 209.06 118.14 M185.45 145.31 C192.84 134.8, 202.14 125.83, 209.06 118.14 M191.74 144.16 C196.73 137.64, 206.5 128.94, 208.8 124.53 M191.74 144.16 C198.41 138.11, 203.88 130.99, 208.8 124.53" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M32 0 C63.99 -0.29, 99.08 0.07, 177.73 0 M32 0 C66.99 0.59, 101.04 0.92, 177.73 0 M177.73 0 C200.04 -0.58, 209.08 11.36, 209.73 32 M177.73 0 C200.9 -0.24, 208.84 12.55, 209.73 32 M209.73 32 C209.87 57.55, 211.27 84, 209.73 114.31 M209.73 32 C210.3 60.8, 209.87 91.66, 209.73 114.31 M209.73 114.31 C209.51 137.4, 198.52 146.52, 177.73 146.31 M209.73 114.31 C209.02 137.37, 198.33 148.14, 177.73 146.31 M177.73 146.31 C118.11 144.28, 62 145.01, 32 146.31 M177.73 146.31 C123.3 147.1, 67.16 145.92, 32 146.31 M32 146.31 C9.51 144.82, 0.36 136.81, 0 114.31 M32 146.31 C11.15 146.53, 1.46 133.83, 0 114.31 M0 114.31 C-1.19 95.58, 1.82 78.2, 0 32 M0 114.31 C-0.14 89.98, -0.36 66.39, 0 32 M0 32 C0.94 8.71, 9.62 -1.41, 32 0 M0 32 C-1 10.86, 10.96 0.41, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(397.85702339733473 235.324247448214) rotate(0 58.42396545410156 10)"><text x="58.42396545410156" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Activity Server</text></g><g stroke-linecap="round" transform="translate(737.1839695182254 148.39137945851326) rotate(0 89.798828125 92)"><path d="M25.91 27.83 C25.91 27.83, 25.91 27.83, 25.91 27.83 M25.91 27.83 C25.91 27.83, 25.91 27.83, 25.91 27.83 M10.56 51.58 C16.46 44.6, 20.5 36.52, 39.43 18.37 M10.56 51.58 C18.6 41.73, 29.31 31.64, 39.43 18.37 M8.33 60.24 C22.46 45.01, 35.78 29.31, 52.94 8.92 M8.33 60.24 C23.36 41.44, 38.5 24.2, 52.94 8.92 M7.41 67.4 C20.66 54.09, 29.26 39.44, 57.27 10.04 M7.41 67.4 C25.57 45.66, 45.19 23.96, 57.27 10.04 M6.5 74.55 C24.4 54.41, 42.65 31.07, 63.57 8.89 M6.5 74.55 C22.84 54.07, 38.89 36.55, 63.57 8.89 M4.92 82.46 C26.66 58.41, 49.38 32.21, 70.53 6.98 M4.92 82.46 C26.41 55.62, 49.48 30.18, 70.53 6.98 M4.01 89.61 C34.47 56.81, 62.85 22.99, 76.83 5.84 M4.01 89.61 C30.15 59.66, 56.63 29.27, 76.83 5.84 M3.74 96.01 C30.16 66.36, 55.07 39.25, 83.13 4.69 M3.74 96.01 C33.28 61.2, 63.82 26.53, 83.13 4.69 M4.79 100.89 C35.61 64.3, 71.2 27.97, 90.74 2.03 M4.79 100.89 C32.64 66.95, 63.18 35.21, 90.74 2.03 M5.85 105.78 C27.55 84, 46.24 59.64, 95.73 2.39 M5.85 105.78 C41.27 64.41, 77.05 23.97, 95.73 2.39 M6.9 110.67 C44.84 70.09, 81.81 29.33, 100.06 3.5 M6.9 110.67 C42.9 67.07, 80.11 26.28, 100.06 3.5 M7.95 115.56 C42.01 76.57, 77.71 35.52, 104.39 4.62 M7.95 115.56 C28.1 92.32, 48.32 70.55, 104.39 4.62 M9 120.45 C41.09 84.61, 70.48 46.63, 109.37 4.98 M9 120.45 C45.16 77.94, 81.6 36.33, 109.37 4.98 M9.39 126.09 C30.87 98.53, 53.81 73.57, 113.71 6.09 M9.39 126.09 C49.47 78.93, 90.23 32.85, 113.71 6.09 M10.44 130.98 C48.46 87.81, 85.6 45.01, 118.69 6.45 M10.44 130.98 C39.66 96.77, 69.46 64.47, 118.69 6.45 M12.81 134.36 C53.74 91.45, 89.03 44.94, 123.68 6.81 M12.81 134.36 C56.68 86.05, 99.31 36.98, 123.68 6.81 M15.17 137.74 C39.28 108.1, 63.82 81.63, 126.7 9.44 M15.17 137.74 C56.77 90.11, 99.17 41.85, 126.7 9.44 M16.88 141.87 C51.1 100.87, 89.11 57.37, 130.37 11.31 M16.88 141.87 C41.09 114.45, 66.33 86.73, 130.37 11.31 M19.24 145.25 C63.24 92.76, 107.31 43.95, 133.39 13.93 M19.24 145.25 C60.96 97.69, 101.4 50.79, 133.39 13.93 M21.6 148.63 C59.84 108.2, 94.51 65.9, 137.07 15.8 M21.6 148.63 C65.35 96.55, 110.78 44.45, 137.07 15.8 M23.96 152.01 C48.54 123.35, 77.34 91.44, 140.09 18.42 M23.96 152.01 C63.69 109, 101.07 65.43, 140.09 18.42 M26.33 155.39 C70.52 104.03, 114.49 54.42, 143.76 20.29 M26.33 155.39 C66.92 111.11, 106.39 65.97, 143.76 20.29 M28.03 159.52 C58.58 124.04, 88.76 88.44, 146.78 22.92 M28.03 159.52 C51.85 132.19, 75.85 104.15, 146.78 22.92 M31.71 161.39 C73.36 113.24, 110.97 67.32, 149.8 25.54 M31.71 161.39 C57.26 131.97, 83.11 101.71, 149.8 25.54 M34.73 164.01 C71.76 118.78, 111.58 74.64, 153.47 27.41 M34.73 164.01 C73.82 119.43, 112.78 74.22, 153.47 27.41 M38.4 165.88 C73.16 128.56, 109.6 87.56, 155.84 30.79 M38.4 165.88 C77.45 120.21, 117.45 74.09, 155.84 30.79 M41.42 168.51 C87.65 116.24, 134.02 63.14, 158.2 34.17 M41.42 168.51 C72.05 133, 104.81 96.8, 158.2 34.17 M45.1 170.38 C83.66 124.2, 122.33 77.75, 160.56 37.55 M45.1 170.38 C77.32 134.64, 107.62 98.27, 160.56 37.55 M48.11 173 C87.81 127.87, 128.85 80.39, 162.92 40.93 M48.11 173 C74.5 141.56, 101.63 111.09, 162.92 40.93 M51.79 174.87 C76.6 145.8, 102.32 115.11, 165.29 44.31 M51.79 174.87 C92.56 127.12, 133.57 81.84, 165.29 44.31 M55.46 176.74 C81.37 146.82, 105 115.75, 167.65 47.69 M55.46 176.74 C79.52 150.28, 102.19 123.25, 167.65 47.69 M58.48 179.36 C92.32 141.83, 125.08 103.2, 170.01 51.06 M58.48 179.36 C85.3 149.4, 112.26 117.53, 170.01 51.06 M63.47 179.72 C104.67 130.72, 148.65 83.59, 172.38 54.44 M63.47 179.72 C88.5 148.76, 115.88 118.08, 172.38 54.44 M67.8 180.84 C105.19 136.81, 143.64 92.12, 174.74 57.82 M67.8 180.84 C98.95 145.53, 129.96 110.12, 174.74 57.82 M72.79 181.2 C104.7 145.93, 137.45 108.8, 176.45 61.96 M72.79 181.2 C114.33 135.59, 153.78 89.04, 176.45 61.96 M77.12 182.31 C100.46 157.52, 122.71 128.39, 177.5 66.84 M77.12 182.31 C118.18 134.92, 157.05 89.05, 177.5 66.84 M81.45 183.43 C118.39 141.18, 154.93 95.42, 178.55 71.73 M81.45 183.43 C112.81 147.31, 144.67 112.48, 178.55 71.73 M86.44 183.79 C118.46 144.53, 152.35 108.41, 179.6 76.62 M86.44 183.79 C121.49 143.31, 157.55 101.09, 179.6 76.62 M90.77 184.9 C122.05 147.1, 159.17 108.81, 180.65 81.51 M90.77 184.9 C121.98 151.04, 151.42 115.73, 180.65 81.51 M94.44 186.77 C111.19 164.34, 132.09 143.2, 181.7 86.4 M94.44 186.77 C125.63 148.08, 158.24 111.07, 181.7 86.4 M101.4 184.87 C126.45 152.34, 154.52 123.47, 182.09 92.04 M101.4 184.87 C131.5 150.42, 161.27 115.9, 182.09 92.04 M107.7 183.72 C131.82 156.23, 153.49 131.66, 180.52 99.95 M107.7 183.72 C124.1 164.25, 140.36 146.15, 180.52 99.95 M114 182.57 C131.61 164.82, 145.11 143.8, 178.95 107.85 M114 182.57 C136.91 157.4, 159.28 130.11, 178.95 107.85 M120.3 181.42 C143.23 157.61, 161.57 133.08, 177.37 115.76 M120.3 181.42 C138.31 158.8, 157.11 138.62, 177.37 115.76 M127.91 178.76 C138.44 167.56, 151.73 152.01, 173.83 125.93 M127.91 178.76 C139.68 165.9, 151.41 153.22, 173.83 125.93 M143.39 167.05 C147.76 160.05, 156.74 154.93, 159.14 148.93 M143.39 167.05 C148.54 160.06, 155.92 154.41, 159.14 148.93" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M54.58 7.72 C64.16 1.97, 77.83 0.77, 89.15 0.5 C100.47 0.23, 111.91 1.74, 122.48 6.1 C133.05 10.46, 144.31 18.52, 152.57 26.66 C160.84 34.81, 167.43 44.34, 172.07 54.99 C176.71 65.63, 180.14 78.75, 180.4 90.53 C180.67 102.31, 178.03 114.75, 173.67 125.68 C169.32 136.61, 162.19 147.52, 154.27 156.1 C146.36 164.67, 136.56 172.47, 126.17 177.13 C115.78 181.78, 103.37 183.88, 91.91 184.04 C80.44 184.2, 68.29 182.39, 57.38 178.09 C46.47 173.79, 34.75 166.49, 26.46 158.22 C18.18 149.96, 11.93 139.34, 7.67 128.51 C3.41 117.68, 1.11 105.03, 0.89 93.27 C0.68 81.5, 2.19 68.83, 6.38 57.91 C10.56 46.99, 17.43 36.15, 26 27.72 C34.58 19.29, 51.92 10.82, 57.83 7.33 C63.73 3.85, 61.14 5.69, 61.43 6.8 M102.73 1.03 C114.02 1.35, 127.73 8.65, 137.62 14.67 C147.5 20.69, 155.6 28.09, 162.03 37.16 C168.46 46.24, 173.38 57.47, 176.18 69.11 C178.98 80.74, 180.37 95.15, 178.81 106.96 C177.25 118.77, 172.68 130.27, 166.84 139.95 C161 149.64, 153.29 158.23, 143.78 165.06 C134.27 171.9, 121.17 178.18, 109.78 180.98 C98.39 183.78, 86.66 183.38, 75.43 181.85 C64.19 180.33, 52.13 177.76, 42.35 171.81 C32.58 165.85, 23.49 155.74, 16.77 146.12 C10.05 136.51, 4.76 125.69, 2.03 114.13 C-0.69 102.57, -1.26 88.62, 0.42 76.78 C2.1 64.93, 5.93 53.13, 12.11 43.05 C18.28 32.97, 28.2 23.2, 37.48 16.29 C46.75 9.37, 56.85 4.07, 67.75 1.56 C78.66 -0.96, 96.94 0.94, 102.89 1.21 C108.85 1.48, 103.5 1.53, 103.47 3.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(770.9854678510108 180.33755558935093) rotate(0 55.999969482421875 60)"><text x="55.999969482421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text><text x="55.999969482421875" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- shard by </text><text x="55.999969482421875" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">completionTime</text><text x="55.999969482421875" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- offload old </text><text x="55.999969482421875" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">data to cold </text><text x="55.999969482421875" y="100" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">storage</text></g><g stroke-linecap="round"><g transform="translate(226.10299988424106 251.48696655325693) rotate(0 57.651494483597475 -1.2073361150210644)"><path d="M0.63 0.64 C20.03 0.41, 96.23 -0.82, 115.44 -1.39 M-0.5 -0.07 C18.84 -0.61, 95.24 -2.72, 114.57 -2.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(226.10299988424106 251.48696655325693) rotate(0 57.651494483597475 -1.2073361150210644)"><path d="M28.65 -10.08 C23.59 -7.37, 18.13 -4.29, 0.63 0.64 M28.65 -10.08 C21.81 -7.18, 13.02 -3.35, 0.63 0.64" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(226.10299988424106 251.48696655325693) rotate(0 57.651494483597475 -1.2073361150210644)"><path d="M28.98 10.44 C23.86 8.68, 18.32 7.28, 0.63 0.64 M28.98 10.44 C22.12 7.77, 13.24 6.04, 0.63 0.64" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(226.10299988424106 251.48696655325693) rotate(0 57.651494483597475 -1.2073361150210644)"><path d="M86.6 7.89 C93.77 5.6, 100.51 3.97, 114.57 -2.98 M86.6 7.89 C95.02 4.74, 101.41 2.72, 114.57 -2.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(226.10299988424106 251.48696655325693) rotate(0 57.651494483597475 -1.2073361150210644)"><path d="M86.16 -12.63 C93.41 -10.44, 100.25 -7.6, 114.57 -2.98 M86.16 -12.63 C94.63 -10.21, 101.14 -6.67, 114.57 -2.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(570.0309888514363 248.845731823214) rotate(0 75.98623928829198 0.77056783987382)"><path d="M0.14 1.02 C25.46 1.12, 127.31 1.04, 152.55 1.2 M-1.25 0.52 C23.91 0.73, 126.6 2.66, 151.91 2.55" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.0309888514363 248.845731823214) rotate(0 75.98623928829198 0.77056783987382)"><path d="M28.34 -9.22 C20.16 -4.61, 7.95 -2.62, 0.14 1.02 M28.34 -9.22 C18.59 -5, 9.61 -2.04, 0.14 1.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.0309888514363 248.845731823214) rotate(0 75.98623928829198 0.77056783987382)"><path d="M28.32 11.31 C20.05 8.69, 7.83 3.44, 0.14 1.02 M28.32 11.31 C18.41 8.65, 9.44 4.74, 0.14 1.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.0309888514363 248.845731823214) rotate(0 75.98623928829198 0.77056783987382)"><path d="M123.63 12.56 C135.25 9.97, 142.93 4.82, 151.91 2.55 M123.63 12.56 C132.63 10.06, 142.56 6.24, 151.91 2.55" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(570.0309888514363 248.845731823214) rotate(0 75.98623928829198 0.77056783987382)"><path d="M123.81 -7.96 C135.47 -3.32, 143.09 -1.24, 151.91 2.55 M123.81 -7.96 C132.91 -3.59, 142.78 -0.54, 151.91 2.55" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(952.6726559409877 118.85968285603121) rotate(0 116.71992492675787 60)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Activity</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- id (PK)</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- type: RUN | BIKE</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- startTime</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- status</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- statusUpdateEvents: JSON</text></g><g stroke-linecap="round" transform="translate(25.811172429670478 190.75426093663555) rotate(0 87.79113108585798 22.4585913983438)"><path d="M2.99 2.6 C2.99 2.6, 2.99 2.6, 2.99 2.6 M2.99 2.6 C2.99 2.6, 2.99 2.6, 2.99 2.6 M0.76 11.26 C3.79 7.74, 8.02 3.55, 9.94 0.69 M0.76 11.26 C3.82 8.56, 5.95 4.57, 9.94 0.69 M0.5 17.66 C6.15 10.83, 10.92 7.72, 15.59 0.3 M0.5 17.66 C4.42 13.59, 6.08 10.64, 15.59 0.3 M0.89 23.3 C5.27 17.61, 11.08 11.67, 20.57 0.66 M0.89 23.3 C7.41 17.12, 12.75 8.91, 20.57 0.66 M0.63 29.7 C7.13 22.92, 12.52 17.04, 26.22 0.27 M0.63 29.7 C9.97 20.45, 17.25 9.45, 26.22 0.27 M1.03 35.34 C5.93 25.3, 15.51 18.79, 31.2 0.63 M1.03 35.34 C10.87 24.29, 19.3 14.69, 31.2 0.63 M2.08 40.23 C10.59 29.94, 22.7 16.75, 36.85 0.23 M2.08 40.23 C16.6 25.1, 29.45 9.24, 36.85 0.23 M5.1 42.85 C17.53 26.76, 28.89 13.21, 41.83 0.59 M5.1 42.85 C19.77 25.86, 32.99 8.77, 41.83 0.59 M8.77 44.72 C23.17 28.34, 39.88 12.14, 47.48 0.2 M8.77 44.72 C20.89 30.62, 33.93 14.86, 47.48 0.2 M14.41 44.33 C25.01 29.34, 38.91 17.64, 52.46 0.56 M14.41 44.33 C28.87 27.15, 42.43 9.38, 52.46 0.56 M19.4 44.69 C26.99 35.46, 36.28 24.81, 58.11 0.16 M19.4 44.69 C33.07 28.39, 47.12 12.1, 58.11 0.16 M25.04 44.29 C33.34 33.46, 43.25 23.52, 63.09 0.52 M25.04 44.29 C33.2 35.5, 41.12 25.41, 63.09 0.52 M30.03 44.66 C39.68 35.41, 46.97 23.41, 68.08 0.88 M30.03 44.66 C41.3 31.36, 53.19 16.47, 68.08 0.88 M35.67 44.26 C48.19 30.68, 59.33 18.19, 73.72 0.49 M35.67 44.26 C48.46 29.19, 61.76 13.16, 73.72 0.49 M40.66 44.62 C51.74 28.26, 66.92 16.31, 78.71 0.85 M40.66 44.62 C48.9 33.45, 58.2 24.56, 78.71 0.85 M46.3 44.23 C56.76 34.19, 65.52 21.49, 84.35 0.45 M46.3 44.23 C60.39 28.38, 74.17 12.85, 84.35 0.45 M51.29 44.59 C67.37 27.88, 79.74 11.29, 89.34 0.81 M51.29 44.59 C65.72 27.94, 79.43 12.47, 89.34 0.81 M56.93 44.19 C68.42 32.26, 80.61 15.53, 94.98 0.42 M56.93 44.19 C69.99 27.8, 84.29 11.44, 94.98 0.42 M61.92 44.55 C68.98 35.29, 78.61 28.22, 99.97 0.78 M61.92 44.55 C70.84 34.13, 79.05 23.09, 99.97 0.78 M66.91 44.91 C79.38 30.59, 90.32 17.93, 105.62 0.38 M66.91 44.91 C80.93 27.71, 97 11.53, 105.62 0.38 M72.55 44.52 C85.69 30.87, 97.2 16.46, 110.6 0.74 M72.55 44.52 C84.58 28.91, 98.3 15.18, 110.6 0.74 M77.54 44.88 C91.38 31.83, 103.72 16.23, 115.59 1.1 M77.54 44.88 C91.14 30.54, 104.49 15.47, 115.59 1.1 M83.18 44.48 C96.01 28.35, 111.32 10.91, 121.23 0.71 M83.18 44.48 C91.99 35.44, 99 27.6, 121.23 0.71 M88.17 44.84 C97.65 34.14, 106.11 21.54, 126.22 1.07 M88.17 44.84 C101.66 29.55, 115.14 14.39, 126.22 1.07 M93.81 44.45 C105.93 28.83, 118.8 17.42, 131.86 0.67 M93.81 44.45 C108.73 27.94, 123.42 10.49, 131.86 0.67 M98.8 44.81 C112.08 29.2, 128.9 10.74, 136.85 1.04 M98.8 44.81 C113.58 28, 126.48 12.98, 136.85 1.04 M104.44 44.41 C118.22 30.21, 129.1 15.11, 142.49 0.64 M104.44 44.41 C114.87 32.96, 126.41 20.96, 142.49 0.64 M109.43 44.77 C120.03 31.06, 131.79 18.61, 147.48 1 M109.43 44.77 C122.2 31.12, 134.47 16.03, 147.48 1 M114.41 45.13 C127.97 30.02, 143.52 11.51, 153.12 0.61 M114.41 45.13 C123.97 34.38, 134.36 21.47, 153.12 0.61 M120.06 44.74 C135.32 29.63, 148.45 13.52, 158.11 0.97 M120.06 44.74 C129.74 34.73, 139.67 24.59, 158.11 0.97 M125.04 45.1 C136.31 32.74, 148.04 20.23, 163.1 1.33 M125.04 45.1 C138.79 29.95, 152.85 14.69, 163.1 1.33 M130.69 44.7 C144.35 27.13, 157.4 11.24, 168.74 0.93 M130.69 44.7 C142.21 32.41, 152.03 19.14, 168.74 0.93 M135.68 45.06 C145.52 33.72, 156.8 19.56, 171.76 3.56 M135.68 45.06 C144.11 35.01, 152.58 25.8, 171.76 3.56 M141.32 44.67 C153.1 29.63, 165.72 17.28, 174.78 6.18 M141.32 44.67 C152.37 30.94, 165.1 18.36, 174.78 6.18 M146.31 45.03 C155.11 35.72, 164.19 27.01, 175.83 11.07 M146.31 45.03 C155.46 34.2, 165.72 22.15, 175.83 11.07 M151.95 44.64 C156.83 39.54, 160.97 34.72, 175.57 17.47 M151.95 44.64 C156.72 39.12, 161.64 33.4, 175.57 17.47 M156.94 45 C163.78 36.58, 169.55 27.67, 175.3 23.86 M156.94 45 C163.93 38.26, 169.33 31.95, 175.3 23.86 M161.92 45.36 C168.25 39.91, 170.66 34.37, 175.7 29.51 M161.92 45.36 C167.09 38.28, 172.92 33.7, 175.7 29.51 M167.57 44.96 C169.46 44.03, 170.05 40.78, 175.44 35.9 M167.57 44.96 C170.69 41.93, 172.6 38.01, 175.44 35.9" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M11.23 0 C65.28 2.09, 117.74 -0.28, 164.35 0 M11.23 0 C69.59 -0.61, 128.3 0.09, 164.35 0 M164.35 0 C173.3 1.22, 175.7 4.85, 175.58 11.23 M164.35 0 C173.03 -2.09, 175.79 4.32, 175.58 11.23 M175.58 11.23 C175.99 17.1, 177.28 23.56, 175.58 33.69 M175.58 11.23 C175.68 19.03, 174.88 28.58, 175.58 33.69 M175.58 33.69 C174.48 42.75, 170.74 44.85, 164.35 44.92 M175.58 33.69 C177.35 43.13, 171.47 44.13, 164.35 44.92 M164.35 44.92 C128.4 45.61, 90.31 46.46, 11.23 44.92 M164.35 44.92 C130.08 43.8, 96.12 45.31, 11.23 44.92 M11.23 44.92 C2.99 44.65, -0.69 41.64, 0 33.69 M11.23 44.92 C2.77 43.17, -1.48 39.42, 0 33.69 M0 33.69 C-1.19 25.02, 0.39 18.36, 0 11.23 M0 33.69 C0.58 26.49, 0.39 19.37, 0 11.23 M0 11.23 C-0.83 5.56, 3.47 1.92, 11.23 0 M0 11.23 C1.63 3.05, 5.29 -1.02, 11.23 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(97.13831425771596 203.2128523349794) rotate(0 16.4639892578125 10)"><text x="16.4639892578125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">GPS</text></g><g transform="translate(954.4775688809096 241.71230440386535) rotate(0 39.91997528076172 20)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- routeId</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- distance</text></g><g transform="translate(957.4099837008245 306.5539759972344) rotate(0 66.24795532226562 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Route</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- activityId (PK)</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- latitude</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- longitude</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- timestamp</text></g><g transform="translate(1206.5279466850295 116.76132954018976) rotate(0 47.671966552734375 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Friend</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- user1 (PK)</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- user2</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- createdAt</text></g><g stroke-linecap="round" transform="translate(24.479156255974658 248.18724488664702) rotate(0 87.79113108585798 25)"><path d="M3.33 2.89 C3.33 2.89, 3.33 2.89, 3.33 2.89 M3.33 2.89 C3.33 2.89, 3.33 2.89, 3.33 2.89 M1.1 11.55 C3.12 7.46, 7.1 2.81, 10.28 0.99 M1.1 11.55 C4.51 7.04, 7.52 4.53, 10.28 0.99 M0.84 17.95 C7.03 10.93, 13.62 5.26, 15.93 0.59 M0.84 17.95 C5.05 13.44, 7.64 8.89, 15.93 0.59 M1.23 23.6 C5.94 14.45, 16.07 8.6, 20.91 0.95 M1.23 23.6 C8.41 16.45, 14.5 8.93, 20.91 0.95 M0.97 29.99 C10.03 18.3, 20.89 11, 26.56 0.56 M0.97 29.99 C6.51 23.82, 11.6 18.36, 26.56 0.56 M0.71 36.39 C13.11 22.97, 25.07 10.53, 31.54 0.92 M0.71 36.39 C7.87 28.05, 16.29 18.91, 31.54 0.92 M1.1 42.03 C16.17 26.62, 30.53 10.86, 37.19 0.52 M1.1 42.03 C12.09 30.87, 23.22 17.99, 37.19 0.52 M2.81 46.17 C14.9 32.44, 31.79 13.52, 42.17 0.88 M2.81 46.17 C14.99 32.73, 25.88 19.94, 42.17 0.88 M5.83 48.79 C14.72 38.35, 24.17 29.14, 47.82 0.49 M5.83 48.79 C16.62 37.7, 27.32 26.11, 47.82 0.49 M10.16 49.91 C21.94 33.09, 39.35 19.83, 52.8 0.85 M10.16 49.91 C21.19 38.02, 31.18 23.86, 52.8 0.85 M15.8 49.51 C24.63 37.44, 37.05 27.77, 57.79 1.21 M15.8 49.51 C27.66 35.15, 38.44 23.17, 57.79 1.21 M20.79 49.87 C31.91 36.14, 43.42 23.24, 63.43 0.82 M20.79 49.87 C35.24 32.42, 50.99 15.48, 63.43 0.82 M26.43 49.48 C34.4 39.17, 43.33 29.77, 68.42 1.18 M26.43 49.48 C41.55 32.24, 56.88 13.98, 68.42 1.18 M31.42 49.84 C40.62 38.32, 53.5 26.57, 74.06 0.78 M31.42 49.84 C42.54 36.67, 51.91 26.21, 74.06 0.78 M36.41 50.2 C46.42 38.54, 56.45 27.36, 79.05 1.14 M36.41 50.2 C51.29 32.46, 67.75 14.39, 79.05 1.14 M42.05 49.8 C56.86 35.85, 69.81 18.9, 84.69 0.75 M42.05 49.8 C58.48 31.96, 73.65 11.7, 84.69 0.75 M47.04 50.16 C59.99 36.34, 73.55 23.61, 89.68 1.11 M47.04 50.16 C58.93 35.62, 72.6 20.52, 89.68 1.11 M52.68 49.77 C60.57 37.56, 70.19 29.32, 95.32 0.71 M52.68 49.77 C64.35 36.6, 75.1 25.72, 95.32 0.71 M57.67 50.13 C70.78 34.73, 83.27 16.94, 100.31 1.07 M57.67 50.13 C70.67 36.84, 82.07 22, 100.31 1.07 M63.31 49.73 C72.95 39.31, 82.09 30.16, 105.3 1.43 M63.31 49.73 C78.46 32.18, 94.47 14.45, 105.3 1.43 M68.3 50.09 C79.47 38.77, 90.28 25.43, 110.94 1.04 M68.3 50.09 C83.97 32.06, 99.52 12.33, 110.94 1.04 M73.28 50.45 C88.35 35.36, 101.07 18.86, 115.93 1.4 M73.28 50.45 C83.32 36.74, 94.48 24.39, 115.93 1.4 M78.93 50.06 C96.42 30.25, 113.19 12.89, 121.57 1 M78.93 50.06 C91.53 35.39, 104.66 19.85, 121.57 1 M83.91 50.42 C96.42 36.79, 107.56 21.98, 126.56 1.36 M83.91 50.42 C96.67 37.97, 107.65 24.06, 126.56 1.36 M89.56 50.03 C103.34 35.98, 115.07 20.04, 132.2 0.97 M89.56 50.03 C97.94 40.85, 105.83 30.03, 132.2 0.97 M94.54 50.39 C110.79 33.65, 127.09 16.5, 137.19 1.33 M94.54 50.39 C110.78 30.95, 126.87 11.79, 137.19 1.33 M100.19 49.99 C112.04 36.82, 121.85 24.8, 142.83 0.93 M100.19 49.99 C111.11 38.18, 120.87 25.06, 142.83 0.93 M105.17 50.35 C117.35 36.18, 131.12 16.89, 147.82 1.29 M105.17 50.35 C113.81 40.26, 121.56 31.23, 147.82 1.29 M110.82 49.96 C119.24 39.97, 130.89 26.07, 152.8 1.65 M110.82 49.96 C127.01 30.47, 142.6 11.43, 152.8 1.65 M115.8 50.32 C130.73 34.62, 143.89 19.54, 158.45 1.26 M115.8 50.32 C130.15 34.32, 143.94 16.77, 158.45 1.26 M120.79 50.68 C135.05 37.6, 144.78 23.61, 163.43 1.62 M120.79 50.68 C132.19 37.72, 144.56 24, 163.43 1.62 M126.43 50.28 C141.38 33.22, 156.38 16.36, 169.08 1.23 M126.43 50.28 C135.62 39.32, 144.43 29.33, 169.08 1.23 M131.42 50.64 C144.06 36.44, 157.65 19.99, 172.1 3.85 M131.42 50.64 C143.1 38.35, 153.88 26.02, 172.1 3.85 M137.06 50.25 C147.62 38.98, 156.54 26.88, 174.46 7.23 M137.06 50.25 C149.57 36.67, 159.89 23.87, 174.46 7.23 M142.05 50.61 C148.56 38.87, 157.64 32.81, 176.17 11.36 M142.05 50.61 C152.66 38.24, 161.48 27.89, 176.17 11.36 M147.69 50.21 C155.37 42.24, 165.57 32.71, 175.9 17.76 M147.69 50.21 C155.81 40.28, 165.54 30.6, 175.9 17.76 M152.68 50.57 C163.47 41.51, 170.34 30.83, 175.64 24.16 M152.68 50.57 C161.25 42.34, 169.52 32.58, 175.64 24.16 M158.32 50.18 C164.89 42.65, 169.96 36.76, 175.38 30.56 M158.32 50.18 C163.37 44.52, 168.87 38.42, 175.38 30.56 M163.31 50.54 C166.08 43.82, 171.46 41.09, 175.78 36.2 M163.31 50.54 C167.25 45.42, 172.89 40.08, 175.78 36.2 M170.27 48.63 C171.61 47.06, 172.61 46.19, 174.86 43.35 M170.27 48.63 C171.16 47.35, 172.55 45.61, 174.86 43.35" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M12.5 0 C57.39 1.25, 101 -0.1, 163.08 0 M12.5 0 C66.11 1.62, 119.43 2.25, 163.08 0 M163.08 0 C170.87 0.21, 174.96 5.67, 175.58 12.5 M163.08 0 C170.68 1.83, 177.86 5.96, 175.58 12.5 M175.58 12.5 C176.02 18.57, 176.98 25.76, 175.58 37.5 M175.58 12.5 C175.61 19.57, 175.2 26.58, 175.58 37.5 M175.58 37.5 C175.94 47, 171.84 50.2, 163.08 50 M175.58 37.5 C177.04 44.02, 169.46 49.38, 163.08 50 M163.08 50 C125.78 48.46, 85 48.52, 12.5 50 M163.08 50 C113.74 48.09, 66.16 47.88, 12.5 50 M12.5 50 C3.12 48.59, -0.87 46, 0 37.5 M12.5 50 C4.46 50.41, 0.76 47.18, 0 37.5 M0 37.5 C-0.05 27.55, 1.84 18.98, 0 12.5 M0 37.5 C0.5 27.16, -1.17 16.91, 0 12.5 M0 12.5 C-1.53 2.25, 5.55 1.2, 12.5 0 M0 12.5 C0.26 4.14, 2.29 -1.52, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(36.9263313481803 253.18724488664702) rotate(0 75.34395599365234 20)"><text x="75.34395599365234" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">In-memory activity </text><text x="75.34395599365234" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">buffer</text></g><g stroke-linecap="round" transform="translate(23.65184273698378 312.3608310386335) rotate(0 87.79113108585798 25)"><path d="M3.33 2.89 C3.33 2.89, 3.33 2.89, 3.33 2.89 M3.33 2.89 C3.33 2.89, 3.33 2.89, 3.33 2.89 M1.1 11.55 C4.64 7.23, 7.58 5.51, 10.28 0.99 M1.1 11.55 C3.56 9.04, 4.44 7.3, 10.28 0.99 M0.84 17.95 C4 13.7, 8.56 9.19, 15.93 0.59 M0.84 17.95 C5.94 13.34, 9.92 6.68, 15.93 0.59 M1.23 23.6 C6.39 18.43, 10.39 14.14, 20.91 0.95 M1.23 23.6 C8.55 16.7, 13.81 8.04, 20.91 0.95 M0.97 29.99 C4.84 21.23, 13.35 15.96, 26.56 0.56 M0.97 29.99 C9.41 20.56, 16.47 12.56, 26.56 0.56 M0.71 36.39 C8.16 27.37, 19.16 15.45, 31.54 0.92 M0.71 36.39 C13.7 23.07, 25 8.98, 31.54 0.92 M1.1 42.03 C13.31 26.21, 24.44 12.92, 37.19 0.52 M1.1 42.03 C15.52 25.34, 28.49 8.54, 37.19 0.52 M2.81 46.17 C17.45 29.5, 34.42 13.01, 42.17 0.88 M2.81 46.17 C15.15 31.81, 28.41 15.8, 42.17 0.88 M5.83 48.79 C17.64 32.37, 32.75 19.27, 47.82 0.49 M5.83 48.79 C21.76 29.83, 36.83 10.33, 47.82 0.49 M10.16 49.91 C18.61 39.62, 28.8 27.94, 52.8 0.85 M10.16 49.91 C25.29 32, 40.77 14.06, 52.8 0.85 M15.8 49.51 C25 37.59, 35.85 26.56, 57.79 1.21 M15.8 49.51 C24.85 39.71, 33.62 28.65, 57.79 1.21 M20.79 49.87 C31.46 39.46, 39.8 26.24, 63.43 0.82 M20.79 49.87 C33.52 34.88, 46.85 18.33, 63.43 0.82 M26.43 49.48 C40.11 34.56, 52.4 20.75, 68.42 1.18 M26.43 49.48 C40.6 32.84, 55.27 15.23, 68.42 1.18 M31.42 49.84 C43.97 31.74, 60.64 18.08, 74.06 0.78 M31.42 49.84 C40.75 37.43, 51.09 27.34, 74.06 0.78 M36.41 50.2 C47.96 38.91, 57.84 24.91, 79.05 1.14 M36.41 50.2 C52.17 32.4, 67.62 14.95, 79.05 1.14 M42.05 49.8 C59.87 31.06, 74.01 12.44, 84.69 0.75 M42.05 49.8 C58.23 31.23, 73.65 13.8, 84.69 0.75 M47.04 50.16 C59.89 36.57, 73.49 18.22, 89.68 1.11 M47.04 50.16 C61.77 31.83, 77.75 13.54, 89.68 1.11 M52.68 49.77 C60.7 39.42, 71.29 31.26, 95.32 0.71 M52.68 49.77 C62.65 38.05, 71.94 25.75, 95.32 0.71 M57.67 50.13 C71.43 34.41, 83.6 20.33, 100.31 1.07 M57.67 50.13 C73.2 31.22, 90.76 13.33, 100.31 1.07 M63.31 49.73 C77.67 34.64, 90.42 18.81, 105.3 1.43 M63.31 49.73 C76.64 32.59, 91.69 17.33, 105.3 1.43 M68.3 50.09 C83.64 35.31, 97.5 17.96, 110.94 1.04 M68.3 50.09 C83.51 33.97, 98.45 17.06, 110.94 1.04 M73.28 50.45 C87.77 32.4, 104.73 13.05, 115.93 1.4 M73.28 50.45 C83.05 40.38, 90.99 31.47, 115.93 1.4 M78.93 50.06 C89.52 38.02, 99.13 24.1, 121.57 1 M78.93 50.06 C94.06 32.92, 109.14 15.92, 121.57 1 M83.91 50.42 C97.56 33.07, 111.93 19.93, 126.56 1.36 M83.91 50.42 C100.61 31.84, 117.08 12.35, 126.56 1.36 M89.56 50.03 C104.68 32.31, 123.3 11.78, 132.2 0.97 M89.56 50.03 C106.05 31.28, 120.64 14.31, 132.2 0.97 M94.54 50.39 C109.78 34.44, 122.15 17.62, 137.19 1.33 M94.54 50.39 C106.28 37.5, 119.07 24.05, 137.19 1.33 M100.19 49.99 C112.2 34.66, 125.34 20.61, 142.83 0.93 M100.19 49.99 C114.47 34.67, 128.23 17.88, 142.83 0.93 M105.17 50.35 C120.3 33.5, 137.39 13.22, 147.82 1.29 M105.17 50.35 C115.76 38.41, 127.18 24.33, 147.82 1.29 M110.82 49.96 C127.48 33.24, 142.03 15.5, 152.8 1.65 M110.82 49.96 C121.49 38.87, 132.38 27.62, 152.8 1.65 M115.8 50.32 C128.35 36.43, 141.41 22.39, 158.45 1.26 M115.8 50.32 C131.22 33.28, 146.94 16.12, 158.45 1.26 M120.79 50.68 C136.18 31.11, 150.92 13.26, 163.43 1.62 M120.79 50.68 C133.63 36.86, 144.79 22.05, 163.43 1.62 M126.43 50.28 C138.37 36.52, 151.73 19.97, 169.08 1.23 M126.43 50.28 C136.35 38.52, 146.31 27.61, 169.08 1.23 M131.42 50.64 C145.87 32.56, 161.11 17.19, 172.1 3.85 M131.42 50.64 C144.96 33.98, 160.18 18.53, 172.1 3.85 M137.06 50.25 C148.13 38.37, 159.5 27.02, 174.46 7.23 M137.06 50.25 C148.8 36.45, 161.57 21.51, 174.46 7.23 M142.05 50.61 C149.15 42.94, 155.45 35.65, 176.17 11.36 M142.05 50.61 C149.01 42.63, 156.05 34.46, 176.17 11.36 M147.69 50.21 C158.02 37.62, 167.39 24.58, 175.9 17.76 M147.69 50.21 C157.9 39.71, 166.5 29.72, 175.9 17.76 M152.68 50.57 C162.52 41.05, 168.42 31.49, 175.64 24.16 M152.68 50.57 C161.33 39.36, 170.72 30.69, 175.64 24.16 M158.32 50.18 C162.31 47.69, 164.13 41.28, 175.38 30.56 M158.32 50.18 C164.93 43.49, 169.51 35.36, 175.38 30.56 M163.31 50.54 C167.63 47.83, 167.88 42.8, 175.78 36.2 M163.31 50.54 C167.03 46.06, 171.57 40.95, 175.78 36.2 M170.27 48.63 C171.12 47.32, 173.05 45.37, 174.86 43.35 M170.27 48.63 C171.83 46.87, 173.26 45.02, 174.86 43.35" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M12.5 0 C69.78 0.95, 123.04 0.09, 163.08 0 M12.5 0 C61.15 -1.22, 110.04 -0.57, 163.08 0 M163.08 0 C170.78 1.59, 177.57 5.73, 175.58 12.5 M163.08 0 C171.12 -1.66, 173.46 4.87, 175.58 12.5 M175.58 12.5 C175.71 20.16, 177.48 24.41, 175.58 37.5 M175.58 12.5 C175.62 19.73, 175.65 25.89, 175.58 37.5 M175.58 37.5 C176.85 44.26, 169.71 49.46, 163.08 50 M175.58 37.5 C174.62 44.21, 170.21 51.84, 163.08 50 M163.08 50 C124.02 48.63, 82.51 48.19, 12.5 50 M163.08 50 C128.89 47.82, 95.3 48.61, 12.5 50 M12.5 50 C4.43 50.36, 0.66 47, 0 37.5 M12.5 50 C5.66 49.87, 1.06 45.76, 0 37.5 M0 37.5 C1.69 32.45, -0.83 25.92, 0 12.5 M0 37.5 C-0.52 30.16, 0.94 25.33, 0 12.5 M0 12.5 C0.23 4.14, 2.54 -1.32, 12.5 0 M0 12.5 C0.23 4.72, 2.17 -1.92, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(36.29102680135739 327.3608310386335) rotate(0 75.15194702148438 10)"><text x="75.15194702148438" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Persistent storage</text></g><g transform="translate(84.97434849304136 153.03213464076362) rotate(0 21.639984130859375 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client</text></g><g stroke-linecap="round" transform="translate(631.3334727952093 10) rotate(0 67.39296112068519 66.31509478301734)"><path d="M8.76 31.46 C8.76 31.46, 8.76 31.46, 8.76 31.46 M8.76 31.46 C8.76 31.46, 8.76 31.46, 8.76 31.46 M5.87 40.88 C13.61 29.37, 24.2 17.08, 32.11 10.69 M5.87 40.88 C15.58 28.93, 24.57 19.94, 32.11 10.69 M3.64 49.54 C17.85 33.55, 32.36 18.77, 39.73 8.03 M3.64 49.54 C13.24 38.8, 21.28 27.99, 39.73 8.03 M0.76 58.96 C14.84 38.85, 34.52 22.02, 47.99 4.62 M0.76 58.96 C17.12 41.2, 32.42 23.08, 47.99 4.62 M1.15 64.6 C20.28 41.21, 41.53 21.95, 55.6 1.96 M1.15 64.6 C12.95 51.44, 24.02 39.1, 55.6 1.96 M2.2 69.49 C25.33 43.87, 47.89 19.24, 61.9 0.81 M2.2 69.49 C16.56 52.48, 32.33 34.88, 61.9 0.81 M3.25 74.38 C28.64 46.77, 53.57 18.85, 66.23 1.93 M3.25 74.38 C22.41 54.21, 41.54 32.12, 66.23 1.93 M3.65 80.02 C25.59 55.26, 52.25 25.11, 71.22 2.29 M3.65 80.02 C24.11 56.73, 43.35 34.33, 71.22 2.29 M4.7 84.91 C19.87 67, 35.95 50.17, 76.21 2.65 M4.7 84.91 C22.85 65.42, 40.71 45.6, 76.21 2.65 M5.09 90.55 C27.4 61.9, 55.34 36.53, 80.54 3.76 M5.09 90.55 C24.34 69.03, 42.77 45.17, 80.54 3.76 M7.46 93.93 C24.8 72.53, 45.56 53.28, 85.53 4.12 M7.46 93.93 C29.42 67.94, 50.25 44.41, 85.53 4.12 M9.82 97.31 C30.16 72.79, 51.3 48.82, 89.86 5.24 M9.82 97.31 C37.62 64.44, 66.81 32.03, 89.86 5.24 M12.18 100.69 C28.36 80.88, 45.85 61.64, 93.53 7.11 M12.18 100.69 C41.68 66.83, 71.23 32.21, 93.53 7.11 M13.89 104.82 C33.18 81.86, 56.18 58.45, 97.21 8.97 M13.89 104.82 C35.47 79.79, 54.85 57.82, 97.21 8.97 M16.25 108.2 C35.79 86.16, 54.9 64.53, 100.88 10.84 M16.25 108.2 C46.61 72.39, 78.63 36.41, 100.88 10.84 M18.61 111.58 C47.01 81.74, 73.72 48.96, 104.56 12.71 M18.61 111.58 C51.51 74.88, 83.19 35.63, 104.56 12.71 M20.98 114.96 C47.19 86.53, 73.66 58.95, 108.23 14.58 M20.98 114.96 C46.09 84.53, 73.44 53.69, 108.23 14.58 M24.65 116.83 C42.2 93.83, 61.37 74.61, 111.91 16.45 M24.65 116.83 C47.62 90.53, 69.61 66.72, 111.91 16.45 M28.33 118.7 C55.77 86.88, 82.77 52.4, 115.58 18.32 M28.33 118.7 C54.53 90.71, 78.98 60.86, 115.58 18.32 M31.34 121.32 C50.63 99.71, 69.24 79.67, 117.29 22.46 M31.34 121.32 C62.54 85.01, 94.68 48.72, 117.29 22.46 M35.02 123.19 C56.67 100.1, 77.59 75.11, 119.65 25.84 M35.02 123.19 C66.01 86.94, 97.19 49.23, 119.65 25.84 M38.69 125.06 C66.9 94.42, 92.98 62.54, 122.01 29.21 M38.69 125.06 C59.21 99.2, 80.8 74.86, 122.01 29.21 M42.37 126.93 C75.14 89.75, 106.96 55.09, 124.38 32.59 M42.37 126.93 C67.19 98.28, 92.61 68.59, 124.38 32.59 M46.04 128.8 C69.49 102.51, 91.6 75.09, 126.74 35.97 M46.04 128.8 C69.45 104.45, 90.8 78.61, 126.74 35.97 M50.37 129.92 C75.33 102.69, 98.48 73.6, 128.45 40.11 M50.37 129.92 C65.51 112.55, 80.53 93.53, 128.45 40.11 M55.36 130.28 C83.59 100.28, 111.58 69.69, 130.81 43.48 M55.36 130.28 C84.34 96.1, 113.21 62.23, 130.81 43.48 M60.35 130.64 C79.49 108.72, 96.72 88.16, 131.2 49.13 M60.35 130.64 C78.33 110.87, 95.12 89.67, 131.2 49.13 M65.34 131 C85.32 107.72, 106.94 79.39, 132.25 54.02 M65.34 131 C78.64 115.4, 91.33 100.69, 132.25 54.02 M70.32 131.36 C83.43 115.77, 100 96.21, 133.3 58.9 M70.32 131.36 C94.59 102.41, 118.31 74.02, 133.3 58.9 M75.31 131.72 C95.24 110.07, 113.48 89.14, 134.36 63.79 M75.31 131.72 C95.08 109.33, 114.33 85.5, 134.36 63.79 M81.61 130.57 C98.89 113.93, 111.7 96.4, 134.75 69.44 M81.61 130.57 C95.91 114.44, 111.1 97.46, 134.75 69.44 M89.22 127.91 C104.86 110.04, 120.58 92.37, 133.83 76.59 M89.22 127.91 C98.81 116.47, 108.05 105.99, 133.83 76.59 M96.83 125.25 C107.28 113.55, 118.73 99.57, 130.95 86 M96.83 125.25 C106.69 115.01, 115.68 104.74, 130.95 86 M104.44 122.59 C111.52 115.41, 116.97 107.29, 128.06 95.42 M104.44 122.59 C112.62 114.09, 118.58 106.3, 128.06 95.42" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M59.02 0.29 C68.17 -1.71, 79.66 1.23, 88.93 4.21 C98.21 7.2, 107.89 11.9, 114.69 18.2 C121.49 24.5, 126.38 33.11, 129.74 42.02 C133.09 50.92, 135.44 62.01, 134.83 71.63 C134.22 81.24, 131.12 91.25, 126.08 99.71 C121.03 108.17, 112.67 117.03, 104.55 122.39 C96.43 127.74, 87.08 130.78, 77.37 131.86 C67.66 132.93, 55.84 131.73, 46.3 128.83 C36.77 125.94, 27.04 120.97, 20.14 114.48 C13.24 107.99, 8.21 98.8, 4.91 89.9 C1.61 81, -0.27 70.82, 0.36 61.09 C0.99 51.36, 3.78 39.93, 8.71 31.52 C13.64 23.1, 20.2 15.94, 29.93 10.6 C39.66 5.26, 59.09 0.97, 67.09 -0.52 C75.09 -2.01, 77.83 0.53, 77.92 1.66 M74.29 -0.69 C83.83 -0.67, 95.97 3.71, 104.22 8.87 C112.48 14.02, 118.92 21.83, 123.84 30.24 C128.76 38.65, 132.53 49.57, 133.74 59.33 C134.95 69.09, 134.16 79.62, 131.09 88.79 C128.02 97.95, 122.11 107.62, 115.31 114.31 C108.52 121, 99.5 125.95, 90.32 128.92 C81.14 131.9, 70.16 133.01, 60.22 132.13 C50.27 131.26, 39.02 128.56, 30.65 123.66 C22.27 118.77, 14.82 111.21, 9.96 102.77 C5.09 94.32, 2.3 82.86, 1.45 72.98 C0.61 63.09, 2.06 52.61, 4.9 43.45 C7.74 34.29, 11.92 24.89, 18.48 18.01 C25.05 11.13, 34.65 4.96, 44.29 2.18 C53.93 -0.59, 71.13 1.42, 76.3 1.35 C81.46 1.28, 75.78 0.97, 75.27 1.75" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(664.7404286295839 46.42324156691711) rotate(0 33.83198547363281 30)"><text x="33.83198547363281" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Recent </text><text x="33.83198547363281" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">activity </text><text x="33.83198547363281" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Cache</text></g><g stroke-linecap="round"><g transform="translate(567.1697109799708 175.94371768760902) rotate(0 36.42079873622646 -22.688032012115514)"><path d="M-0.37 0.9 C11.76 -6.52, 60.06 -36.87, 72.46 -44.42 M1.63 0.33 C13.6 -7.43, 59.27 -38.27, 71.31 -46.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(567.1697109799708 175.94371768760902) rotate(0 36.42079873622646 -22.688032012115514)"><path d="M18.13 -22.72 C14.61 -16.97, 9.65 -7.9, -0.37 0.9 M18.13 -22.72 C10.18 -13.61, 3.56 -4.21, -0.37 0.9" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(567.1697109799708 175.94371768760902) rotate(0 36.42079873622646 -22.688032012115514)"><path d="M28.98 -5.3 C22.48 -4.34, 14.56 -0.02, -0.37 0.9 M28.98 -5.3 C16.96 -2.86, 6.23 -0.03, -0.37 0.9" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(567.1697109799708 175.94371768760902) rotate(0 36.42079873622646 -22.688032012115514)"><path d="M53.46 -21.93 C59.81 -29.09, 64.76 -33.05, 71.31 -46.04 M53.46 -21.93 C59.32 -30.61, 66.43 -39.24, 71.31 -46.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(567.1697109799708 175.94371768760902) rotate(0 36.42079873622646 -22.688032012115514)"><path d="M42.14 -39.04 C51.59 -41.5, 59.64 -40.79, 71.31 -46.04 M42.14 -39.04 C52.25 -41.17, 63.64 -43.34, 71.31 -46.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(603.4204486323573 345.83467951256443) rotate(0 82.92263937210942 75.85004876934931)"><path d="M26.6 20.48 C26.6 20.48, 26.6 20.48, 26.6 20.48 M26.6 20.48 C26.6 20.48, 26.6 20.48, 26.6 20.48 M5.35 51.02 C17.19 41.45, 24.46 27.35, 37.49 14.04 M5.35 51.02 C15.95 38.5, 26.38 26.83, 37.49 14.04 M3.77 58.93 C18.32 43.39, 34.2 25.52, 47.73 8.37 M3.77 58.93 C13.26 48.85, 21.83 38.41, 47.73 8.37 M2.86 66.08 C23.04 44.79, 43.51 19.39, 56.65 4.2 M2.86 66.08 C20.74 45.71, 35.43 28.01, 56.65 4.2 M1.28 73.99 C21.1 54.19, 37.47 31.61, 62.95 3.05 M1.28 73.99 C22.91 48.44, 44.69 25.01, 62.95 3.05 M1.02 80.39 C18.67 62.95, 35.44 42.16, 68.6 2.65 M1.02 80.39 C25.84 51.78, 48.96 22.96, 68.6 2.65 M2.07 85.28 C23.89 60.78, 44.37 33.33, 74.24 2.26 M2.07 85.28 C16.2 66.7, 32.8 49.68, 74.24 2.26 M3.12 90.17 C32.7 56.52, 60.88 24.73, 80.54 1.11 M3.12 90.17 C26.96 63.12, 48.51 37.72, 80.54 1.11 M4.83 94.3 C33.06 62.92, 58.15 29.69, 86.18 0.72 M4.83 94.3 C22.67 73.99, 39.36 55.06, 86.18 0.72 M5.88 99.19 C32.17 65.26, 61.86 32.12, 91.82 0.32 M5.88 99.19 C27.73 73.98, 48.55 50.1, 91.82 0.32 M6.93 104.08 C36.61 72.23, 64.75 39.9, 96.15 1.44 M6.93 104.08 C36.22 70.33, 66.71 35.79, 96.15 1.44 M7.98 108.96 C30.16 83.86, 50.68 59.98, 100.49 2.55 M7.98 108.96 C32.63 82.32, 55.93 54.64, 100.49 2.55 M11 111.59 C35.98 80.56, 62.9 50.55, 104.82 3.66 M11 111.59 C32.9 85.68, 53.13 62.14, 104.82 3.66 M13.36 114.97 C46.04 79.57, 72.64 46.22, 109.15 4.78 M13.36 114.97 C43.55 80.15, 74.96 44.9, 109.15 4.78 M15.73 118.35 C37.66 94.53, 58.02 70.1, 113.48 5.89 M15.73 118.35 C51.21 77.03, 87.42 34.17, 113.48 5.89 M18.74 120.97 C48.15 84.93, 80.36 47.35, 117.81 7.01 M18.74 120.97 C50.6 84.49, 81.82 48.94, 117.81 7.01 M21.11 124.35 C44.37 96.53, 65.54 71.2, 122.14 8.12 M21.11 124.35 C45.9 97.25, 69.14 71.1, 122.14 8.12 M23.47 127.73 C65.38 81.97, 103.75 34.88, 125.16 10.75 M23.47 127.73 C50 97.05, 77.95 64.81, 125.16 10.75 M26.49 130.35 C60.5 89.82, 93.65 53.32, 128.18 13.37 M26.49 130.35 C59.8 93.14, 91.92 55.31, 128.18 13.37 M28.85 133.73 C58.1 98.8, 84.85 67.33, 131.2 16 M28.85 133.73 C61.49 95.42, 96.04 56.79, 131.2 16 M32.53 135.6 C61.94 99.61, 96.9 63.08, 134.87 17.87 M32.53 135.6 C69.59 92.2, 106.42 50.03, 134.87 17.87 M36.2 137.47 C56.72 115.83, 78.09 90.49, 137.89 20.49 M36.2 137.47 C72.31 96.23, 107.6 55.06, 137.89 20.49 M39.88 139.34 C63.73 112.48, 87.17 85.49, 140.91 23.11 M39.88 139.34 C71.02 103.25, 101.95 67.19, 140.91 23.11 M43.55 141.21 C81.53 97.4, 120.4 53.14, 143.93 25.74 M43.55 141.21 C75.15 104.47, 107.03 68.85, 143.93 25.74 M47.23 143.08 C78.6 107.03, 110.28 67.16, 147.6 27.61 M47.23 143.08 C80.86 104.54, 114.05 65.24, 147.6 27.61 M50.9 144.95 C77.01 114.63, 104.94 86.41, 149.97 30.99 M50.9 144.95 C85.25 105.71, 118.55 66.82, 149.97 30.99 M54.58 146.82 C84.64 111.4, 118.15 74.92, 152.33 34.37 M54.58 146.82 C74.58 121.52, 98.19 96.63, 152.33 34.37 M58.91 147.93 C93.15 109.46, 126.68 72.65, 154.04 38.5 M58.91 147.93 C81.58 120.75, 106.5 92.81, 154.04 38.5 M63.24 149.05 C90.35 117.21, 121.22 85.83, 156.4 41.88 M63.24 149.05 C100.11 106.17, 137.11 64.18, 156.4 41.88 M68.23 149.41 C95.4 115.98, 126.56 83.17, 158.11 46.01 M68.23 149.41 C104.2 108.28, 138.59 66.57, 158.11 46.01 M73.21 149.77 C95.28 123.92, 120.15 94.67, 160.47 49.39 M73.21 149.77 C98.58 120.5, 123.96 91.73, 160.47 49.39 M78.2 150.13 C107.63 117.34, 135.42 84.63, 162.17 53.53 M78.2 150.13 C98.82 125.76, 119.45 101.59, 162.17 53.53 M83.19 150.49 C111.81 118.11, 137.02 89.11, 164.54 56.9 M83.19 150.49 C111.39 117.21, 141.16 84.27, 164.54 56.9 M88.17 150.85 C118.77 117.29, 146.16 85.87, 164.93 62.55 M88.17 150.85 C105.92 132.81, 121.41 114.02, 164.93 62.55 M93.16 151.21 C120.94 120.74, 147.13 90.47, 164.67 68.95 M93.16 151.21 C113.27 127.59, 132.57 103.98, 164.67 68.95 M100.77 148.55 C115.71 135.12, 128.08 118.49, 165.07 74.59 M100.77 148.55 C125.63 120.84, 149.94 91.01, 165.07 74.59 M108.38 145.89 C128.8 122.18, 146.36 99.99, 164.8 80.99 M108.38 145.89 C128.82 121.8, 151.31 96.95, 164.8 80.99 M115.99 143.23 C130.54 129.03, 143.18 110.76, 165.2 86.63 M115.99 143.23 C127.5 131.99, 138.04 118.47, 165.2 86.63 M123.61 140.57 C132.65 130.37, 140.23 121.88, 161.66 96.8 M123.61 140.57 C136.83 125.18, 149.72 111.4, 161.66 96.8 M135.81 132.63 C138.8 127.62, 144.51 121.86, 156.8 108.48 M135.81 132.63 C141.06 125.7, 147.89 120.23, 156.8 108.48" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M121.65 8.21 C131.57 11.77, 141.83 20.82, 148.94 29.03 C156.05 37.24, 161.73 47.26, 164.31 57.48 C166.9 67.7, 166.47 80.15, 164.44 90.33 C162.42 100.5, 158.59 110.29, 152.18 118.55 C145.78 126.81, 135.86 134.44, 126.02 139.88 C116.18 145.33, 104.12 149.73, 93.13 151.22 C82.14 152.7, 70.72 151.65, 60.08 148.82 C49.44 145.99, 38.05 141.08, 29.26 134.24 C20.48 127.39, 12.26 117.21, 7.34 107.76 C2.43 98.31, 0.06 87.76, -0.24 77.54 C-0.54 67.31, 1.09 55.91, 5.56 46.41 C10.02 36.91, 18.31 27.6, 26.55 20.54 C34.79 13.48, 44.49 7.5, 54.98 4.04 C65.48 0.59, 77.07 -1.71, 89.53 -0.2 C102 1.31, 122 9.6, 129.77 13.1 C137.54 16.6, 137.01 19.73, 136.18 20.79 M54.49 4.93 C64.27 0.6, 77.58 0.42, 88.92 1.05 C100.27 1.67, 112.6 4.03, 122.58 8.67 C132.56 13.32, 142.1 20.58, 148.79 28.91 C155.47 37.23, 160.09 48.4, 162.69 58.62 C165.3 68.84, 166.06 80.38, 164.43 90.21 C162.8 100.04, 158.94 109.41, 152.89 117.61 C146.83 125.8, 138.05 134.02, 128.11 139.37 C118.17 144.73, 104.74 148.4, 93.25 149.73 C81.76 151.07, 69.58 149.85, 59.18 147.4 C48.79 144.94, 39.29 141.36, 30.87 135.02 C22.46 128.67, 14.03 118.85, 8.69 109.31 C3.35 99.77, -0.73 87.98, -1.16 77.76 C-1.6 67.55, 1.92 57.62, 6.08 48.03 C10.25 38.44, 15.73 27.21, 23.82 20.21 C31.9 13.22, 49.32 8.38, 54.59 6.05 C59.87 3.72, 55.14 5.16, 55.47 6.23" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(635.4959599222998 381.5506444437765) rotate(0 50.71196746826172 40)"><text x="50.71196746826172" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Redis</text><text x="50.71196746826172" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- sorted Set</text><text x="50.71196746826172" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">for </text><text x="50.71196746826172" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">leaderboards</text></g><g stroke-linecap="round"><g transform="translate(551.1359032366063 324.5981108817491) rotate(0 28.159463151093917 28.15946315109386)"><path d="M-0.15 -0.87 C8.85 8.42, 45.91 47, 55.21 56.69 M-1.7 1.29 C7.56 10.13, 47.97 45.74, 57.34 54.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(551.1359032366063 324.5981108817491) rotate(0 28.159463151093917 28.15946315109386)"><path d="M26.79 12.33 C14.48 5.18, 5.79 0.65, -0.15 -0.87 M26.79 12.33 C17.42 8.17, 6.29 1.98, -0.15 -0.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(551.1359032366063 324.5981108817491) rotate(0 28.159463151093917 28.15946315109386)"><path d="M12 26.56 C5.49 13.75, 2.7 3.54, -0.15 -0.87 M12 26.56 C8.32 17.01, 2.78 5.43, -0.15 -0.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(551.1359032366063 324.5981108817491) rotate(0 28.159463151093917 28.15946315109386)"><path d="M29.62 43.29 C39.33 46.06, 52.46 51.37, 57.34 54.76 M29.62 43.29 C40.83 48.49, 50.4 51.65, 57.34 54.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(551.1359032366063 324.5981108817491) rotate(0 28.159463151093917 28.15946315109386)"><path d="M43.48 28.15 C47.77 36.95, 55.37 48.3, 57.34 54.76 M43.48 28.15 C49.35 39.09, 53.68 47.98, 57.34 54.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Strava System Design</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-2">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The main challenge with this approach is ensuring data consistency between Redis and our primary database. We need to implement a robust system to handle failures and retries when updating Redis. Additionally, we must consider Redis's memory limitations ‚Äì storing complete leaderboard data for all possible combinations of activity types, time ranges, and geographical filters could consume significant memory. To mitigate this, we might need to implement a caching strategy where we only keep the most frequently accessed leaderboards in Redis and calculate less common ones on-demand.</div></div></div></div></div></div></div></div></div>
</body>
</html>
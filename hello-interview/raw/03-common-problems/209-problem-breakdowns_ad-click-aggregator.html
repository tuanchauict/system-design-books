<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Click Aggregator System Design Interview Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Common Problems</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Design an Ad Click Aggregator</h1></div><div class="flex flex-col md:flex-row gap-2 md:items-center justify-between"><div class="flex flex-col lg:flex-row gap-4 md:items-center"><a target="_blank" rel="noopener noreferrer" class="flex flex-row gap-2 items-center" href="https://www.linkedin.com/in/evan-king-40072280/" style="text-decoration: none;"><img class="rounded-full" src="https://hellointerview-files.s3.us-west-2.amazonaws.com/public-media/evan-headshot.png" alt="Evan King" width="40" height="40"><div class="flex flex-col"><div class="flex flex-row gap-2 items-center"><p class="MuiTypography-root MuiTypography-body2 mui-ltrqv0">Evan King</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeInherit mui-70s7oy" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></div><span class="MuiTypography-root MuiTypography-caption mui-1eozzb8">Ex-Meta Staff Engineer</span></div></a><div class="flex flex-row gap-4 md:gap-8 items-center"><div class="flex flex-row gap-1 items-center" aria-label="Difficulty"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-127w52h">hard</p></div><div class="flex flex-row gap-1 items-center" aria-label="Average time allowed in interview"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-1pb8xyp">35 min</p></div></div></div><a class="MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation mui-1c7cv5a" tabindex="0" href="/practice/system-design/start/ad-click-aggregator" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"></path></svg>Practice this problem<span class="MuiTouchRipple-root mui-w0pj6f"></span></a></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<div class="mb-4"><iframe class="w-full aspect-video" src="https://www.youtube.com/embed/Zcv_899yqhI" title="System Design Interview: Design an Ad Click Aggregator w/ a Ex-Meta Staff Engineer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="understanding-the-problem">Understanding the Problem</h2>
<div class="my-6"><div class="MuiBox-root mui-1fz7ihe"><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>üñ±Ô∏è What is an Ad Click Aggregator</strong>
An Ad Click Aggregator is a system that collects and aggregates data on ad clicks. It is used by advertisers to track the performance of their ads and optimize their campaigns. For our purposes, we will assume these are ads displayed on a website or app, like Facebook.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#1-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users can click on an ad and be redirected to the advertiser's website</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Advertisers can query ad click metrics over time with a minimum granularity of 1 minute</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope):</strong></div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Ad targeting</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Ad serving</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Cross device tracking</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Integration with offline marketing channels</div></li>
</ul>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="non-functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#2-non-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Non-Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Before we jump into our non-functional requirements, it's important to ask your interviewer about the scale of the system. For this design in particular, the scale will have a large impact on the database design and the overall architecture.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We are going to design for a system that has 10M active ads and a peak of 10k clicks per second. The total number of clicks per day will be around 100M.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With that in mind, let's document the non-functional requirements:</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Scalable to support a peak of 10k clicks per second</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Low latency analytics queries for advertisers (sub-second response time)</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Fault tolerant and accurate data collection. We should not lose any click data.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">As realtime as possible. Advertisers should be able to query data as soon as possible after the click.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Idempotent click tracking. We should not count the same click multiple times.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope):</strong></div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Fraud or spam detection</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Demographic and geo profiling of users</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Conversion tracking</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here's how it might look on your whiteboard:</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 923.2310554249216 278.682949052764">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="923.2310554249216" height="278.682949052764" fill="#ffffff"></rect><g transform="translate(16.739775424336415 208.68294905276406) rotate(0 130.20791625976562 29.99999999999997)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Scale</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">10M ads at any given time</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">10k ad clicks per second at peak</text></g><g transform="translate(10 11.163596802866437) rotate(0 292.423828125 90)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Functional Requirements</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Users click an ad and get redirected to the advertiser's website</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Advertisers can query click metrics over time w/ 1 minute min granularity</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">---- out of scope ----</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Ad targeting &amp; serving</text><text x="0" y="120" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Cross device tracking</text><text x="0" y="140" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Integration with offline channels </text><text x="0" y="160" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g transform="translate(627.8871833546091 10) rotate(0 142.67193603515622 120)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Non-functional</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Scalable to support peak 10k CPS</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Low latency analytics queries &lt; 1s</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Fault tolerance</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Data integrity</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- As realtime as possible </text><text x="0" y="120" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Idempotency of ad clicks </text><text x="0" y="140" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="160" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">---- out of scope ----</text><text x="0" y="180" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Spam detection</text><text x="0" y="200" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Demographic profiling</text><text x="0" y="220" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Conversion tracking</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Requirements</span></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="the-set-up">The Set Up</h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="planning-the-approach">Planning the Approach</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For this question, which is less of a user-facing product and more focused on data processing, we're going to follow the delivery framework outlined <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">here</a>, focusing on the system interface and the data flow.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="system-interface"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/in-a-hurry/delivery#api-or-system-interface-5-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">System Interface</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For data processing questions like this one, it helps to start by defining the system's interface. This includes clearly outline what data the system receives and what it outputs, establishing a clear boundary of the system‚Äôs functionality. The inputs and outputs of this system are very simple, but it's important to get these right!</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Input</strong>: Ad click data from users.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Output</strong>: Ad click metrics for advertisers.</div></li>
</ol>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="data-flow"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/in-a-hurry/delivery#optional-data-flow-5-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Data Flow</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The data flow is the sequential series of steps we'll cover in order to get from the inputs to our system to the outputs. Clarifying this flow early will help to align with our interviewer before the high-level design. For the ad click aggregator:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User clicks on an ad on a website.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The click is tracked and stored in the system.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The user is redirected to the advertiser's website.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Advertisers query the system for aggregated click metrics.</div></li>
</ol>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Note that this is simple, we will improve upon as we go, but it's important to start simple and build up from there.</div></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="high-level-design"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#high-level-design-10-15-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">High-Level Design</a></h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-users-can-click-on-ads-and-be-redirected-to-the-target">1) Users can click on ads and be redirected to the target</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's start with the easy part, when a user clicks on an ad in their browser, we need to make sure that they're redirected to the advertiser's website. We'll introduce a Ad Placement Service which will be responsible for placing ads on the website and associating them with the correct redirect URL.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user clicks on an ad which was placed by the Ad Placement Service, we will send a request to our <span class="MuiBox-root mui-1vu004u">/click</span> endpoint, which will track the click and then redirect the user to the advertiser's website.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 789.3318825123624 341.819613324171">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="789.3318825123624" height="341.819613324171" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 136.78358978890333) rotate(0 55.986328125 44.6328125)"><path d="M22.32 0 C44.3 -0.15, 63.5 -0.01, 89.66 0 M22.32 0 C42.48 0.15, 64.44 0.18, 89.66 0 M89.66 0 C105 -0.11, 113 8.69, 111.97 22.32 M89.66 0 C103.21 -1.02, 109.7 6.95, 111.97 22.32 M111.97 22.32 C109.95 31.81, 112.43 41.4, 111.97 66.95 M111.97 22.32 C112.16 39.32, 112.26 55.53, 111.97 66.95 M111.97 66.95 C111.71 80.1, 105.39 89.19, 89.66 89.27 M111.97 66.95 C112.25 83.51, 102.9 88.88, 89.66 89.27 M89.66 89.27 C62.68 89.32, 35.95 90.42, 22.32 89.27 M89.66 89.27 C62.59 88.82, 36.35 89.09, 22.32 89.27 M22.32 89.27 C6.65 89.2, -0.67 80.39, 0 66.95 M22.32 89.27 C6.96 88.54, 2 83.29, 0 66.95 M0 66.95 C-0.87 58.57, 1.63 46.54, 0 22.32 M0 66.95 C-0.2 50.34, 0.47 32.14, 0 22.32 M0 22.32 C-0.48 8.39, 5.47 1.56, 22.32 0 M0 22.32 C1.04 7.43, 6.85 1.01, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.880859375 171.41640228890333) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round" transform="translate(261.9480910247312 36.02785242715004) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C45.85 -0.97, 66.1 -1.39, 107.17 0 M23.81 0 C46.61 0.17, 69.45 0.85, 107.17 0 M107.17 0 C121.89 -0.89, 129 7.51, 130.98 23.81 M107.17 0 C121.19 -1.44, 131 5.93, 130.98 23.81 M130.98 23.81 C132.51 36.57, 130.43 51.71, 130.98 71.43 M130.98 23.81 C131.07 40.03, 131.63 57.93, 130.98 71.43 M130.98 71.43 C131.23 88.77, 121.62 94.91, 107.17 95.25 M130.98 71.43 C133.01 87.08, 124.73 94.3, 107.17 95.25 M107.17 95.25 C85.9 96.14, 60.24 94.55, 23.81 95.25 M107.17 95.25 C83.85 95.23, 60.98 94.55, 23.81 95.25 M23.81 95.25 C7.52 94.61, 1.74 88.58, 0 71.43 M23.81 95.25 C5.95 93.22, 1.07 85.85, 0 71.43 M0 71.43 C1.46 56.26, 1 37.79, 0 23.81 M0 71.43 C-0.66 54.32, -1.41 37.03, 0 23.81 M0 23.81 C0.9 7.93, 7.42 0.88, 23.81 0 M0 23.81 C1.55 6.02, 6.54 -0.58, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(280.3406691497312 63.65089930215004) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(134.0925241049199 163.57533612070142) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M-0.99 -0.35 C19.96 -11.84, 103.95 -58.19, 124.96 -69.71 M0.69 -1.58 C21.56 -12.82, 103.47 -57.24, 124.1 -68.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.57533612070142) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M18.75 -22.94 C13.31 -17.44, 8.67 -11.88, -0.99 -0.35 M18.75 -22.94 C12.47 -16.6, 6.24 -9.71, -0.99 -0.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.57533612070142) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M28.65 -4.97 C20.97 -3.83, 13.97 -2.55, -0.99 -0.35 M28.65 -4.97 C19.36 -3.86, 10.21 -2.27, -0.99 -0.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.57533612070142) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M104.17 -45.91 C108.48 -50.81, 113.28 -55.97, 124.1 -68.34 M104.17 -45.91 C109.36 -53.09, 114.82 -59.47, 124.1 -68.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.57533612070142) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M94.42 -63.96 C100.93 -64.48, 108.06 -65.34, 124.1 -68.34 M94.42 -63.96 C102.57 -65.88, 110.9 -66.94, 124.1 -68.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(404.8205866605349 79.50823435819916) rotate(0 47.265762700984396 0.022458893724035534)"><path d="M0.17 -0.32 C16.13 -0.26, 78.98 -0.2, 94.81 -0.02 M-1.2 -1.53 C14.72 -1.25, 78.02 1.42, 94.01 1.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.50823435819916) rotate(0 47.265762700984396 0.022458893724035534)"><path d="M28.38 -10.51 C21.69 -7.8, 15.99 -5.01, 0.17 -0.32 M28.38 -10.51 C17.11 -7.15, 7.06 -3.87, 0.17 -0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.50823435819916) rotate(0 47.265762700984396 0.022458893724035534)"><path d="M28.33 10.01 C21.71 8.27, 16.02 6.59, 0.17 -0.32 M28.33 10.01 C17.2 5.93, 7.17 1.77, 0.17 -0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.50823435819916) rotate(0 47.265762700984396 0.022458893724035534)"><path d="M65.56 11.03 C71.24 9.38, 77.85 7.87, 94.01 1.49 M65.56 11.03 C74.94 7.48, 85.43 3.61, 94.01 1.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.50823435819916) rotate(0 47.265762700984396 0.022458893724035534)"><path d="M66.09 -9.49 C71.59 -6.68, 78.08 -3.73, 94.01 1.49 M66.09 -9.49 C75.16 -5.6, 85.46 -2.03, 94.01 1.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(500.8343990482881 10) rotate(0 72.69127211417481 70.84147595836083)"><path d="M90.77 1.35 C100.57 2.77, 111.7 9.33, 119.67 16.15 C127.64 22.97, 134.44 32.77, 138.57 42.25 C142.71 51.74, 144.66 62.86, 144.47 73.05 C144.29 83.25, 142.08 94.4, 137.47 103.44 C132.85 112.47, 125.33 121.04, 116.77 127.26 C108.22 133.48, 96.47 138.67, 86.13 140.76 C75.79 142.86, 64.79 142.51, 54.75 139.81 C44.71 137.12, 34.12 131.25, 25.89 124.59 C17.65 117.94, 9.64 109.2, 5.32 99.86 C1.01 90.53, -0.61 79.03, 0 68.6 C0.62 58.17, 4.16 46.23, 9.02 37.28 C13.87 28.33, 20.82 20.78, 29.12 14.9 C37.41 9.02, 47.42 3.82, 58.79 2.02 C70.15 0.22, 89.98 3.03, 97.3 4.11 C104.61 5.19, 102.84 7.31, 102.65 8.51 M61.78 0.8 C71.52 -1.63, 83.67 0.28, 93.66 3.14 C103.66 5.99, 114 11.01, 121.74 17.93 C129.48 24.84, 135.98 34.73, 140.1 44.61 C144.22 54.5, 147.44 67.15, 146.47 77.23 C145.5 87.3, 139.65 96.52, 134.28 105.06 C128.9 113.61, 122.56 122.37, 114.22 128.5 C105.88 134.63, 94.94 139.96, 84.25 141.84 C73.57 143.73, 60.08 142.84, 50.13 139.81 C40.17 136.78, 32.02 130.68, 24.55 123.65 C17.07 116.62, 9.14 107.39, 5.3 97.64 C1.47 87.88, 0.86 75.37, 1.55 65.1 C2.24 54.83, 4.64 44.63, 9.45 36.01 C14.25 27.4, 21.51 19.27, 30.38 13.4 C39.25 7.52, 57.43 2.53, 62.67 0.77 C67.92 -0.99, 61.59 1.87, 61.83 2.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(550.7345547174533 70.74898791894009) rotate(0 22.890625 10)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(657.5239754078702 18.709967329693313) rotate(0 60.903953552246094 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round" transform="translate(261.55734531268445 229.83990207627608) rotate(0 67.78910812950699 50.98985562394745)"><path d="M25.49 0 C45.59 -0.78, 65.28 0.85, 110.08 0 M25.49 0 C43.26 0.36, 61.1 -0.68, 110.08 0 M110.08 0 C127.82 1.17, 136.51 9.27, 135.58 25.49 M110.08 0 C126.78 -1.99, 136.57 8.41, 135.58 25.49 M135.58 25.49 C135.61 43.19, 135.75 58.81, 135.58 76.48 M135.58 25.49 C135.8 39.64, 135.78 51.59, 135.58 76.48 M135.58 76.48 C134.61 92.98, 126.79 102.02, 110.08 101.98 M135.58 76.48 C134.68 93.4, 126.31 100.33, 110.08 101.98 M110.08 101.98 C87.73 100.99, 61.08 103.64, 25.49 101.98 M110.08 101.98 C89.39 103.38, 70.98 103.15, 25.49 101.98 M25.49 101.98 C8.94 103.37, 1.78 93.07, 0 76.48 M25.49 101.98 C7.95 103.07, -2.27 95.27, 0 76.48 M0 76.48 C0.88 60.23, -1.66 40.07, 0 25.49 M0 76.48 C-0.19 62.26, 0.24 49.14, 0 25.49 M0 25.49 C0.17 8.09, 9.3 -1.05, 25.49 0 M0 25.49 C-2 6.41, 8.51 1.78, 25.49 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(278.90895344219143 270.8297577002236) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g stroke-linecap="round"><g transform="translate(130.5561836138795 219.51166857609292) rotate(0 62.281662865861335 30.85117700084629)"><path d="M0.01 -1.05 C20.9 9.44, 103.68 51.55, 124.39 62.15 M-1.45 1.02 C19.36 11.2, 102.55 50.33, 123.34 60.26" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.51166857609292) rotate(0 62.281662865861335 30.85117700084629)"><path d="M29.79 2.56 C21.54 1.48, 17.49 0.48, 0.01 -1.05 M29.79 2.56 C19.22 1.71, 8.37 0.18, 0.01 -1.05" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.51166857609292) rotate(0 62.281662865861335 30.85117700084629)"><path d="M20.5 20.86 C14.4 15.76, 12.39 10.75, 0.01 -1.05 M20.5 20.86 C13.43 13.32, 5.99 5.06, 0.01 -1.05" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.51166857609292) rotate(0 62.281662865861335 30.85117700084629)"><path d="M93.47 57.46 C98.27 57.78, 107.31 58.19, 123.34 60.26 M93.47 57.46 C104.82 59.19, 115.9 60.01, 123.34 60.26" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.51166857609292) rotate(0 62.281662865861335 30.85117700084629)"><path d="M102.26 38.92 C105.01 43.3, 112.12 47.78, 123.34 60.26 M102.26 38.92 C110.3 47.43, 118.15 55.07, 123.34 60.26" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Handle Redirect</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">There are two ways we can handle this redirect, with one being simpler and the other being more robust.</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Client side redirect</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The simplest thing we can do is send over a redirect URL with each ad that's placed on the website. When a user clicks on the ad, the browser will automatically redirect them to the target URL. It's simple, straightforward, and requires no additional server side logic. We would then, in parallel, POST to our <span class="MuiBox-root mui-1vu004u">/click</span> endpoint to track the click.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The downside with this approach is that users could go to an advertiser's website without us knowing about it. This could lead to discrepancies in our click data and make it harder for advertisers to track the performance of their ads. Sophisticated users could grab the url off of the page and navigate to it directly, bypassing our click tracking entirely. Someone would probably build a browser extension to do this.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Server side redirect</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-1">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A more robust solution is to have the user click on the ad, which will then send a request to our server. Our server can then track the click and respond with a redirect to the advertiser's website via a 302 (redirect) status code.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This way, we can ensure that we track every click and provide a consistent experience for users and advertisers. This approach also allows us to append additional tracking parameters to the URL, which can help the advertiser track the source of the click, but this is out of scope so we won't go into more detail here.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-1">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The only downside is the added complexity, which could slow down the user experience. We need to make sure that our system can handle the additional load and respond quickly to the user's request.</div></div></div></div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-advertisers-can-query-ad-click-metrics-over-time-at-1-minute-intervals">2) Advertisers can query ad click metrics over time at 1 minute intervals</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our users were successfully redirected, now let's focus on the advertisers. They need to be able to quickly query metrics about their ads to see how they're performing. We'll expand on the click processor path that we introduced above by breaking down some options for how a click is processed and stored.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Once our <span class="MuiBox-root mui-1vu004u">/click</span> endpoint receives a request what happens next?</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Store and Query From the Same Database</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-2">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a click comes in from a user, we can simply store that click event in our database. The schema would look something like this:</div><div class="MuiTableContainer-root mui-ntrpdu"><table class="MuiTable-root mui-hu1vpi"><thead class="MuiTableHead-root mui-1wbz3t9"><tr class="MuiTableRow-root MuiTableRow-head mui-a1y8t3"><th class="MuiTableCell-root MuiTableCell-head MuiTableCell-sizeSmall mui-1dvcw2j" scope="col">EventId</th><th class="MuiTableCell-root MuiTableCell-head MuiTableCell-sizeSmall mui-1dvcw2j" scope="col">Ad Id</th><th class="MuiTableCell-root MuiTableCell-head MuiTableCell-sizeSmall mui-1dvcw2j" scope="col">User Id</th><th class="MuiTableCell-root MuiTableCell-head MuiTableCell-sizeSmall mui-1dvcw2j" scope="col">Timestamp</th></tr></thead><tbody class="MuiTableBody-root mui-1xnox0e"><tr class="MuiTableRow-root mui-a1y8t3"><td class="MuiTableCell-root MuiTableCell-body MuiTableCell-sizeSmall mui-7wgons">1</td><td class="MuiTableCell-root MuiTableCell-body MuiTableCell-sizeSmall mui-7wgons">123</td><td class="MuiTableCell-root MuiTableCell-body MuiTableCell-sizeSmall mui-7wgons">456</td><td class="MuiTableCell-root MuiTableCell-body MuiTableCell-sizeSmall mui-7wgons">1640000000</td></tr></tbody></table></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Then, when an advertiser wants to query metrics, we would query the database for all events that match the ad ID and time range running a <span class="MuiBox-root mui-1vu004u">GROUP BY</span> query to get the metrics that they need. For example,</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">SELECT</span><span> 
</span><span>  </span><span class="token" style="color: rgb(64, 120, 242);">COUNT</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(64, 120, 242);">*</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">as</span><span> total_clicks</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> 
</span><span>  </span><span class="token" style="color: rgb(64, 120, 242);">COUNT</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(166, 38, 164);">DISTINCT</span><span> UserId</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">as</span><span> unique_users
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">FROM</span><span> ClickEvents
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">WHERE</span><span> AdId </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">123</span><span>
</span><span>  </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">Timestamp</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">BETWEEN</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">1640000000</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">1640000001</span><span>
</span><span>  </span><span class="token" style="color: rgb(166, 38, 164);">GROUP</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">BY</span><span> AdId</span></code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1106.1807126439026 480.0720125333919">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1106.1807126439026" height="480.0720125333919" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 136.4417545404017) rotate(0 55.98632812499999 44.6328125)"><path d="M22.32 0 C49.39 -0.44, 73.4 -0.3, 89.66 0 M22.32 0 C46.17 -0.23, 69.73 -1.36, 89.66 0 M89.66 0 C102.9 0.02, 110.87 7.15, 111.97 22.32 M89.66 0 C106.21 -1.51, 113.08 7.84, 111.97 22.32 M111.97 22.32 C112.77 31.5, 112.74 44.41, 111.97 66.95 M111.97 22.32 C112.23 34.97, 111.88 48.75, 111.97 66.95 M111.97 66.95 C111.91 82.28, 102.55 87.37, 89.66 89.27 M111.97 66.95 C111.56 81.75, 105.23 91.4, 89.66 89.27 M89.66 89.27 C72.82 90.15, 59.43 88.13, 22.32 89.27 M89.66 89.27 C64.82 90.4, 40.93 90, 22.32 89.27 M22.32 89.27 C7.81 87.66, 1.68 80.83, 0 66.95 M22.32 89.27 C5.82 87.65, -1.9 81.89, 0 66.95 M0 66.95 C-1.93 53.72, -1.51 41.45, 0 22.32 M0 66.95 C-0.35 57.92, 0.45 48.59, 0 22.32 M0 22.32 C0.95 8.18, 5.55 -1.49, 22.32 0 M0 22.32 C-0.39 8.38, 8.4 2.22, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.88085937499999 171.0745670404017) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round" transform="translate(261.9480910247312 35.6860171786484) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C46.1 0.06, 67.28 -0.21, 107.17 0 M23.81 0 C49.5 0.8, 76.27 0.65, 107.17 0 M107.17 0 C124.5 -1.32, 131.95 8.29, 130.98 23.81 M107.17 0 C121.58 2.21, 132.72 8.36, 130.98 23.81 M130.98 23.81 C131.18 33.02, 130.62 47.27, 130.98 71.43 M130.98 23.81 C131.1 33.58, 130.14 41.94, 130.98 71.43 M130.98 71.43 C130.62 87.24, 123.65 97.11, 107.17 95.25 M130.98 71.43 C129.58 88.38, 122.14 94.39, 107.17 95.25 M107.17 95.25 C78.45 92.91, 49.13 93, 23.81 95.25 M107.17 95.25 C77.37 94.61, 48.05 94.91, 23.81 95.25 M23.81 95.25 C6.53 93.84, -1.66 87.36, 0 71.43 M23.81 95.25 C7.87 96.05, 1.45 85.27, 0 71.43 M0 71.43 C-1.45 58.03, -0.26 42.41, 0 23.81 M0 71.43 C0.16 55.59, -1.26 38.27, 0 23.81 M0 23.81 C-0.34 8.76, 8.77 1.93, 23.81 0 M0 23.81 C0.41 10.11, 9.62 -1.84, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(280.3406691497312 63.3090640536484) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(134.0925241049199 163.23350087219978) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M-0.32 0.22 C20.34 -11.66, 103.09 -58.93, 123.78 -70.53 M1.71 -0.72 C22.75 -12.55, 105.22 -58.37, 125.97 -69.59" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.23350087219978) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M19.07 -22.68 C14.01 -17.85, 6.2 -11.24, -0.32 0.22 M19.07 -22.68 C13.83 -16.47, 7.75 -8.75, -0.32 0.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.23350087219978) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M29.25 -4.86 C21.17 -5.16, 10.44 -3.66, -0.32 0.22 M29.25 -4.86 C21.05 -4.03, 11.9 -1.67, -0.32 0.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.23350087219978) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M106.2 -47.03 C112.08 -55.11, 115.48 -61.53, 125.97 -69.59 M106.2 -47.03 C113 -54.45, 118.71 -60.41, 125.97 -69.59" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.0925241049199 163.23350087219978) rotate(0 62.39560422619138 -34.695175134860335)"><path d="M96.32 -65.01 C105.14 -67.92, 111.37 -69.19, 125.97 -69.59 M96.32 -65.01 C106 -67, 114.67 -67.55, 125.97 -69.59" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(404.8205866605349 79.16639910969752) rotate(0 47.34102570860614 0.022474603057730747)"><path d="M-1.01 -1.14 C14.66 -1.17, 77.87 -0.11, 93.7 0.06 M0.66 0.87 C16.73 1.03, 80.53 1.56, 95.9 1.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.16639910969752) rotate(0 47.34102570860614 0.022474603057730747)"><path d="M27.31 -11.06 C17.69 -10.22, 11.88 -6.98, -1.01 -1.14 M27.31 -11.06 C19.78 -8.24, 10.58 -4.62, -1.01 -1.14" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.16639910969752) rotate(0 47.34102570860614 0.022474603057730747)"><path d="M27.06 9.46 C17.47 4.7, 11.73 2.33, -1.01 -1.14 M27.06 9.46 C19.45 6.43, 10.33 4.19, -1.01 -1.14" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.16639910969752) rotate(0 47.34102570860614 0.022474603057730747)"><path d="M67.65 11.7 C73.45 7.55, 83.09 5.31, 95.9 1.6 M67.65 11.7 C76.12 9.18, 83.06 7.08, 95.9 1.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(404.8205866605349 79.16639910969752) rotate(0 47.34102570860614 0.022474603057730747)"><path d="M67.77 -8.83 C73.57 -7.37, 83.18 -4, 95.9 1.6 M67.77 -8.83 C76.36 -5.49, 83.26 -1.73, 95.9 1.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(500.9849255355389 10) rotate(0 72.69127211417481 70.84147595836083)"><path d="M52.2 3.17 C61.56 -0.74, 74.71 -1.39, 85.34 0.41 C95.97 2.22, 107.41 8.04, 115.96 13.99 C124.51 19.95, 131.72 27.21, 136.64 36.15 C141.55 45.1, 144.93 57.47, 145.45 67.66 C145.98 77.85, 143.92 87.82, 139.79 97.29 C135.66 106.77, 128.73 117.53, 120.68 124.53 C112.64 131.54, 101.75 136.64, 91.53 139.32 C81.31 142, 69.5 142.58, 59.34 140.6 C49.19 138.63, 39.17 133.44, 30.61 127.46 C22.05 121.47, 13.07 113.45, 7.98 104.67 C2.89 95.9, 0.3 85.13, 0.07 74.82 C-0.17 64.52, 2.43 52.42, 6.58 42.85 C10.72 33.29, 16.55 24.21, 24.94 17.43 C33.33 10.65, 50.57 4.8, 56.91 2.19 C63.24 -0.42, 62.55 0.88, 62.96 1.77 M99.47 5.84 C109.38 8.28, 120.02 15.22, 127.43 22.72 C134.84 30.22, 141.28 40.96, 143.91 50.85 C146.55 60.73, 145.47 71.8, 143.24 82.03 C141 92.25, 136.47 103.59, 130.51 112.18 C124.55 120.77, 116.34 128.87, 107.47 133.55 C98.61 138.23, 87.81 140, 77.32 140.26 C66.83 140.52, 54.27 139.1, 44.55 135.13 C34.83 131.16, 25.85 124.01, 19.01 116.43 C12.16 108.86, 6.49 99.19, 3.47 89.66 C0.45 80.12, -0.96 69.1, 0.9 59.21 C2.76 49.32, 8.35 38.65, 14.63 30.31 C20.91 21.98, 29.76 14.43, 38.58 9.21 C47.41 3.99, 57.25 -0.52, 67.59 -1.02 C77.93 -1.53, 95.05 4.6, 100.61 6.15 C106.17 7.71, 101.31 7.07, 100.93 8.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(550.8850812047041 70.74898791894012) rotate(0 22.890625 10)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(657.5239754078711 18.709967329693427) rotate(0 60.903953552246094 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round" transform="translate(261.55734531268445 229.49806682777444) rotate(0 67.78910812950699 50.98985562394745)"><path d="M25.49 0 C57.39 -1.68, 90.5 1.11, 110.08 0 M25.49 0 C52.92 -0.08, 78.41 -0.36, 110.08 0 M110.08 0 C128.43 -1.99, 136.23 6.75, 135.58 25.49 M110.08 0 C127.01 0.53, 133.3 6.32, 135.58 25.49 M135.58 25.49 C137.42 38.66, 136.49 53.48, 135.58 76.48 M135.58 25.49 C135.44 39.45, 134.89 53.11, 135.58 76.48 M135.58 76.48 C133.69 94.67, 125.22 102.38, 110.08 101.98 M135.58 76.48 C136.01 91.64, 129.02 100.83, 110.08 101.98 M110.08 101.98 C90.69 101.22, 71.9 102.54, 25.49 101.98 M110.08 101.98 C92.74 100.52, 74.85 101.12, 25.49 101.98 M25.49 101.98 C8.25 102.79, 1.33 94.51, 0 76.48 M25.49 101.98 C9.59 102.83, -2.17 91.77, 0 76.48 M0 76.48 C1.73 62.41, 1.68 49.09, 0 25.49 M0 76.48 C0.48 64.29, 0.76 54.3, 0 25.49 M0 25.49 C0.67 8.51, 7.77 -0.15, 25.49 0 M0 25.49 C1.76 6.8, 8.67 -0.17, 25.49 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(278.90895344219143 270.4879224517219) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g mask="url(#mask-ozWoHi2ZxUzB3UKY06HNc)" stroke-linecap="round"><g transform="translate(130.5561836138795 219.16983332759128) rotate(0 62.281662865861335 30.85117700084629)"><path d="M0.91 0.22 C21.66 10.34, 103.04 51.64, 123.75 61.9 M-0.07 -0.71 C21.13 9.53, 105.24 49.25, 126.03 59.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.16983332759128) rotate(0 62.281662865861335 30.85117700084629)"><path d="M30.71 3.7 C24 1.75, 16.93 3.29, 0.91 0.22 M30.71 3.7 C22.3 1.57, 12.83 0.63, 0.91 0.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.16983332759128) rotate(0 62.281662865861335 30.85117700084629)"><path d="M21.5 22.04 C16.79 15.68, 11.9 12.89, 0.91 0.22 M21.5 22.04 C16.08 14.32, 9.43 7.77, 0.91 0.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.16983332759128) rotate(0 62.281662865861335 30.85117700084629)"><path d="M96.2 56.72 C103.65 55.89, 110.66 58.99, 126.03 59.89 M96.2 56.72 C105.97 56.76, 114.75 57.85, 126.03 59.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(130.5561836138795 219.16983332759128) rotate(0 62.281662865861335 30.85117700084629)"><path d="M105.22 38.29 C110.71 41.87, 115.6 49.34, 126.03 59.89 M105.22 38.29 C112.06 43.94, 118.07 50.67, 126.03 59.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-ozWoHi2ZxUzB3UKY06HNc"><rect x="0" y="0" fill="#fff" width="355.1195093456022" height="380.87218732928386"></rect><rect x="175.06831522974085" y="240.02101032843757" fill="#000" width="35.5390625" height="20" opacity="1"></rect></mask><g transform="translate(175.06831522974085 240.02101032843757) rotate(0 18.468734844494605 9.745083922324682)"><text x="17.76953125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">/click</text></g><g stroke-linecap="round" transform="translate(491.59414922797714 211.95657694029524) rotate(0 72.69127211417481 70.84147595836083)"><path d="M39.23 7.78 C47.57 2.36, 60.07 0.34, 70.79 -0.02 C81.51 -0.39, 94.01 1.31, 103.53 5.6 C113.05 9.89, 121.3 17.58, 127.93 25.72 C134.56 33.85, 140.5 44.52, 143.29 54.4 C146.09 64.29, 146.82 75.11, 144.71 85.02 C142.6 94.92, 137.28 105.53, 130.62 113.83 C123.97 122.13, 114.1 130.23, 104.78 134.8 C95.46 139.37, 85.06 141.36, 74.7 141.24 C64.34 141.13, 52.2 138.51, 42.63 134.11 C33.06 129.71, 23.96 122.76, 17.3 114.85 C10.64 106.94, 5.24 96.42, 2.65 86.65 C0.07 76.88, -0.16 65.97, 1.8 56.24 C3.76 46.52, 6.86 37.07, 14.42 28.3 C21.99 19.53, 40.4 7.91, 47.18 3.63 C53.95 -0.66, 54.57 1.35, 55.07 2.57 M85.3 0.05 C95.29 0.69, 107.2 5.89, 115.86 11.96 C124.51 18.04, 132.37 27.17, 137.24 36.48 C142.12 45.8, 144.53 57.43, 145.1 67.87 C145.67 78.3, 144.62 89.65, 140.69 99.09 C136.76 108.52, 129.82 118.01, 121.54 124.48 C113.26 130.95, 101.29 135.11, 91.01 137.91 C80.73 140.7, 69.88 142.57, 59.86 141.23 C49.85 139.88, 39.38 135.68, 30.93 129.84 C22.47 124, 14.1 115.62, 9.14 106.18 C4.19 96.74, 1.89 83.59, 1.19 73.22 C0.49 62.85, 0.99 53.47, 4.94 43.98 C8.89 34.49, 16.76 23.11, 24.89 16.29 C33.02 9.46, 43.56 5.56, 53.71 3.03 C63.86 0.49, 80.64 1.19, 85.77 1.08 C90.89 0.97, 84.57 1.37, 84.46 2.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(520.6114923971423 272.7055648592353) rotate(0 43.7734375 10)"><text x="43.7734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics DB</text></g><g stroke-linecap="round"><g transform="translate(413.1380123315712 283.6776920585271) rotate(0 36.95190064367671 -0.02351976363297581)"><path d="M0.81 -1.2 C13.38 -1.34, 62.12 -1.33, 74.29 -1.1 M-0.23 0.79 C12.31 0.79, 61.33 -0.26, 73.55 -0.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(413.1380123315712 283.6776920585271) rotate(0 36.95190064367671 -0.02351976363297581)"><path d="M45.43 10.34 C49.29 8.63, 55.37 5.76, 73.55 -0.11 M45.43 10.34 C54.43 7.2, 63.99 4.79, 73.55 -0.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(413.1380123315712 283.6776920585271) rotate(0 36.95190064367671 -0.02351976363297581)"><path d="M45.29 -10.18 C49.13 -7.63, 55.24 -6.25, 73.55 -0.11 M45.29 -10.18 C54.14 -6.69, 63.74 -2.48, 73.55 -0.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(720.8925572627913 232.47293851419226) rotate(0 67.78910812950699 50.98985562394745)"><path d="M25.49 0 C54.82 -0.33, 88.1 -2.26, 110.08 0 M25.49 0 C43.17 0.96, 59.64 0.49, 110.08 0 M110.08 0 C126.29 -0.74, 136.73 10.46, 135.58 25.49 M110.08 0 C126.08 1.26, 133.31 10.33, 135.58 25.49 M135.58 25.49 C136.28 36.35, 134.28 48.15, 135.58 76.48 M135.58 25.49 C134.39 38.28, 135.19 51.36, 135.58 76.48 M135.58 76.48 C136.84 91.7, 127.12 100.63, 110.08 101.98 M135.58 76.48 C136.76 91.44, 128.21 101.32, 110.08 101.98 M110.08 101.98 C86.81 103.49, 62.21 100.66, 25.49 101.98 M110.08 101.98 C91.42 103.29, 72.1 103.27, 25.49 101.98 M25.49 101.98 C9.97 100.38, -1 94.29, 0 76.48 M25.49 101.98 C9.01 99.72, 1.16 94.04, 0 76.48 M0 76.48 C-0.16 61, -1.48 42.62, 0 25.49 M0 76.48 C0.52 62.31, 0.27 47.2, 0 25.49 M0 25.49 C-1.46 8.27, 7.15 -1.32, 25.49 0 M0 25.49 C-2.17 10.55, 7.52 -0.12, 25.49 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(732.0332278922983 273.4627941381397) rotate(0 56.6484375 10)"><text x="56.6484375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics Service</text></g><g stroke-linecap="round" transform="translate(941.0937553814551 246.8409096678106) rotate(0 77.5434786312237 35.58840984914019)"><path d="M17.79 0 C51.4 0.83, 88.72 1.79, 137.29 0 M17.79 0 C64.36 -0.93, 112.29 0.43, 137.29 0 M137.29 0 C148.29 1.1, 153.11 7.52, 155.09 17.79 M137.29 0 C146.99 1.37, 152.94 6.39, 155.09 17.79 M155.09 17.79 C153.81 27.73, 153.4 38.81, 155.09 53.38 M155.09 17.79 C155.71 27.67, 155.1 38.65, 155.09 53.38 M155.09 53.38 C156.12 63.47, 150.14 70.6, 137.29 71.18 M155.09 53.38 C154.8 66.17, 150.68 72.36, 137.29 71.18 M137.29 71.18 C94.27 69.71, 55.04 70.89, 17.79 71.18 M137.29 71.18 C90.62 71.5, 41.98 72.71, 17.79 71.18 M17.79 71.18 C6.37 69.22, 1.01 65.73, 0 53.38 M17.79 71.18 C6.7 71.2, -0.84 65.07, 0 53.38 M0 53.38 C0.11 40.84, 1.06 28.07, 0 17.79 M0 53.38 C-0.9 39.95, -0.85 26.09, 0 17.79 M0 17.79 C-1.89 7.71, 5.08 -0.11, 17.79 0 M0 17.79 C0.49 6.6, 3.84 0.1, 17.79 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(964.6450465126788 272.4293195169508) rotate(0 53.9921875 10)"><text x="53.9921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analyst Browser</text></g><g stroke-linecap="round"><g transform="translate(710.041863201573 285.2517571371445) rotate(0 -34.665750668433475 -0.012512452867099455)"><path d="M0.36 1.12 C-11.28 1.21, -58.37 0.8, -70.06 0.53 M-0.91 0.66 C-12.14 0.4, -56.08 -1.29, -67.74 -1.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(710.041863201573 285.2517571371445) rotate(0 -34.665750668433475 -0.012512452867099455)"><path d="M-27.89 11.2 C-18.06 7.05, -11.02 4.64, 0.36 1.12 M-27.89 11.2 C-20.95 8.82, -14.08 6.42, 0.36 1.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(710.041863201573 285.2517571371445) rotate(0 -34.665750668433475 -0.012512452867099455)"><path d="M-27.77 -9.32 C-17.98 -7.68, -10.97 -4.3, 0.36 1.12 M-27.77 -9.32 C-20.74 -6.3, -13.9 -3.31, 0.36 1.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(710.041863201573 285.2517571371445) rotate(0 -34.665750668433475 -0.012512452867099455)"><path d="M-39.33 -10.95 C-45.49 -9.36, -54.43 -6.2, -67.74 -1.3 M-39.33 -10.95 C-47.18 -7.58, -55.2 -4.8, -67.74 -1.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(710.041863201573 285.2517571371445) rotate(0 -34.665750668433475 -0.012512452867099455)"><path d="M-39.77 9.57 C-45.8 5.37, -54.62 2.74, -67.74 -1.3 M-39.77 9.57 C-47.62 7.53, -55.53 4.92, -67.74 -1.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(931.4914248619798 279.35422101909535) rotate(0 -31.318669526471467 0.1251245286714493)"><path d="M-0.73 0.56 C-11.31 0.34, -52.91 -0.34, -63.11 -0.19 M1.09 -0.19 C-9.72 0.26, -53.73 1.13, -64.31 1.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(931.4914248619798 279.35422101909535) rotate(0 -31.318669526471467 0.1251245286714493)"><path d="M-29.07 10.4 C-18.88 6.53, -11.19 5.23, -0.73 0.56 M-29.07 10.4 C-18.73 7.12, -7.4 3, -0.73 0.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(931.4914248619798 279.35422101909535) rotate(0 -31.318669526471467 0.1251245286714493)"><path d="M-28.77 -10.12 C-18.48 -7.21, -10.9 -1.75, -0.73 0.56 M-28.77 -10.12 C-18.64 -5.23, -7.43 -1.17, -0.73 0.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(931.4914248619798 279.35422101909535) rotate(0 -31.318669526471467 0.1251245286714493)"><path d="M-36.23 -9.47 C-44.47 -6.93, -55.41 -1.5, -64.31 1.11 M-36.23 -9.47 C-48.44 -4.3, -59.58 -0.29, -64.31 1.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(931.4914248619798 279.35422101909535) rotate(0 -31.318669526471467 0.1251245286714493)"><path d="M-36 11.05 C-44.51 6.81, -55.52 5.47, -64.31 1.11 M-36 11.05 C-48.21 8.05, -59.44 3.89, -64.31 1.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(505.245454567274 370.0720125333919) rotate(0 56.92796325683594 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Click Event</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- eventId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- UserId</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Timestamp</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Store and Query From the Same Database</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-2">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Frankly, at our scale, this solution sucks. The database will quickly become a bottleneck as we scale up to 10k clicks per second. The <span class="MuiBox-root mui-1vu004u">GROUP BY</span> query will be slow and inefficient, and we won't be able to provide low latency queries to advertisers -- breaking our non-functional requirement.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Separate Analytics Database with Batch Processing</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-3">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A better solution is to have a separate analytics database that stores pre-aggregated data. When a click comes in, we will store the raw event in our event database. Then, in batches, we can process the raw events and aggregate them into a separate database that is special optimized for querying.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The schema for our analytics database could look something like this:</div><div class="MuiTableContainer-root mui-ntrpdu"><table class="MuiTable-root mui-hu1vpi"><thead class="MuiTableHead-root mui-1wbz3t9"><tr class="MuiTableRow-root MuiTableRow-head mui-a1y8t3"><th class="MuiTableCell-root MuiTableCell-head MuiTableCell-sizeSmall mui-1dvcw2j" scope="col">Ad Id</th><th class="MuiTableCell-root MuiTableCell-head MuiTableCell-sizeSmall mui-1dvcw2j" scope="col">Minute Timestamp</th><th class="MuiTableCell-root MuiTableCell-head MuiTableCell-sizeSmall mui-1dvcw2j" scope="col">Unique Clicks</th></tr></thead><tbody class="MuiTableBody-root mui-1xnox0e"><tr class="MuiTableRow-root mui-a1y8t3"><td class="MuiTableCell-root MuiTableCell-body MuiTableCell-sizeSmall mui-7wgons">123</td><td class="MuiTableCell-root MuiTableCell-body MuiTableCell-sizeSmall mui-7wgons">1640000000</td><td class="MuiTableCell-root MuiTableCell-body MuiTableCell-sizeSmall mui-7wgons">100</td></tr></tbody></table></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When an advertiser wants to query metrics, we simply query this analytics database for the metrics that they need. This allows us to provide low latency queries since we did the expensive aggregation work in advance.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To pull this off, we'll need an event database that is optimized for lots of writes. <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/_/index.html" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Cassandra</a> is a good choice here. It uses a storage structure that resembles <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Log-structured_merge-tree" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">LSM</a>. It writes inserts and updates in a log-like structure known as a memtable (in memory) and periodically flushes these memtables to disk in files called SSTables. These SSTable, while optimized for reads of specific rows, are not optimized for range queries or aggregations which is why we need to do the batch processing to pre-aggregate.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In order to do the batch processing, we can use a tool like <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://spark.apache.org/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Apache Spark</a>. Spark is a distributed computing engine that is optimized for these types of workflows and can handle the large volume of data that we will be processing.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">How much data will we be processing exactly?</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Well, if we have 10k clicks per second and we choose to run our batch processing every 5 minutes, we will be processing 3M events every minute. Each event will only be a hundred bytes at most, so we will be processing 300MB of data every minute. This is well within the capabilities of Spark.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Using map-reduce, Spark will read the raw events in parallel chunks, aggregate them by ad ID and minute timestamp, and then write the aggregated data to our analytics database.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For an analytics database, we want a technology that is optimized for reads and aggregations. Online analytical processing (OLAP) databases like Redshift, Snowflake, or BigQuery are all good choices here. They are optimized for these types of queries and can handle the large volume of data that we will be storing.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 933.7726843023902 665.0430791337103">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="933.7726843023902" height="665.0430791337103" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 464.3768649219064) rotate(0 55.986328125 44.6328125)"><path d="M22.32 0 C43.66 0.99, 60.77 0.99, 89.66 0 M22.32 0 C37.66 -0.66, 52.84 0.9, 89.66 0 M89.66 0 C104 1.04, 110.43 8.82, 111.97 22.32 M89.66 0 C105.64 -1.7, 110.65 7.24, 111.97 22.32 M111.97 22.32 C114.09 35.25, 114.18 46.74, 111.97 66.95 M111.97 22.32 C111.7 33.91, 113.26 46.27, 111.97 66.95 M111.97 66.95 C112.94 79.91, 104.83 87.78, 89.66 89.27 M111.97 66.95 C111.27 82.58, 106.5 88.11, 89.66 89.27 M89.66 89.27 C72.38 89.37, 53.3 89.16, 22.32 89.27 M89.66 89.27 C76.37 89.08, 61.77 89.63, 22.32 89.27 M22.32 89.27 C5.69 88.96, 1.43 81.17, 0 66.95 M22.32 89.27 C8.97 89.83, -1.32 82.8, 0 66.95 M0 66.95 C-0.76 50.97, 1.12 34.09, 0 22.32 M0 66.95 C-1 53.7, -1.01 39.1, 0 22.32 M0 22.32 C1.41 6.19, 6.14 -0.8, 22.32 0 M0 22.32 C-1.18 8.78, 5.66 2, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.880859375 499.0096774219064) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round" transform="translate(190.40717210331968 296.4529199834724) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C51.46 -1.59, 81.91 -1, 107.17 0 M23.81 0 C43.26 -0.25, 62.47 -0.08, 107.17 0 M107.17 0 C124 -1.48, 129.83 7.77, 130.98 23.81 M107.17 0 C122.17 1.75, 132.49 9.99, 130.98 23.81 M130.98 23.81 C130.68 42.51, 132.21 57.11, 130.98 71.43 M130.98 23.81 C131.92 36.48, 131.59 50.33, 130.98 71.43 M130.98 71.43 C130.37 87.97, 124.75 94.24, 107.17 95.25 M130.98 71.43 C130.46 88.73, 121.81 96.87, 107.17 95.25 M107.17 95.25 C78.38 94.08, 53.92 96.9, 23.81 95.25 M107.17 95.25 C84.75 95.21, 64.79 95.03, 23.81 95.25 M23.81 95.25 C9.27 95.73, -1.14 88.16, 0 71.43 M23.81 95.25 C9.51 94.94, -0.47 86.37, 0 71.43 M0 71.43 C-0.06 56.34, 1.26 38.8, 0 23.81 M0 71.43 C1.16 53.8, -0.2 37.01, 0 23.81 M0 23.81 C-1.03 9.1, 6.39 1.74, 23.81 0 M0 23.81 C1.67 7.91, 9.41 -2.29, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(208.79975022831968 324.0759668584724) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(129.9101562500001 466.21489701769406) rotate(0 28.95927198060855 -32.086585136752774)"><path d="M-0.36 -0.76 C9.26 -11.28, 47.34 -52.6, 57 -63.06 M1.65 1.45 C11.71 -9.38, 50.06 -53.43, 59.23 -64.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.9101562500001 466.21489701769406) rotate(0 28.95927198060855 -32.086585136752774)"><path d="M11.18 -28.45 C7.15 -23.36, 7.49 -15.7, -0.36 -0.76 M11.18 -28.45 C7.38 -19.36, 2.26 -8.95, -0.36 -0.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.9101562500001 466.21489701769406) rotate(0 28.95927198060855 -32.086585136752774)"><path d="M26.28 -14.56 C18.61 -12.85, 15.32 -8.53, -0.36 -0.76 M26.28 -14.56 C17.27 -10.25, 6.83 -4.74, -0.36 -0.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.9101562500001 466.21489701769406) rotate(0 28.95927198060855 -32.086585136752774)"><path d="M48.78 -36.48 C50.02 -44.75, 55.65 -50.51, 59.23 -64.6 M48.78 -36.48 C53.16 -47.2, 55.79 -56.45, 59.23 -64.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.9101562500001 466.21489701769406) rotate(0 28.95927198060855 -32.086585136752774)"><path d="M33.15 -49.77 C38.15 -54.79, 47.54 -57.36, 59.23 -64.6 M33.15 -49.77 C42.93 -55.92, 51.06 -60.49, 59.23 -64.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(229.25572894704658 554.3260836719064) rotate(0 64.1640625 42.67578125)"><path d="M21.34 0 C46.33 0.12, 68.66 -0.89, 106.99 0 M21.34 0 C52.38 0.55, 84.19 1.4, 106.99 0 M106.99 0 C122.53 1.78, 129.57 8.98, 128.33 21.34 M106.99 0 C122.41 -0.85, 130 8.01, 128.33 21.34 M128.33 21.34 C129.23 32.57, 126.35 42.17, 128.33 64.01 M128.33 21.34 C129.05 30.47, 127.97 41.21, 128.33 64.01 M128.33 64.01 C127.26 79.65, 121.68 86.38, 106.99 85.35 M128.33 64.01 C128.62 76.14, 119.76 86.13, 106.99 85.35 M106.99 85.35 C74.92 83.81, 42 86.99, 21.34 85.35 M106.99 85.35 C83.54 85.98, 61.91 85.43, 21.34 85.35 M21.34 85.35 C6.7 84.54, 0.46 79.3, 0 64.01 M21.34 85.35 C7.14 85.57, 0.34 79.97, 0 64.01 M0 64.01 C-0.67 56.63, -1.49 45.11, 0 21.34 M0 64.01 C-0.56 53.79, 0.95 41.81, 0 21.34 M0 21.34 C1.28 5.12, 8.18 -1.8, 21.34 0 M0 21.34 C-1.52 7.39, 6.63 -1.95, 21.34 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(242.98229144704658 587.0018649219064) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g stroke-linecap="round"><g transform="translate(131.6445312500001 547.3302102857374) rotate(0 45.82903634852329 22.911542423554977)"><path d="M-0.93 0.83 C14.5 8.21, 76.92 37.45, 92.23 44.94 M0.79 0.22 C16.13 7.68, 76.74 38.21, 91.59 46.01" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(131.6445312500001 547.3302102857374) rotate(0 45.82903634852329 22.911542423554977)"><path d="M28.95 3.59 C22.15 3.56, 11.12 0.7, -0.93 0.83 M28.95 3.59 C20.9 3.9, 12.16 3.14, -0.93 0.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(131.6445312500001 547.3302102857374) rotate(0 45.82903634852329 22.911542423554977)"><path d="M20.18 22.14 C15.68 17.11, 7.05 9.18, -0.93 0.83 M20.18 22.14 C14.77 16.98, 8.58 10.81, -0.93 0.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(131.6445312500001 547.3302102857374) rotate(0 45.82903634852329 22.911542423554977)"><path d="M61.82 42.28 C71.36 44.49, 76.64 43.4, 91.59 46.01 M61.82 42.28 C71.14 44.03, 79.78 45.16, 91.59 46.01" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(131.6445312500001 547.3302102857374) rotate(0 45.82903634852329 22.911542423554977)"><path d="M71.18 24.02 C78.25 31.15, 80.97 35.05, 91.59 46.01 M71.18 24.02 C77.7 31.16, 83.61 37.62, 91.59 46.01" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(369.67760394704646 597.1421298468631) rotate(0 146.83035354755327 -1.0006386839033894)"><path d="M0.57 -0.89 C49.56 -1.38, 244.2 -2.07, 292.97 -2.1 M-0.58 1.26 C48.87 0.9, 246.53 0.08, 295.32 -0.62" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(369.67760394704646 597.1421298468631) rotate(0 146.83035354755327 -1.0006386839033894)"><path d="M267.22 9.88 C271.93 6.26, 279.5 4.31, 295.32 -0.62 M267.22 9.88 C278.35 6.61, 288.82 1.36, 295.32 -0.62" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(369.67760394704646 597.1421298468631) rotate(0 146.83035354755327 -1.0006386839033894)"><path d="M267.05 -10.64 C271.93 -9.69, 279.54 -7.07, 295.32 -0.62 M267.05 -10.64 C278.37 -6.19, 288.91 -3.72, 295.32 -0.62" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(677.1602151274094 530.3047978837103) rotate(0 69.244140625 62.369140625)"><path d="M57.05 1.74 C66.89 -0.92, 80.13 0.37, 90.19 3.18 C100.25 5.99, 109.84 12.02, 117.4 18.6 C124.96 25.19, 132.24 33.46, 135.56 42.69 C138.88 51.93, 139.15 64.33, 137.32 74.03 C135.5 83.73, 131.29 93.36, 124.61 100.88 C117.93 108.4, 107.21 115.25, 97.26 119.16 C87.32 123.07, 75.43 124.73, 64.93 124.35 C54.44 123.97, 43.47 121.79, 34.28 116.88 C25.09 111.97, 15.39 103.34, 9.81 94.88 C4.22 86.43, 1.33 75.71, 0.78 66.15 C0.24 56.59, 2.26 46.25, 6.56 37.51 C10.85 28.78, 17.64 20.03, 26.57 13.74 C35.5 7.46, 53.5 1.75, 60.14 -0.2 C66.77 -2.14, 66.17 0.91, 66.39 2.09 M75.05 -0.35 C85.67 -0.54, 97.72 4.37, 106.54 9.62 C115.35 14.87, 122.45 22.95, 127.93 31.16 C133.41 39.38, 138.76 49.46, 139.42 58.9 C140.07 68.34, 136.44 78.86, 131.85 87.81 C127.26 96.75, 120.3 106.54, 111.86 112.56 C103.42 118.59, 91.79 122.23, 81.2 123.95 C70.62 125.67, 58.79 125.72, 48.34 122.9 C37.89 120.07, 26.29 114.1, 18.49 106.98 C10.69 99.85, 4.25 89.68, 1.55 80.13 C-1.15 70.59, 0.2 59.24, 2.3 49.7 C4.39 40.17, 7.73 30.17, 14.1 22.92 C20.48 15.66, 30.77 9.75, 40.56 6.17 C50.34 2.59, 67.08 2.25, 72.81 1.45 C78.55 0.65, 74.7 0.8, 74.97 1.37" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(702.675729359037 572.5722962359954) rotate(0 43.765625 20)"><text x="43.765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Cassandra</text><text x="43.765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(Raw Events)</text></g><g stroke-linecap="round" transform="translate(614.9875602658119 441.88616382862347) rotate(0 132.1990642903039 17.26150615779403)"><path d="M8.63 0 C74.84 -0.31, 139.65 -0.48, 255.77 0 M8.63 0 C73.13 -0.91, 139.39 -0.4, 255.77 0 M255.77 0 C262.49 -1.92, 264.69 1.39, 264.4 8.63 M255.77 0 C260.82 0.76, 266.37 1.73, 264.4 8.63 M264.4 8.63 C265.72 13.83, 265.39 18.43, 264.4 25.89 M264.4 8.63 C264.96 11.88, 264.5 15.96, 264.4 25.89 M264.4 25.89 C262.65 31.34, 262.95 33.87, 255.77 34.52 M264.4 25.89 C265.93 32.21, 260.21 35.5, 255.77 34.52 M255.77 34.52 C164.06 34.48, 74.57 34.12, 8.63 34.52 M255.77 34.52 C178.49 36.52, 101.97 35.88, 8.63 34.52 M8.63 34.52 C4.29 33.28, -1.3 30.85, 0 25.89 M8.63 34.52 C1.7 35.87, -1.78 33.65, 0 25.89 M0 25.89 C-1.72 20.38, -1.55 11.88, 0 8.63 M0 25.89 C0.77 19.7, 0.18 14.33, 0 8.63 M0 8.63 C0.97 1.66, 3.09 -0.81, 8.63 0 M0 8.63 C-1.55 1.45, 4.82 -2.21, 8.63 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(728.5225620561158 449.14766998641744) rotate(0 18.6640625 10)"><text x="18.6640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Spark</text></g><g stroke-linecap="round"><g transform="translate(746.757579998922 484.71176811584974) rotate(0 0 20.619649502747052)"><path d="M0.29 -0.2 C0.3 6.62, 0.5 34.56, 0.4 41.45 M-0.23 -0.78 C-0.29 6.11, 0 33.51, 0.17 40.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(746.757579998922 484.71176811584974) rotate(0 0 20.619649502747052)"><path d="M-7.19 21.34 C-4.81 29.02, -1.38 34.67, 0.17 40.6 M-7.19 21.34 C-4.75 26.36, -2.81 31.98, 0.17 40.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(746.757579998922 484.71176811584974) rotate(0 0 20.619649502747052)"><path d="M6.91 21.11 C4.19 28.91, 2.51 34.65, 0.17 40.6 M6.91 21.11 C5.32 26.23, 3.22 31.91, 0.17 40.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(666.8814308082608 435.7607556306052) rotate(0 0.13300451709790195 -54.42448957625197)"><path d="M0.87 0.47 C0.69 -17.63, -0.54 -90.89, -0.45 -109.01 M-0.13 -0.33 C0.03 -18.2, 1.66 -89.23, 1.89 -107.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(666.8814308082608 435.7607556306052) rotate(0 0.13300451709790195 -54.42448957625197)"><path d="M11.64 -79.19 C9.09 -90.29, 4.6 -97.17, 1.89 -107.56 M11.64 -79.19 C8.25 -89.9, 4.41 -98.7, 1.89 -107.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(666.8814308082608 435.7607556306052) rotate(0 0.13300451709790195 -54.42448957625197)"><path d="M-8.88 -79.57 C-4.2 -90.69, -1.47 -97.43, 1.89 -107.56 M-8.88 -79.57 C-5.12 -89.95, -1.82 -98.62, 1.89 -107.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(598.0137357861388 199.47781945773477) rotate(0 68.19125898493701 60.80703946728937)"><path d="M98.9 7.1 C108.05 10.33, 117.34 18.08, 123.56 25.94 C129.77 33.81, 134.89 44.95, 136.21 54.31 C137.53 63.68, 135.15 73.55, 131.46 82.13 C127.76 90.7, 121.75 99.45, 114.04 105.77 C106.34 112.1, 95.51 117.71, 85.24 120.08 C74.96 122.44, 62.93 122.38, 52.41 119.98 C41.88 117.58, 30.01 111.84, 22.08 105.7 C14.14 99.56, 8.44 91.82, 4.78 83.16 C1.11 74.5, -1.16 63.36, 0.08 53.74 C1.32 44.11, 6.15 33.08, 12.2 25.4 C18.24 17.73, 27.05 11.81, 36.33 7.69 C45.6 3.57, 56.54 0.54, 67.84 0.67 C79.14 0.79, 97.55 6.38, 104.14 8.43 C110.74 10.48, 108.06 12.04, 107.41 12.97 M54.4 1.4 C64 -1.23, 77.3 0.77, 87.22 3.49 C97.13 6.21, 106.54 11.44, 113.9 17.7 C121.26 23.97, 127.62 32.46, 131.4 41.09 C135.18 49.72, 138.18 60.22, 136.59 69.47 C134.99 78.73, 128.47 88.77, 121.84 96.61 C115.21 104.46, 106.37 112.18, 96.81 116.55 C87.25 120.93, 74.7 123.38, 64.46 122.88 C54.21 122.37, 44.14 118.68, 35.34 113.53 C26.53 108.37, 17.33 100.11, 11.61 91.94 C5.89 83.77, 2.24 73.61, 1.03 64.5 C-0.17 55.4, 0.47 45.96, 4.4 37.3 C8.33 28.64, 16.07 18.77, 24.62 12.53 C33.16 6.29, 50.61 1.76, 55.66 -0.14 C60.71 -2.05, 54.77 0.02, 54.91 1.09" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(631.9825868751788 250.2877889738258) rotate(0 34.00390625 10)"><text x="34.00390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">OLAP DB</text></g><g stroke-linecap="round" transform="translate(764.0742534390301 343.48683329086043) rotate(0 57.76669424787974 28.148384426612438)"><path d="M14.07 0 C46.81 -0.13, 81.9 -1.03, 101.46 0 M14.07 0 C42.94 1.06, 71.72 1.14, 101.46 0 M101.46 0 C111.31 1.03, 115.79 2.87, 115.53 14.07 M101.46 0 C109.38 0.78, 117.32 3.74, 115.53 14.07 M115.53 14.07 C115.26 24.63, 114.92 33.65, 115.53 42.22 M115.53 14.07 C116.06 23.07, 115.17 31.93, 115.53 42.22 M115.53 42.22 C115.99 52.66, 110.87 56.49, 101.46 56.3 M115.53 42.22 C115.87 53.34, 108.69 57.61, 101.46 56.3 M101.46 56.3 C82.27 55.62, 64.78 55.89, 14.07 56.3 M101.46 56.3 C70.87 57.05, 39.47 56.06, 14.07 56.3 M14.07 56.3 C5.76 54.5, -1.32 51.85, 0 42.22 M14.07 56.3 C4.21 54.35, 1.96 49.46, 0 42.22 M0 42.22 C-0.96 33.53, -0.56 23.06, 0 14.07 M0 42.22 C0.01 35.55, 0.16 28.36, 0 14.07 M0 14.07 C-0.2 2.78, 3.78 1.81, 14.07 0 M0 14.07 C1.65 6.7, 4.39 1.6, 14.07 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(773.6378226869099 361.63521771747287) rotate(0 48.203125 10)"><text x="48.203125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">cron Scheduler</text></g><g stroke-linecap="round"><g transform="translate(823.4383049299609 407.10245933386204) rotate(0 0.5835053273318636 15.034132670816916)"><path d="M-0.17 0.18 C0.09 5.21, 1.44 24.75, 1.64 29.79 M0.75 -0.2 C0.97 4.94, 1.47 25.4, 1.45 30.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(823.4383049299609 407.10245933386204) rotate(0 0.5835053273318636 15.034132670816916)"><path d="M-3.88 16.28 C-2.01 21.36, -0.96 24.97, 1.45 30.35 M-3.88 16.28 C-1.9 21.54, -0.01 26.1, 1.45 30.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(823.4383049299609 407.10245933386204) rotate(0 0.5835053273318636 15.034132670816916)"><path d="M6.41 16.15 C5.04 21.25, 2.86 24.91, 1.45 30.35 M6.41 16.15 C4.67 21.5, 2.83 26.1, 1.45 30.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(764.3564718004698 315.39408387844196) rotate(0 65.823974609375 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Run every minute</text></g><g stroke-linecap="round" transform="translate(586.080063994076 10) rotate(0 77.5434786312237 35.58840984914019)"><path d="M17.79 0 C65.1 -0.8, 111.34 0.74, 137.29 0 M17.79 0 C59.13 1.43, 102.52 0.67, 137.29 0 M137.29 0 C149.64 0.27, 153.34 5.62, 155.09 17.79 M137.29 0 C150.8 -0.76, 156.62 6.49, 155.09 17.79 M155.09 17.79 C154.97 26.02, 154.42 35.54, 155.09 53.38 M155.09 17.79 C155.24 31.11, 154.15 43.49, 155.09 53.38 M155.09 53.38 C153.19 64.82, 150.57 69.93, 137.29 71.18 M155.09 53.38 C153.6 64.33, 147.98 72.52, 137.29 71.18 M137.29 71.18 C110.67 73.33, 82.1 73.11, 17.79 71.18 M137.29 71.18 C111.99 70.48, 87.95 70.39, 17.79 71.18 M17.79 71.18 C6.26 69.36, 0.97 64.03, 0 53.38 M17.79 71.18 C6.18 70.24, -1.55 63.82, 0 53.38 M0 53.38 C0.39 40.48, -0.59 25.8, 0 17.79 M0 53.38 C0.88 46.98, 0.03 39.52, 0 17.79 M0 17.79 C1.84 7.25, 5.37 0.33, 17.79 0 M0 17.79 C1.13 6.57, 6.49 0.69, 17.79 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(609.6313551252997 35.58840984914019) rotate(0 53.9921875 10)"><text x="53.9921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analyst Browser</text></g><g transform="translate(749.6826057092192 210.42282885160876) rotate(0 44.791969299316406 30)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Druid</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedShift</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Snowflake</text></g><g stroke-linecap="round" transform="translate(613.5325761871857 116.90008943762996) rotate(0 51.13453969928662 25)"><path d="M12.5 0 C35.67 -1.37, 63.16 1.45, 89.77 0 M12.5 0 C31.6 -0.26, 53.16 -0.43, 89.77 0 M89.77 0 C99.44 0.49, 101.13 5.01, 102.27 12.5 M89.77 0 C99.67 -0.3, 101.79 3.23, 102.27 12.5 M102.27 12.5 C102.59 20.87, 103.91 26.78, 102.27 37.5 M102.27 12.5 C102.74 20.81, 101.38 29.96, 102.27 37.5 M102.27 37.5 C101.24 47, 96.55 51.74, 89.77 50 M102.27 37.5 C103.94 45.8, 99.57 47.71, 89.77 50 M89.77 50 C62.71 49.07, 33.47 51.19, 12.5 50 M89.77 50 C74.3 48.69, 57.96 48.89, 12.5 50 M12.5 50 C2.82 48.76, 1.69 43.91, 0 37.5 M12.5 50 C4.73 50.06, 0.91 44.76, 0 37.5 M0 37.5 C2.05 31.69, 1.98 22.74, 0 12.5 M0 37.5 C-0.51 28.43, 0.26 19.31, 0 12.5 M0 12.5 C0.48 4.76, 2.6 0.64, 12.5 0 M0 12.5 C-1.51 3.69, 5.67 0.21, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(632.0069596364723 121.90008943762996) rotate(0 32.66015625 20)"><text x="32.66015625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics </text><text x="32.66015625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(665.7569353116107 86.79278662922252) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M0.43 -0.23 C0.5 3.64, 0.25 19.5, 0.1 23.42 M-0.02 -0.82 C0.03 3.13, -0.36 20.05, -0.27 24.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(665.7569353116107 86.79278662922252) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-4.22 13.17 C-3.51 15.9, -2.25 17.84, -0.27 24.15 M-4.22 13.17 C-2.86 16.38, -2.1 19.55, -0.27 24.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(665.7569353116107 86.79278662922252) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M3.76 13.2 C2.58 15.95, 1.95 17.89, -0.27 24.15 M3.76 13.2 C2.85 16.38, 1.34 19.55, -0.27 24.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(663.8498599488087 171.9143736093315) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M0.13 0.08 C-0.15 3.89, -1.17 18.89, -1.25 22.63 M-0.46 -0.36 C-0.62 3.55, -0.26 19.39, -0.27 23.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(663.8498599488087 171.9143736093315) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-4.27 12.65 C-2.7 16.17, -1.36 21.09, -0.27 23.29 M-4.27 12.65 C-3.33 15.61, -1.9 18.29, -0.27 23.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(663.8498599488087 171.9143736093315) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M3.5 12.57 C2.13 16.12, 0.55 21.08, -0.27 23.29 M3.5 12.57 C2.37 15.56, 1.72 18.26, -0.27 23.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(415.1691977152517 280.0206690210798) rotate(0 72.69127211417481 70.84147595836083)"><path d="M98.41 3.92 C108.28 6.34, 118.4 15.06, 125.61 22.52 C132.82 29.98, 138.55 39.02, 141.67 48.68 C144.79 58.35, 145.62 70.33, 144.33 80.52 C143.03 90.71, 139.62 101.28, 133.92 109.83 C128.22 118.37, 119.11 126.66, 110.13 131.77 C101.15 136.87, 90.42 139.71, 80.03 140.45 C69.64 141.2, 57.79 139.56, 47.78 136.24 C37.78 132.92, 27.46 127.9, 19.99 120.55 C12.51 113.2, 6.24 102.09, 2.95 92.15 C-0.33 82.2, -1.35 71.06, 0.25 60.88 C1.85 50.71, 6.58 39.44, 12.57 31.1 C18.57 22.75, 27.3 15.82, 36.22 10.79 C45.14 5.76, 55.33 1.65, 66.1 0.93 C76.87 0.21, 94.55 5.27, 100.84 6.48 C107.14 7.69, 104.16 7.23, 103.86 8.19 M43.04 4.91 C51.61 0.02, 64.73 -1.27, 75.23 -0.89 C85.72 -0.51, 96.95 2.52, 106.02 7.19 C115.08 11.86, 123.09 19.11, 129.62 27.14 C136.16 35.17, 142.9 45.16, 145.21 55.36 C147.52 65.57, 146.21 78.31, 143.5 88.36 C140.8 98.41, 135.81 108.07, 128.97 115.68 C122.12 123.28, 112.23 129.42, 102.44 133.98 C92.64 138.54, 80.5 142.82, 70.19 143.02 C59.89 143.22, 49.88 139.91, 40.61 135.19 C31.33 130.46, 20.85 122.88, 14.55 114.66 C8.25 106.43, 4.94 96.04, 2.82 85.87 C0.7 75.69, -0.66 63.63, 1.83 53.61 C4.32 43.58, 10.86 33.54, 17.75 25.72 C24.63 17.91, 39.08 9.66, 43.16 6.72 C47.24 3.77, 41.95 7.09, 42.22 8.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(465.0693533844169 340.7696569400199) rotate(0 22.890625 10)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(423.5880600709942 180.17081215023518) rotate(0 60.903953552246094 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round"><g transform="translate(334.08460548117023 355.1749100874408) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M-0.69 0.51 C11.62 0.37, 62.27 -0.3, 74.65 -0.53 M1.15 -0.27 C13.31 -0.24, 62.21 0.85, 74.13 0.93" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334.08460548117023 355.1749100874408) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M27.37 -10.12 C17.95 -5.02, 6.55 -2.9, -0.69 0.51 M27.37 -10.12 C20.13 -7.12, 12.99 -3.71, -0.69 0.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334.08460548117023 355.1749100874408) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M27.64 10.4 C18.07 7.97, 6.57 2.57, -0.69 0.51 M27.64 10.4 C20.28 8.08, 13.08 6.17, -0.69 0.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334.08460548117023 355.1749100874408) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M45.78 10.75 C57 8.68, 66.29 3.29, 74.13 0.93 M45.78 10.75 C53.12 8.15, 60.6 6.26, 74.13 0.93" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(334.08460548117023 355.1749100874408) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M46.1 -9.77 C57.25 -4.32, 66.42 -2.17, 74.13 0.93 M46.1 -9.77 C53.4 -7.05, 60.8 -3.62, 74.13 0.93" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(831.3567602301246 547.7815303868201) rotate(0 46.20796203613281 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Event</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- eventId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- adId</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- userId</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- timestamp</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Batch Processing</span></div></div></div></div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The ad click is sent to the click processor service.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The click processor service writes the event to our event store.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Every N minutes, a cron job kicks off a spark job that reads the events from the event store and aggregates them.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The aggregated data is stored in an OLAP database for querying.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Advertisers can query the OLAP database to get metrics on their ads.</div></li>
</ol><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-3">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This solution works, and it works pretty well, but there are several key challenges that prevent it from being a "great" solution. First, the batched processing job introduces a significant delay in the data pipeline. Advertisers will always be querying data that is at a couple minutes old. This is not ideal and something we can improve upon. Second, the system is not scalable. If we have a sudden spike in clicks, the system will not be able to handle the load.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While the simple inclusion of a queue between the click processor and the event store would help with the scalability issue, it would not solve the latency problem. To address both of these challenges, we can introduce a stream processing design that processes events in real-time.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Real-time Analytics With Stream Processing</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-4">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To address the latency and scalability issues, let's introduce a stream for real-time processing. This system allows us to process events as they come in, rather than waiting for a batch job to run.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a click comes in our click processing service will immediately write the event to a stream like <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Kafka</a> or <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://aws.amazon.com/kinesis/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Kinesis</a>. We then need a stream processor like <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://flink.apache.org/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Flink</a> or <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://spark.apache.org/streaming/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Spark Streaming</a> to read the events from the stream and aggregate them in real-time.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This works by keeping a running count of click totals in memory and updating them as new events come in. When we reach the end of a time window, we can flush the aggregated data to our OLAP database.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 877.4568932810187 466.5365412058459">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="877.4568932810187" height="466.5365412058459" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 280.93914068787035) rotate(0 55.986328125 44.6328125)"><path d="M22.32 0 C39.82 0.76, 59.67 -2.66, 89.66 0 M22.32 0 C47.46 -0.53, 72.6 -0.53, 89.66 0 M89.66 0 C103.35 0.01, 111.46 5.91, 111.97 22.32 M89.66 0 C102.7 -1.34, 111.85 6.91, 111.97 22.32 M111.97 22.32 C111.25 36.05, 111.36 54.95, 111.97 66.95 M111.97 22.32 C111.51 37.38, 112.74 51.71, 111.97 66.95 M111.97 66.95 C110.14 82.05, 103.9 91.18, 89.66 89.27 M111.97 66.95 C113.27 82.05, 105.88 89.05, 89.66 89.27 M89.66 89.27 C65.47 90.72, 39.74 89.89, 22.32 89.27 M89.66 89.27 C71.08 89.44, 51.81 89.94, 22.32 89.27 M22.32 89.27 C7.57 88.36, 1.81 81.81, 0 66.95 M22.32 89.27 C8.59 89.35, 0.79 82.46, 0 66.95 M0 66.95 C-2.15 54.51, -2.32 42.44, 0 22.32 M0 66.95 C-0.84 49.76, -0.2 31.78, 0 22.32 M0 22.32 C0.19 6.63, 7.79 -0.62, 22.32 0 M0 22.32 C0.26 8.24, 7.37 -1.28, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.880859375 315.57195318787035) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round"><g transform="translate(129.91015625 310.21416254405995) rotate(0 13.727197134581274 -42.60575583781406)"><path d="M-1.2 0.8 C3.28 -13.3, 22.86 -69.71, 27.72 -84.02 M0.37 0.17 C4.64 -14.28, 22.39 -71.55, 26.91 -85.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.91015625 310.21416254405995) rotate(0 13.727197134581274 -42.60575583781406)"><path d="M-1.84 -29.19 C-0.12 -17.62, 0.77 -6.03, -1.2 0.8 M-1.84 -29.19 C-1.96 -19.78, -1.42 -11.13, -1.2 0.8" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.91015625 310.21416254405995) rotate(0 13.727197134581274 -42.60575583781406)"><path d="M17.59 -22.59 C12.07 -13.65, 5.75 -4.52, -1.2 0.8 M17.59 -22.59 C11.31 -15.21, 5.76 -8.65, -1.2 0.8" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.91015625 310.21416254405995) rotate(0 13.727197134581274 -42.60575583781406)"><path d="M28.22 -55.54 C28.92 -66.23, 29.09 -76.88, 26.91 -85.52 M28.22 -55.54 C26.94 -64.94, 26.87 -75.12, 26.91 -85.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(129.91015625 310.21416254405995) rotate(0 13.727197134581274 -42.60575583781406)"><path d="M8.65 -61.72 C16.64 -69.92, 24.07 -78.28, 26.91 -85.52 M8.65 -61.72 C13.57 -69.21, 19.64 -77.45, 26.91 -85.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(229.43750000000006 370.88835943787035) rotate(0 64.1640625 42.67578125)"><path d="M21.34 0 C40.46 0.72, 55.88 1.64, 106.99 0 M21.34 0 C48.01 -0.77, 74.4 -0.59, 106.99 0 M106.99 0 C121.11 -0.46, 129.27 8.57, 128.33 21.34 M106.99 0 C119.01 -1.2, 126.31 6.03, 128.33 21.34 M128.33 21.34 C129.69 36.44, 129.2 55.23, 128.33 64.01 M128.33 21.34 C127.62 35.16, 128.5 47.15, 128.33 64.01 M128.33 64.01 C129.5 78.05, 122.72 83.64, 106.99 85.35 M128.33 64.01 C127.49 79.47, 123.17 86.03, 106.99 85.35 M106.99 85.35 C79.16 85.37, 47.39 83.68, 21.34 85.35 M106.99 85.35 C81.04 84.95, 53.79 85, 21.34 85.35 M21.34 85.35 C7.8 85.9, -0.23 79.98, 0 64.01 M21.34 85.35 C7 83.33, 0.5 76.01, 0 64.01 M0 64.01 C1.1 47.61, -0.17 33.48, 0 21.34 M0 64.01 C0.13 53.43, 0.07 43.82, 0 21.34 M0 21.34 C-0.06 6, 6.26 -0.81, 21.34 0 M0 21.34 C-0.1 6.55, 8.92 1.77, 21.34 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(243.16406250000006 403.56414068787035) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g stroke-linecap="round"><g transform="translate(131.64453125 363.85320318787035) rotate(0 45.919921875 22.939453125)"><path d="M1.1 0.17 C16.2 7.79, 76.06 38.42, 91.13 45.89 M0.22 -0.78 C15.66 7.03, 78.4 39.67, 93.47 47.43" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(131.64453125 363.85320318787035) rotate(0 45.919921875 22.939453125)"><path d="M63.71 43.58 C74.29 43.45, 84.29 45.45, 93.47 47.43 M63.71 43.58 C70.28 44.38, 77.45 46.2, 93.47 47.43" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(131.64453125 363.85320318787035) rotate(0 45.919921875 22.939453125)"><path d="M73.15 25.35 C80.49 31.61, 87.23 39.91, 93.47 47.43 M73.15 25.35 C77.46 30.18, 82.53 36.07, 93.47 47.43" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(369.85937499999983 413.57195318787035) rotate(0 12.25390625 -0.012888304629086633)"><path d="M-0.33 0 C3.65 -0.08, 20.3 -0.39, 24.37 -0.45 M0.51 -0.47 C4.36 -0.51, 19.75 -0.06, 23.86 0.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(369.85937499999983 413.57195318787035) rotate(0 12.25390625 -0.012888304629086633)"><path d="M12.24 3.93 C16.8 2.28, 20.87 0.43, 23.86 0.04 M12.24 3.93 C15.2 3.23, 17.56 1.9, 23.86 0.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(369.85937499999983 413.57195318787035) rotate(0 12.25390625 -0.012888304629086633)"><path d="M12.46 -4.45 C16.93 -2.82, 20.93 -1.39, 23.86 0.04 M12.46 -4.45 C15.36 -3.13, 17.67 -2.43, 23.86 0.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(404.17578124999983 396.3739195565813) rotate(0 79.8203125 18.873046875)"><path d="M9.44 0 C41.78 -1.24, 76.01 0.25, 150.2 0 M9.44 0 C47.49 -1.55, 86.59 -1.5, 150.2 0 M150.2 0 C158.15 0.58, 160.33 4.38, 159.64 9.44 M150.2 0 C155.09 0.87, 161.06 3.18, 159.64 9.44 M159.64 9.44 C161.47 14.44, 159.84 18.41, 159.64 28.31 M159.64 9.44 C159.44 15.42, 160.58 20.68, 159.64 28.31 M159.64 28.31 C160.51 34.08, 157.19 39.35, 150.2 37.75 M159.64 28.31 C159.32 33.75, 154.23 38.06, 150.2 37.75 M150.2 37.75 C107.01 40.02, 63.92 39.71, 9.44 37.75 M150.2 37.75 C104.06 38.09, 58.23 38, 9.44 37.75 M9.44 37.75 C4.37 39.49, 1.57 36.07, 0 28.31 M9.44 37.75 C2.02 37.98, 0.36 33.24, 0 28.31 M0 28.31 C-0.51 22.68, 0.74 16.56, 0 9.44 M0 28.31 C0.04 23.47, 0.82 19.81, 0 9.44 M0 9.44 C-0.37 5, 3.79 -0.93, 9.44 0 M0 9.44 C1.22 4.24, 0.97 -0.52, 9.44 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(459.99609374999983 405.2469664315813) rotate(0 24 10)"><text x="24" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Kinesis</text></g><g stroke-linecap="round"><g transform="translate(574.3437499999998 414.72583760007274) rotate(0 12.010718827765345 0.19367369831059023)"><path d="M-0.03 -0.13 C4.09 0.06, 20.36 0.75, 24.28 0.79 M-0.71 -0.67 C3.4 -0.6, 19.77 -0.17, 23.98 0.03" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(574.3437499999998 414.72583760007274) rotate(0 12.010718827765345 0.19367369831059023)"><path d="M12.56 3.73 C14.95 3.2, 18.04 1.53, 23.98 0.03 M12.56 3.73 C15.65 2.93, 18.33 2.11, 23.98 0.03" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(574.3437499999998 414.72583760007274) rotate(0 12.010718827765345 0.19367369831059023)"><path d="M12.85 -4.48 C15.15 -3.2, 18.18 -3.07, 23.98 0.03 M12.85 -4.48 C15.83 -3.25, 18.45 -2.03, 23.98 0.03" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(607.7210028400939 381.16291826570523) rotate(0 40.23065809100831 37.686811470070325)"><path d="M18.84 0 C32.9 -2.12, 43 -1.96, 61.62 0 M18.84 0 C30.01 0.49, 39.86 0.25, 61.62 0 M61.62 0 C75.41 0.03, 78.63 6.51, 80.46 18.84 M61.62 0 C73.45 2.2, 81.76 6.5, 80.46 18.84 M80.46 18.84 C78.72 31.63, 81.49 47.57, 80.46 56.53 M80.46 18.84 C80.97 32.06, 80.48 43.31, 80.46 56.53 M80.46 56.53 C78.49 69.36, 74.31 74.47, 61.62 75.37 M80.46 56.53 C82.54 69.07, 75.33 75.46, 61.62 75.37 M61.62 75.37 C49.05 75.22, 31.24 75.75, 18.84 75.37 M61.62 75.37 C53.71 76.48, 43.74 75.85, 18.84 75.37 M18.84 75.37 C6.59 74.19, 0.19 68.28, 0 56.53 M18.84 75.37 C6.68 74.66, 0.26 69.9, 0 56.53 M0 56.53 C-0.6 45.24, -0.28 35.71, 0 18.84 M0 56.53 C0.39 41.86, 0.6 28.6, 0 18.84 M0 18.84 C-1.89 5.82, 6.97 -1.71, 18.84 0 M0 18.84 C0.28 5.31, 8.12 2.04, 18.84 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(631.0571296811022 408.84972973577555) rotate(0 16.89453125 10)"><text x="16.89453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Flink</text></g><g stroke-linecap="round"><g transform="translate(646.5896876896929 376.8872341809001) rotate(0 0.15031034460486126 -26.344843432486414)"><path d="M-1.05 -0.57 C-0.65 -9.18, 1 -43.78, 1.29 -52.34 M0.59 1.75 C1.03 -7.19, 0.94 -45, 0.86 -54.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(646.5896876896929 376.8872341809001) rotate(0 0.15031034460486126 -26.344843432486414)"><path d="M9.97 -29.56 C7.3 -33.03, 6.97 -39.03, 0.86 -54.28 M9.97 -29.56 C7.44 -38.45, 2.62 -47.3, 0.86 -54.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(646.5896876896929 376.8872341809001) rotate(0 0.15031034460486126 -26.344843432486414)"><path d="M-8.05 -29.49 C-7.05 -32.81, -3.7 -38.83, 0.86 -54.28 M-8.05 -29.49 C-4.06 -38.48, -2.36 -47.34, 0.86 -54.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(586.7019930864515 203.30074160587537) rotate(0 62.92936798114465 59.195253689893434)"><path d="M74.13 1.5 C83.31 2.08, 93.65 5.94, 101.33 11.38 C109.01 16.82, 115.97 25.55, 120.21 34.13 C124.44 42.71, 127.24 53.53, 126.73 62.83 C126.22 72.14, 122.3 82.06, 117.15 89.98 C112 97.89, 104.3 105.69, 95.84 110.34 C87.39 114.99, 76.03 117.24, 66.4 117.89 C56.78 118.54, 46.85 117.79, 38.12 114.23 C29.39 110.67, 20.23 103.78, 14.02 96.53 C7.81 89.28, 2.62 79.81, 0.87 70.7 C-0.89 61.6, 0.69 50.92, 3.49 41.92 C6.3 32.92, 10.96 23.21, 17.69 16.71 C24.41 10.21, 32.98 5, 43.84 2.9 C54.69 0.79, 74.84 3.17, 82.82 4.08 C90.8 5, 91.96 7.55, 91.7 8.39 M71.46 -0.76 C80.84 -0.9, 91.75 3.81, 99.84 9.58 C107.94 15.35, 115.51 25.24, 120.04 33.86 C124.57 42.47, 127.46 52.29, 127.03 61.27 C126.59 70.24, 122.26 80, 117.43 87.71 C112.6 95.43, 106.02 102.61, 98.06 107.57 C90.09 112.52, 79.33 116.43, 69.64 117.46 C59.95 118.48, 48.97 116.93, 39.92 113.72 C30.86 110.52, 21.71 105.27, 15.32 98.24 C8.92 91.22, 3.86 80.71, 1.55 71.58 C-0.77 62.46, -1.04 52.27, 1.45 43.48 C3.93 34.69, 9.56 25.33, 16.45 18.86 C23.33 12.39, 33.62 7.48, 42.76 4.66 C51.89 1.85, 66.41 2.55, 71.26 1.95 C76.11 1.34, 71.81 0.17, 71.85 1.03" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(615.6296719823451 252.63862999758715) rotate(0 34.00390625 10)"><text x="34.00390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">OLAP DB</text></g><g stroke-linecap="round" transform="translate(572.1618764582474 10) rotate(0 77.5434786312237 35.58840984914019)"><path d="M17.79 0 C58.53 1.96, 97.78 -1.1, 137.29 0 M17.79 0 C55.55 -1.05, 92.76 -1.24, 137.29 0 M137.29 0 C150.66 -1.71, 154.36 7, 155.09 17.79 M137.29 0 C151.11 0.68, 156.09 5.33, 155.09 17.79 M155.09 17.79 C154.63 27.74, 155.64 41.75, 155.09 53.38 M155.09 17.79 C155.91 26.89, 155.75 36.2, 155.09 53.38 M155.09 53.38 C154.85 66.98, 149.06 69.42, 137.29 71.18 M155.09 53.38 C155.58 63.02, 150.57 73.19, 137.29 71.18 M137.29 71.18 C92.28 70.9, 45.67 70.79, 17.79 71.18 M137.29 71.18 C106.41 71.15, 75.27 70.25, 17.79 71.18 M17.79 71.18 C5.08 70.37, -0.09 64.76, 0 53.38 M17.79 71.18 C7.74 72.95, -0.42 67.38, 0 53.38 M0 53.38 C1.12 39.66, -0.29 30.42, 0 17.79 M0 53.38 C0.76 46.64, 0.9 37.4, 0 17.79 M0 17.79 C1.41 7.69, 4.41 -1.24, 17.79 0 M0 17.79 C0.38 4.82, 8.21 1.53, 17.79 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(595.7131675894711 35.58840984914019) rotate(0 53.9921875 10)"><text x="53.9921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analyst Browser</text></g><g stroke-linecap="round" transform="translate(599.6143886513576 116.90008943763041) rotate(0 51.13453969928662 25)"><path d="M12.5 0 C40.66 0.07, 70.28 1.84, 89.77 0 M12.5 0 C37.17 -0.78, 59.98 0.61, 89.77 0 M89.77 0 C99.8 0.59, 103.14 3.64, 102.27 12.5 M89.77 0 C98.9 1.84, 101.95 3.32, 102.27 12.5 M102.27 12.5 C101.4 19.35, 102.28 23.58, 102.27 37.5 M102.27 12.5 C102.24 20.96, 102.31 26.8, 102.27 37.5 M102.27 37.5 C102.7 43.9, 99.33 51.75, 89.77 50 M102.27 37.5 C104.07 47.53, 96.98 50.24, 89.77 50 M89.77 50 C64.58 50.42, 40.39 50.3, 12.5 50 M89.77 50 C63.46 49.16, 37.96 49.33, 12.5 50 M12.5 50 C5.74 51.54, -0.37 47.69, 0 37.5 M12.5 50 C4.91 48.93, 1.22 46.93, 0 37.5 M0 37.5 C-1.66 32.61, -0.79 28.83, 0 12.5 M0 37.5 C0.47 28.67, -1 17.46, 0 12.5 M0 12.5 C0.33 3.2, 6.15 1.33, 12.5 0 M0 12.5 C1.28 5.12, 5.24 0.24, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(618.0887721006443 121.90008943763041) rotate(0 32.66015625 20)"><text x="32.66015625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics </text><text x="32.66015625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(651.8387477757826 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M0.31 0.05 C0.39 3.85, 0.27 19.48, 0.29 23.29 M-0.19 -0.4 C-0.15 3.72, -0.05 20.02, 0.02 23.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(651.8387477757826 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-4.09 13.04 C-2.88 16.3, -1.89 19.33, 0.02 23.96 M-4.09 13.04 C-2.98 15.46, -2.22 17.64, 0.02 23.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(651.8387477757826 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M3.89 12.95 C2.96 16.26, 1.81 19.31, 0.02 23.96 M3.89 12.95 C3.29 15.41, 2.34 17.61, 0.02 23.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(649.9316724129801 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M0.32 -0.05 C0.21 3.65, -0.14 18.41, -0.36 22.25 M-0.18 -0.56 C-0.35 3.19, -0.37 18.93, -0.58 22.71" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(649.9316724129801 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-4.21 11.94 C-2.96 16.19, -2.1 19.4, -0.58 22.71 M-4.21 11.94 C-2.75 15.66, -1.5 19.77, -0.58 22.71" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(649.9316724129801 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M3.57 12.12 C2.04 16.34, 0.13 19.48, -0.58 22.71 M3.57 12.12 C2.27 15.8, 0.78 19.84, -0.58 22.71" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(165.6910475452658 135.07889785719908) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C51.99 -1.35, 84.66 1.07, 107.17 0 M23.81 0 C51.63 1.02, 78.61 -0.15, 107.17 0 M107.17 0 C121.08 0.27, 131.12 7.03, 130.98 23.81 M107.17 0 C125.12 -0.02, 132.13 8.02, 130.98 23.81 M130.98 23.81 C132.85 39.64, 129.35 56.1, 130.98 71.43 M130.98 23.81 C132.06 34.23, 130.78 43.28, 130.98 71.43 M130.98 71.43 C131.29 86.12, 123.24 94.43, 107.17 95.25 M130.98 71.43 C131.38 86.59, 123.3 96.05, 107.17 95.25 M107.17 95.25 C81.59 94.8, 57.15 96.46, 23.81 95.25 M107.17 95.25 C76.07 95.55, 44.86 96.5, 23.81 95.25 M23.81 95.25 C6.04 94.79, 0.69 85.6, 0 71.43 M23.81 95.25 C8.21 94.27, 1.84 89.34, 0 71.43 M0 71.43 C2.1 51.12, -0.89 34.18, 0 23.81 M0 71.43 C0.08 59.87, -0.01 47.57, 0 23.81 M0 23.81 C1.07 8.75, 8.37 1.76, 23.81 0 M0 23.81 C0.1 6.88, 5.8 0.94, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(184.0836256702658 162.70194473219908) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(390.4530731571977 118.64664689480651) rotate(0 72.69127211417481 70.84147595836083)"><path d="M89.21 1.53 C99.18 2.38, 109.13 7.82, 117.28 14.19 C125.43 20.56, 133.5 30.24, 138.11 39.76 C142.72 49.28, 144.88 60.97, 144.93 71.29 C144.97 81.61, 142.79 92.5, 138.38 101.67 C133.96 110.83, 126.55 119.95, 118.42 126.29 C110.29 132.62, 99.69 137.41, 89.6 139.69 C79.5 141.96, 68.3 142.12, 57.84 139.96 C47.39 137.8, 35.42 132.95, 26.86 126.73 C18.29 120.5, 10.77 111.71, 6.44 102.6 C2.11 93.5, 0.66 82.51, 0.88 72.08 C1.09 61.65, 3.36 49.39, 7.73 40.03 C12.1 30.66, 19.15 22.24, 27.11 15.9 C35.06 9.55, 43.62 3.82, 55.46 1.98 C67.31 0.13, 89.58 3.43, 98.2 4.83 C106.83 6.24, 107.54 9.34, 107.23 10.41 M52.64 2.36 C62.25 -1.04, 75.86 0.15, 86.19 2.18 C96.52 4.21, 106.15 8.9, 114.6 14.54 C123.05 20.18, 131.62 27.14, 136.87 36 C142.11 44.87, 145.82 57.44, 146.07 67.73 C146.32 78.02, 142.46 88.62, 138.37 97.74 C134.28 106.87, 129.12 115.71, 121.54 122.47 C113.95 129.24, 102.85 135.07, 92.85 138.32 C82.86 141.57, 71.72 143.8, 61.57 141.99 C51.41 140.17, 40.51 133.38, 31.93 127.44 C23.34 121.49, 15.55 115.25, 10.06 106.3 C4.57 97.35, -0.33 84.31, -1.03 73.74 C-1.73 63.17, 1.36 52.01, 5.84 42.87 C10.32 33.74, 17.9 25.51, 25.85 18.92 C33.8 12.34, 48.88 5.8, 53.54 3.35 C58.2 0.9, 53.48 3.11, 53.81 4.25" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(440.3532288263629 179.3956348137466) rotate(0 22.890625 10)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(398.8719355129402 18.796790023960966) rotate(0 60.903953552246094 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round"><g transform="translate(309.36848092311635 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M-0.17 -0.44 C11.87 -0.64, 60.3 -0.13, 72.64 -0.21 M-1.72 -1.72 C10.63 -1.78, 62.25 1.11, 74.74 1.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(309.36848092311635 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M28.06 -10.61 C17.95 -9.21, 9.51 -3.71, -0.17 -0.44 M28.06 -10.61 C21.46 -7.99, 14.12 -5.16, -0.17 -0.44" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(309.36848092311635 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M27.99 9.91 C17.74 4.44, 9.32 3.08, -0.17 -0.44 M27.99 9.91 C21.22 7.31, 13.9 4.91, -0.17 -0.44" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(309.36848092311635 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M46.14 10.49 C54.9 5.52, 65.48 4.59, 74.74 1.41 M46.14 10.49 C53.84 8.22, 60.97 6.14, 74.74 1.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(309.36848092311635 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M47 -10.02 C55.64 -8.12, 65.93 -2.19, 74.74 1.41 M47 -10.02 C54.67 -7.07, 61.58 -3.92, 74.74 1.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(728.8489831247687 216.73699973711882) rotate(0 69.303955078125 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Aggregated Data</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Minute</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Click Count</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Real-time Analytics With Stream Processing</span></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now, when a click comes in:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The click processor service writes the event to a stream like Kafka or Kinesis.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">A stream processor like Flink or Spark Streaming reads the events from the stream and aggregates them in real-time.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The aggregated data is stored in our OLAP database for querying.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Advertisers can query the OLAP database to get metrics on their ads in near real-time.</div></li>
</ol><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-4">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Astute readers may recognize that the latency from click to query between this solution and the "good" solution is not all that different depending on what aggregation window we choose for Flink and how often we run Spark jobs. If we aggregate on minute boundaries and also run our Spark jobs every minute, the latency is about the same (just slightly higher for the batch processing solution due to the time it takes to run the Spark job). That said, we have levers to play with. It's much more realistic for us to decrease the Flink aggregation window than it is for us to decrease the Spark job frequency given the overhead of running Spark jobs. This means we could aggregate clicks every couple of seconds with this streaming approach to decrease latency, while we'd be hard-pressed to run Spark jobs every couple of seconds.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Even better, Flink has flush intervals that can be configured, so we can aggregate on a minute boundary but flush the results every couple of seconds. This way, we get the best of both worlds, and the latest minute's data will just be incomplete until the minute boundary is reached, which would be the expected behavior.</div></div></div></div></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="potential-deep-dives"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#deep-dives-10-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Potential Deep Dives</a></h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-how-can-we-scale-to-support-10k-clicks-per-second">1) How can we scale to support 10k clicks per second?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's walk through each bottleneck the system could face from the moment a click is captured and how we can overcome it:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Click Processor Service</strong>: We can easily scale this service horizontally by adding more instances. Most modern cloud providers like AWS, Azure, and GCP provide managed services that automatically scale services based on CPU or memory usage. We'll need a load balancer in front of the service to distribute the load across instances.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Stream</strong>: Both Kafka and Kinesis are distributed and can handle a large number of events per second but need to be properly configured. Kinesis, for example, has a limit of 1MB/s or 1000 records/s per shard, so we'll need to add some sharding. Sharding by AdId is a natural choice, this way, the stream processor can read from multiple shards in parallel since they will be independent of each other (all events for a given AdId will be in the same shard).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Stream Processor</strong>: The stream processor, like Flink, can also be scaled horizontally by adding more tasks or jobs. We'll have a seperate Flink job reading from each shard doing the aggregation for the AdIds in that shard.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>OLAP Database</strong>: The OLAP database can be scaled horizontally by adding more nodes. While we could shard by AdId, we may also consider sharding by AdvertiserId instead. In doing so, all the data for a given advertiser will be on the same node, making queries for that advertiser's ads faster. This is in anticipation of advertisers querying for all of their active ads in a single view. Of course, it's important to monitor the database and query performance to ensure that it's meeting the SLAs and adapting the sharding strategy as needed.</div></li>
</ol>
<h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="hot-shards">Hot Shards</h5>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With the above scaling strategies, we should be able to handle a peak of 10k clicks per second. <strong>There is just one remaining issue, hot shards.</strong> Consider the case where Nike just launched a new Ad with Lebron James. This Ad is getting a lot of clicks and all of them are going to the same shard. This shard is now overwhelmed, which increases latency and, in the worst case, could even cause data loss.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To solve the hot shard problem, we need a way of further partitioning the data. One popular approach is to update the partition key by appending a random number to the AdId. We could do this only for the popular ads as determined by ad spend or previous click volume. This way, the partition key becomes <span class="MuiBox-root mui-1vu004u">AdId:0-N</span> where <span class="MuiBox-root mui-1vu004u">N</span> is the number of additional partitions for that AdId.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1061.2456944715427 478.35848642068777">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1061.2456944715427" height="478.35848642068777" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(399.1152757098577 383.00692392068777) rotate(0 64.1640625 42.67578125)"><path d="M21.34 0 C43.25 -0.99, 64.48 -0.42, 106.99 0 M21.34 0 C52.29 -0.59, 86.17 -0.7, 106.99 0 M106.99 0 C120.49 -0.9, 127.28 8.47, 128.33 21.34 M106.99 0 C122.18 1.33, 126.42 7.8, 128.33 21.34 M128.33 21.34 C129.1 32.8, 129.42 39.53, 128.33 64.01 M128.33 21.34 C128.83 33.82, 129.34 46.88, 128.33 64.01 M128.33 64.01 C128.98 78.41, 119.83 84.78, 106.99 85.35 M128.33 64.01 C127.17 77.43, 121.45 86.97, 106.99 85.35 M106.99 85.35 C73.38 85.51, 41.01 87.81, 21.34 85.35 M106.99 85.35 C88.31 85.55, 68.64 85.26, 21.34 85.35 M21.34 85.35 C7.85 86.72, -1.59 78.89, 0 64.01 M21.34 85.35 C8.21 85.62, -0.44 76.43, 0 64.01 M0 64.01 C-0.45 51.46, 0.11 37.9, 0 21.34 M0 64.01 C0.34 54.13, -0.14 45.5, 0 21.34 M0 21.34 C0.35 7.59, 6.76 0.62, 21.34 0 M0 21.34 C0.55 7.55, 7.95 2.28, 21.34 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(412.8418382098577 415.68270517068777) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g stroke-linecap="round"><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M0 0.4 C4.17 0.38, 20.91 0, 24.88 -0.16 M-0.67 0.13 C3.49 -0.05, 20.45 -0.98, 24.71 -1" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M13.4 3.55 C16.91 2.88, 19.79 0.48, 24.71 -1 M13.4 3.55 C16.42 2.16, 19.52 1.24, 24.71 -1" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M13.12 -4.79 C16.7 -3.2, 19.66 -3.34, 24.71 -1 M13.12 -4.79 C16.26 -3.85, 19.44 -2.45, 24.71 -1" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(573.7238890737023 404.7372919106974) rotate(0 79.8203125 18.873046875)"><path d="M9.44 0 C52.48 -3.27, 93.34 0.58, 150.2 0 M9.44 0 C46.65 1.32, 85.32 1.22, 150.2 0 M150.2 0 C154.84 0.6, 158.31 4.71, 159.64 9.44 M150.2 0 C157.8 0.5, 161.38 4.02, 159.64 9.44 M159.64 9.44 C161.38 14.03, 159.36 19.04, 159.64 28.31 M159.64 9.44 C159.05 15.39, 159.23 21.55, 159.64 28.31 M159.64 28.31 C159.84 36.01, 158.41 36.48, 150.2 37.75 M159.64 28.31 C161.19 34.92, 156.01 39.8, 150.2 37.75 M150.2 37.75 C94.13 38.26, 40.07 36.81, 9.44 37.75 M150.2 37.75 C105.08 39.03, 62.03 38.82, 9.44 37.75 M9.44 37.75 C2.76 36.17, 0.35 33.08, 0 28.31 M9.44 37.75 C0.92 36.85, 1.14 34.36, 0 28.31 M0 28.31 C0.62 23.08, -1.24 15.59, 0 9.44 M0 28.31 C-0.2 23.36, 0.19 18.02, 0 9.44 M0 9.44 C0.73 5.13, 3.57 0.11, 9.44 0 M0 9.44 C-2.3 1.54, 3.88 1.35, 9.44 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(629.5442015737023 413.6103387856974) rotate(0 24 10)"><text x="24" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Kinesis</text></g><g stroke-linecap="round"><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M0.51 -0.18 C4.53 -0.28, 19.71 -0.75, 23.53 -0.75 M0.12 -0.74 C4.09 -0.76, 19.19 -0.13, 23 -0.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M11.77 3.68 C13.84 2.64, 16.02 1.77, 23 -0.17 M11.77 3.68 C15.65 2.32, 19.83 1.04, 23 -0.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M11.92 -4.44 C13.95 -3.85, 16.1 -3.09, 23 -0.17 M11.92 -4.44 C15.76 -2.81, 19.89 -1.1, 23 -0.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(776.9805580283177 382.42148804048793) rotate(0 40.23065809100831 37.686811470070325)"><path d="M18.84 0 C34.77 -0.89, 53.87 1, 61.62 0 M18.84 0 C33.49 0.65, 50.04 0.09, 61.62 0 M61.62 0 C75.69 0.76, 78.75 6.2, 80.46 18.84 M61.62 0 C75.33 2.12, 81.13 5.95, 80.46 18.84 M80.46 18.84 C80.75 31.79, 80 46.49, 80.46 56.53 M80.46 18.84 C81.46 28.19, 81.17 38.94, 80.46 56.53 M80.46 56.53 C80.04 70.88, 76.07 73.8, 61.62 75.37 M80.46 56.53 C80.47 68.44, 74.77 76.39, 61.62 75.37 M61.62 75.37 C52.18 73.94, 40.65 76.48, 18.84 75.37 M61.62 75.37 C48.47 74.28, 34 74.65, 18.84 75.37 M18.84 75.37 C7.28 75.16, 0.98 67.38, 0 56.53 M18.84 75.37 C8.34 75.93, 1.65 67.39, 0 56.53 M0 56.53 C0.56 43.97, 0.7 32.59, 0 18.84 M0 56.53 C0.07 44.56, -1.14 31.78, 0 18.84 M0 18.84 C0.64 7.46, 6.86 0.08, 18.84 0 M0 18.84 C1.63 4.88, 4.48 0.77, 18.84 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(800.316684869326 410.10829951055825) rotate(0 16.89453125 10)"><text x="16.89453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Flink</text></g><g stroke-linecap="round"><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M0.51 0.7 C0.5 -8.37, -0.52 -44.64, -0.69 -53.59 M-0.69 0.02 C-0.28 -9.5, 1.06 -46.38, 1.5 -55.53" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M9.67 -29.82 C8.63 -37.81, 6.04 -43.86, 1.5 -55.53 M9.67 -29.82 C7.19 -39.14, 2.49 -49.29, 1.5 -55.53" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M-8.77 -30.58 C-5.23 -38.46, -3.25 -44.32, 1.5 -55.53 M-8.77 -30.58 C-4.27 -39.66, -2 -49.51, 1.5 -55.53" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(755.9615482746752 203.30074160587537) rotate(0 62.92936798114465 59.195253689893434)"><path d="M42.53 4.02 C50.9 0.11, 63.08 -1.52, 72.68 -0.2 C82.27 1.13, 92.15 6.35, 100.1 11.96 C108.05 17.58, 116.12 25.2, 120.39 33.49 C124.65 41.77, 126.07 52.52, 125.69 61.69 C125.31 70.86, 122.83 80.78, 118.09 88.52 C113.35 96.27, 105.54 103.31, 97.27 108.16 C88.99 113.02, 78.22 116.66, 68.44 117.64 C58.66 118.61, 47.43 117.27, 38.59 114.02 C29.74 110.77, 21.66 105.06, 15.36 98.12 C9.06 91.18, 2.94 81.54, 0.79 72.38 C-1.37 63.23, -0.43 51.97, 2.42 43.18 C5.28 34.39, 10.62 26.51, 17.93 19.63 C25.24 12.76, 40.63 4.8, 46.29 1.91 C51.95 -0.97, 51.42 1.45, 51.89 2.33 M66.42 0.65 C75.75 0.29, 88.53 4.57, 96.95 9.14 C105.37 13.72, 112.1 20.41, 116.95 28.1 C121.8 35.8, 125.79 46.05, 126.05 55.31 C126.31 64.57, 122.54 75.19, 118.5 83.66 C114.45 92.13, 109.18 100.71, 101.79 106.14 C94.4 111.58, 83.65 114.67, 74.14 116.28 C64.63 117.89, 53.92 118.64, 44.71 115.82 C35.5 113, 25.85 106.04, 18.89 99.35 C11.93 92.66, 5.86 84.22, 2.95 75.67 C0.05 67.13, -0.33 56.93, 1.45 48.07 C3.24 39.21, 7.54 29.65, 13.68 22.5 C19.81 15.35, 29.18 8.64, 38.26 5.17 C47.34 1.69, 63.23 2.28, 68.15 1.65 C73.08 1.03, 68.25 0.86, 67.83 1.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(784.8892271705689 252.63862999758715) rotate(0 34.00390625 10)"><text x="34.00390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">OLAP DB</text></g><g stroke-linecap="round" transform="translate(741.4214316464712 10) rotate(0 77.5434786312237 35.58840984914019)"><path d="M17.79 0 C46.1 0.83, 74.29 -2.39, 137.29 0 M17.79 0 C53.43 -1.25, 89.29 -0.81, 137.29 0 M137.29 0 C149.81 0.18, 153.71 5.36, 155.09 17.79 M137.29 0 C148 -0.81, 155.32 7.55, 155.09 17.79 M155.09 17.79 C155.14 31.45, 156.65 47.84, 155.09 53.38 M155.09 17.79 C155.34 26.11, 154.62 33.68, 155.09 53.38 M155.09 53.38 C155.83 66.61, 147.57 71.83, 137.29 71.18 M155.09 53.38 C156.18 65.51, 148.72 69.37, 137.29 71.18 M137.29 71.18 C98.58 71.02, 61.22 71, 17.79 71.18 M137.29 71.18 C112.4 70.73, 86.31 71.24, 17.79 71.18 M17.79 71.18 C6.28 71.65, -0.35 65.86, 0 53.38 M17.79 71.18 C6.48 71.62, 0.84 67.53, 0 53.38 M0 53.38 C-1.42 42.59, 1.16 31.1, 0 17.79 M0 53.38 C-1.04 42.91, 0.19 31.64, 0 17.79 M0 17.79 C0.37 7.24, 6.97 0.6, 17.79 0 M0 17.79 C0.04 5.42, 7.87 1.69, 17.79 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(764.9727227776949 35.58840984914019) rotate(0 53.9921875 10)"><text x="53.9921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analyst Browser</text></g><g stroke-linecap="round" transform="translate(768.8739438395813 116.90008943763041) rotate(0 51.13453969928662 25)"><path d="M12.5 0 C41.44 1.67, 72.39 1.24, 89.77 0 M12.5 0 C34.9 -0.14, 55.96 -0.52, 89.77 0 M89.77 0 C97.09 -0.7, 102.47 5.57, 102.27 12.5 M89.77 0 C100.3 -1.46, 103.81 4.49, 102.27 12.5 M102.27 12.5 C100.91 19.49, 101.93 26.96, 102.27 37.5 M102.27 12.5 C102.52 21.79, 101.36 30.04, 102.27 37.5 M102.27 37.5 C103.22 46.06, 97.72 48.43, 89.77 50 M102.27 37.5 C102.67 44.09, 95.88 49.11, 89.77 50 M89.77 50 C61.03 52.17, 36.21 51.81, 12.5 50 M89.77 50 C72.49 50.06, 54.69 50.13, 12.5 50 M12.5 50 C4.64 50.38, 0.73 47.82, 0 37.5 M12.5 50 C4.65 50.12, -2.3 44.22, 0 37.5 M0 37.5 C-0.07 30.62, -1.37 19.33, 0 12.5 M0 37.5 C0.07 29.81, 0.41 21.12, 0 12.5 M0 12.5 C0.03 3.73, 5.86 1.47, 12.5 0 M0 12.5 C2.21 3.77, 2.44 0.2, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(787.348327288868 121.90008943763041) rotate(0 32.66015625 20)"><text x="32.66015625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics </text><text x="32.66015625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M0.16 -0.08 C0.18 3.75, 0.41 19.59, 0.4 23.5 M-0.42 -0.59 C-0.46 3.3, 0.15 18.52, 0.2 22.62" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-4.09 11.77 C-2.62 16.03, -0.86 19.55, 0.2 22.62 M-4.09 11.77 C-2.95 15.02, -1.45 18.68, 0.2 22.62" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M3.89 11.55 C2.57 15.9, 1.53 19.5, 0.2 22.62 M3.89 11.55 C2.57 14.86, 1.6 18.59, 0.2 22.62" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M0.44 0.16 C0.32 3.97, -0.33 19.03, -0.59 22.77 M0 -0.23 C-0.19 3.68, -0.92 19.61, -0.93 23.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-4.52 12.71 C-3.18 16.43, -2.12 19.4, -0.93 23.49 M-4.52 12.71 C-3.55 15.84, -2.33 18.38, -0.93 23.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M3.25 12.92 C2.04 16.6, 0.54 19.5, -0.93 23.49 M3.25 12.92 C2.12 15.98, 1.23 18.47, -0.93 23.49" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(334.9506027334896 135.07889785719908) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C55.68 -1.65, 86.62 -1.28, 107.17 0 M23.81 0 C46.84 -1.22, 68.63 -0.45, 107.17 0 M107.17 0 C122.62 1.79, 132.87 6.36, 130.98 23.81 M107.17 0 C123.06 -0.65, 131.57 8.96, 130.98 23.81 M130.98 23.81 C132.42 34.26, 131.7 48.83, 130.98 71.43 M130.98 23.81 C131.06 37.89, 129.92 53.09, 130.98 71.43 M130.98 71.43 C131.98 87.1, 124.02 93.53, 107.17 95.25 M130.98 71.43 C133.04 87.87, 124.69 93.54, 107.17 95.25 M107.17 95.25 C80.65 95.04, 53.79 95.86, 23.81 95.25 M107.17 95.25 C80.78 96.13, 52.97 95.37, 23.81 95.25 M23.81 95.25 C8.58 96.42, 0.58 87.38, 0 71.43 M23.81 95.25 C9.57 93.84, -1.8 88.08, 0 71.43 M0 71.43 C1.37 56.06, 0.66 38.63, 0 23.81 M0 71.43 C0.56 58.03, -1.15 45.05, 0 23.81 M0 23.81 C-0.63 6.43, 8.92 -1.82, 23.81 0 M0 23.81 C0.66 7.48, 6.2 -1.6, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(353.3431808584896 162.70194473219908) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(559.7126283454215 118.64664689480651) rotate(0 72.69127211417478 70.84147595836083)"><path d="M75.71 0.76 C85.64 -0.01, 98.13 3.48, 107.62 8.43 C117.1 13.38, 126.64 22.1, 132.62 30.45 C138.6 38.81, 141.87 48.6, 143.49 58.57 C145.12 68.55, 145.02 80.53, 142.38 90.31 C139.73 100.09, 134.51 109.56, 127.62 117.26 C120.73 124.96, 110.7 132.58, 101.05 136.5 C91.4 140.42, 80.2 141.3, 69.73 140.8 C59.25 140.3, 47.55 138.32, 38.23 133.52 C28.9 128.72, 20.09 120.35, 13.77 111.98 C7.45 103.61, 2.28 93.51, 0.31 83.29 C-1.65 73.07, -0.95 60.47, 1.96 50.66 C4.88 40.85, 10.75 31.88, 17.82 24.44 C24.89 17.01, 34.1 9.9, 44.38 6.04 C54.65 2.18, 72.82 1.79, 79.48 1.29 C86.13 0.78, 84.42 1.96, 84.31 3.03 M64.23 0.91 C74.05 -1.25, 86.94 0.7, 97 4.24 C107.06 7.79, 117.16 14.99, 124.6 22.2 C132.03 29.4, 138.46 38.23, 141.6 47.47 C144.74 56.72, 144.57 67.35, 143.43 77.67 C142.29 87.98, 140.02 100.5, 134.75 109.37 C129.49 118.23, 120.65 125.69, 111.85 130.85 C103.05 136.01, 92.67 139.08, 81.95 140.31 C71.24 141.54, 57.55 141.48, 47.56 138.23 C37.57 134.98, 29.2 127.95, 22 120.79 C14.8 113.63, 7.84 104.83, 4.37 95.27 C0.91 85.71, 0.11 73.81, 1.23 63.41 C2.36 53.01, 5.47 41.44, 11.14 32.87 C16.8 24.3, 26.1 17.44, 35.24 11.99 C44.37 6.54, 61.22 1.86, 65.94 0.19 C70.65 -1.47, 63.72 0.96, 63.53 1.99" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(609.6127840145867 179.3956348137466) rotate(0 22.890625 10)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(568.1314907011639 18.796790023960966) rotate(0 60.903953552246094 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round"><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M0.81 0.17 C12.88 0.41, 61.22 0.95, 73.57 0.7 M-0.23 -0.79 C11.56 -0.79, 59.99 -0.9, 72.49 -0.86" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M29.11 -9.79 C18.12 -6.08, 8.44 0.16, 0.81 0.17 M29.11 -9.79 C23.1 -7.23, 16.12 -5.32, 0.81 0.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M28.89 10.73 C18.12 6.32, 8.53 4.45, 0.81 0.17 M28.89 10.73 C22.93 8.76, 16 6.13, 0.81 0.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M44.3 9.39 C55.79 4.73, 68.46 2.98, 72.49 -0.86 M44.3 9.39 C50.79 7.65, 56.29 5.09, 72.49 -0.86" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M44.31 -11.13 C55.67 -7.67, 68.33 -1.3, 72.49 -0.86 M44.31 -11.13 C50.79 -8.33, 56.3 -6.36, 72.49 -0.86" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(897.9498265516207 216.73699973711973) rotate(0 76.64793395996094 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Aggregated Data</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdvertiserId (PK)</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Minute (SK)</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Click Count</text></g><g transform="translate(410.4193573604496 327.9403261879879) rotate(0 183.97589111328128 30)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Both Kinesis and Flink partition by AdId with</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">   celebrity solution for hot shards</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g stroke-linecap="round" transform="translate(199.26532885268892 169.81391348717625) rotate(0 41.82508274689235 135.50951017640364)"><path d="M20.91 0 C36.84 0.51, 54.78 -0.95, 62.74 0 M20.91 0 C33.29 0.04, 47.73 -0.17, 62.74 0 M62.74 0 C76.3 -1.57, 84 5.45, 83.65 20.91 M62.74 0 C74.45 -0.89, 84.79 6.73, 83.65 20.91 M83.65 20.91 C82.39 102.12, 80.72 181.29, 83.65 250.11 M83.65 20.91 C83.84 84.75, 84.19 148.23, 83.65 250.11 M83.65 250.11 C84.38 266.03, 77.1 271.12, 62.74 271.02 M83.65 250.11 C81.35 262.44, 77.42 272.37, 62.74 271.02 M62.74 271.02 C47.75 269.75, 35.88 272.21, 20.91 271.02 M62.74 271.02 C51.23 271.59, 38.69 271.07, 20.91 271.02 M20.91 271.02 C8.66 272.49, 1.92 263.71, 0 250.11 M20.91 271.02 C5.24 271.22, -0.72 262.31, 0 250.11 M0 250.11 C1.44 168.82, 0.59 88.84, 0 20.91 M0 250.11 C2.21 190.55, 1.4 130.67, 0 20.91 M0 20.91 C1.11 8.89, 5.36 0.51, 20.91 0 M0 20.91 C2.29 5.5, 7.47 1.13, 20.91 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(205.75447409958127 285.3234236635799) rotate(0 35.3359375 20)"><text x="35.3359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">LB &amp; API </text><text x="35.3359375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Gateway</text></g><g stroke-linecap="round" transform="translate(10 259.64809044298454) rotate(0 55.98632812499999 44.6328125)"><path d="M22.32 0 C44.53 1.06, 67.53 -1.27, 89.66 0 M22.32 0 C44.52 -0.86, 67.27 -0.84, 89.66 0 M89.66 0 C102.6 -0.78, 112.97 7.23, 111.97 22.32 M89.66 0 C105.66 -1.97, 114.03 8, 111.97 22.32 M111.97 22.32 C111.19 39.25, 112.12 55.14, 111.97 66.95 M111.97 22.32 C112.44 38.07, 112.29 51.9, 111.97 66.95 M111.97 66.95 C109.97 80.43, 105.18 90.44, 89.66 89.27 M111.97 66.95 C112.64 81.91, 106.17 87.86, 89.66 89.27 M89.66 89.27 C74.48 89.93, 61.1 90.61, 22.32 89.27 M89.66 89.27 C68.28 89.85, 46.18 88.95, 22.32 89.27 M22.32 89.27 C5.94 89.44, -0.63 80.32, 0 66.95 M22.32 89.27 C8.57 87.17, 0.66 81.37, 0 66.95 M0 66.95 C-0.49 55.15, 0.55 48.04, 0 22.32 M0 66.95 C0.73 54.22, -0.63 39.82, 0 22.32 M0 22.32 C1.99 6.16, 7.87 0.98, 22.32 0 M0 22.32 C0.2 9.02, 7.35 -1.91, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.88085937499999 294.28090294298454) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round"><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M-0.95 0.39 C8.56 0.3, 47.94 0.46, 57.56 0.26 M0.75 -0.45 C10.12 -0.4, 47.72 1.79, 56.91 1.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M25.81 -9.37 C17.51 -5.35, 8.06 -3.39, -0.95 0.39 M25.81 -9.37 C18.94 -7.8, 14.47 -5.36, -0.95 0.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M25.83 10.12 C17.38 7.57, 7.94 2.96, -0.95 0.39 M25.83 10.12 C18.91 7.37, 14.45 5.5, -0.95 0.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M29.8 10.63 C39.52 8.85, 48.24 4.56, 56.91 1.87 M29.8 10.63 C34.82 8.51, 42.28 6.85, 56.91 1.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M30.51 -8.84 C40.13 -4.07, 48.61 -1.79, 56.91 1.87 M30.51 -8.84 C35.4 -6.66, 42.71 -4, 56.91 1.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M0.57 0.14 C17.01 9.91, 81.45 49.2, 97.71 59.01 M-0.59 -0.84 C15.76 9.02, 80.3 49.94, 96.65 60.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M30 5.97 C23.72 4.44, 15.43 3.89, 0.57 0.14 M30 5.97 C23.96 4.44, 17.36 2.39, 0.57 0.14" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M19.36 23.52 C15.37 18.07, 9.43 13.65, 0.57 0.14 M19.36 23.52 C15.88 18.1, 11.66 12.11, 0.57 0.14" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M67.31 53.77 C74.03 54.64, 78.69 56.75, 96.65 60.06 M67.31 53.77 C74.32 55.19, 80.88 55.85, 96.65 60.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M78.21 36.39 C82.58 41.14, 84.85 47.09, 96.65 60.06 M78.21 36.39 C82.61 41.66, 86.73 46.21, 96.65 60.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M-0.23 -0.94 C5.41 -8.24, 28.87 -36.58, 34.42 -43.62 M-1.81 1.18 C3.64 -6, 27.39 -35.35, 33.58 -42.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M8.72 -26.8 C4.07 -17.48, 1.01 -10.78, -0.23 -0.94 M8.72 -26.8 C7 -20.91, 5.07 -13.06, -0.23 -0.94" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M23.25 -15 C13.53 -9.81, 5.43 -7.21, -0.23 -0.94 M23.25 -15 C17.67 -12.21, 11.95 -7.44, -0.23 -0.94" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M24.38 -16.8 C25.97 -25.38, 29.22 -36.62, 33.58 -42.56 M24.38 -16.8 C27.14 -24.37, 29.95 -30, 33.58 -42.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M9.97 -28.74 C16.59 -33.15, 24.84 -40.23, 33.58 -42.56 M9.97 -28.74 C16.56 -33.18, 23.13 -35.69, 33.58 -42.56" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Scaling</span></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-how-can-we-ensure-that-we-dont-lose-any-click-data">2) How can we ensure that we don't lose any click data?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The first thing to note is that we are already using a stream like Kafka or Kinesis to store the click data. By default, these streams are distributed, fault-tolerant, and highly available. They replicate data across multiple nodes and data centers, so even if a node goes down, the data is not lost. Importantly for our system, they also allow us to enable persistent storage, so even if the data is consumed by the stream processor, it is still stored in the stream for a certain period of time.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can configure a retention period of 7 days, for example, so that if, for some reason, our stream processor goes down, it will come back up and can read the data that it lost from the stream again.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1061.2456944715427 478.35848642068777">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1061.2456944715427" height="478.35848642068777" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(399.1152757098577 383.00692392068777) rotate(0 64.1640625 42.67578125)"><path d="M21.34 0 C46.06 -2.16, 70.47 -0.4, 106.99 0 M21.34 0 C53.57 -0.29, 87.72 -0.22, 106.99 0 M106.99 0 C121.18 -1.28, 128.84 7.76, 128.33 21.34 M106.99 0 C120.98 -0.07, 127.64 6.02, 128.33 21.34 M128.33 21.34 C127.28 37.1, 127.3 53.23, 128.33 64.01 M128.33 21.34 C129 36.93, 128.61 50.5, 128.33 64.01 M128.33 64.01 C129.83 78.07, 122.93 84.83, 106.99 85.35 M128.33 64.01 C130.47 76.59, 121.04 84.22, 106.99 85.35 M106.99 85.35 C83.16 85.28, 61.06 84.92, 21.34 85.35 M106.99 85.35 C76.16 85.28, 45.7 85.19, 21.34 85.35 M21.34 85.35 C8.28 83.63, -0.77 79.21, 0 64.01 M21.34 85.35 C9.05 87.47, 2.18 79.57, 0 64.01 M0 64.01 C-0.76 50.3, -1.09 36.12, 0 21.34 M0 64.01 C0.62 54.4, 0.1 44.76, 0 21.34 M0 21.34 C-1.27 6.49, 7.85 -0.16, 21.34 0 M0 21.34 C1.44 8.83, 7.36 2.12, 21.34 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(412.8418382098577 415.68270517068777) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g stroke-linecap="round"><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M0.06 0.47 C4.19 0.39, 20.37 0.11, 24.36 -0.01 M-0.58 0.23 C3.52 -0.03, 19.64 -0.54, 23.92 -0.77" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M12.65 3.88 C15.65 2.81, 18.07 1.37, 23.92 -0.77 M12.65 3.88 C16.37 2.12, 20.19 0.87, 23.92 -0.77" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M12.29 -4.45 C15.41 -3.66, 17.91 -3.26, 23.92 -0.77 M12.29 -4.45 C16.15 -3.45, 20.09 -1.94, 23.92 -0.77" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(573.7238890737021 404.7372919106974) rotate(0 79.82031250000003 18.873046875)"><path d="M9.44 0 C54.54 -1.38, 97.44 1.03, 150.2 0 M9.44 0 C57.41 1.22, 104.77 0.87, 150.2 0 M150.2 0 C155.9 -0.95, 161.03 2.51, 159.64 9.44 M150.2 0 C157 -1.05, 159.64 2.12, 159.64 9.44 M159.64 9.44 C160.07 17.19, 161.36 22.45, 159.64 28.31 M159.64 9.44 C160.59 14.27, 160.66 18.93, 159.64 28.31 M159.64 28.31 C159.48 33.61, 155.93 36.07, 150.2 37.75 M159.64 28.31 C157.79 33.95, 157.21 38.42, 150.2 37.75 M150.2 37.75 C106.06 39.27, 62.15 40.26, 9.44 37.75 M150.2 37.75 C109.1 37.02, 69.62 37.45, 9.44 37.75 M9.44 37.75 C5.04 38.9, 0.46 34, 0 28.31 M9.44 37.75 C4.71 36.73, 0.08 33.2, 0 28.31 M0 28.31 C-0.97 23.73, 0.87 17.39, 0 9.44 M0 28.31 C0.47 21.13, 0.71 14.8, 0 9.44 M0 9.44 C0.22 4.99, 1.34 -0.78, 9.44 0 M0 9.44 C0.56 1.59, 4.62 1.97, 9.44 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(629.5442015737021 413.6103387856974) rotate(0 24.00000000000003 10)"><text x="24" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Kinesis</text></g><g stroke-linecap="round"><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M0.27 0.21 C4.29 0.04, 19.79 -0.76, 23.72 -0.85 M-0.26 -0.15 C3.72 -0.27, 19.31 -0.14, 23.29 -0.33" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M12.2 3.91 C14.96 2.91, 16.88 2.1, 23.29 -0.33 M12.2 3.91 C15.8 2.36, 19.78 1, 23.29 -0.33" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M12.07 -4.21 C14.87 -3.36, 16.82 -2.31, 23.29 -0.33 M12.07 -4.21 C15.71 -3.06, 19.73 -1.72, 23.29 -0.33" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(776.9805580283177 382.42148804048793) rotate(0 40.23065809100831 37.686811470070325)"><path d="M18.84 0 C32.48 0.52, 49.32 -0.19, 61.62 0 M18.84 0 C32.24 -0.11, 44.48 -0.25, 61.62 0 M61.62 0 C74.18 -0.89, 80.83 7.19, 80.46 18.84 M61.62 0 C72.85 0.43, 82.59 8.27, 80.46 18.84 M80.46 18.84 C80.18 33.85, 79.82 47.29, 80.46 56.53 M80.46 18.84 C80.15 26.6, 79.63 35.75, 80.46 56.53 M80.46 56.53 C81.08 69.68, 74.43 76.6, 61.62 75.37 M80.46 56.53 C82.53 68.95, 74.47 75.34, 61.62 75.37 M61.62 75.37 C44.38 74.85, 31.56 77.31, 18.84 75.37 M61.62 75.37 C45.08 75.32, 28.77 75.18, 18.84 75.37 M18.84 75.37 C6.35 74.15, -0.32 67.78, 0 56.53 M18.84 75.37 C5.16 74.04, 0.95 70, 0 56.53 M0 56.53 C-0.91 46.37, -0.44 35.99, 0 18.84 M0 56.53 C-0.95 42.02, 0.2 27.62, 0 18.84 M0 18.84 C1.28 8, 6.03 0.45, 18.84 0 M0 18.84 C0.22 5.36, 6.45 0.57, 18.84 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(800.316684869326 410.10829951055825) rotate(0 16.89453125 10)"><text x="16.89453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Flink</text></g><g stroke-linecap="round"><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M-0.12 -0.03 C-0.18 -9.19, -0.26 -45.47, -0.05 -54.52 M-1.64 -1.1 C-1.92 -10.13, -1.6 -44.59, -1.19 -53.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M7.41 -27.71 C4.47 -36.64, 0.78 -42.98, -1.19 -53.28 M7.41 -27.71 C5.05 -35.05, 2.92 -41.01, -1.19 -53.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M-11.04 -28.17 C-7.97 -36.93, -5.65 -43.12, -1.19 -53.28 M-11.04 -28.17 C-8.45 -35.3, -5.63 -41.14, -1.19 -53.28" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(755.9615482746752 203.30074160587537) rotate(0 62.92936798114465 59.195253689893434)"><path d="M83.86 3.52 C92.86 5.65, 102.19 12.76, 108.92 19.43 C115.65 26.1, 121.65 34.55, 124.24 43.54 C126.82 52.54, 126.56 64.26, 124.45 73.38 C122.33 82.5, 117.98 91.34, 111.55 98.27 C105.12 105.2, 95.08 111.51, 85.86 114.95 C76.65 118.4, 65.93 119.85, 56.25 118.92 C46.56 117.99, 35.96 114.61, 27.74 109.37 C19.53 104.12, 11.66 95.7, 6.96 87.45 C2.25 79.2, -0.31 69.13, -0.49 59.84 C-0.66 50.56, 1.49 39.8, 5.92 31.71 C10.34 23.63, 17.96 16.5, 26.08 11.33 C34.21 6.15, 44.29 1.62, 54.65 0.68 C65.01 -0.27, 82.31 4.54, 88.24 5.65 C94.17 6.76, 90.75 6.48, 90.24 7.34 M58.96 0.82 C68.23 -0.08, 81.2 2.91, 90.4 6.75 C99.59 10.6, 108.33 16.91, 114.14 23.86 C119.95 30.81, 123.62 39.68, 125.25 48.46 C126.87 57.23, 126.92 67.85, 123.91 76.51 C120.9 85.17, 114.33 94.02, 107.19 100.41 C100.04 106.8, 90.47 112.16, 81.01 114.84 C71.56 117.52, 59.88 117.93, 50.45 116.48 C41.02 115.03, 31.95 111.51, 24.41 106.15 C16.87 100.78, 9.42 92.85, 5.21 84.28 C1.01 75.72, -1.58 64.13, -0.81 54.77 C-0.04 45.41, 4.43 35.67, 9.84 28.12 C15.26 20.57, 23.36 13.9, 31.67 9.46 C39.98 5.01, 55.27 2.93, 59.7 1.47 C64.13 0, 58.16 0.1, 58.25 0.68" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(784.8892271705689 252.63862999758715) rotate(0 34.00390625 10)"><text x="34.00390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">OLAP DB</text></g><g stroke-linecap="round" transform="translate(741.4214316464712 10) rotate(0 77.5434786312237 35.58840984914019)"><path d="M17.79 0 C61.02 -0.26, 105.18 0.1, 137.29 0 M17.79 0 C59.97 0.64, 100.83 -0.53, 137.29 0 M137.29 0 C150.65 -0.17, 156.8 5.41, 155.09 17.79 M137.29 0 C151.3 -1.65, 154.91 4.8, 155.09 17.79 M155.09 17.79 C154.22 28.08, 155.37 37.37, 155.09 53.38 M155.09 17.79 C155.53 30.64, 156.03 43.41, 155.09 53.38 M155.09 53.38 C156.25 63.52, 148.38 72.15, 137.29 71.18 M155.09 53.38 C157.03 67.36, 151.33 72.51, 137.29 71.18 M137.29 71.18 C97.81 72.06, 58.87 71.67, 17.79 71.18 M137.29 71.18 C109.68 70.88, 81.13 71.25, 17.79 71.18 M17.79 71.18 C4.66 70.56, 0.74 65.09, 0 53.38 M17.79 71.18 C7.37 72.89, 0.25 67.36, 0 53.38 M0 53.38 C-1.21 47.2, 1.85 38.22, 0 17.79 M0 53.38 C0.04 42.16, -0.77 29.91, 0 17.79 M0 17.79 C-0.24 5.03, 7.79 1.31, 17.79 0 M0 17.79 C0.7 5.5, 7.83 -0.37, 17.79 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(764.9727227776949 35.58840984914019) rotate(0 53.9921875 10)"><text x="53.9921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analyst Browser</text></g><g stroke-linecap="round" transform="translate(768.8739438395813 116.90008943763041) rotate(0 51.13453969928662 25)"><path d="M12.5 0 C36.58 -1.3, 59.23 1.71, 89.77 0 M12.5 0 C43.1 0.15, 73.06 -0.02, 89.77 0 M89.77 0 C99.97 -1.44, 102.11 3.18, 102.27 12.5 M89.77 0 C97.45 -1.93, 100.42 3.51, 102.27 12.5 M102.27 12.5 C103.57 22.57, 102.22 29.31, 102.27 37.5 M102.27 12.5 C103.01 19.1, 102.04 27.91, 102.27 37.5 M102.27 37.5 C103.96 47.67, 100 51.16, 89.77 50 M102.27 37.5 C102.8 45.14, 99.67 48.98, 89.77 50 M89.77 50 C65.02 48.9, 41.73 50.7, 12.5 50 M89.77 50 C62.9 50.28, 37.67 50.51, 12.5 50 M12.5 50 C5.42 51.49, 0.22 47.67, 0 37.5 M12.5 50 C2.09 49.1, 0.56 44.28, 0 37.5 M0 37.5 C0.23 28.59, -1.02 19.45, 0 12.5 M0 37.5 C0.06 28.93, 1.11 21.92, 0 12.5 M0 12.5 C0.61 3.79, 5.82 -0.32, 12.5 0 M0 12.5 C0.74 4.77, 3.41 0.62, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(787.348327288868 121.90008943763041) rotate(0 32.66015625 20)"><text x="32.66015625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics </text><text x="32.66015625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M0.51 0.47 C0.6 4.32, 0.28 19.37, 0.25 23.17 M0.11 0.24 C0.18 4.16, -0.05 19.85, -0.03 23.78" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-3.96 12.8 C-2.49 15.75, -2.23 18.53, -0.03 23.78 M-3.96 12.8 C-2.5 15.8, -1.64 19.07, -0.03 23.78" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M4.02 12.84 C3.56 15.82, 1.89 18.59, -0.03 23.78 M4.02 12.84 C3.16 15.82, 1.68 19.07, -0.03 23.78" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M0.29 -0.17 C0.15 3.53, -0.26 18.88, -0.36 22.67 M-0.23 -0.73 C-0.45 3.3, -0.55 19.38, -0.58 23.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-4.39 12.64 C-3.02 17.26, -1.4 21.52, -0.58 23.35 M-4.39 12.64 C-3.32 15.45, -2.33 18.28, -0.58 23.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M3.39 12.7 C1.7 17.31, 0.27 21.55, -0.58 23.35 M3.39 12.7 C2.33 15.46, 1.18 18.28, -0.58 23.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(334.9506027334896 135.07889785719908) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C53.04 1.09, 82.09 1.24, 107.17 0 M23.81 0 C42.54 -0.43, 61.04 0.13, 107.17 0 M107.17 0 C123.66 0.58, 131.23 9.17, 130.98 23.81 M107.17 0 C125.11 -0.15, 131.27 7.9, 130.98 23.81 M130.98 23.81 C129.21 40.31, 131.9 60.04, 130.98 71.43 M130.98 23.81 C131.66 42.18, 132.11 60.7, 130.98 71.43 M130.98 71.43 C131.05 86.09, 122.72 93.94, 107.17 95.25 M130.98 71.43 C129.86 85.98, 123.99 96.16, 107.17 95.25 M107.17 95.25 C82.44 95.45, 58.8 95.97, 23.81 95.25 M107.17 95.25 C75.03 95.62, 44.95 95.34, 23.81 95.25 M23.81 95.25 C9.22 96.96, -0.25 87.76, 0 71.43 M23.81 95.25 C8.16 94.32, 0.17 87.88, 0 71.43 M0 71.43 C-0.65 62.5, 1.56 50.45, 0 23.81 M0 71.43 C-0.07 58.3, -0.73 44.9, 0 23.81 M0 23.81 C1.75 7.23, 6.21 -0.59, 23.81 0 M0 23.81 C2.04 8.49, 7.65 1.02, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(353.3431808584896 162.70194473219908) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(559.7126283454215 118.64664689480651) rotate(0 72.69127211417478 70.84147595836083)"><path d="M69.02 -0.75 C78.99 -2.09, 91.54 1.94, 101.37 6.18 C111.2 10.41, 120.98 16.82, 128 24.67 C135.02 32.53, 140.81 43.4, 143.49 53.29 C146.17 63.19, 146.12 74, 144.07 84.03 C142.03 94.05, 137.47 105.11, 131.23 113.44 C125 121.77, 116.08 129.37, 106.65 134 C97.23 138.64, 85.07 140.8, 74.67 141.24 C64.26 141.69, 53.56 140.52, 44.22 136.66 C34.87 132.8, 25.44 125.94, 18.59 118.08 C11.73 110.23, 6.03 99.45, 3.09 89.52 C0.14 79.58, -0.82 68.57, 0.95 58.46 C2.71 48.36, 7.51 37.29, 13.69 28.9 C19.87 20.51, 28.15 13, 38.01 8.1 C47.87 3.2, 66.44 0.54, 72.85 -0.48 C79.26 -1.51, 76.32 0.72, 76.48 1.96 M100.41 5.02 C110.4 7.93, 120.34 16.42, 127.36 24.24 C134.38 32.07, 139.88 42.42, 142.5 51.95 C145.13 61.48, 144.74 71.72, 143.11 81.44 C141.49 91.16, 138.36 101.53, 132.75 110.26 C127.13 118.98, 118.67 128.52, 109.43 133.79 C100.19 139.06, 87.91 141.51, 77.28 141.87 C66.66 142.23, 55.37 139.77, 45.67 135.95 C35.97 132.13, 26.36 126.53, 19.07 118.93 C11.79 111.32, 5 100.32, 1.94 90.32 C-1.12 80.33, -1.34 68.8, 0.73 58.98 C2.81 49.15, 8.29 39.74, 14.4 31.39 C20.5 23.04, 28.24 14.14, 37.37 8.9 C46.5 3.65, 58.66 0.48, 69.15 -0.09 C79.65 -0.65, 95.39 4.37, 100.34 5.53 C105.28 6.68, 99.13 5.91, 98.81 6.85" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(609.6127840145866 179.3956348137466) rotate(0 22.89062500000003 10)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(568.131490701164 18.796790023960966) rotate(0 60.903953552246065 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round"><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M-0.96 -0.34 C11.46 -0.18, 61.71 -0.14, 74.2 -0.02 M0.73 -1.57 C13.06 -1.69, 61.35 -1.95, 73.45 -1.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M27.27 -10.49 C18.95 -7.34, 12.44 -4.95, -0.96 -0.34 M27.27 -10.49 C17.28 -6.85, 7.58 -3.28, -0.96 -0.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M27.18 10.04 C19.06 7.61, 12.57 4.43, -0.96 -0.34 M27.18 10.04 C17.04 6.25, 7.37 2.41, -0.96 -0.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M45.29 8.4 C52.45 6.43, 61.25 3.25, 73.45 -1.96 M45.29 8.4 C55.5 4.66, 66.18 0.82, 73.45 -1.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M45.22 -12.12 C52.23 -8.52, 61.05 -6.12, 73.45 -1.96 M45.22 -12.12 C55.64 -8.45, 66.34 -4.87, 73.45 -1.96" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(897.9498265516207 216.73699973711973) rotate(0 76.64793395996094 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Aggregated Data</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdvertiserId (PK)</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Minute (SK)</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Click Count</text></g><g transform="translate(410.4193573604496 314.0709607156641) rotate(0 183.97589111328128 30)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Both Kinesis and Flink partition by AdId with</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">   celebrity solution for hot shards</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- 7 day retention period on Kinesis</text></g><g stroke-linecap="round" transform="translate(199.26532885268892 169.81391348717625) rotate(0 41.82508274689235 135.50951017640364)"><path d="M20.91 0 C33.86 -0.12, 47.04 0.88, 62.74 0 M20.91 0 C32.62 0.85, 45.95 1.28, 62.74 0 M62.74 0 C78.57 1.16, 84.11 6.37, 83.65 20.91 M62.74 0 C78.24 -1.02, 83.73 5.57, 83.65 20.91 M83.65 20.91 C81.39 86.66, 83.05 150.81, 83.65 250.11 M83.65 20.91 C82.73 107.16, 82.94 194.17, 83.65 250.11 M83.65 250.11 C83.87 265.89, 74.87 270.24, 62.74 271.02 M83.65 250.11 C84.21 262.49, 78.15 272.99, 62.74 271.02 M62.74 271.02 C49.91 271.21, 39.19 269.59, 20.91 271.02 M62.74 271.02 C53.33 271.48, 42.36 270.64, 20.91 271.02 M20.91 271.02 C8.63 270.7, 0.64 264.57, 0 250.11 M20.91 271.02 C6.21 271.64, 2.02 263.23, 0 250.11 M0 250.11 C0.98 200.95, 1.33 150.91, 0 20.91 M0 250.11 C1.61 184.42, 1.49 118.7, 0 20.91 M0 20.91 C0.62 5.14, 8.49 -1.18, 20.91 0 M0 20.91 C1.5 6.89, 8.03 2.19, 20.91 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(205.75447409958127 285.3234236635799) rotate(0 35.3359375 20)"><text x="35.3359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">LB &amp; API </text><text x="35.3359375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Gateway</text></g><g stroke-linecap="round" transform="translate(10 259.64809044298454) rotate(0 55.98632812499999 44.6328125)"><path d="M22.32 0 C43.16 0.74, 62.72 -1.19, 89.66 0 M22.32 0 C46.74 -0.04, 69.5 -0.92, 89.66 0 M89.66 0 C105.89 -0.89, 112.04 6.22, 111.97 22.32 M89.66 0 C104.16 -1.51, 110.85 6.11, 111.97 22.32 M111.97 22.32 C113.68 36.28, 111.53 53.51, 111.97 66.95 M111.97 22.32 C112.36 36.28, 111.35 48.01, 111.97 66.95 M111.97 66.95 C112.46 80.47, 105.81 90.98, 89.66 89.27 M111.97 66.95 C111.68 82.34, 104.75 88.34, 89.66 89.27 M89.66 89.27 C67.9 88.54, 47.35 90.63, 22.32 89.27 M89.66 89.27 C65.89 88.98, 40.78 89.4, 22.32 89.27 M22.32 89.27 C6.78 89.8, 1.75 81.12, 0 66.95 M22.32 89.27 C5.45 88.59, 2.04 82.38, 0 66.95 M0 66.95 C-0.48 53.13, -1.57 42.81, 0 22.32 M0 66.95 C0.03 53.31, 0.49 40.92, 0 22.32 M0 22.32 C1.3 7.37, 8.36 1.91, 22.32 0 M0 22.32 C1.27 8.43, 5.62 -1.73, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.880859375 294.28090294298454) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round"><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M-0.46 0.58 C9.09 0.96, 48.23 1.19, 58 1.23 M1.5 -0.16 C10.91 0, 48.17 -0.15, 57.58 -0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M26.44 -8.82 C17.69 -3.87, 8.92 -0.29, -0.46 0.58 M26.44 -8.82 C17.51 -5.98, 7.24 -2.78, -0.46 0.58" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M26.19 10.67 C17.7 8.64, 9.02 5.24, -0.46 0.58 M26.19 10.67 C17.31 6.54, 7.13 2.76, -0.46 0.58" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M30.9 9.68 C41.52 7.89, 51.94 4.52, 57.58 -0.32 M30.9 9.68 C41.11 5.74, 50.01 2, 57.58 -0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642636) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M30.71 -9.81 C41.23 -4.62, 51.72 -1.01, 57.58 -0.32 M30.71 -9.81 C41.03 -6.77, 50 -3.55, 57.58 -0.32" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M1.01 1.1 C17.6 11.11, 82.88 50.9, 99.08 60.65 M0.08 0.64 C16.66 10.25, 82.48 48.88, 98.73 58.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M30.43 6.97 C24.55 7.58, 16.18 4.61, 1.01 1.1 M30.43 6.97 C22.48 4.65, 14.34 3.02, 1.01 1.1" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M19.78 24.51 C16.59 20.44, 11.01 12.89, 1.01 1.1 M19.78 24.51 C14.58 17.49, 9.32 11.13, 1.01 1.1" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M69.27 53.21 C78.84 56.34, 85.86 56.39, 98.73 58.89 M69.27 53.21 C77.3 54.26, 85.06 55.75, 98.73 58.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M79.82 35.6 C86.71 43.43, 90.98 48.08, 98.73 58.89 M79.82 35.6 C85.12 41.37, 90.03 47.61, 98.73 58.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M1.14 0.69 C6.72 -6.67, 28.84 -35.74, 34.49 -43.07 M0.27 0.01 C5.63 -6.66, 27.95 -34.68, 33.68 -41.72" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M9.26 -25.43 C7.53 -14.85, 2.66 -3.91, 1.14 0.69 M9.26 -25.43 C7.03 -19.46, 4.63 -12.7, 1.14 0.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M24.15 -14.1 C16.6 -7.74, 6 -1.15, 1.14 0.69 M24.15 -14.1 C18.11 -11.11, 11.9 -7.25, 1.14 0.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M24.86 -15.82 C29.17 -25.4, 30.8 -34.45, 33.68 -41.72 M24.86 -15.82 C26.94 -23.04, 28.87 -29.59, 33.68 -41.72" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M10.28 -27.55 C20.3 -32.76, 27.54 -37.3, 33.68 -41.72 M10.28 -27.55 C16.09 -31.69, 21.75 -35.23, 33.68 -41.72" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Stream Retention Policy</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Stream processors like Flink also have a feature called checkpointing. This is where the processor periodically writes its state to a persistent storage like S3. If it goes down, it can read the last checkpoint and resume processing from where it left off. This is particularly useful when the aggregation windows are large, like a day or a week. You can imagine we have a weeks worth of data in memory being aggregated and if the processor goes down, we don't want to lose all that work.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For our case, however, our aggregation windows are very small. Candidates often propose using checkpointing when I ask this question in interview, but I'll usually push back and ask if it really makes sense given the small aggregation windows. If Flink were to go down, we would have lost, at most, a minutes worth of aggregated data. Given persistence is enabled on the stream, we can just read the lost click events from the stream again and re-aggregate them.</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">These types of identifications that somewhat go against the grain are really effective ways to show seniority. A well-studied candidate may remember reading about checkpointing and propose it as a solution, but an experienced candidate will instead think critically about whether it's actually necessary given the context of the problem.</div></div></div></div></div>
<h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="reconciliation">Reconciliation</h5>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Click data matters, a lot. If we lose click data, we lose money. So we need to make sure that our data is correct. This is a tough balance, because guaranteeing correctness and low latency are often at odds. We can balance the two by introducing periodic reconciliation.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Despite our best efforts with the above measures, things could still go wrong. Transient processing errors in Flink, bad code pushes, out-of-order events in the stream, etc., could all lead to slight inaccuracies in our data. To catch these, we can introduce a periodic reconciliation job that runs every hour or day.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">At the end of the stream, alongside the stream processors, we can also dump the raw click events to a data lake like S3. Flink supports this through its FileSystem interface and various connectors, allowing for both batch and real-time data processing outputs to be stored directly in S3 buckets. Then, as with the "good" answer in "Advertisers can query ad click metrics over time at 1-minute intervals" above, we can run a batch job that reads all the raw click events from the data lake and re-aggregates them. This way, we can compare the results of the batch job to the results of the stream processor and ensure that they match. If they don't, we can investigate the discrepancies and fix the root cause while updating the data in the OLAP DB with the correct values.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1213.9192344114304 682.1096014240266">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1213.9192344114304" height="682.1096014240266" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(399.1152757098577 383.00692392068686) rotate(0 64.1640625 42.67578125)"><path d="M21.34 0 C54.6 -1.47, 86.13 -1.55, 106.99 0 M21.34 0 C38.75 0.41, 55.29 0.39, 106.99 0 M106.99 0 C121.99 0.1, 130.28 5.45, 128.33 21.34 M106.99 0 C122.62 -1.33, 129.09 7.12, 128.33 21.34 M128.33 21.34 C128.73 38.03, 130.02 53.44, 128.33 64.01 M128.33 21.34 C128.4 34.23, 127.83 45.96, 128.33 64.01 M128.33 64.01 C128.79 77.75, 120.66 86.06, 106.99 85.35 M128.33 64.01 C126.37 76.14, 122.88 86.34, 106.99 85.35 M106.99 85.35 C79.45 85.23, 47.11 84.82, 21.34 85.35 M106.99 85.35 C88.7 87, 70.16 86.25, 21.34 85.35 M21.34 85.35 C7.91 83.61, -0.02 76.72, 0 64.01 M21.34 85.35 C5.39 83.34, 0.83 78.82, 0 64.01 M0 64.01 C0.12 48.91, 1.5 32.74, 0 21.34 M0 64.01 C-0.77 48, -0.11 32.32, 0 21.34 M0 21.34 C-0.51 5.17, 7.03 -1.62, 21.34 0 M0 21.34 C0.07 5.51, 6.81 1.27, 21.34 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(412.8418382098577 415.68270517068686) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g stroke-linecap="round"><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M-0.48 -0.53 C3.65 -0.53, 20.19 -0.49, 24.34 -0.43 M0.28 0.38 C4.37 0.52, 19.92 0.51, 23.88 0.25" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M12.55 4.74 C14.44 3.76, 17.46 2.85, 23.88 0.25 M12.55 4.74 C16.49 3.23, 20.47 1.45, 23.88 0.25" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.681427027597 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M12.32 -3.6 C14.22 -2.76, 17.29 -1.86, 23.88 0.25 M12.32 -3.6 C16.3 -2.31, 20.36 -1.29, 23.88 0.25" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(573.7238890737021 404.7372919106965) rotate(0 79.8203125 18.873046875)"><path d="M9.44 0 C39.34 0.16, 70.18 -1.54, 150.2 0 M9.44 0 C57.46 -0.9, 104.15 -0.64, 150.2 0 M150.2 0 C157.16 0.01, 160.82 3.28, 159.64 9.44 M150.2 0 C157.09 0.43, 161.23 5.06, 159.64 9.44 M159.64 9.44 C161.19 16, 161.13 21.99, 159.64 28.31 M159.64 9.44 C159.42 16.3, 158.88 21.64, 159.64 28.31 M159.64 28.31 C161.09 35.46, 157.33 37.68, 150.2 37.75 M159.64 28.31 C159.58 36.6, 156.38 36.23, 150.2 37.75 M150.2 37.75 C113.34 38.26, 74.63 37.37, 9.44 37.75 M150.2 37.75 C106.22 35.76, 61.5 35.65, 9.44 37.75 M9.44 37.75 C3.87 38.25, 1.17 33.32, 0 28.31 M9.44 37.75 C1.57 37.57, 0.22 36.01, 0 28.31 M0 28.31 C1.59 21.79, 0.1 18.01, 0 9.44 M0 28.31 C0.01 20.77, 0.08 14.1, 0 9.44 M0 9.44 C-0.27 4.25, 4.79 1.1, 9.44 0 M0 9.44 C-0.66 2.65, 2.82 -2.02, 9.44 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(629.5442015737021 413.6103387856965) rotate(0 24 10)"><text x="24" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Kinesis</text></g><g stroke-linecap="round"><g transform="translate(743.8918578237021 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M-0.45 0.19 C3.54 0.08, 19.82 -0.28, 23.94 -0.47 M0.32 -0.19 C4.25 -0.22, 19.64 0.31, 23.62 0.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.8918578237021 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M12.42 4.17 C16.01 3.26, 19.22 2.42, 23.62 0.24 M12.42 4.17 C14.94 3.35, 17.45 2.52, 23.62 0.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.8918578237021 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M12.52 -3.95 C16.09 -2.4, 19.28 -0.79, 23.62 0.24 M12.52 -3.95 C15.04 -3, 17.53 -2.08, 23.62 0.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(776.9805580283175 382.421488040487) rotate(0 40.23065809100831 37.686811470070325)"><path d="M18.84 0 C28.25 1.78, 35.81 1.06, 61.62 0 M18.84 0 C29.8 0.07, 39.83 0.19, 61.62 0 M61.62 0 C75.56 1.67, 81.93 5.94, 80.46 18.84 M61.62 0 C75.96 1.93, 79.87 8.14, 80.46 18.84 M80.46 18.84 C80.15 26.5, 81.34 33.55, 80.46 56.53 M80.46 18.84 C81.15 26.68, 80.71 35.45, 80.46 56.53 M80.46 56.53 C80.36 67.77, 73.67 73.6, 61.62 75.37 M80.46 56.53 C81.93 71.17, 73.73 77.39, 61.62 75.37 M61.62 75.37 C49.77 75.52, 39.88 74.05, 18.84 75.37 M61.62 75.37 C53.12 74.84, 42.76 75.4, 18.84 75.37 M18.84 75.37 C6.48 76.6, -0.67 70.66, 0 56.53 M18.84 75.37 C6.21 77.49, -1.81 69.39, 0 56.53 M0 56.53 C-2.17 45.62, -1.84 34.92, 0 18.84 M0 56.53 C0.87 48.4, -0.24 38.96, 0 18.84 M0 18.84 C-0.28 4.53, 4.49 0.5, 18.84 0 M0 18.84 C1.99 4.33, 6.59 1.34, 18.84 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(800.3166848693259 410.10829951055734) rotate(0 16.89453125 10)"><text x="16.89453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Flink</text></g><g stroke-linecap="round"><g transform="translate(815.846939893381 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M0.73 -0.69 C0.66 -9.52, 0.66 -45.08, 0.71 -53.94 M-0.34 1.56 C-0.64 -6.97, -0.19 -43.39, -0.03 -52.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.846939893381 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M8.84 -26.93 C4.37 -36.33, 2.01 -45.95, -0.03 -52.4 M8.84 -26.93 C6.74 -33.89, 4.07 -42.71, -0.03 -52.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.846939893381 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M-9.61 -27.18 C-6.75 -36.6, -1.78 -46.11, -0.03 -52.4 M-9.61 -27.18 C-6.05 -34.11, -3.06 -42.84, -0.03 -52.4" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(755.9615482746751 203.30074160587537) rotate(0 62.92936798114462 59.195253689893434)"><path d="M81.37 3.23 C90.63 5, 101.02 11.3, 107.91 17.75 C114.8 24.19, 119.72 33.35, 122.69 41.91 C125.67 50.48, 127.27 60.38, 125.75 69.15 C124.23 77.92, 119.59 87.17, 113.58 94.51 C107.56 101.86, 98.7 109.3, 89.67 113.22 C80.64 117.14, 69.13 118.7, 59.38 118.03 C49.63 117.37, 39.65 113.76, 31.15 109.24 C22.66 104.73, 13.52 98.54, 8.42 90.94 C3.32 83.34, 1.1 72.93, 0.58 63.65 C0.06 54.38, 1.31 43.77, 5.31 35.3 C9.32 26.83, 17.08 18.59, 24.6 12.84 C32.12 7.09, 40.08 2.04, 50.44 0.8 C60.8 -0.44, 79.47 4.12, 86.74 5.39 C94.01 6.66, 94.19 7.75, 94.07 8.44 M66.82 -1.02 C75.83 -1.36, 86.02 2.26, 94.45 7.27 C102.88 12.28, 112.02 21.12, 117.38 29.03 C122.74 36.95, 126.32 45.69, 126.63 54.76 C126.94 63.83, 123.38 74.79, 119.25 83.46 C115.11 92.13, 109.4 100.91, 101.8 106.77 C94.21 112.63, 83.29 116.9, 73.67 118.61 C64.05 120.33, 53.48 119.97, 44.07 117.06 C34.65 114.16, 24.09 107.76, 17.18 101.18 C10.27 94.6, 5.38 86.63, 2.63 77.6 C-0.12 68.56, -1.13 56.34, 0.67 46.97 C2.46 37.61, 7.3 28.54, 13.4 21.4 C19.49 14.26, 28.37 7.54, 37.24 4.13 C46.11 0.72, 61.51 1.28, 66.63 0.94 C71.76 0.61, 68.09 1.33, 67.99 2.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(784.8892271705688 252.63862999758715) rotate(0 34.00390625 10)"><text x="34.00390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">OLAP DB</text></g><g stroke-linecap="round" transform="translate(741.4214316464711 10) rotate(0 77.54347863122368 35.58840984914019)"><path d="M17.79 0 C61.05 1.07, 105.22 1.17, 137.29 0 M17.79 0 C51.37 -0.19, 84.63 -0.54, 137.29 0 M137.29 0 C149.62 -0.49, 154.54 6.64, 155.09 17.79 M137.29 0 C147.2 -2.1, 156.76 6.92, 155.09 17.79 M155.09 17.79 C156.81 29.86, 153.75 41.62, 155.09 53.38 M155.09 17.79 C155.12 26.19, 154.68 32.96, 155.09 53.38 M155.09 53.38 C155.88 63.51, 149.13 69.66, 137.29 71.18 M155.09 53.38 C153.37 63.23, 149.99 71.76, 137.29 71.18 M137.29 71.18 C94.28 70.55, 52.81 69.69, 17.79 71.18 M137.29 71.18 C91.3 72.41, 46.76 72.87, 17.79 71.18 M17.79 71.18 C5.42 69.23, -0.08 63.62, 0 53.38 M17.79 71.18 C6 69.57, -0.31 66.52, 0 53.38 M0 53.38 C-0.62 39.5, -1.95 24.4, 0 17.79 M0 53.38 C-0.17 42.4, 0.24 29.77, 0 17.79 M0 17.79 C0.75 5.29, 5.12 1.81, 17.79 0 M0 17.79 C-0.26 5.26, 5.22 1.62, 17.79 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(764.9727227776948 35.58840984914019) rotate(0 53.9921875 10)"><text x="53.9921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analyst Browser</text></g><g stroke-linecap="round" transform="translate(768.8739438395812 116.90008943763041) rotate(0 51.13453969928662 25)"><path d="M12.5 0 C40.68 0.98, 71.21 -1.08, 89.77 0 M12.5 0 C42.15 -0.6, 71.06 0, 89.77 0 M89.77 0 C96.4 -1.83, 103.72 5.03, 102.27 12.5 M89.77 0 C99.06 -0.07, 102.21 6.16, 102.27 12.5 M102.27 12.5 C100.33 21.15, 103.91 26.86, 102.27 37.5 M102.27 12.5 C102.51 21.32, 102.1 31.12, 102.27 37.5 M102.27 37.5 C100.77 44.08, 98.83 50.5, 89.77 50 M102.27 37.5 C103.62 44.36, 96.53 49.82, 89.77 50 M89.77 50 C67.4 49.68, 43.74 48.17, 12.5 50 M89.77 50 C65.32 49.48, 41.35 49.65, 12.5 50 M12.5 50 C4.23 48.61, -0.27 46.94, 0 37.5 M12.5 50 C6.06 51.26, -0.66 45.34, 0 37.5 M0 37.5 C0.72 32.08, -1.47 23.48, 0 12.5 M0 37.5 C0.24 28.22, -0.54 20.49, 0 12.5 M0 12.5 C-0.22 3.58, 3.54 1.41, 12.5 0 M0 12.5 C0.49 2.07, 5.28 0.26, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(787.348327288868 121.90008943763041) rotate(0 32.66015625 20)"><text x="32.66015625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics </text><text x="32.66015625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(821.0983029640063 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-0.14 0.44 C-0.29 4.3, -0.53 19.8, -0.49 23.59 M0.79 0.2 C0.76 4.13, 0.67 18.84, 0.51 22.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640063 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-3.24 11.71 C-1.31 15.4, -0.09 20.19, 0.51 22.76 M-3.24 11.71 C-2.47 14.48, -0.98 17.92, 0.51 22.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640063 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M4.74 11.88 C3.66 15.5, 1.86 20.22, 0.51 22.76 M4.74 11.88 C3.31 14.62, 2.6 18.01, 0.51 22.76" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(819.1912276012038 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-0.45 0.25 C-0.54 3.94, -0.57 18.81, -0.64 22.59 M0.32 -0.09 C0.18 3.64, -0.73 19.54, -1.01 23.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012038 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-4.2 12.31 C-3.02 15.45, -2.54 18.15, -1.01 23.22 M-4.2 12.31 C-2.97 16.1, -1.99 19.63, -1.01 23.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012038 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M3.56 12.81 C2.61 15.78, 0.96 18.34, -1.01 23.22 M3.56 12.81 C2.19 16.4, 0.57 19.76, -1.01 23.22" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(334.9506027334896 135.07889785719908) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C41.47 -0.75, 60.81 -1.89, 107.17 0 M23.81 0 C41.63 -0.39, 58.59 0.51, 107.17 0 M107.17 0 C122.94 -1.32, 130.47 6.16, 130.98 23.81 M107.17 0 C124.51 2.07, 130.53 9.95, 130.98 23.81 M130.98 23.81 C129.3 35.05, 129.52 44.83, 130.98 71.43 M130.98 23.81 C131.74 33.29, 130.47 43.97, 130.98 71.43 M130.98 71.43 C131.18 88.54, 122.37 96.81, 107.17 95.25 M130.98 71.43 C130.91 89.43, 121.24 95.55, 107.17 95.25 M107.17 95.25 C81.26 94.96, 57.62 95.09, 23.81 95.25 M107.17 95.25 C88.79 96.26, 68.49 95.49, 23.81 95.25 M23.81 95.25 C7.65 93.49, -1.79 87.81, 0 71.43 M23.81 95.25 C9.93 93.3, 0.31 88.65, 0 71.43 M0 71.43 C-0.41 53.74, 2.03 37.43, 0 23.81 M0 71.43 C0.36 57.64, 0.63 45.77, 0 23.81 M0 23.81 C-1.24 6.99, 9.2 -1.83, 23.81 0 M0 23.81 C2.06 10.19, 9.67 -1.53, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(353.3431808584896 162.70194473219908) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(559.7126283454215 118.64664689480651) rotate(0 72.69127211417481 70.84147595836083)"><path d="M98.46 4.59 C108.26 6.97, 119.16 14.64, 126.29 22.03 C133.42 29.43, 138.33 39.09, 141.25 48.96 C144.17 58.83, 144.99 71.1, 143.8 81.26 C142.61 91.42, 139.64 101.58, 134.1 109.9 C128.57 118.22, 119.78 125.84, 110.61 131.16 C101.43 136.48, 89.82 140.84, 79.05 141.82 C68.29 142.8, 55.99 140.89, 46.02 137.06 C36.04 133.23, 26.44 126.22, 19.2 118.85 C11.96 111.48, 5.64 102.37, 2.6 92.84 C-0.45 83.3, -0.54 71.97, 0.95 61.65 C2.44 51.33, 5.77 39.51, 11.54 30.9 C17.31 22.29, 26.32 15.15, 35.57 9.99 C44.83 4.82, 56.16 0.72, 67.07 -0.07 C77.98 -0.86, 95.15 4.16, 101.02 5.26 C106.9 6.35, 102.87 5.43, 102.31 6.51 M93.78 1.85 C103.72 3.73, 114.25 10.39, 121.96 17.67 C129.68 24.95, 135.97 35.69, 140.05 45.53 C144.13 55.36, 147.21 66.65, 146.43 76.67 C145.65 86.7, 140.82 97.16, 135.36 105.69 C129.9 114.23, 122.48 121.98, 113.67 127.9 C104.85 133.82, 92.61 139.65, 82.47 141.23 C72.33 142.8, 62.64 140.25, 52.84 137.35 C43.04 134.45, 31.48 130.68, 23.67 123.84 C15.85 117, 9.77 106.03, 5.95 96.28 C2.13 86.53, 0.24 75.23, 0.75 65.35 C1.25 55.48, 3.89 45.91, 8.99 37.02 C14.08 28.14, 22.65 17.89, 31.33 12.03 C40.02 6.17, 50.63 3.61, 61.1 1.89 C71.57 0.17, 88.65 1.25, 94.16 1.7 C99.66 2.15, 94.71 3.35, 94.14 4.59" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(609.6127840145866 179.39563481374663) rotate(0 22.890625 10)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(568.131490701164 18.796790023960966) rotate(0 60.903953552246094 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round"><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M-0.03 1.04 C12.18 0.85, 61.51 -0.75, 73.76 -1.16 M-1.51 0.54 C10.5 0.49, 60.43 0.16, 72.79 -0.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M27.85 -10.03 C20.05 -6.35, 7.46 -2.97, -0.03 1.04 M27.85 -10.03 C21.84 -6.56, 15.5 -4.98, -0.03 1.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M28.44 10.48 C20.45 7.15, 7.66 3.51, -0.03 1.04 M28.44 10.48 C22.17 9.62, 15.72 6.88, -0.03 1.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M44.71 10.52 C56.04 6.82, 62.59 2.8, 72.79 -0.04 M44.71 10.52 C50.38 8.91, 55.87 5.93, 72.79 -0.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.6280361113401 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M44.49 -10 C55.89 -6.69, 62.51 -3.69, 72.79 -0.04 M44.49 -10 C50.33 -7.27, 55.87 -5.92, 72.79 -0.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(900.3971322767741 165.16319025809753) rotate(0 76.64793395996094 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Aggregated Data</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdvertiserId (PK)</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Minute (SK)</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Click Count</text></g><g transform="translate(410.4193573604496 314.0709607156632) rotate(0 183.97589111328125 30)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Both Kinesis and Flink partition by AdId with</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">   celebrity solution for hot shards</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- 7 day retention period on Kinesis</text></g><g stroke-linecap="round" transform="translate(199.26532885268892 169.81391348717625) rotate(0 41.82508274689235 135.50951017640364)"><path d="M20.91 0 C34.2 -0.66, 45.64 -1.54, 62.74 0 M20.91 0 C33.97 -0.4, 46.3 -0.51, 62.74 0 M62.74 0 C77.4 0.5, 84.82 5.69, 83.65 20.91 M62.74 0 C75.11 -0.18, 83.87 8.38, 83.65 20.91 M83.65 20.91 C86.75 80.67, 85.4 142.9, 83.65 250.11 M83.65 20.91 C83.12 102.51, 83.18 184.9, 83.65 250.11 M83.65 250.11 C83.38 265.16, 78.32 272.12, 62.74 271.02 M83.65 250.11 C82.99 263.55, 76.35 269, 62.74 271.02 M62.74 271.02 C52.24 271.65, 46.29 272.47, 20.91 271.02 M62.74 271.02 C51.76 271.79, 41.48 270.59, 20.91 271.02 M20.91 271.02 C6.35 272.43, 0.42 262.23, 0 250.11 M20.91 271.02 C8.09 271.28, -1.43 262.96, 0 250.11 M0 250.11 C3.45 168.16, 0.66 84.95, 0 20.91 M0 250.11 C-0.53 166.08, -1.45 81.37, 0 20.91 M0 20.91 C-0.1 6.98, 7.07 0.9, 20.91 0 M0 20.91 C1.58 5.66, 4.82 -1.55, 20.91 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(205.75447409958127 285.3234236635799) rotate(0 35.3359375 20)"><text x="35.3359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">LB &amp; API </text><text x="35.3359375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Gateway</text></g><g stroke-linecap="round" transform="translate(10 259.64809044298363) rotate(0 55.986328125 44.6328125)"><path d="M22.32 0 C41.46 1.22, 58.37 0.41, 89.66 0 M22.32 0 C37.77 0.84, 53.08 -0.05, 89.66 0 M89.66 0 C103.17 -0.16, 112.17 8.67, 111.97 22.32 M89.66 0 C103.77 1.8, 111.91 9.56, 111.97 22.32 M111.97 22.32 C113.21 31.69, 110.09 42, 111.97 66.95 M111.97 22.32 C111.85 32.64, 112.81 42.41, 111.97 66.95 M111.97 66.95 C111.4 81.4, 104.25 87.51, 89.66 89.27 M111.97 66.95 C109.92 82.4, 106.52 87.32, 89.66 89.27 M89.66 89.27 C67.6 90.39, 46.78 88.83, 22.32 89.27 M89.66 89.27 C63.05 89.77, 37.28 88.16, 22.32 89.27 M22.32 89.27 C8.41 89.49, -1.24 80.88, 0 66.95 M22.32 89.27 C8.89 87.16, 2.06 84.08, 0 66.95 M0 66.95 C1.64 51.13, -1 34.35, 0 22.32 M0 66.95 C0.23 53.15, 0.33 39.79, 0 22.32 M0 22.32 C1.37 6.3, 5.57 -1.35, 22.32 0 M0 22.32 C1.38 8.96, 7.37 -1.01, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.880859375 294.28090294298363) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round"><g transform="translate(134.99271419461374 303.97266727642545) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M-0.01 -0.91 C9.26 -0.89, 46.52 -1.15, 56.09 -0.93 M-1.48 1.23 C8.12 1.45, 48.6 -0.06, 58.33 0.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642545) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M26.74 -10.73 C16.05 -8.89, 6.72 -3.34, -0.01 -0.91 M26.74 -10.73 C17.41 -7.78, 9.5 -3.9, -0.01 -0.91" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642545) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M26.79 8.76 C16.25 3.98, 6.91 2.91, -0.01 -0.91 M26.79 8.76 C17.33 5.37, 9.4 2.91, -0.01 -0.91" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642545) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M31.71 10.23 C39.33 5.28, 48.14 4.04, 58.33 0.06 M31.71 10.23 C39.63 7.01, 49.06 4.4, 58.33 0.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.99271419461374 303.97266727642545) rotate(0 28.49354597393547 0.061418079753821075)"><path d="M31.4 -9.26 C38.95 -7.59, 47.87 -2.2, 58.33 0.06 M31.4 -9.26 C39.53 -6.14, 49.07 -2.42, 58.33 0.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M-0.9 -1.05 C15.5 9.14, 81.79 50.22, 98.38 60.26 M0.83 1.01 C17.11 10.91, 81.42 48.45, 97.66 58.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M28.47 5.06 C17.99 3.74, 11.47 2.36, -0.9 -1.05 M28.47 5.06 C21.68 4.21, 14.32 2.94, -0.9 -1.05" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M17.67 22.51 C10.55 16.05, 7.25 9.46, -0.9 -1.05 M17.67 22.51 C13.55 17.55, 8.73 12.16, -0.9 -1.05" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M68.18 52.72 C75.2 55.33, 86.26 57.45, 97.66 58.3 M68.18 52.72 C75.2 54.67, 81.72 56.16, 97.66 58.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 364.99871621246257) rotate(0 48.97119861655193 29.978607841885832)"><path d="M78.66 35.08 C82.41 42.88, 90.34 50.27, 97.66 58.3 M78.66 35.08 C83.08 41.19, 87.13 46.84, 97.66 58.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M0.43 0.3 C6.4 -6.77, 29.42 -36.29, 34.91 -43.47 M-0.8 -0.58 C5.15 -7.43, 28.23 -35.52, 34.33 -42.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M9.06 -25.66 C7.4 -18.61, 3.67 -15.3, 0.43 0.3 M9.06 -25.66 C6.23 -17.24, 4.02 -9.51, 0.43 0.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M23.73 -14.04 C18.86 -9.55, 11.83 -8.86, 0.43 0.3 M23.73 -14.04 C16.61 -8.92, 10.1 -4.59, 0.43 0.3" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M24.77 -16.71 C27.65 -21.34, 28.02 -29.66, 34.33 -42.34 M24.77 -16.71 C27.2 -23.47, 30.3 -30.82, 34.33 -42.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.6863060210908) rotate(0 17.104613218133522 -21.35349127125596)"><path d="M10.53 -28.85 C16.51 -30.8, 20.09 -36.38, 34.33 -42.34 M10.53 -28.85 C17.14 -32.16, 24.4 -35.96, 34.33 -42.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(736.9681749175397 447.3291240580256) rotate(0 18.929250724075928 25.420822374378076)"><path d="M0.7 -0.77 C6.8 7.64, 30.83 42.02, 37.04 50.75 M-0.39 1.44 C6.06 10.02, 33.04 44.21, 39.32 52.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(736.9681749175397 447.3291240580256) rotate(0 18.929250724075928 25.420822374378076)"><path d="M13.83 36.41 C21.16 40.21, 30.85 47.1, 39.32 52.24 M13.83 36.41 C22.96 42.85, 31.41 47.78, 39.32 52.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(736.9681749175397 447.3291240580256) rotate(0 18.929250724075928 25.420822374378076)"><path d="M29.97 23.73 C31.91 31.89, 36.17 43.04, 39.32 52.24 M29.97 23.73 C33.23 34.88, 35.84 44.39, 39.32 52.24" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(752.2357532418339 493.6851907923183) rotate(0 65.60316897266054 63.5)"><path d="M69.59 0.05 C79.33 -0.51, 91.16 3.02, 99.81 8 C108.46 12.97, 116.18 21.45, 121.48 29.9 C126.78 38.34, 131.08 48.85, 131.63 58.68 C132.17 68.5, 129.06 79.79, 124.76 88.85 C120.47 97.91, 113.73 106.92, 105.85 113.06 C97.96 119.2, 87.22 123.67, 77.48 125.69 C67.73 127.71, 56.89 128, 47.36 125.16 C37.84 122.32, 27.7 115.67, 20.3 108.63 C12.91 101.6, 6.36 92.41, 2.99 82.95 C-0.39 73.49, -1.73 61.41, 0.07 51.88 C1.86 42.35, 7.57 33.42, 13.75 25.78 C19.93 18.14, 27.13 10.17, 37.14 6.04 C47.16 1.9, 67.21 1.53, 73.84 0.98 C80.48 0.43, 77.24 1.82, 76.97 2.71 M93.8 7.44 C102.99 10.52, 112.5 16.69, 118.73 24.46 C124.96 32.23, 129.85 44.22, 131.18 54.06 C132.51 63.89, 129.97 74.41, 126.7 83.45 C123.43 92.5, 118.57 101.21, 111.56 108.32 C104.55 115.43, 94.38 123.41, 84.62 126.12 C74.86 128.83, 63 126.73, 53.02 124.6 C43.05 122.47, 32.68 119.61, 24.79 113.32 C16.91 107.04, 9.69 96.11, 5.72 86.88 C1.75 77.66, 0.32 67.74, 0.95 57.95 C1.59 48.16, 4.16 36.44, 9.54 28.15 C14.92 19.86, 24.23 12.8, 33.25 8.23 C42.27 3.65, 53.3 1.16, 63.64 0.71 C73.98 0.26, 90.52 4.56, 95.3 5.53 C100.08 6.5, 92.79 5.26, 92.29 6.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(781.9543828165993 537.2839101869725) rotate(0 35.99609375 20)"><text x="35.99609375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Raw Click </text><text x="35.99609375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Data (s3)</text></g><g stroke-linecap="round" transform="translate(969.4976419437264 457.75345636681686) rotate(0 40.84526841546733 107.17807252860484)"><path d="M20.42 0 C34.64 0.08, 47.57 -1.44, 61.27 0 M20.42 0 C32.96 -1.21, 45.96 -1.05, 61.27 0 M61.27 0 C74.94 -1.39, 81.42 7.91, 81.69 20.42 M61.27 0 C76.77 1.26, 81.03 6.31, 81.69 20.42 M81.69 20.42 C80.67 71.75, 78.48 119.89, 81.69 193.93 M81.69 20.42 C83.02 82.28, 82.23 145.68, 81.69 193.93 M81.69 193.93 C81.47 206.96, 74.26 215.76, 61.27 214.36 M81.69 193.93 C82.18 205.46, 76 214.61, 61.27 214.36 M61.27 214.36 C49.72 216.41, 43.8 216.12, 20.42 214.36 M61.27 214.36 C52.2 213.98, 42.65 214.72, 20.42 214.36 M20.42 214.36 C5.56 213.13, -0.1 207.56, 0 193.93 M20.42 214.36 C6.92 215.39, 1.58 206.24, 0 193.93 M0 193.93 C2.49 158.05, 0.29 120.52, 0 20.42 M0 193.93 C-0.39 137.67, 0.05 81.51, 0 20.42 M0 20.42 C-1.96 6.86, 5.39 0.72, 20.42 0 M0 20.42 C-0.76 6.02, 6.69 -0.44, 20.42 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(991.6788478591938 554.9315288954217) rotate(0 18.6640625 10)"><text x="18.6640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Spark</text></g><g stroke-linecap="round" transform="translate(1113.5378410644794 594.5028790248243) rotate(0 45.190696673475486 19.707706582320498)"><path d="M9.85 0 C31.11 0.3, 53.03 0.05, 80.53 0 M9.85 0 C24.22 -0.12, 38.39 1.13, 80.53 0 M80.53 0 C88.74 1.1, 89.81 2.86, 90.38 9.85 M80.53 0 C86.77 -2.02, 88.33 3.86, 90.38 9.85 M90.38 9.85 C91.36 18.55, 89.29 25.83, 90.38 29.56 M90.38 9.85 C90.19 14.85, 90 21.11, 90.38 29.56 M90.38 29.56 C90.81 34.31, 88.07 39.64, 80.53 39.42 M90.38 29.56 C88.95 35.04, 88.55 37.31, 80.53 39.42 M80.53 39.42 C51.67 41.47, 26.8 40.89, 9.85 39.42 M80.53 39.42 C63.26 38.87, 47.2 39.49, 9.85 39.42 M9.85 39.42 C3.39 40.32, 1.37 34.99, 0 29.56 M9.85 39.42 C1.13 37.87, 1.38 37.65, 0 29.56 M0 29.56 C0.57 24.3, 1 18.1, 0 9.85 M0 29.56 C-1.08 23.67, -0.81 18.08, 0 9.85 M0 9.85 C-0.66 2.6, 3.18 -0.38, 9.85 0 M0 9.85 C-1.29 4.49, 3.32 1.91, 9.85 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1144.5136939879549 604.2105856071448) rotate(0 14.21484375 10)"><text x="14.21484375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">cron</text></g><g stroke-linecap="round"><g transform="translate(1101.618995098421 614.342113802998) rotate(0 -17.663040992236347 0)"><path d="M-0.14 -0.53 C-6.02 -0.66, -29.49 -0.47, -35.35 -0.45 M0.79 0.38 C-5.16 0.28, -29.72 0.08, -35.79 0.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1101.618995098421 614.342113802998) rotate(0 -17.663040992236347 0)"><path d="M-19.14 -5.87 C-24.77 -4.23, -29.41 -2.48, -35.79 0.02 M-19.14 -5.87 C-22.61 -4.22, -26.94 -3.2, -35.79 0.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1101.618995098421 614.342113802998) rotate(0 -17.663040992236347 0)"><path d="M-19.25 6.21 C-24.88 4.38, -29.49 2.66, -35.79 0.02 M-19.25 6.21 C-22.69 5.08, -26.99 3.31, -35.79 0.02" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(963.1047748571441 565.1935453480737) rotate(0 -36.905232806046854 -1.4819644685528601)"><path d="M-0.05 -0.97 C-12.29 -1.41, -61.45 -3.58, -73.77 -3.8 M-1.53 1.13 C-13.9 0.92, -62.49 -1.8, -74.7 -2.7" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(963.1047748571441 565.1935453480737) rotate(0 -36.905232806046854 -1.4819644685528601)"><path d="M-45.92 -11.17 C-55.53 -8.8, -63.2 -6.8, -74.7 -2.7 M-45.92 -11.17 C-56.37 -8.22, -66.45 -5.87, -74.7 -2.7" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(963.1047748571441 565.1935453480737) rotate(0 -36.905232806046854 -1.4819644685528601)"><path d="M-47.21 9.31 C-56.27 6.06, -63.59 2.44, -74.7 -2.7 M-47.21 9.31 C-57.37 4.98, -66.99 0.05, -74.7 -2.7" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(943.0217457861968 353.43289445249684) rotate(0 68.41211460905242 31.137503778101063)"><path d="M15.57 0 C45.46 -0.3, 79.26 1.61, 121.26 0 M15.57 0 C52.93 -0.65, 89.68 0.48, 121.26 0 M121.26 0 C133.36 -1.69, 137.1 6.36, 136.82 15.57 M121.26 0 C132.89 -1.08, 137.69 4.45, 136.82 15.57 M136.82 15.57 C136.52 23.03, 138.51 32.16, 136.82 46.71 M136.82 15.57 C136.35 21.61, 137.61 27.67, 136.82 46.71 M136.82 46.71 C138.62 59.04, 133.14 60.95, 121.26 62.28 M136.82 46.71 C138.58 58.63, 132.72 60.79, 121.26 62.28 M121.26 62.28 C83.47 61.52, 48.14 61.71, 15.57 62.28 M121.26 62.28 C83.84 61, 48.9 62.33, 15.57 62.28 M15.57 62.28 C5.13 61.4, -1.77 57.57, 0 46.71 M15.57 62.28 C5.87 63.34, 0.28 57.09, 0 46.71 M0 46.71 C0.01 34.17, 0.69 23.82, 0 15.57 M0 46.71 C-0.55 38.95, 0.03 30.97, 0 15.57 M0 15.57 C0.31 4.2, 5.09 1.13, 15.57 0 M0 15.57 C-1.95 4.6, 5.64 -0.17, 15.57 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(962.7815166452492 364.5703982305979) rotate(0 48.65234375 20)"><text x="48.65234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Reconciliation </text><text x="48.65234375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Worker</text></g><g mask="url(#mask-4bfrAexKA1t8pUb_4z1eP)" stroke-linecap="round"><g transform="translate(1016.5189570472016 349.2031513794809) rotate(0 -69.74586110485126 -22.80028455212073)"><path d="M0.99 0.66 C-6.6 -6.8, -22.21 -36.21, -45.65 -44.09 C-69.09 -51.98, -123.84 -46.45, -139.66 -46.65 M0.04 -0.04 C-7.71 -7.38, -23.35 -35.05, -46.78 -42.69 C-70.2 -50.33, -124.83 -45.66, -140.52 -45.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1016.5189570472016 349.2031513794809) rotate(0 -69.74586110485126 -22.80028455212073)"><path d="M-112.63 -56.95 C-119.47 -54.13, -128.99 -50.66, -140.52 -45.89 M-112.63 -56.95 C-117.79 -55.38, -124.44 -51.6, -140.52 -45.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1016.5189570472016 349.2031513794809) rotate(0 -69.74586110485126 -22.80028455212073)"><path d="M-112.04 -36.44 C-119.16 -39.49, -128.85 -41.91, -140.52 -45.89 M-112.04 -36.44 C-117.14 -39.22, -123.91 -39.8, -140.52 -45.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-4bfrAexKA1t8pUb_4z1eP"><rect x="0" y="0" fill="#fff" width="1256.010679256904" height="494.8037204837224"></rect><rect x="917.2455978010958" y="285.370733243793" fill="#000" width="107.9375" height="40" opacity="1"></rect></mask><g transform="translate(917.2455978010958 285.370733243793) rotate(0 29.507992137593533 39.98800042064113)"><text x="53.96875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">potentially fix </text><text x="53.96875" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">incorrect records</text></g><g stroke-linecap="round"><g transform="translate(1065.9007462062182 505.00405759083515) rotate(0 31.93939204423691 -60.94305661582939)"><path d="M-0.17 -1.05 C10.36 -9.64, 58.47 -31.45, 62.81 -51.76 C67.14 -72.07, 32.15 -111.33, 25.85 -122.9 M-1.72 1.01 C9.2 -7.93, 60.4 -33.2, 64.95 -53.72 C69.51 -74.24, 32.23 -110.51, 25.63 -122.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1065.9007462062182 505.00405759083515) rotate(0 31.93939204423691 -60.94305661582939)"><path d="M50.92 -105.98 C42.34 -112.18, 37.73 -113.04, 25.63 -122.12 M50.92 -105.98 C45.99 -109.78, 40.38 -113.1, 25.63 -122.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1065.9007462062182 505.00405759083515) rotate(0 31.93939204423691 -60.94305661582939)"><path d="M34.63 -93.5 C30.49 -103.06, 30.31 -107.31, 25.63 -122.12 M34.63 -93.5 C33.2 -100.08, 31.09 -106.09, 25.63 -122.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Reconciliation</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This essentially combines our two solutions, real-time stream processing and periodic batch processing, to ensure that our data is not only fast but also accurate.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-how-can-we-prevent-abuse-from-users-clicking-on-ads-multiple-times">3) How can we prevent abuse from users clicking on ads multiple times?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While modern systems have advanced fraud detection systems, which we have considered out of scope, we still want to come up with a way to enforce ad click idempotency. ie. if a user clicks on an ad multiple times, we only count it as one click.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's breakdown a couple of ways to do this:</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Add userId To Click Event Payload</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-5">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One simple way to do this is requiring users to be logged in before they can see an ad. This method logs their userId, which would be extracted from the JWT token or session cookie, alongside the click data. We could then dedup our clicks based on the combination of userId and adId.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Importantly, the dedupping would need to be done before the click data is put into the stream. This is because we need to dedup across aggregation windows. If a duplicate click comes in on either side of a minute boundary, it will be counted as two clicks.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-5">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach has some serious limitations. First, it requires that all users are logged in, which may not always be the case (granted, this is a product decision to discuss with your interviewer). Second, it makes sure that we count only one click for any given user clicking on any given ad, but this would not actually be what we want.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Consider retargeting, where we intentionally show the same ad to the same user multiple times over an extended period. We need to amend our problem statement to say that we only count one click per user per ad <em>instance</em>. This is a subtle but important distinction, and our current solution does not account for it.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Generate a Unique impression ID</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-6">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The better approach is to have the Ad Placement Service generate a unique impression ID for each ad instance shown to the user. This impression ID would be sent to the browser along with the ad and will serve as an idempotency key. When the user clicks on the ad, the browser sends the impression ID along with the click data. This way we can dedup clicks based on the impression ID.</div><div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">What is an Impression?</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">An ad impression is a metric that represents the display of an ad on a web page. It is counted when the ad is fetched from its source and displayed on the user's screen. If we showed the same user the same ad multiple times in multiple places, then each of these placements is a new impression.</div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="but-how-do-we-dedup">But how do we dedup?</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We won't be able to do this easily in Flink because we need to dedup across aggregation windows. If a duplicate click comes in on either side of a minute boundary, it will be counted as two clicks. Instead, we should dedup <em>before</em> we put the click in the stream. When a click comes in, we check if the impression ID exists in a cache. If it does, then its a duplicate and we ignore it. If it doesn't, then we put the click in the stream and add the impression ID to the cache.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach is good, but it introduced a new problem. Now, a malicious user could send a bunch of fake clicks with falsified impression IDs. Because they'd all be unique, our current solution would count them all. To solve this, we can sign the impression ID with a secret key before sending it to the browser. When the click comes in, we can verify the signature to ensure the impression ID is valid before checking the cache.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's recap:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Ad Placement Service generates a unique impression ID for each ad instance shown to the user.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The impression ID is signed with a secret key and sent to the browser along with the ad.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When the user clicks on the ad, the browser sends the impression ID along with the click data.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Click Processor verifies the signature of the impression ID.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Click Processor checks if the impression ID exists in a cache. If it does, then it's a duplicate, and we ignore it. If it doesn't, then we put the click in the stream and add the impression ID to the cache.</div></li>
</ol><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-6">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This solution is not without its challenges. We've added complexity, and the cache could potentially become a bottleneck if not properly scaled. That said, it's worth noting that the cache data should be relatively small. With 100 million per day, if these were all unique impressions, then that's only 100 million * 16 bytes (128 bits) = 1.6 GB. Tiny.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Regardless, we can easily play it safe by using a distributed cache like Redis Cluster or Memcached to scale. In the event the cache goes down, we would handle this by having a replica of the cache that could take over and by enabling cache persistence so the cache data is not lost.</div></div></div></div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="4-how-can-we-ensure-that-advertisers-can-query-metrics-at-low-latency">4) How can we ensure that advertisers can query metrics at low latency?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This was largely solved by the pre-processing of the data in real-time. Whether using the "good" solution with periodic batch processing or the "great" solution with real-time stream processing, the data is already aggregated and stored in the OLAP database making the queries fast.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Where this query can still be slow is when we are aggregating over larger time windows, like a days, weeks, or even years. In this case, we can pre-aggregate the data in the OLAP database. This can be done by creating a new table that stores the aggregated data at a higher level of granularity, like daily or weekly. This can be via a nighly cron job that runs a query to aggregate the data and store it in the new table. When an advertiser queries the data, they can query the pre-aggregated table for the higher level of granularity and then drill down to the lower level of granularity if needed.</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Pre-aggregating the data in the OLAP database is a common technique to improve query performance. It can be thought of similar to a form of caching. We are trading off storage space for query performance for the most common queries.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="final-design">Final Design</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Putting it all together, one final design could look like this:</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1213.9192344114304 682.1096014240266">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1213.9192344114304" height="682.1096014240266" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(399.1152757098577 383.00692392068686) rotate(0 64.1640625 42.67578125)"><path d="M21.34 0 C50.64 -2.65, 80.88 1.23, 106.99 0 M21.34 0 C44.23 -0.77, 69.04 0.01, 106.99 0 M106.99 0 C120.93 -0.21, 127.22 7.7, 128.33 21.34 M106.99 0 C119.92 -0.54, 126.94 5.78, 128.33 21.34 M128.33 21.34 C128.65 36.47, 128.76 49.34, 128.33 64.01 M128.33 21.34 C127.84 35.78, 127.14 52.05, 128.33 64.01 M128.33 64.01 C129.01 76.84, 120.51 86.74, 106.99 85.35 M128.33 64.01 C130.45 79.8, 121.49 86.54, 106.99 85.35 M106.99 85.35 C80.94 85.2, 53.51 86.54, 21.34 85.35 M106.99 85.35 C72.42 84.78, 38.87 84.93, 21.34 85.35 M21.34 85.35 C7.08 85.12, 1.42 80.24, 0 64.01 M21.34 85.35 C5.53 83.95, -1.53 80.01, 0 64.01 M0 64.01 C-1.8 51.96, -0.4 38.81, 0 21.34 M0 64.01 C-0.19 55.32, 1.34 47.41, 0 21.34 M0 21.34 C-1.74 8.71, 8.56 -0.43, 21.34 0 M0 21.34 C1.91 7.13, 9.02 2.09, 21.34 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(412.8418382098577 415.68270517068686) rotate(0 50.4375 10)"><text x="50.4375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Click Processor</text></g><g stroke-linecap="round"><g transform="translate(539.6814270275969 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M0.52 -0.13 C4.75 -0.13, 20.91 -0.13, 24.82 -0.22 M0.12 -0.68 C4.36 -0.82, 20.45 -1.17, 24.61 -1.09" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.6814270275969 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M13.18 3.13 C15.34 2.71, 17.98 0.92, 24.61 -1.09 M13.18 3.13 C15.99 2.02, 18.73 1.08, 24.61 -1.09" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(539.6814270275969 423.7170963345252) rotate(0 12.189072306922242 -0.19957899977089255)"><path d="M13.14 -5.21 C15.29 -3.95, 17.94 -4.07, 24.61 -1.09 M13.14 -5.21 C15.98 -4.23, 18.73 -3.07, 24.61 -1.09" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(573.7238890737023 404.7372919106974) rotate(0 79.8203125 18.873046875)"><path d="M9.44 0 C65.63 -2.62, 119.54 -0.26, 150.2 0 M9.44 0 C55.21 0.44, 101.54 -0.08, 150.2 0 M150.2 0 C155.29 -1.16, 159.99 4.58, 159.64 9.44 M150.2 0 C158.49 0.01, 161.45 3.29, 159.64 9.44 M159.64 9.44 C159.49 15.42, 157.93 20.59, 159.64 28.31 M159.64 9.44 C159.37 15.56, 160.58 21, 159.64 28.31 M159.64 28.31 C159.88 35.63, 156.74 39.09, 150.2 37.75 M159.64 28.31 C161.32 35.41, 155.6 37.79, 150.2 37.75 M150.2 37.75 C103.35 34.62, 57.21 34.84, 9.44 37.75 M150.2 37.75 C110.67 38.58, 69.02 36.98, 9.44 37.75 M9.44 37.75 C1.82 39.28, -0.13 34.38, 0 28.31 M9.44 37.75 C5.04 35.62, 0.55 34.08, 0 28.31 M0 28.31 C-1.36 21.72, 0.37 19.07, 0 9.44 M0 28.31 C0.85 20.58, 0.95 13.26, 0 9.44 M0 9.44 C1.66 4.96, 1.85 -0.4, 9.44 0 M0 9.44 C0.55 1.84, 2.07 1.13, 9.44 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(629.5442015737023 413.6103387856974) rotate(0 24 10)"><text x="24" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Kinesis</text></g><g stroke-linecap="round"><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M0.24 0.16 C4.25 0.11, 19.79 -0.47, 23.66 -0.56 M-0.31 -0.23 C3.66 -0.17, 19.31 0.29, 23.18 0.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M12.04 4.2 C14.74 3.17, 17.01 2.01, 23.18 0.11 M12.04 4.2 C15.54 2.7, 19.44 1.74, 23.18 0.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(743.891857823702 418.69016807719254) rotate(0 11.866442510026047 -0.2482063744369043)"><path d="M12.02 -3.91 C14.7 -3.11, 16.98 -2.45, 23.18 0.11 M12.02 -3.91 C15.51 -2.75, 19.41 -1.04, 23.18 0.11" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(776.9805580283177 382.42148804048793) rotate(0 40.23065809100831 37.686811470070325)"><path d="M18.84 0 C33.3 -1.05, 48.77 -1.07, 61.62 0 M18.84 0 C30.86 0.96, 43.39 0.25, 61.62 0 M61.62 0 C75.76 0.12, 81.35 7.5, 80.46 18.84 M61.62 0 C73.01 -0.33, 79.83 4.05, 80.46 18.84 M80.46 18.84 C79.02 25.78, 81.81 35.97, 80.46 56.53 M80.46 18.84 C80.63 33.38, 81.24 46.93, 80.46 56.53 M80.46 56.53 C79.69 69.13, 74.74 77.23, 61.62 75.37 M80.46 56.53 C78.32 68.35, 72.08 74.7, 61.62 75.37 M61.62 75.37 C51.99 76.79, 44.81 73.99, 18.84 75.37 M61.62 75.37 C51.33 75.59, 41.99 74.78, 18.84 75.37 M18.84 75.37 C6.76 74.92, -0.14 67.22, 0 56.53 M18.84 75.37 C4.24 73.5, -1.3 69.32, 0 56.53 M0 56.53 C1.23 43.04, -0.81 28.31, 0 18.84 M0 56.53 C-0.96 44.99, -0.07 33.29, 0 18.84 M0 18.84 C-0.93 7.27, 5.13 -1.68, 18.84 0 M0 18.84 C-1.76 5.43, 4.85 -0.84, 18.84 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(800.316684869326 410.10829951055825) rotate(0 16.89453125 10)"><text x="16.89453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Flink</text></g><g stroke-linecap="round"><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M-0.68 -0.28 C-0.63 -9.44, -0.62 -45.84, -0.42 -54.64 M1.17 -1.47 C1.66 -10.52, 2.13 -44.55, 1.92 -53.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M11.19 -28.14 C8.39 -35.59, 5.43 -40.22, 1.92 -53.47 M11.19 -28.14 C8.31 -37.49, 4.52 -46.36, 1.92 -53.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(815.8469398933811 378.1458039556828) rotate(0 0.15276288302800367 -26.974080749090263)"><path d="M-7.26 -28.1 C-5.56 -35.45, -4.01 -40.1, 1.92 -53.47 M-7.26 -28.1 C-3.28 -37.47, -0.22 -46.35, 1.92 -53.47" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(755.9615482746752 203.30074160587537) rotate(0 62.92936798114465 59.195253689893434)"><path d="M68.49 1.02 C77.69 0.85, 88.75 5.11, 97.04 9.86 C105.34 14.6, 113.51 21.64, 118.28 29.5 C123.06 37.35, 125.63 47.92, 125.68 57 C125.74 66.09, 122.84 75.66, 118.6 84.02 C114.36 92.38, 108.02 101.58, 100.23 107.14 C92.44 112.69, 81.33 115.85, 71.83 117.34 C62.33 118.84, 52.22 119.01, 43.23 116.12 C34.23 113.22, 24.61 106.78, 17.88 99.98 C11.15 93.19, 5.5 84.06, 2.86 75.34 C0.23 66.61, 0.05 56.68, 2.05 47.63 C4.05 38.57, 8.74 28.14, 14.85 21.01 C20.97 13.88, 29.17 8.41, 38.74 4.84 C48.31 1.27, 66.45 0.21, 72.26 -0.4 C78.08 -1, 73.96 0.21, 73.62 1.2 M59.57 1.64 C68.57 0.04, 78.56 0.44, 87.15 4.06 C95.73 7.68, 104.84 16.09, 111.08 23.38 C117.32 30.66, 122.39 39.19, 124.62 47.77 C126.84 56.35, 127.16 66.1, 124.43 74.85 C121.7 83.61, 115.27 93.75, 108.23 100.29 C101.18 106.84, 91.7 111.46, 82.15 114.12 C72.59 116.79, 60.6 117.61, 50.87 116.3 C41.14 115, 31.04 111.44, 23.77 106.31 C16.5 101.17, 11.42 93.66, 7.25 85.51 C3.09 77.36, -1.65 66.87, -1.22 57.41 C-0.79 47.95, 4.45 36.85, 9.84 28.75 C15.22 20.66, 22.76 13.4, 31.08 8.86 C39.4 4.32, 55.32 2.81, 59.75 1.51 C64.17 0.2, 57.69 0.41, 57.62 1.03" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(784.8892271705689 252.63862999758715) rotate(0 34.00390625 10)"><text x="34.00390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">OLAP DB</text></g><g stroke-linecap="round" transform="translate(741.4214316464712 10) rotate(0 77.5434786312237 35.58840984914019)"><path d="M17.79 0 C55.77 0.54, 93.85 -0.15, 137.29 0 M17.79 0 C60.66 -0.8, 103.11 0.06, 137.29 0 M137.29 0 C149.84 -1.4, 154.38 7.32, 155.09 17.79 M137.29 0 C151.28 1.56, 155.36 7.12, 155.09 17.79 M155.09 17.79 C156.03 28.14, 155.36 40.6, 155.09 53.38 M155.09 17.79 C153.85 31.49, 153.95 45.62, 155.09 53.38 M155.09 53.38 C155.05 65.02, 150.58 73.17, 137.29 71.18 M155.09 53.38 C153.5 63.84, 147.63 72.95, 137.29 71.18 M137.29 71.18 C100.36 72.64, 66.67 72.02, 17.79 71.18 M137.29 71.18 C112.1 70.3, 88.99 71.19, 17.79 71.18 M17.79 71.18 C4.2 72.78, 1.45 64.81, 0 53.38 M17.79 71.18 C7.84 71.2, 1.91 67.33, 0 53.38 M0 53.38 C-1.07 44.09, 1.06 35.51, 0 17.79 M0 53.38 C-0.35 45.33, 0.6 38.99, 0 17.79 M0 17.79 C1.19 4.18, 5.32 -0.81, 17.79 0 M0 17.79 C0.23 5.1, 6.48 1.59, 17.79 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(764.9727227776949 35.58840984914019) rotate(0 53.9921875 10)"><text x="53.9921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analyst Browser</text></g><g stroke-linecap="round" transform="translate(768.8739438395813 116.90008943763041) rotate(0 51.13453969928662 25)"><path d="M12.5 0 C42.99 -1.36, 70.76 -0.89, 89.77 0 M12.5 0 C28.53 -0.62, 43.53 0.78, 89.77 0 M89.77 0 C99.95 1.36, 102.51 5.2, 102.27 12.5 M89.77 0 C98.39 1.55, 103.95 4.98, 102.27 12.5 M102.27 12.5 C104.13 17.17, 101.63 23.74, 102.27 37.5 M102.27 12.5 C102.05 19.16, 102.78 27.04, 102.27 37.5 M102.27 37.5 C100.89 44.61, 96.77 51.54, 89.77 50 M102.27 37.5 C102.12 45.57, 99.99 47.88, 89.77 50 M89.77 50 C62.87 48.17, 38.1 48.82, 12.5 50 M89.77 50 C64.95 51.56, 42.59 50.55, 12.5 50 M12.5 50 C5.83 50.02, 1.66 47.65, 0 37.5 M12.5 50 C2.67 49.54, 0.55 44.53, 0 37.5 M0 37.5 C-1.8 29.64, -0.87 23.59, 0 12.5 M0 37.5 C0.51 30.04, -0.39 23.93, 0 12.5 M0 12.5 C0.2 3.45, 4.64 1.39, 12.5 0 M0 12.5 C0.99 3.99, 3.89 1.76, 12.5 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(787.348327288868 121.90008943763041) rotate(0 32.66015625 20)"><text x="32.66015625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Analytics </text><text x="32.66015625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-0.15 -0.53 C-0.2 3.36, -0.62 19.37, -0.57 23.28 M0.77 0.38 C0.91 4.37, 0.53 20.12, 0.39 23.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M-3.29 12.88 C-2.95 15.07, -1.53 18.6, 0.39 23.95 M-3.29 12.88 C-2.19 15.61, -1.58 18.1, 0.39 23.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(821.0983029640064 86.79278662922206) rotate(0 -0.018329159458971844 11.669999486472648)"><path d="M4.69 13.1 C3.05 15.23, 2.48 18.7, 0.39 23.95 M4.69 13.1 C3.95 15.81, 2.73 18.26, 0.39 23.95" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-0.54 -0.06 C-0.61 3.75, -0.51 18.47, -0.58 22.33 M0.19 -0.56 C0.08 3.35, -0.65 19.04, -0.92 22.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M-4.2 11.95 C-3.42 15.13, -2.86 17.7, -0.92 22.83 M-4.2 11.95 C-2.91 16.11, -1.69 20.17, -0.92 22.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(819.1912276012039 171.91437360933196) rotate(0 -0.38601381970147486 11.359815943839294)"><path d="M3.56 12.39 C2.23 15.41, 0.67 17.86, -0.92 22.83 M3.56 12.39 C1.99 16.41, 0.33 20.31, -0.92 22.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(334.9506027334896 135.07889785719908) rotate(0 65.490234375 47.623046875)"><path d="M23.81 0 C39.31 -0.99, 59 1.56, 107.17 0 M23.81 0 C54.61 0.24, 85.88 -0.08, 107.17 0 M107.17 0 C122.27 0.03, 131.55 9.8, 130.98 23.81 M107.17 0 C120.91 -0.74, 128.88 7.27, 130.98 23.81 M130.98 23.81 C130.69 35.7, 132.91 43.37, 130.98 71.43 M130.98 23.81 C130.6 35.08, 131.49 45.66, 130.98 71.43 M130.98 71.43 C131.46 86.86, 122.9 93.37, 107.17 95.25 M130.98 71.43 C128.94 85.44, 121.74 95.48, 107.17 95.25 M107.17 95.25 C75.73 95.97, 40.65 96.18, 23.81 95.25 M107.17 95.25 C81.44 95.8, 57.25 95.43, 23.81 95.25 M23.81 95.25 C7 96.23, -1.15 85.63, 0 71.43 M23.81 95.25 C6.18 94.39, -1.43 86.47, 0 71.43 M0 71.43 C-2.22 54.98, -1.28 39.95, 0 23.81 M0 71.43 C0.32 58.79, -0.23 47.06, 0 23.81 M0 23.81 C1.26 8.84, 9.04 1.08, 23.81 0 M0 23.81 C-1.67 8.95, 6.09 -0.1, 23.81 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(353.3431808584896 162.70194473219908) rotate(0 47.09765625 20)"><text x="47.09765625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad Placement </text><text x="47.09765625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(559.7126283454214 118.64664689480651) rotate(0 72.69127211417481 70.84147595836083)"><path d="M77.71 0.86 C87.72 0.29, 99.37 3.66, 108.44 8.58 C117.51 13.49, 126 22.06, 132.15 30.34 C138.3 38.63, 143.66 48.4, 145.33 58.3 C147 68.21, 145.3 79.94, 142.14 89.79 C138.99 99.65, 133.43 109.68, 126.42 117.44 C119.42 125.2, 109.82 132.23, 100.12 136.37 C90.42 140.51, 78.54 142.99, 68.23 142.27 C57.93 141.54, 47.56 137.25, 38.29 132.03 C29.03 126.81, 18.73 119.23, 12.64 110.96 C6.55 102.68, 3.39 92.25, 1.75 82.39 C0.11 72.53, 0.14 61.59, 2.8 51.8 C5.47 42.02, 10.73 31.44, 17.75 23.68 C24.76 15.92, 32.93 8.96, 44.9 5.22 C56.87 1.49, 80.06 0.92, 89.56 1.27 C99.06 1.62, 102.03 5.87, 101.91 7.32 M108.24 8.15 C117.98 11.63, 126.56 20.66, 132.76 29.24 C138.96 37.81, 143.96 49.55, 145.46 59.58 C146.97 69.61, 144.73 79.91, 141.78 89.41 C138.83 98.92, 134.65 108.73, 127.77 116.62 C120.9 124.5, 110.41 132.78, 100.54 136.73 C90.67 140.69, 79.12 141.03, 68.54 140.35 C57.97 139.67, 46.34 137.39, 37.08 132.65 C27.81 127.91, 18.84 119.86, 12.93 111.91 C7.03 103.96, 3.22 95.16, 1.65 84.95 C0.09 74.74, 0.88 60.88, 3.52 50.66 C6.16 40.43, 10.71 31.19, 17.51 23.61 C24.3 16.02, 34.49 8.9, 44.3 5.15 C54.1 1.4, 65.75 0.58, 76.34 1.11 C86.92 1.65, 102.81 6.73, 107.81 8.36 C112.8 9.98, 106.81 9.7, 106.29 10.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(609.6127840145866 179.39563481374663) rotate(0 22.890625 9.999999999999986)"><text x="22.890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ad DB</text></g><g transform="translate(568.1314907011639 18.796790023960966) rotate(0 60.903953552246094 40)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Advertisement:</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- RedirectUrl</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- ... metadata </text></g><g stroke-linecap="round"><g transform="translate(478.62803611134007 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M0.88 0.42 C13.08 0.23, 61.15 -0.4, 73.36 -0.35 M-0.12 -0.4 C11.87 -0.46, 59.88 1.3, 72.17 1.2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.62803611134007 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M28.94 -10.19 C20.95 -7.44, 11.51 -2.79, 0.88 0.42 M28.94 -10.19 C16.9 -6.4, 5.98 -2.08, 0.88 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.62803611134007 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M29.19 10.33 C20.99 6.67, 11.47 4.91, 0.88 0.42 M29.19 10.33 C17.25 6.06, 6.23 2.31, 0.88 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.62803611134007 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M43.81 10.99 C53.31 6.95, 61.5 5.23, 72.17 1.2 M43.81 10.99 C54.13 6.94, 65.39 3.25, 72.17 1.2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(478.62803611134007 193.80088796116706) rotate(0 36.91240173703113 -0.18481720816680536)"><path d="M44.15 -9.53 C53.68 -7.16, 61.76 -2.47, 72.17 1.2 M44.15 -9.53 C54.15 -5.51, 65.27 -1.15, 72.17 1.2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(900.3971322767742 165.16319025809753) rotate(0 76.64793395996094 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Aggregated Data</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdId</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- AdvertiserId (PK)</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Minute (SK)</text><text x="0" y="80" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Click Count</text></g><g transform="translate(410.4193573604496 314.0709607156632) rotate(0 183.97589111328125 30)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Both Kinesis and Flink partition by AdId with</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">   celebrity solution for hot shards</text><text x="0" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- 7 day retention period on Kinesis</text></g><g stroke-linecap="round" transform="translate(199.26532885268892 170.00189876250442) rotate(0 41.82508274689235 135.50951017640364)"><path d="M20.91 0 C34 -1.43, 47.79 -1.21, 62.74 0 M20.91 0 C33.58 1.05, 44.14 -0.56, 62.74 0 M62.74 0 C75.35 1.54, 83.52 6.75, 83.65 20.91 M62.74 0 C78.57 -2.12, 84.2 6.45, 83.65 20.91 M83.65 20.91 C80.43 87.09, 81.99 156.83, 83.65 250.11 M83.65 20.91 C82.57 112.13, 82.66 203.73, 83.65 250.11 M83.65 250.11 C85.31 265.86, 75.38 270.62, 62.74 271.02 M83.65 250.11 C84.2 262.74, 75.61 272.15, 62.74 271.02 M62.74 271.02 C51.85 269.45, 41.71 271.35, 20.91 271.02 M62.74 271.02 C45.74 270.25, 29.46 270.29, 20.91 271.02 M20.91 271.02 C7.45 272.4, 0.86 263.9, 0 250.11 M20.91 271.02 C6.69 272.78, 1.45 265.09, 0 250.11 M0 250.11 C-0.3 167.4, -1.12 86.46, 0 20.91 M0 250.11 C-1.78 161.83, -2.13 74.54, 0 20.91 M0 20.91 C-1.55 5.49, 8.43 -1.67, 20.91 0 M0 20.91 C1.37 8.97, 7.18 0.94, 20.91 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(205.75447409958127 285.51140893890806) rotate(0 35.3359375 20)"><text x="35.3359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">LB &amp; API </text><text x="35.3359375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Gateway</text></g><g stroke-linecap="round" transform="translate(10 259.64809044298363) rotate(0 55.986328125 44.6328125)"><path d="M22.32 0 C36.1 0.5, 50.22 1.96, 89.66 0 M22.32 0 C48.58 1.18, 76.11 0.3, 89.66 0 M89.66 0 C106.18 -1.85, 112.45 6.99, 111.97 22.32 M89.66 0 C104.37 -2.16, 109.93 5.57, 111.97 22.32 M111.97 22.32 C113.99 31.45, 113.62 45.5, 111.97 66.95 M111.97 22.32 C113.17 35.65, 111.69 46.96, 111.97 66.95 M111.97 66.95 C112.45 80.69, 103.6 90.25, 89.66 89.27 M111.97 66.95 C110.65 79.9, 102.78 88.41, 89.66 89.27 M89.66 89.27 C75.63 90.68, 55.89 88.87, 22.32 89.27 M89.66 89.27 C72.42 89.72, 55.13 88.95, 22.32 89.27 M22.32 89.27 C7.2 90.8, 1.26 82.73, 0 66.95 M22.32 89.27 C8.7 90.5, -1.67 82.83, 0 66.95 M0 66.95 C1.67 58.72, -1.55 46.77, 0 22.32 M0 66.95 C-0.46 55.97, 1.04 45.64, 0 22.32 M0 22.32 C1.19 9.17, 7.62 0.81, 22.32 0 M0 22.32 C2.23 7.45, 8.38 1.33, 22.32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(38.880859375 294.28090294298363) rotate(0 27.10546875 10)"><text x="27.10546875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Browser</text></g><g stroke-linecap="round"><g transform="translate(134.9927141946137 303.97266727642545) rotate(0 28.493545973935483 0.11173916449297394)"><path d="M0.85 1.2 C10.22 1.14, 46.94 -0.5, 56.16 -0.51 M-0.16 0.78 C9.59 0.87, 48.63 0.89, 58.44 0.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.9927141946137 303.97266727642545) rotate(0 28.493545973935483 0.11173916449297394)"><path d="M27.29 -9.42 C21.39 -7.44, 10.29 -4.23, 0.85 1.2 M27.29 -9.42 C18.14 -6.37, 7.59 -1.67, 0.85 1.2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.9927141946137 303.97266727642545) rotate(0 28.493545973935483 0.11173916449297394)"><path d="M27.93 10.06 C21.86 6.23, 10.57 3.64, 0.85 1.2 M27.93 10.06 C18.55 5.77, 7.76 3.12, 0.85 1.2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.9927141946137 303.97266727642545) rotate(0 28.493545973935483 0.11173916449297394)"><path d="M31.76 10.67 C41.73 6.11, 46.47 3.17, 58.44 0.65 M31.76 10.67 C42.65 6, 52.11 2.92, 58.44 0.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.9927141946137 303.97266727642545) rotate(0 28.493545973935483 0.11173916449297394)"><path d="M31.56 -8.82 C41.56 -7.57, 46.36 -4.69, 58.44 0.65 M31.56 -8.82 C42.51 -6.15, 52.05 -1.88, 58.44 0.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(295.213602149306 365.1145452262963) rotate(0 48.97119861655193 29.936599059514265)"><path d="M-0.83 -0.73 C15.22 9.2, 80.7 50.72, 97.15 60.8 M0.94 1.5 C17.3 11.61, 83.42 49.24, 99.44 59.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 365.1145452262963) rotate(0 48.97119861655193 29.936599059514265)"><path d="M28.5 5.6 C16.34 1.72, 8.21 0.57, -0.83 -0.73 M28.5 5.6 C20.22 3.27, 11.44 0.73, -0.83 -0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 365.1145452262963) rotate(0 48.97119861655193 29.936599059514265)"><path d="M17.57 22.97 C9.29 12.72, 5.22 5.13, -0.83 -0.73 M17.57 22.97 C12.3 15.73, 6.68 8.17, -0.83 -0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 365.1145452262963) rotate(0 48.97119861655193 29.936599059514265)"><path d="M69.95 53.65 C79.73 54.57, 93.43 57.81, 99.44 59.16 M69.95 53.65 C78.75 55.29, 86.95 56.17, 99.44 59.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(295.213602149306 365.1145452262963) rotate(0 48.97119861655193 29.936599059514265)"><path d="M80.39 35.99 C86.47 43.39, 96.29 53.18, 99.44 59.16 M80.39 35.99 C86.32 42.63, 91.51 48.6, 99.44 59.16" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(290.44346373588587 231.76087386033032) rotate(0 17.104613218133522 -21.37302857672921)"><path d="M-0.8 0.92 C5.03 -6.1, 28.13 -35.42, 34.13 -42.88 M0.99 0.36 C6.72 -6.41, 27.48 -34.17, 33.14 -41.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.76087386033032) rotate(0 17.104613218133522 -21.37302857672921)"><path d="M7.93 -25.02 C7.29 -19.21, 3.51 -11.45, -0.8 0.92 M7.93 -25.02 C6.11 -20.59, 3.48 -15.08, -0.8 0.92" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.76087386033032) rotate(0 17.104613218133522 -21.37302857672921)"><path d="M22.57 -13.34 C18.62 -10.33, 11.46 -5.26, -0.8 0.92 M22.57 -13.34 C17.68 -11.37, 12.01 -8.29, -0.8 0.92" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.76087386033032) rotate(0 17.104613218133522 -21.37302857672921)"><path d="M24.97 -15.29 C28.55 -21.4, 28.68 -25.66, 33.14 -41.41 M24.97 -15.29 C26.53 -21.63, 27.41 -26.93, 33.14 -41.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(290.44346373588587 231.76087386033032) rotate(0 17.104613218133522 -21.37302857672921)"><path d="M10.09 -26.66 C17.04 -30.04, 20.61 -31.68, 33.14 -41.41 M10.09 -26.66 C14.77 -30.61, 18.74 -33.55, 33.14 -41.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(736.9681749175398 447.3291240580256) rotate(0 18.929250724075928 25.420822374378076)"><path d="M-0.08 -0.14 C6.53 8, 32.47 41.28, 38.85 49.73 M-1.58 -1.25 C5.03 6.91, 31.9 41.86, 38.41 50.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(736.9681749175398 447.3291240580256) rotate(0 18.929250724075928 25.420822374378076)"><path d="M13.23 34.39 C19.01 39.86, 23.27 42.5, 38.41 50.69 M13.23 34.39 C19.31 38.34, 26.63 43.77, 38.41 50.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(736.9681749175398 447.3291240580256) rotate(0 18.929250724075928 25.420822374378076)"><path d="M29.59 22.01 C31.65 30.36, 32.09 35.89, 38.41 50.69 M29.59 22.01 C31.13 29.24, 33.9 38.11, 38.41 50.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(752.235753241834 493.6851907923183) rotate(0 65.60316897266057 63.5)"><path d="M72.46 -0.44 C82.06 -0.34, 93.41 4.73, 101.96 10.61 C110.51 16.5, 118.7 26.2, 123.74 34.86 C128.78 43.51, 132.06 52.72, 132.19 62.52 C132.33 72.32, 129.45 84.63, 124.55 93.63 C119.64 102.63, 111.23 110.91, 102.75 116.53 C94.26 122.15, 83.53 126.4, 73.63 127.35 C63.73 128.31, 52.9 125.83, 43.36 122.26 C33.81 118.69, 23.37 113.25, 16.38 105.93 C9.38 98.61, 3.7 88.02, 1.37 78.34 C-0.97 68.66, 0 57.44, 2.37 47.84 C4.74 38.23, 9 28.09, 15.58 20.71 C22.16 13.33, 31.94 6.82, 41.86 3.54 C51.78 0.27, 69.04 1.16, 75.11 1.05 C81.18 0.94, 78.54 1.96, 78.29 2.9 M52.78 2.33 C62.13 -0.39, 74.77 -0.37, 84.45 2.38 C94.12 5.12, 103.44 11.88, 110.83 18.82 C118.21 25.76, 125.37 34.75, 128.76 44.02 C132.15 53.29, 133.15 64.73, 131.19 74.44 C129.23 84.14, 123.43 94.54, 116.99 102.26 C110.56 109.98, 101.71 116.46, 92.57 120.78 C83.44 125.1, 71.93 128.76, 62.17 128.19 C52.41 127.62, 42.77 122.64, 34.03 117.35 C25.3 112.05, 15.57 104.61, 9.76 96.43 C3.95 88.25, 0.12 78.08, -0.83 68.27 C-1.78 58.45, -0.27 46.74, 4.06 37.55 C8.4 28.35, 16.95 18.92, 25.16 13.1 C33.37 7.27, 48.7 4.25, 53.31 2.6 C57.93 0.94, 52.51 2.33, 52.82 3.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(781.9543828165994 537.2839101869725) rotate(0 35.99609375 20)"><text x="35.99609375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Raw Click </text><text x="35.99609375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Data (s3)</text></g><g stroke-linecap="round" transform="translate(969.4976419437265 457.75345636681686) rotate(0 40.84526841546733 107.17807252860484)"><path d="M20.42 0 C31.77 -1.75, 45.25 -1.1, 61.27 0 M20.42 0 C32.22 0.4, 46.47 -0.62, 61.27 0 M61.27 0 C76.54 0.02, 83.35 8.62, 81.69 20.42 M61.27 0 C73.39 -0.46, 82.24 5.5, 81.69 20.42 M81.69 20.42 C80.87 62.85, 81.8 107.09, 81.69 193.93 M81.69 20.42 C82.85 65.24, 81.95 111.4, 81.69 193.93 M81.69 193.93 C81.89 206.83, 75.36 215.74, 61.27 214.36 M81.69 193.93 C82.68 207.37, 74.61 216.12, 61.27 214.36 M61.27 214.36 C47.51 213.13, 32.47 212.97, 20.42 214.36 M61.27 214.36 C49.97 213.91, 36.81 213.99, 20.42 214.36 M20.42 214.36 C5.41 213.82, -1.55 206.06, 0 193.93 M20.42 214.36 C8.49 212.44, 1.37 209.54, 0 193.93 M0 193.93 C-0.7 141.11, 0.45 84.66, 0 20.42 M0 193.93 C0.36 153.34, 0.58 114.02, 0 20.42 M0 20.42 C0.59 7.66, 8.03 0.91, 20.42 0 M0 20.42 C-1.29 7.25, 7.6 -1.62, 20.42 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(983.6905666091939 534.9315288954217) rotate(0 26.65234375 30)"><text x="26.65234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Spark</text><text x="26.65234375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(Map </text><text x="26.65234375" y="40" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Reduce)</text></g><g stroke-linecap="round" transform="translate(1113.5378410644794 594.5028790248243) rotate(0 45.190696673475486 19.707706582320498)"><path d="M9.85 0 C24.97 2.33, 41.66 -1.34, 80.53 0 M9.85 0 C37.54 0.16, 64.41 1.06, 80.53 0 M80.53 0 C85.8 -0.4, 90.86 2.15, 90.38 9.85 M80.53 0 C86.02 1.13, 89.06 1.35, 90.38 9.85 M90.38 9.85 C89.59 14.9, 92.26 19.84, 90.38 29.56 M90.38 9.85 C90.42 13.68, 90.56 18.91, 90.38 29.56 M90.38 29.56 C91.24 35.98, 86.86 40.95, 80.53 39.42 M90.38 29.56 C91.84 37.17, 88.36 40.65, 80.53 39.42 M80.53 39.42 C64.38 37.72, 50.06 40.42, 9.85 39.42 M80.53 39.42 C64.16 38.65, 48.42 38.17, 9.85 39.42 M9.85 39.42 C4.75 37.75, 1.19 37.86, 0 29.56 M9.85 39.42 C3.5 40.35, 2.23 36.14, 0 29.56 M0 29.56 C-1.52 22.31, -0.03 15.9, 0 9.85 M0 29.56 C0.27 25.91, 0.58 21.87, 0 9.85 M0 9.85 C-1.12 3.67, 3.97 -1.41, 9.85 0 M0 9.85 C0.11 3.09, 1.91 -1.82, 9.85 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1144.5136939879549 604.2105856071448) rotate(0 14.21484375 10)"><text x="14.21484375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">cron</text></g><g stroke-linecap="round"><g transform="translate(1101.6189950984212 614.342113802998) rotate(0 -17.663040992236347 0)"><path d="M-0.48 0.44 C-6.39 0.33, -29.2 -0.05, -34.93 -0.12 M0.28 0.19 C-5.71 0.39, -29.28 0.45, -35.16 0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1101.6189950984212 614.342113802998) rotate(0 -17.663040992236347 0)"><path d="M-18.6 -5.64 C-24.42 -2.63, -31.89 -0.1, -35.16 0.52 M-18.6 -5.64 C-23.84 -3.8, -28.43 -2.11, -35.16 0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1101.6189950984212 614.342113802998) rotate(0 -17.663040992236347 0)"><path d="M-18.52 6.45 C-24.43 4.66, -31.93 2.41, -35.16 0.52 M-18.52 6.45 C-23.83 4.65, -28.45 2.7, -35.16 0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(963.104774857144 565.1935453480737) rotate(0 -36.905232806046854 -1.4819644685528601)"><path d="M0.87 -0.26 C-11.1 -0.91, -60.53 -2.68, -72.82 -2.95 M-0.14 -1.44 C-12.08 -1.97, -61.09 -1.04, -73.24 -1.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(963.104774857144 565.1935453480737) rotate(0 -36.905232806046854 -1.4819644685528601)"><path d="M-45.02 -11.59 C-51.39 -7.56, -56.96 -5.39, -73.24 -1.41 M-45.02 -11.59 C-55.88 -8.24, -67.61 -3.2, -73.24 -1.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(963.104774857144 565.1935453480737) rotate(0 -36.905232806046854 -1.4819644685528601)"><path d="M-45.08 8.93 C-51.6 8.59, -57.16 6.38, -73.24 -1.41 M-45.08 8.93 C-55.78 4.27, -67.49 1.29, -73.24 -1.41" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(943.0217457861967 353.43289445249684) rotate(0 68.41211460905242 31.137503778101063)"><path d="M15.57 0 C54.93 0.78, 96.07 -2.18, 121.26 0 M15.57 0 C44.71 1.09, 74.21 -0.24, 121.26 0 M121.26 0 C130.11 -0.74, 135.58 4.46, 136.82 15.57 M121.26 0 C132.39 2.28, 138.19 3.17, 136.82 15.57 M136.82 15.57 C135.98 24.44, 138.08 33.21, 136.82 46.71 M136.82 15.57 C137.42 25.13, 137.34 34.32, 136.82 46.71 M136.82 46.71 C135.37 57.96, 130.03 62.19, 121.26 62.28 M136.82 46.71 C135.52 58.98, 133.44 60.47, 121.26 62.28 M121.26 62.28 C92.05 59.98, 62.42 62.99, 15.57 62.28 M121.26 62.28 C98.45 63.6, 76.43 63.2, 15.57 62.28 M15.57 62.28 C6.01 63.43, -1.99 55.66, 0 46.71 M15.57 62.28 C4.56 62.37, -0.26 54.93, 0 46.71 M0 46.71 C1.04 38.27, 1.1 26.25, 0 15.57 M0 46.71 C-0.06 36.69, -0.71 26.04, 0 15.57 M0 15.57 C-1.3 6.96, 5 -0.54, 15.57 0 M0 15.57 C0.25 3.19, 7.48 -0.87, 15.57 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(962.7815166452491 364.5703982305979) rotate(0 48.65234375 20)"><text x="48.65234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Reconciliation </text><text x="48.65234375" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Worker</text></g><g mask="url(#mask-cIBviLcM69faYZ7cpvyJU)" stroke-linecap="round"><g transform="translate(1016.5189570472015 349.2031513794809) rotate(0 -69.74586110485126 -22.80028455212073)"><path d="M-0.78 -0.24 C-8.45 -7.84, -21.81 -37.05, -45.02 -44.51 C-68.23 -51.98, -124.19 -44.66, -140.05 -45.01 M1.01 -1.41 C-6.88 -8.35, -22.13 -35.73, -45.81 -43.33 C-69.5 -50.94, -125.36 -46.59, -141.11 -47.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1016.5189570472015 349.2031513794809) rotate(0 -69.74586110485126 -22.80028455212073)"><path d="M-113.12 -57.84 C-124.14 -53.41, -135.59 -50.69, -141.11 -47.04 M-113.12 -57.84 C-123.72 -54.67, -133.36 -50.9, -141.11 -47.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1016.5189570472015 349.2031513794809) rotate(0 -69.74586110485126 -22.80028455212073)"><path d="M-112.73 -37.32 C-124.08 -40.75, -135.69 -45.88, -141.11 -47.04 M-112.73 -37.32 C-123.35 -41.32, -133.12 -44.72, -141.11 -47.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-cIBviLcM69faYZ7cpvyJU"><rect x="0" y="0" fill="#fff" width="1256.010679256904" height="494.8037204837224"></rect><rect x="917.2455978010956" y="285.370733243793" fill="#000" width="107.9375" height="40" opacity="1"></rect></mask><g transform="translate(917.2455978010956 285.370733243793) rotate(0 29.223157335992255 39.772061903917404)"><text x="53.96875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">potentially fix </text><text x="53.96875" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">incorrect records</text></g><g stroke-linecap="round"><g transform="translate(1065.9007462062182 505.00405759083606) rotate(0 31.93939204423691 -60.94305661582939)"><path d="M-0.56 0.59 C9.92 -8.14, 59.11 -32.58, 63.19 -53.07 C67.26 -73.55, 30.41 -110.79, 23.89 -122.33 M1.35 -0.14 C12.2 -8.7, 61.38 -31.87, 65.54 -52.06 C69.7 -72.24, 33.24 -109.68, 26.3 -121.25" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1065.9007462062182 505.00405759083606) rotate(0 31.93939204423691 -60.94305661582939)"><path d="M51.52 -105 C44.43 -111.53, 33.6 -117.17, 26.3 -121.25 M51.52 -105 C45.32 -108.37, 38.96 -114.51, 26.3 -121.25" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1065.9007462062182 505.00405759083606) rotate(0 31.93939204423691 -60.94305661582939)"><path d="M35.18 -92.59 C33.45 -103.06, 27.91 -112.73, 26.3 -121.25 M35.18 -92.59 C33.35 -99.16, 31.29 -108.56, 26.3 -121.25" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(305.95404368295556 261.4841331209627) rotate(0 39.46268808342085 36.73294215164606)"><path d="M24.38 2.98 C31.22 0.17, 42.65 0.05, 50.07 1.7 C57.48 3.35, 64.13 7.42, 68.86 12.86 C73.59 18.3, 77.82 27.06, 78.43 34.34 C79.04 41.61, 76.46 50.34, 72.53 56.49 C68.61 62.64, 62 68.62, 54.88 71.25 C47.75 73.87, 37.26 73.96, 29.77 72.24 C22.29 70.52, 14.83 66.34, 9.96 60.93 C5.08 55.52, 1.11 47.19, 0.54 39.78 C-0.02 32.37, 2.2 22.9, 6.57 16.49 C10.94 10.07, 23.16 3.76, 26.74 1.3 C30.32 -1.16, 27.79 0.91, 28.07 1.75 M23.34 2.38 C29.8 -0.69, 39.67 -1.63, 47.54 -0.09 C55.42 1.45, 65.23 5.77, 70.59 11.65 C75.95 17.53, 79.26 27.7, 79.7 35.18 C80.14 42.67, 77.18 50.65, 73.23 56.56 C69.28 62.48, 63.05 67.9, 55.99 70.69 C48.92 73.48, 38.84 75.18, 30.83 73.31 C22.83 71.45, 13.13 65.1, 7.94 59.49 C2.76 53.88, 0.09 46.88, -0.29 39.65 C-0.67 32.42, 1.52 22.4, 5.66 16.11 C9.8 9.81, 21.3 3.87, 24.55 1.87 C27.8 -0.13, 24.76 3.27, 25.14 4.1" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(325.52411616873997 288.2429627842467) rotate(0 19.98828125 10)"><text x="19.98828125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Cache</text></g><g stroke-linecap="round"><g transform="translate(395.81497062238793 396.0777279535314) rotate(0 -19.584364980351637 -25.12215906602796)"><path d="M-0.75 -0.44 C-7.06 -8.54, -32.49 -40.58, -38.78 -49.06 M1.06 -1.72 C-5.29 -10.08, -32.87 -42.42, -39.52 -50.55" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(395.81497062238793 396.0777279535314) rotate(0 -19.584364980351637 -25.12215906602796)"><path d="M-26.24 -16.26 C-21.33 -11.91, -12.92 -7.84, -0.75 -0.44 M-26.24 -16.26 C-20.77 -13.16, -15.22 -8.74, -0.75 -0.44" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(395.81497062238793 396.0777279535314) rotate(0 -19.584364980351637 -25.12215906602796)"><path d="M-10.11 -28.94 C-8.85 -21.86, -4.05 -14.95, -0.75 -0.44 M-10.11 -28.94 C-8.11 -23.21, -5.98 -16.11, -0.75 -0.44" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(395.81497062238793 396.0777279535314) rotate(0 -19.584364980351637 -25.12215906602796)"><path d="M-13.56 -35.51 C-20.04 -38.38, -23.13 -41.2, -39.52 -50.55 M-13.56 -35.51 C-18.93 -39.17, -24.3 -41.31, -39.52 -50.55" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(395.81497062238793 396.0777279535314) rotate(0 -19.584364980351637 -25.12215906602796)"><path d="M-29.31 -22.34 C-32.22 -28.06, -31.79 -33.83, -39.52 -50.55 M-29.31 -22.34 C-31.29 -28.74, -33.32 -33.67, -39.52 -50.55" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(222.6058638160497 81.28368931132354) rotate(0 154.46392822265625 20)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- generate ad impression id as</text><text x="0" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">    idempotency key and store in cache</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Final Design</span></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="what-is-expected-at-each-level"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/blog/the-system-design-interview-what-is-expected-at-each-level" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">What is Expected at Each Level?</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Ok, that was a lot. You may be thinking, ‚Äúhow much of that is actually required from me in an interview?‚Äù Let‚Äôs break it down.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="mid-level">Mid-level</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Breadth vs. Depth:</strong> A mid-level candidate will be mostly focused on breadth (80% vs 20%). You should be able to craft a high-level design that meets the functional requirements you've defined, but many of the components will be abstractions with which you only have surface-level familiarity.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Probing the Basics:</strong> Your interviewer will spend some time probing the basics to confirm that you know what each component in your system does. For example, if you add an API Gateway, expect that they may ask you what it does and how it works (at a high level). In short, the interviewer is not taking anything for granted with respect to your knowledge.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Mixture of Driving and Taking the Backseat:</strong> You should drive the early stages of the interview in particular, but the interviewer doesn‚Äôt expect that you are able to proactively recognize problems in your design with high precision. Because of this, it‚Äôs reasonable that they will take over and drive the later stages of the interview while probing your design.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Ad Click Aggregator:</strong> For this question, I expect a proficient E4 candidate to understand the need for pre-aggregating the data and to at least propose a batch processing solution. They should be able to problem-solve effectively when faced with my probing inquiries about idempotency or database choices.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="senior">Senior</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Depth of Expertise</strong>: As a senior candidate, expectations shift towards more in-depth knowledge ‚Äî about 60% breadth and 40% depth. This means you should be able to go into technical details in areas where you have hands-on experience. It's crucial that you demonstrate a deep understanding of key concepts and technologies relevant to the task at hand.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design</strong>: You should be familiar with advanced system design principles. For example, knowing how a batch processing job would use map reduce or understanding how Flink real-time processing works at a high level.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Articulating Architectural Decisions</strong>: You should be able to clearly articulate the pros and cons of different architectural choices, especially how they impact scalability, performance, and maintainability. You justify your decisions and explain the trade-offs involved in your design choices.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Problem-Solving and Proactivity</strong>: You should demonstrate strong problem-solving skills and a proactive approach. This includes anticipating potential challenges in your designs and suggesting improvements. You need to be adept at identifying and addressing bottlenecks, optimizing performance, and ensuring system reliability.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Ad Click Aggregator:</strong> For this question, E5 candidates are expected to speed through the initial high level design so you can spend time discussing, in detail, optimizations for scaling the system, reducing the latency between click and query, and ensuring the system is fault-tolerant. You should be able to discuss the trade-offs between different technologies and justify your choices, understanding why you would favor one technology over another. Ideally, a senior candidate recognizes the need for real-time processing and can contrast it with batch processing, but they may not be able to propose a fully fault-tolerant solution and would not have gone into the full depth that we went into above. Instead, they would have chosen a couple of instances from the above deep dives to focus on.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="staff">Staff+</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Emphasis on Depth</strong>: As a staff+ candidate, the expectation is a deep dive into the nuances of system design ‚Äî I'm looking for about 40% breadth and 60% depth in your understanding. This level is all about demonstrating that, while you may not have solved this particular problem before, you have solved enough problems in the real world to be able to confidently design a solution backed by your experience.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You should know which technologies to use, not just in theory but in practice, and be able to draw from your past experiences to explain how they‚Äôd be applied to solve specific problems effectively. The interviewer knows you know the small stuff (REST API, data normalization, etc) so you can breeze through that at a high level so you have time to get into what is interesting.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>High Degree of Proactivity</strong>: At this level, an exceptional degree of proactivity is expected. You should be able to identify and solve issues independently, demonstrating a strong ability to recognize and address the core challenges in system design. This involves not just responding to problems as they arise but anticipating them and implementing preemptive solutions. Your interviewer should intervene only to focus, not to steer.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Practical Application of Technology</strong>: You should be well-versed in the practical application of various technologies. Your experience should guide the conversation, showing a clear understanding of how different tools and systems can be configured in real-world scenarios to meet specific requirements.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Complex Problem-Solving and Decision-Making</strong>: Your problem-solving skills should be top-notch. This means not only being able to tackle complex technical challenges but also making informed decisions that consider various factors such as scalability, performance, reliability, and maintenance.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design and Scalability</strong>: Your approach to system design should be advanced, focusing on scalability and reliability, especially under high load conditions. This includes a thorough understanding of distributed systems, load balancing, caching strategies, and other advanced concepts necessary for building robust, scalable systems.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Ad Click Aggregator:</strong> For a staff+ candidate, expectations are high regarding depth and quality of solutions, particularly for the complex scenarios discussed above. I expect a staff candidate to clearly weigh the trade offs between batch processing and real-time processing, and to be able to discuss the implications of each choice in detail. They should be able to propose a fault-tolerant solution and discuss the trade-offs involved in different database choices. They should also be able to discuss the implications of different data storage strategies and how they would impact the system's performance and scalability. While they may not choose the same 4 deep dives we did above, they should be able to drive deep into the areas they've chosen and, in the ideal case, teach the interviewer something new about the topic based on their experience.</div>
</body>
</html>
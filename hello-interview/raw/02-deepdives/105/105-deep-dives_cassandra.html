<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cassandra Deep Dive for System Design Interviews</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Deep Dives</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Cassandra</h1><p class="MuiTypography-root MuiTypography-body2 mui-45a2r">Learn how to use Cassandra in a wide variety of system design settings.</p></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="intro">Intro</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Databases are a fundamental and core aspect of system design, and one of the most versatile / popular databases to have in your toolbox is <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/_/index.html" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Cassandra</a>. Cassandra was originally built by Facebook to support its rapidly scaling inbox search feature. Since then, Cassandra has been adopted by <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/_/case-studies.html" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">countless companies</a> to rapidly scale data storage, throughput, and readback. From Discord (explored later in this post), to Netflix, to Apple, to Bloomberg, Cassandra is a NoSQL database that is here to stay, used by a wide array of firms for a large set of use-cases.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Apache Cassandra is an open-source, distributed NoSQL database. It implements a partitioned wide-column storage model with eventually consistent semantics. It is a distributed database that runs in a cluster and can horizontally scale via commodity hardware. It combines elements of Dynamo (see our write-up on <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/deep-dives/dynamodb" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">DynamoDB</a>) and <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://static.googleusercontent.com/media/research.google.com/en//archive/bigtable-osdi06.pdf" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Bigtable</a> to handle massive data footprints, query volume, and flexible storage requirements.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In this deep dive, we'll break down the features of Cassandra that make it attractive as a database, especially for system design. We'll discuss the most important internals of Cassandra to demystify how it provides said features. Finally, we'll discuss when and how to use Cassandra. Let's go!</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="cassandra-basics">Cassandra Basics</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's start by understanding a bit about the basics.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="data-model">Data Model</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra has a set of basic data definitions that define how store and interact with data.</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Keyspace</strong> - Keyspaces are basically data containers, and can be likened to "databases" in relational systems like Postgres or MySQL. They contain many tables. They are also responsible for owning configuration information about the tables. For example, keyspaces have a configured replication strategy (discussed later) for managing data redundancy / availability. The keyspace also owns any user-defined-types (UDTs) you might make to support your use-case.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Table</strong> - A table is container for your data, in the form of rows. It has a name and contains configuration information about the data that is stored within it.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Row</strong> - A row is a container for data. It is represented by a primary key and contains columns.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Column</strong> - A column contains data belonging to a row. A column is represented by a name, a type, and a value corresponding to the value of that column for a row. Not all columns need to be specified per row in a Cassandra table; Cassandra is a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.scylladb.com/glossary/wide-column-database/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">wide-column database</a> so the specified columns can vary per row in a table, making Cassandra more flexible than something like a relational database, which requires an entry for every column per row (even if that entry is <span class="MuiBox-root mui-1vu004u">NULL</span>). Additionally, every column has timestamp metadata associated with it, denoting when it was written. When a column has a write conflict between replicas, it is resolved via "last write wins".</div></li>
</ul>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/7cbaeb89277750f28a5aeab41ca80871"></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">At the most basic level, you can liken Cassandra's data structures to a large JSON.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>  </span><span class="token" style="color: rgb(228, 86, 73);">"keyspace1"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"table1"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>      </span><span class="token" style="color: rgb(228, 86, 73);">"row1"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>        </span><span class="token" style="color: rgb(228, 86, 73);">"col1"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">1</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>        </span><span class="token" style="color: rgb(228, 86, 73);">"col2"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"2"</span><span>
</span><span>      </span><span class="token" style="color: rgb(56, 58, 66);">}</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>      </span><span class="token" style="color: rgb(228, 86, 73);">"row2"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>        </span><span class="token" style="color: rgb(228, 86, 73);">"col1"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">10</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>        </span><span class="token" style="color: rgb(228, 86, 73);">"col3"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">3.0</span><span>
</span><span>      </span><span class="token" style="color: rgb(56, 58, 66);">}</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>      </span><span class="token" style="color: rgb(228, 86, 73);">"row3"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>        </span><span class="token" style="color: rgb(228, 86, 73);">"col4"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>          </span><span class="token" style="color: rgb(228, 86, 73);">"company"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"Hello Interview"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>          </span><span class="token" style="color: rgb(228, 86, 73);">"city"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"Seattle"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>          </span><span class="token" style="color: rgb(228, 86, 73);">"state"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"WA"</span><span>
</span><span>        </span><span class="token" style="color: rgb(56, 58, 66);">}</span><span>
</span><span>      </span><span class="token" style="color: rgb(56, 58, 66);">}</span><span>
</span><span>    </span><span class="token" style="color: rgb(56, 58, 66);">}</span><span>
</span><span>  </span><span class="token" style="color: rgb(56, 58, 66);">}</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Of note, Cassandra columns support a plethora of <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/doc/stable/cassandra/cql/types.html" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">types</a>, including user-defined types and <span class="MuiBox-root mui-1vu004u">JSON</span> values. This makes Cassandra very flexible as a data store for both flat and nested data.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="primary-key">Primary Key</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One of the most important constructs in Cassandra is the "primary key" of a table. Every row is represented uniquely by a primary key. A primary key consists of one or more partition keys and may include clustering keys. Let's break down what these terms mean.</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Partition Key</strong> - One or more columns that are used to determine what partition the row is in. We'll discuss partitioning of data later in this deep-dive.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Clustering Key</strong> - Zero or more columns that are used to determine the sorted order of rows in a table. Data ordering is important depending on one's data modeling needs, so Cassandra gives users control over this via the clustering keys.</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When you create a table in Cassandra via the Cassandra Query Language (CQL) dialect, you specify the primary key as part of defining the schema. Below are a few examples of different primary keys with comments inlined:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- Primary key with partition key a, no clustering keys</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> t </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span><span>
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- Primary key with partition key a, clustering key b ascending</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> t </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">WITH</span><span> CLUSTERING </span><span class="token" style="color: rgb(166, 38, 164);">ORDER</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">BY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>b </span><span class="token" style="color: rgb(166, 38, 164);">ASC</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span><span>
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- Primary key with composite partition key a + b, clustering key c</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> t </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> d </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span><span>
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- Primary key with partition key a, clustering keys b + c</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> t </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> d </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span><span>
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- Primary key with partition key a, clustering keys b + c (alternative syntax)</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> t </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> d </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>a</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> b</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> c</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The primary key concept and its subcomponents might remind you of DynamoDB's <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/deep-dives/dynamodb#partition-key-and-sort-key" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">primary key definition</a>. This concept is basically shared 1:1 between the 2 databases.</div></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="key-concepts">Key Concepts</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When introducing Cassandra in a system design interview, you're going to want to know more than just how to use it. You'll want to be able to explain how it works in case your interviewer asks pointed or questions, or you might want to deep dive into data storage specifics, scalability, query efficiency, etc., all of which deeply affect your design. In this section, we dive into the essential details of Cassandra to give you this context.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="partitioning">Partitioning</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One of the most fundamental aspects of Cassandra is its partitioning scheme for data. Cassandra's partitioning techniques are extremely robust and worth understanding generally for system design in case you want to employ them in other areas of your designs (caching, load balancing, etc.).</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra achieves horizontal scalability by partitioning data across many nodes in its cluster. In order to partition data successfully, Cassandra makes use of <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Consistent_hashing" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">consistent hashing</a>. Consistent hashing is a fundamental technique used in distributed systems to partition data / load across machines in a way that prioritizes evenness of distribution while minimizing re-mapping of data if a node enters or leaves the system.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In a traditional hashing scheme, a number of nodes is chosen and a node is determined to store a value based on the following calculation: <span class="MuiBox-root mui-1vu004u">hash(value) % num_nodes</span>. This certainly allocates values to nodes, but there's 2 problems:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">If the number of buckets changes (node added or removed), then a lot of values will be assigned new nodes. In a distributed system like a database, this would mean that data would have to move between nodes in excess.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">If you're unlucky with your hashing scheme, there might be a lot of values that get hashed to the same node, resulting in uneven load between nodes.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To improve on this design, consistent hashing prefers a different approach.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Rather than hashing a value and running a modulo to select a node, consistent hashing hashes a value to a range of integers that are visualized on a ring. This ring has nodes mapping to specific values. When a value is hashed, it is hashed to an integer. The ring is then walked clockwise to find the first value corresponding to a node. The value is then stored on that node.</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/24054a9b753c1089c79054fd3e9bf38c"></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This design prevents excess re-mapping of values if a node enters or leaves the system because it will affect one adjacent node. If a node enters, it re-maps some values from the node ahead of it when moving clockwise on the ring. If a node exits, values from the node exiting re-map to the node ahead of it when moving clockwise on the ring.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">However, this design doesn't address the issue of uneven load between nodes. To address this, Cassandra opts to map multiple nodes on the ring to physical nodes in the distributed system. The nodes on the ring are called <span class="MuiBox-root mui-1vu004u">vnodes</span> (a.k.a. virtual nodes) are owned by physical nodes. This distributes load over the cluster more evenly. It also allows for the system to take advantage of the resources of different physical nodes; some physical nodes might be bigger machines with more resources, so they can be responsible for more <span class="MuiBox-root mui-1vu004u">vnodes</span>. Below is how the cluster might look, with values, called "tokens" (<span class="MuiBox-root mui-1vu004u">t1</span>, <span class="MuiBox-root mui-1vu004u">t2</span>, etc.), represented on the ring, <span class="MuiBox-root mui-1vu004u">vnodes</span> mapped to those tokens, and different physical nodes represented by the colors of the <span class="MuiBox-root mui-1vu004u">vnodes</span>.</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/c4bd45f5434459f5eb5733247f257e24"></div></div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="replication">Replication</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In Cassandra, partitions of data are replicated to nodes on the ring, enabling it to skew extremely available for system designs that rely on that feature. Keyspaces have replication configurations specified and this affects the way Cassandra replicates data.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">At a high level, Cassandra chooses what nodes to replicate data to by scanning clockwise from the <span class="MuiBox-root mui-1vu004u">vnode</span> that corresponds to hashed value in a consistent hashing scheme. For example, if Cassandra is trying to replicate data to 3 nodes, it will hash a value to a node and scan clockwise to find 2 additional <span class="MuiBox-root mui-1vu004u">vnodes</span> to serve as replicas. Of note, Cassandra skips any <span class="MuiBox-root mui-1vu004u">vnodes</span> that are on the same physical node as <span class="MuiBox-root mui-1vu004u">vnodes</span> already in the replica set so that several replicas aren't down when a single physical node goes down.</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/17c41cc975d5bb0fb9580262539dae2f"></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra has two different "replication strategies" it can employ: <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/doc/latest/cassandra/architecture/dynamo.html#network-topology-strategy" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;"><span class="MuiBox-root mui-1vu004u">NetworkTopologyStrategy</span></a> and <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/doc/latest/cassandra/architecture/dynamo.html#simple-strategy" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;"><span class="MuiBox-root mui-1vu004u">SimpleStrategy</span></a>.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><span class="MuiBox-root mui-1vu004u">NetworkTopologyStrategy</span> is the strategy recommended for production and is data center / rack aware so that data replicas are stored across potentially many data centers in case of an outage. It also allows for replicas to be stored on distinct racks in case a rack in a data center goes down. The main goal with this configuration is to establish enough physical separate of replicas to avoid many replicas being affected by a real world outage / incident.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><span class="MuiBox-root mui-1vu004u">SimpleStrategy</span> is a simpler strategy, merely determining replicas via scanning clockwise (this is the one we discussed above). It is useful for simple deployments and testing.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Below is Cassandra CQL for specifying different replication strategy configurations for a keyspace:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- 3 replicas</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">ALTER</span><span> KEYSPACE hello_interview </span><span class="token" style="color: rgb(166, 38, 164);">WITH</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">REPLICATION</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> { </span><span class="token" style="color: rgb(80, 161, 79);">'class'</span><span> : </span><span class="token" style="color: rgb(80, 161, 79);">'SimpleStrategy'</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">'replication_factor'</span><span> : </span><span class="token" style="color: rgb(183, 107, 1);">3</span><span> }</span><span class="token" style="color: rgb(56, 58, 66);">;</span><span>
</span>
<span></span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- 3 replicas in data center 1, 2 replicas in data center 2</span><span>
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">ALTER</span><span> KEYSPACE hello_interview </span><span class="token" style="color: rgb(166, 38, 164);">WITH</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">REPLICATION</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> {</span><span class="token" style="color: rgb(80, 161, 79);">'class'</span><span> : </span><span class="token" style="color: rgb(80, 161, 79);">'NetworkTopologyStrategy'</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">'dc1'</span><span> : </span><span class="token" style="color: rgb(183, 107, 1);">3</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">'dc2'</span><span> : </span><span class="token" style="color: rgb(183, 107, 1);">2</span><span>}</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="consistency">Consistency</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Like any distributed system, Cassandra is subject to the <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.geeksforgeeks.org/the-cap-theorem-in-dbms/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">CAP Theorem</a>. Cassandra gives users flexibility over consistency settings for reads / writes, which allows Cassandra users to "tune" their consistency vs. availability trade-off. Given that every system design involves some degree of CAP theorem analysis / trade-off, it's important to understand the levers you have to pull with Cassandra.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Callout: Of note, Cassandra does not offer transaction support or any notion of ACID gurantees. It only supports atomic and isolated writes at the row level in a partition, but that's about it. You can read more about this <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://docs.datastax.com/en/cassandra-oss/2.2/cassandra/dml/dmlTransactionsDiffer.html" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">here</a>.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra allows you to choose from a list of "consistency levels" for reads and writes, which are required node response numbers for a write or a read to succeed. These enforce different consistency vs. availability behavior depending on the combination used. These range from <span class="MuiBox-root mui-1vu004u">ONE</span>, where a single replica needs to respond, to <span class="MuiBox-root mui-1vu004u">ALL</span>, where all replicas must respond. You can read more about the different consistency levels <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/doc/latest/cassandra/architecture/dynamo.html#tunable-consistency" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">here</a>.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One notable consistency level to understand is <span class="MuiBox-root mui-1vu004u">QUORUM</span>. <span class="MuiBox-root mui-1vu004u">QUORUM</span> requires a majority (<span class="MuiBox-root mui-1vu004u">n/2 + 1</span>) of replicas to respond. Applying <span class="MuiBox-root mui-1vu004u">QUORUM</span> to both reads and writes guarantees that writes are visible to reads because at least one overlapping node is guaranteed to participate in both a write and a read. To illustrate this, let's assume a set of 3 nodes. <span class="MuiBox-root mui-1vu004u">3/2 + 1 = 2</span>, so 2 of 3 nodes need to be written to and read from in order for writes and reads to succeed. This means that a write will always be seen by a read because at least 1 of those 2 nodes will have also seen the write.</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/4611cde4a57695e82c36f6814e773f6a"></div></div></div></div></div></div>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Typically, Cassandra aims for "eventual consistency" for all consistency levels, where all replicas have the latest data assuming enough time passes.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="query-routing">Query Routing</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Any Cassandra node can service a query from the client application because all nodes in Cassandra can assume the role of a query "coordinator". Nodes in Cassandra each know about other alive nodes in the cluster. They share cluster information via a protocol called "gossip" (discussed later). Nodes in Cassandra also are able to determine where data lives in the cluster via performing consistent hashing calculations and by knowing the replication strategy / consistency level configured for the data. When a client issues a query, it selects a node who becomes the coordinator, and the coordinator issues queries to nodes that store the data (a series of replicas).</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/32d9e2a16421ba4a50ccdf25b59a698f"></div></div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="storage-model">Storage Model</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra's storage model is important to understand because it is core to one of its strengths for system design: write throughput. Cassandra leverages a data structure called a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://hackernoon.com/how-cassandra-stores-data-an-exploration-of-log-structured-merge-trees" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Log Structured Merge Tree (LSM tree)</a> index to achieve this speed. The LSM tree is used in place of a B-tree, which is the index of choice for most databases (relational DBs, DynamoDB).</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Before diving into the details, it's important to clarify how Cassandra handles writes vs. other databases. Cassandra opts for an approach that favors write speed over read speed. Every create / update / delete is a new entry (with some exceptions). Cassandra uses the ordering of these updates to determine the "state" of a row. For example, if a row is created and then it is updated later, Cassandra will understand the state of the row by looking at the creation and then the update vs. looking at just a single row. The same goes for deletes, which can be thought of as "removal updates". Cassandra writes a "tombstone" entry for row deletions. The LSM tree enables Cassandra to efficiently understand the state of a row, while writing data to the database as almost entirely "append on" writes.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The 3 constructs core to the LSM tree index are:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Commit Log</strong> - This basically is a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Write-ahead_logging" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">write-ahead-log</a> to ensure durability of writes for Cassandra nodes.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Memtable</strong> - An in-memory, sorted data structure that stores write data. It is sorted by primary key of each row.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>SSTable</strong> - A.k.a. "Sorted String Table." Immutable file on disk containing data that was flushed from a previous Memtable.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With all these constructs working together, writes look like this:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">A write is issued for a node.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">That write is written to the commit log so it doesn't get lost if the node goes down while the write is being processed or if the data is only in the Memtable when the node goes down.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The write is written to the Memtable.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Eventually, the Memtable is flushed to disk as an immutable SSTable after some threshold size is hit or some period of time elapses.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When a Memtable is flushed, any commit log messages are removed that correspond to that Memtable, to save space. These are superfluous now that the Memtable is on disk as an SSTable that is immutable.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The below diagram illustrates the above steps:</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/e12286f3df71b453048634738c40a8ce"></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To summarize, a Memtable houses recent writes, consolidating writes for a keys into a single row, and is occasionally flushed to disk as an immutable SSTable. A commit log serves as a write-ahead-log to ensure data isn't lost if it is only in the Memtable and the node goes down.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When reading data for a particular key, Cassandra reads the Memtable first, which will have the latest data. If the Memtable does not have the data for the key, Cassandra leverages a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Bloom_filter" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">bloom filter</a> to determine which SSTables on disk might have the data. It then reads the SSTables in order from newest to oldest to find the latest data for the row. Of note, the data in SSTables is sorted by primary key, making it easy to find a particular key.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Building on the above foundation, there's 2 additional concepts to internalize:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Compaction</strong> - To prevent bloat of SSTables with many row updates / deletions, Cassandra will run compaction to consolidate data into a smaller set of SSTables, which reflect the consolidated state of data. Compaction also removes rows that were deleted, removing the tombstones that were previously present for that row. This process is particularly efficient because all of these tables are sorted.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>SSTable Indexing</strong> - Cassandra stores files that point to byte offsets in SSTable files to enable faster retrieval of data on-disk. For example, Cassandra might map a key of 12 to a byte offset of 984, meaning the data for key 12 is found at that offset in the SSTable. This is somewhat similar to how a B-tree might point to data on disk.</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To read more about LSM trees, check out <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://hackernoon.com/how-cassandra-stores-data-an-exploration-of-log-structured-merge-trees" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">this article</a>.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="gossip">Gossip</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra nodes communicate information throughout the cluster via "gossip", which is a peer-to-peer scheme for distributing information between nodes. Universal knowledge of the cluster makes every node aware and able to participate in all operations of the database, eliminating any single points of failure and allowing Cassandra to be a very reliable database for availability-skewing system designs. How does this work?</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Nodes track various information about the cluster, such as what nodes are alive / accessible, what the schema is, etc. They manage <span class="MuiBox-root mui-1vu004u">generation</span> and <span class="MuiBox-root mui-1vu004u">version</span> numbers for each node they know about. The <span class="MuiBox-root mui-1vu004u">generation</span> is a timestamp when the node was bootstrapped. The <span class="MuiBox-root mui-1vu004u">version</span> is a logical clock value that increments every ~second. Across the cluster, these values form a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Vector_clock" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">vector clock</a>. This vector clock allows nodes to ignore old cluster state information when it's received via gossip.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra nodes routinely pick other nodes to gossip with, with a probabilistic bias towards "seed" nodes. Seed nodes are designated by Cassandra to bootstrap the cluster and serve as guaranteed "hotspots" for gossip so all nodes are communicating across the cluster. By creating these "choke points," Cassandra eliminates the possibility that sub-clusters of nodes emerge because information happens to not reach the entire cluster. Of note, Cassandra ensures that seed nodes are always discoverable via off-the-shelf <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://middleware.io/blog/service-discovery/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">service discovery mechanisms</a>.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="fault-tolerance">Fault Tolerance</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In a distributed system like Cassandra, nodes fail, and Cassandra must efficiently detect and handle failures to ensure the database can write and read data efficiently. How is it able to achieve these requirements at scale?</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra leverages a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.computer.org/csdl/proceedings-article/srds/2004/22390066/12OmNvT2phv" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Phi Accrual Failure Detector</a> technique to detect failure during gossip; each node independently makes a decision on whether a node is available or not. When a node gossips with a node that doesn't respond, Cassandra's failure detection logic "convicts" that node and stops routing writes to it. The convicted node can re-enter the cluster when it starts heartbeating again. Of note, Cassandra will never consider a node truly "down" unless the Cassandra system administrator decommissions the node or rebuilds it. This is done to prevent intermittent communication failures / node restarts from causing the cluster to re-balance data.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In the presence of write attempts to nodes that are considered "offline", Cassandra leverages a technique called "hinted handoffs." When a node is considered offline by a coordinator node attempting to write to it, the coordinator temporarily stores the write data in order for the write to proceed. This temporary data is called a "hint." When the offline node is detected as online, the node (or nodes) with a hint sends that data to the previously-offline node. Below is how this looks in practice.</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/f3fdec3dfb9c97808ab5af988628552a"></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Of note, hinted handoffs are mostly used as a short term way to prevent a node that is offline from losing writes. Any node that is offline for a long time will either be rebuilt or undergo read repairs, as hints usually have a short lifespan.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="how-to-use-cassandra">How to use Cassandra</h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="data-modeling">Data Modeling</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When leveraging Cassandra in a system design, modeling your data to take advantage of its architecture and strengths is very important.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">If you come from a relational database world, Cassandra data modeling might feel a bit odd at first. Relational data modeling focuses on "normalized" data, where you have a one copy of each <em>entity</em> instance and you manage <em>relationships</em> between these entities via foreign keys and JOIN-tables. In short, modeling data for a relational database is <em>entity-relationship-driven</em>. However, Cassandra doesn't have a concept of foreign keys / referential integrity, JOINs, etc. Cassandra also doesn't favor normalization of data. Instead, data modeling for Cassandra is <em>query-driven</em>.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra's query efficiency is heavily tied to the way that data is stored. Cassandra also lacks the query flexibility of relational databases. It doesn't support JOINs and services single table queries. Therefore, when considering how to model the data of a Cassandra database, the "access patterns" of the application must be considered first and foremost. It also is important to understand what data is needed in each table, so that data can be "denormalized" (duplicated) across tables as necessary. The main areas to consider are:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Partition Key</strong> - What data determines the partition that the data is on.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Partition Size</strong> - How big a partition is in the most extreme case, whether partitions have the capacity to grow indefinitely, etc.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Clustering Key</strong> - How the data should be sorted (if at all).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Data Denormalization</strong> - Whether certain data needs to be denormalized across tables to support the app's queries.</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To drive home this point, it's helpful to go through some examples.</div>
<h4 class="MuiTypography-root MuiTypography-h5 mui-1jefea8" id="example-discord-messages">Example: Discord Messages</h4>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One of the best way to learn to use a tool like Cassandra is through a real-world example like Discord. Discord has shared a good summary of their use of Cassandra to store message data <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://discord.com/blog/how-discord-stores-billions-of-messages" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">via blog posts</a>, and it's a good model for how one might approach message storage for chat apps generally.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Discord channels can be quite busy with messages. Users typically query recent data given the fact that a channel is basically a big group chat. Users might query recent data and scroll a little bit, so having the data sorted in reverse chronological order makes sense.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To service the above needs, Discord originally opted to create a <span class="MuiBox-root mui-1vu004u">messages</span> table with the following schema:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> messages </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>
</span><span>  channel_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  message_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  author_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  content </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>channel_id</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> message_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">WITH</span><span> CLUSTERING </span><span class="token" style="color: rgb(166, 38, 164);">ORDER</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">BY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>message_id </span><span class="token" style="color: rgb(166, 38, 164);">DESC</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You might wonder why <span class="MuiBox-root mui-1vu004u">message_id</span> is used instead of a timestamp column like <span class="MuiBox-root mui-1vu004u">created_at</span>? Discord opted to eliminate the possibility of Cassandra primary key conflicts by assigning messages <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://blog.x.com/engineering/en_us/a/2010/announcing-snowflake" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Snowflake IDs</a>. A Snowflake ID is basically a chronologically sortable UUID. This is preferable to <span class="MuiBox-root mui-1vu004u">created_at</span> because a Snowflake ID collision is impossible (it's a UUID), wheras a timestamp, even with millisecond granularity, has a likelihood of collision.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The above schema enables Cassandra to service messages for a channel via <em>a single partition</em>. The partition key, <span class="MuiBox-root mui-1vu004u">channel_id</span>, ensures that a single partition is responsible for servicing the query, preventing the need to do a "scatter-gather" query across several nodes to get message data for a channel, which could be slow / resource intensive.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The above schema didn't fully meet Discord's needs, however. Some Discord channels can sometimes have an extremely high volume of messages. With the above schema, Discord noticed that Cassandra was struggling to handle large partitions corresponding to busy Discord channels. Large partitions in Cassandra typically hit performance problems, and this was exactly what Discord observed. Additionally, Discord channels can perpetually grow in size with message activity, and would eventually hit performance problems if they lived long enough. A modification to the schema was necessary.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To solve the large partition problem, Discord introduced the concept of a <span class="MuiBox-root mui-1vu004u">bucket</span> and add it to the partition key part of the Cassandra primary key. A <span class="MuiBox-root mui-1vu004u">bucket</span> represented 10 days of data, defined by a fixed window aligned to Discord's self-defined <span class="MuiBox-root mui-1vu004u">DISCORD_EPOCH</span> of January 1, 2015. The messages of even the most busy Discord channels over 10 days would certainly fit in a partition in Cassandra. This also solved the issue of partitions growing monotonically; over time, a new partition would be introduced because a new <span class="MuiBox-root mui-1vu004u">bucket</span> would be created. Finally, Discord could query a single partition to service writes most of the time, because the most recent messages of a channel would usually be in one bucket. The only time they weren't is when 1) a new bucket was created based on time passing, or 2) for inactive Discords, which were the significant minority of queries to the <span class="MuiBox-root mui-1vu004u">messages</span> Cassandra table.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The revised schema looks like this:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> messages </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>
</span><span>  channel_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  bucket </span><span class="token" style="color: rgb(166, 38, 164);">int</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  message_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  author_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  content </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>channel_id</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> bucket</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> message_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">)</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">WITH</span><span> CLUSTERING </span><span class="token" style="color: rgb(166, 38, 164);">ORDER</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">BY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>message_id </span><span class="token" style="color: rgb(166, 38, 164);">DESC</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Notably, Discord used its channel access patterns to dictate its schema design, a great example of <em>query-driven data modeling</em>. Their choice of their primary key, including both partition key and clustering key components, is strongly linked to how data is accessed for their app. Finally, they had to think about partition size when designing the schema. All these factors go into building a good Cassandra schema for system design generally.</div>
<h4 class="MuiTypography-root MuiTypography-h5 mui-1jefea8" id="example-ticketmaster">Example: Ticketmaster</h4>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's consider another example use-case for Cassandra: Ticketmaster's ticket browsing UI. This is the UI that shows an event venue's available seats, and allows a user to select seats and then enter a seat checkout and payment flow.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The Ticketmaster ticket browsing UI is a UI that doesn't need strict consistency. Event ticket availability changes, even as a user is viewing the UI. If a seat is selected and a purchase flow is attempted, the system can check a consistent database to determine if the seat is <em>actually</em> available. Additionally, always showing the browsing UI is important, as a majority of users will browse, but a minority of users will actually enter a checkout flow.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Callout: This example aims to be simple and focused on data modeling, so we gloss over the complexities that ridiculously popular events impose on the system (dubbed, <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.educative.io/blog/taylor-swift-ticketmaster-meltdown" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">"The Taylor Swift Problem"</a>).</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When considering how to model our data to support a ticket browsing UI, we might consider every seat in of an event a "ticket." If we think about the access patterns of our system, we uncover that users will query data for a single event at a time, and want to see totals of available seats and also the seats themselves. Users don't care about seeing the seats in any order, since they will have an event venue map that dictates how they see seat availability. Our first iteration of the schema might look like this:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> tickets </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>
</span><span>  event_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  seat_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  price </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- seat_id is added as a clustering key to ensure primary key uniqueness; order</span><span>
</span><span>  </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- doesn't matter for the app access patterns</span><span>
</span><span>  </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>event_id</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> seat_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With the above schema, the app can query a single partition to service queries about the event, given that the primary key has a partition key of <span class="MuiBox-root mui-1vu004u">event_id</span>. The app can query the partition for price information about the event, for ticket availability totals, etc.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This schema has problems, however. For events this 10,000+ tickets, the database needs to perform work to summarize information based on the user's query (price total, ticket total). Additionally, this work might be performed <em>a lot</em> for events that are very popular and have users frequently entering the ticket browsing UI. How might we resolve these problems?</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One of the hints for how we might improve our schema lies within the Ticketmaster ticket browsing UI user experience (UX). Consider the UX when a user starts browsing tickets. They see a venue map with sections. Each section might have a popover with high-level information about the ticket availability / price information for that section.</div>
<img loading="lazy" width="846" height="672" decoding="async" data-nimg="1" class="rounded-xl object-contain max-w-full" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcassandra-1.1bbeee9d.png&amp;w=1080&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcassandra-1.1bbeee9d.png&amp;w=1920&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcassandra-1.1bbeee9d.png&amp;w=1920&amp;q=75" style="color: transparent;">
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">If a user clicks into a section of interest, Ticketmaster's UI then shows the individual seats and ticket information.</div>
<img loading="lazy" width="1225" height="736" decoding="async" data-nimg="1" class="rounded-xl object-contain max-w-full" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcassandra-2.3ba7a114.png&amp;w=1920&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcassandra-2.3ba7a114.png&amp;w=3840&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcassandra-2.3ba7a114.png&amp;w=3840&amp;q=75" style="color: transparent;">
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This UX unveils that we can add the concept of <span class="MuiBox-root mui-1vu004u">section_id</span> to our <span class="MuiBox-root mui-1vu004u">tickets</span> table, and have the <span class="MuiBox-root mui-1vu004u">section_id</span> as part of the partition key. This means the <span class="MuiBox-root mui-1vu004u">tickets</span> table now services the query to view individual seat tickets for a given section. The new schema looks like this:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> tickets </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>
</span><span>  event_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  section_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  seat_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  price </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>event_id</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> section_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> seat_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The above schema is an improvement on our original schema. The schema distributes an event over several nodes in the Cassandra cluster, because each section of an event is in a different partition. It also means each partition is responsible for serving less data, because the number of tickets in a partition is lower. Finally, this schema better maps to the data needs / access patterns of the Ticketmaster ticket browsing UI.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You might ask: how do we now show ticket data for the entire event? To service the UI that shows all sections and high-level information about ticket availability / price, we can consider a separate table <span class="MuiBox-root mui-1vu004u">event_sections</span>.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> event_sections </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>
</span><span>  event_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  section_id </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  num_tickets </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  price_floor </span><span class="token" style="color: rgb(166, 38, 164);">bigint</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>  </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- section_id is added as a clustering key to ensure primary key uniqueness; order</span><span>
</span><span>  </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- doesn't matter for the app access patterns</span><span>
</span><span>  </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>event_id</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> section_id</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The above table represents the idea of "denormalizing" data in Cassandra. Rather than having our database do an aggregation on a table or query multiple tables / partitions to service an app, it's preferable to denormalize information like ticket numbers and a price floor in a section to make the access pattern for the app efficient. Additionally, the section stats being queried don't need to be extremely precise - there's tolerance eventual consistency. In fact, Ticketmaster doesn't even show exact ticket numbers in their UI, they merely show a total such as <span class="MuiBox-root mui-1vu004u">100+</span>.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The above table is partitioned by <span class="MuiBox-root mui-1vu004u">event_id</span>. Cassandra will be responsible for querying many sections in one query, but events have a low number of sections (usually &lt; 100) and this query will be served off a single partition. This means that Cassandra can efficiently query data to show the top-level venue view.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Generally, the above represents how an application's access patterns and UX have a heavy influence on how data is modeled in Cassandra.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="advanced-features">Advanced Features</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Beyond the fundamental use-cases of Cassandra, it's worthwhile to be aware of some of the advanced features at your disposal. Below is a shortlist of some of the major ones.</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Storage Attached Indexes (SAI)</strong> - SAIs are a newer feature in Cassandra that offer global secondary indexes on columns. They offer flexible querying of data with performance that is worse than traditional querying based off partition key, but is still good. These enable Cassandra users to avoid excess denormalizing of data if there's query patterns that are less frequent. Lower frequency queries typically don't warrant the overhead of a separate, denormalized table for data. You can read more about them <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/doc/latest/cassandra/developing/cql/indexing/sai/sai-concepts.html" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">here</a>.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Materialized Views</strong> - Materialized views are a way for a user to configure Cassandra to materialize tables based off a source table. They are have some overlap with <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.geeksforgeeks.org/sql-views/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">SQL views</a>, except they actually "materialize" a table, hence their name. This is convenient because as a user, you can get Cassandra to denormalize data automatically for you. This cuts complexity at your application level, as you don't need to author your application to write to multiple tables if data that is denormalized changes. You can read more about materialized views <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.geeksforgeeks.org/sql-views/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">here</a>.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Search Indexing</strong> - Cassandra can be wired up to a distributed search engine such as ElasticSearch or Apache Solr via different plugins. One example is the Stratio Lucene Index. You can read more about it <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://cassandra.apache.org/doc/latest/cassandra/integrating/plugins/index.html#stratios-cassandra-lucene-index" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">here</a>.</div></li>
</ul>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="cassandra-in-an-interview">Cassandra in an Interview</h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="when-to-use-it">When to use it</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra can be an awesome choice for systems that play to its strengths. Cassandra is a great choice in systems that prioritize availability over consistency and have high scalability needs. Cassandra can perform fast writes and reads at scale, but Cassandra is an especially good choice for systems with high write throughput, given its write-optimized storage layer based on LSM tree indexing. Additionally, Cassandra's wide-column design makes it a great choice as a database for flexible schemas or schemas that involve many columns that might be sparse. Finally, Cassandra succeeds when you have several clear access patterns for an application or use-case that the schema can revolve around.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="knowing-its-limitations">Knowing its limitations</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra isn't a great database choice for every system. Cassandra isn't good for designs that prioritize strict consistency, given it's heavy bias towards availability. Cassandra also isn't a good choice for systems that require advanced query patterns, such as multi-table JOINs, adhoc aggregations, etc.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="summary">Summary</h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Hopefully now you can see why Cassandra is a very versatile piece of technology for distributed systems. It has a great set of features, but isn't necessarily the database of choice for every system. When leveraging it, it's important to adopt a query-driven data modeling approach to maximize the value Cassandra delivers in terms of write/speeds and scalability. When digging into the details of a system design, having knowledge of Cassandra's internals plays a key role in your ability to use the database properly.</div>
</body>
</html>
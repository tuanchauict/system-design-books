<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Live Comments System Design Interview Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Common Problems</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Design Facebook Live Comments</h1></div><div class="flex flex-col md:flex-row gap-2 md:items-center justify-between"><div class="flex flex-col lg:flex-row gap-4 md:items-center"><a target="_blank" rel="noopener noreferrer" class="flex flex-row gap-2 items-center" href="https://www.linkedin.com/in/evan-king-40072280/" style="text-decoration: none;"><img class="rounded-full" src="https://hellointerview-files.s3.us-west-2.amazonaws.com/public-media/evan-headshot.png" alt="Evan King" width="40" height="40"><div class="flex flex-col"><div class="flex flex-row gap-2 items-center"><p class="MuiTypography-root MuiTypography-body2 mui-ltrqv0">Evan King</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeInherit mui-70s7oy" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></div><span class="MuiTypography-root MuiTypography-caption mui-1eozzb8">Ex-Meta Staff Engineer</span></div></a><div class="flex flex-row gap-4 md:gap-8 items-center"><div class="flex flex-row gap-1 items-center" aria-label="Difficulty"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-127w52h">hard</p></div><div class="flex flex-row gap-1 items-center" aria-label="Average time allowed in interview"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-1pb8xyp">35 min</p></div></div></div><a class="MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation mui-1c7cv5a" tabindex="0" href="/practice/system-design/start/fb-live-comments" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"></path></svg>Practice this problem<span class="MuiTouchRipple-root mui-w0pj6f"></span></a></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<div class="mb-4"><iframe class="w-full aspect-video" src="https://www.youtube.com/embed/LjLx0fCd1k8" title="System Design Interview: Design Live Comments w/ a Ex-Meta Staff Engineer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="understanding-the-problem">Understanding the Problem</h2>
<div class="my-6"><div class="MuiBox-root mui-1fz7ihe"><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>ðŸ“¹ What are Facebook Live Comments?</strong>
Facebook Live Comments is a feature that enables viewers to post comments on a live video feed. Viewers can see a continuous stream of comments in near-real-time.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#1-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Viewers can post comments on a Live video feed.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Viewers can see new comments being posted while they are watching the live video.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Viewers can see comments made before they joined the live feed.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope):</strong></div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Viewers can reply to comments</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Viewers can react to comments</div></li>
</ul>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="non-functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#2-non-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Non-Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should scale to support millions of concurrent videos and thousands of comments per second per live video.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should prioritize availability over consistency, eventual consistency is fine.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should have low latency, broadcasting comments to viewers in near-real time (&lt; 200ms)</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope):</strong></div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should be secure, ensuring that only authorized users can post comments.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should enforce integrity constraints, ensuring that comments are appropriate (ie. not spam, hate speech, etc.)</div></li>
</ul>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>ðŸ¤© Fun Fact!</strong>
Humans generally perceive interactions as real-time if they occur within 200 milliseconds. Any delay shorter than 200 milliseconds in a user interface is typically perceived as instantaneous so when developing real-time systems, this is the target latency to aim for.</div></div></div></div></div>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>ðŸ¤© Fun Fact!</strong>
The most popular Facebook Live video was called Chewbacca Mom which features a mom thoroughly enjoying a plastic, roaring Chewbacca mask. It has been viewed over 180 million times. Check it out <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.youtube.com/watch?v=y3yRv5Jg5TI" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">here</a>.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here's how your requirements section might look on your whiteboard:</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1134.6890829385923 295">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1134.6890829385923" height="295" fill="#ffffff"></rect><g transform="translate(10 10) rotate(0 291.52972412109375 137.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Functional Requirements</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">1. Viewers can post comments</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">2. Viewers can see all comments posted in near realtime</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">3. Viewers can see all comments posted before they joined.</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="150" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">---------------- Below the line -----------------</text><text x="0" y="175" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="200" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Viewers can reply to comments</text><text x="0" y="225" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Viewers can react to comments</text><text x="0" y="250" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g transform="translate(675.4694174112485 12.509977158173683) rotate(0 224.60983276367188 125)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Non-functional Requirements</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">1. Scale to millions of viewers per video</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">2. Availability &gt; consistency</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">3. Low latency comment broadcast (~200ms)</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="150" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">---------------- Below the line -----------------</text><text x="0" y="175" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text><text x="0" y="200" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Security</text><text x="0" y="225" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Integrity</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">FB Live Comments Requirements</span></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="the-set-up">The Set Up</h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="planning-the-approach">Planning the Approach</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Before you move on to designing the system, it's important to start by taking a moment to plan your strategy. Fortunately, for these common product style system design questions, the plan should be straightforward: build your design up sequentially, going one by one through your functional requirements. This will help you stay focused and ensure you don't get lost in the weeds as you go. Once you've satisfied the functional requirements, you'll rely on your non-functional requirements to guide you through layering on depth and complexity to your design.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="defining-the-core-entities"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#core-entities-2-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Defining the Core Entities</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">I like to begin with a broad overview of the primary entities. Initially, establishing these key entities will guide our thought process and lay a solid foundation as we progress towards defining the API. Think of these as the "nouns" of the system.</div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Why just the entities and not the whole data model at this point? The reality is we're too early in the design and likely can't accurately enumerate all the columns/fields yet. Instead, we start by grasping the core entities and then build up the data model as we progress with the design.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For this particular problem, we only have three core entities:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>User</strong>: A user can be a viewer or a broadcaster.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Live Video</strong>: The video that is being broadcasted by a user (this is owned and managed by a different team, but is relevant as we will need to integrate with it).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Comment</strong>: The message posted by a user on a live video.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In your interview, this can be as simple as a bulleted list like:</div>
<div class="mx-auto" style="max-width: 200px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 149.47987365722656 120">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="149.47987365722656" height="120" fill="#ffffff"></rect><g transform="translate(10 10) rotate(0 64.73993682861328 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Core Entities</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Comments</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Live Video</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- User</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">FB Live Comments Core Entities</span></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now, let's carry on to outline the API, tackling each functional requirement in sequence. This step-by-step approach will help us maintain focus and manage scope effectively.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="api-or-system-interface"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#api-or-system-interface-5-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">API or System Interface</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll need a simple POST endpoint to create a comment.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>POST /comments/</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span>liveVideoId
</span><span>Header</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> JWT | SessionToken
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"message"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"Cool video!"</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span><span> </span></code></div></div></pre>
<div class="my-6"><div class="MuiBox-root mui-o9fqh4"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Note that the userId is not passed in the request body. Instead, it is a part of the request header, either by way of a session token or a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://jwt.io/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">JWT</a>. This is a common pattern in modern web applications. The client is responsible for storing the session token or JWT and passing it in the request header. The server then validates the token and extracts the userId from it. This is a more secure approach than passing the userId in the request body because it prevents users from tampering with the request and impersonating other users.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We also need to be able to fetch past comments for a given live video.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>GET /comments/</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span>liveVideoId?cursor=</span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>last_comment_id</span><span class="token" style="color: rgb(56, 58, 66);">}</span><span>&amp;pagesize=</span><span class="token" style="color: rgb(183, 107, 1);">10</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Pagination will be important for this endpoint. More on that later when we get deeper into the design.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="high-level-design"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#high-level-design-10-15-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">High-Level Design</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To get started with our high-level design, let's begin by addressing the first functional requirement.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-viewers-can-post-comments-on-a-live-video-feed">1) Viewers can post comments on a Live video feed</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">First things first, we need to make sure that users are able to post a comment.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This should be rather simple. Users will initiate a POST request to the <span class="MuiBox-root mui-1vu004u">POST /comments/:liveVideoId</span> endpoint with the comment message. The server will then validate the request and store the comment in the database.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1579.9942165232303 287.3576830440106">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1579.9942165232303" height="287.3576830440106" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 54.807721954248905) rotate(0 128.0182913190058 84.77455315625434)"><path d="M32 0 C101.43 -0.49, 167.81 0.79, 224.04 0 M32 0 C82.41 1.24, 132.92 1.62, 224.04 0 M224.04 0 C247.14 -0.97, 256.84 9.3, 256.04 32 M224.04 0 C246.81 1.86, 255.77 12.33, 256.04 32 M256.04 32 C254.36 67.11, 255.69 104.56, 256.04 137.55 M256.04 32 C256.09 59.67, 256.12 86.01, 256.04 137.55 M256.04 137.55 C257.42 159.76, 245.47 170.73, 224.04 169.55 M256.04 137.55 C256.39 157.69, 247.34 171.42, 224.04 169.55 M224.04 169.55 C183.93 168.56, 141.91 170.19, 32 169.55 M224.04 169.55 C160.27 170.07, 98.85 170.58, 32 169.55 M32 169.55 C12.01 170.93, -1.51 157.96, 0 137.55 M32 169.55 C9.3 168.46, 2.16 157.62, 0 137.55 M0 137.55 C2.66 114.93, 1.33 96.47, 0 32 M0 137.55 C0.78 109.01, 0.92 79.26, 0 32 M0 32 C-1.99 12.45, 11.31 0.02, 32 0 M0 32 C0.76 10.86, 11.03 0.2, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(63.86301788150581 127.08227511050325) rotate(0 74.1552734375 12.5)"><text x="74.1552734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commenter Client</text></g><g mask="url(#mask-fTL370NXE7NBtkAFS3EmB)" stroke-linecap="round"><g transform="translate(289.9586521006023 128.96102819440523) rotate(0 123.1463414244705 1.931271818146115)"><path d="M0.94 -0.42 C41.91 0.01, 205.21 2.41, 245.99 3.14 M-0.02 -1.68 C40.75 -1.16, 204.13 3.13, 244.89 4.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 128.96102819440523) rotate(0 123.1463414244705 1.931271818146115)"><path d="M29.28 -10.28 C19.72 -7.45, 10.29 -4.91, 0.94 -0.42 M29.28 -10.28 C21.36 -7.6, 12.16 -4.77, 0.94 -0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 128.96102819440523) rotate(0 123.1463414244705 1.931271818146115)"><path d="M28.99 10.24 C19.42 6.61, 10.08 2.7, 0.94 -0.42 M28.99 10.24 C21.35 6.61, 12.25 3.13, 0.94 -0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 128.96102819440523) rotate(0 123.1463414244705 1.931271818146115)"><path d="M216.43 13.79 C224.64 10.08, 233.08 6.53, 244.89 4.29 M216.43 13.79 C226.16 10.26, 234.42 7.13, 244.89 4.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 128.96102819440523) rotate(0 123.1463414244705 1.931271818146115)"><path d="M216.99 -6.73 C225.12 -3.98, 233.38 -1.07, 244.89 4.29 M216.99 -6.73 C226.35 -3.95, 234.44 -0.76, 244.89 4.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-fTL370NXE7NBtkAFS3EmB"><rect x="0" y="0" fill="#fff" width="636.2513349495433" height="232.82357183069746"></rect><rect x="382.5434700875728" y="118.39230001255135" fill="#000" width="61.123046875" height="25" opacity="1"></rect></mask><g transform="translate(382.5434700875728 118.39230001255135) rotate(0 30.402632924159988 11.873981726262713)"><text x="30.5615234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">HTTPS</text></g><g stroke-linecap="round" transform="translate(560.4601073348726 33.31260065375636) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C87.74 -1.27, 143.92 -0.93, 308.62 0 M32 0 C137.76 -2.03, 242.98 -1.93, 308.62 0 M308.62 0 C328.59 0.33, 340.23 9.75, 340.62 32 M308.62 0 C330.69 1.79, 339.97 12.59, 340.62 32 M340.62 32 C341.98 70.86, 342.29 109.82, 340.62 173.16 M340.62 32 C341.01 67.19, 341.8 102.91, 340.62 173.16 M340.62 173.16 C339.69 196.14, 330.65 205.71, 308.62 205.16 M340.62 173.16 C342.12 196.31, 327.99 202.87, 308.62 205.16 M308.62 205.16 C209.26 205.42, 107.06 205.67, 32 205.16 M308.62 205.16 C238 203.43, 168.78 204.72, 32 205.16 M32 205.16 C9.31 205.72, 1.46 194.05, 0 173.16 M32 205.16 C9.13 206.25, 0.17 196.3, 0 173.16 M0 173.16 C1.28 128.4, -0.49 83.02, 0 32 M0 173.16 C-0.7 130.08, -0.8 86.96, 0 32 M0 32 C-0.51 8.87, 10.61 -1.89, 32 0 M0 32 C1.86 9.08, 12.6 -1.95, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(604.1382935402864 123.39212034765251) rotate(0 126.630859375 12.5)"><text x="126.630859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment Management Service</text></g><g stroke-linecap="round" transform="translate(1103.030141553393 10) rotate(0 133.62108660928106 133.6788415220053)"><path d="M163.31 2.77 C177.3 3.76, 192.33 12.29, 204.6 20.13 C216.87 27.96, 227.72 38.56, 236.94 49.78 C246.15 61.01, 254.69 73.96, 259.88 87.45 C265.07 100.95, 267.83 116.11, 268.05 130.73 C268.27 145.36, 265.68 161.4, 261.2 175.23 C256.71 189.05, 249.75 202.19, 241.13 213.7 C232.52 225.2, 221.64 235.96, 209.53 244.25 C197.43 252.54, 182.41 259.77, 168.5 263.44 C154.6 267.11, 140.4 267.33, 126.08 266.28 C111.76 265.22, 95.94 262.61, 82.6 257.12 C69.25 251.64, 56.74 242.89, 46.01 233.37 C35.28 223.85, 25.47 212.4, 18.23 200.01 C10.99 187.61, 5.24 173.4, 2.57 158.98 C-0.11 144.56, 0.31 127.8, 2.19 113.48 C4.08 99.16, 7.44 85.67, 13.86 73.06 C20.27 60.46, 29.96 48.08, 40.68 37.84 C51.4 27.6, 65.06 17.9, 78.19 11.61 C91.31 5.32, 103.18 0.73, 119.45 0.11 C135.71 -0.5, 164.59 5.76, 175.8 7.93 C187.01 10.11, 187.45 11.25, 186.69 13.17 M195.59 14.35 C208.78 18.78, 218.95 30.95, 228.82 41.61 C238.69 52.28, 248.5 65.28, 254.83 78.36 C261.16 91.44, 265.56 105.7, 266.82 120.11 C268.08 134.53, 265.58 150.82, 262.38 164.84 C259.18 178.86, 254.91 192.12, 247.62 204.21 C240.32 216.3, 229.84 228.21, 218.59 237.38 C207.35 246.54, 193.91 254.11, 180.14 259.21 C166.37 264.31, 150.63 267.46, 135.99 267.98 C121.35 268.5, 106.02 267.04, 92.29 262.33 C78.56 257.61, 65.09 248.75, 53.62 239.69 C42.14 230.62, 31.35 219.81, 23.43 207.93 C15.51 196.06, 9.74 182.35, 6.09 168.44 C2.44 154.52, 0.79 138.87, 1.5 124.44 C2.21 110.01, 5.26 95.01, 10.36 81.87 C15.46 68.72, 22.58 56.37, 32.1 45.57 C41.63 34.78, 54.87 24.19, 67.5 17.1 C80.12 10.01, 93.62 5.73, 107.88 3.02 C122.15 0.3, 138.59 -0.93, 153.09 0.83 C167.59 2.6, 188.33 10.69, 194.88 13.62 C201.44 16.55, 193.71 16.39, 192.42 18.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1174.4402892117364 118.65362618063352) rotate(0 62.2265625 25)"><text x="62.2265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comments DB </text><text x="62.2265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(923.1541645475963 143.95062934659063) rotate(0 80.12984538319643 0)"><path d="M0.26 -0.6 C26.75 -0.44, 132.81 0.19, 159.44 0.2 M-1.06 1.69 C25.76 1.53, 135.02 -1.62, 161.72 -1.82" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(923.1541645475963 143.95062934659063) rotate(0 80.12984538319643 0)"><path d="M28.51 -10.71 C17.68 -8.52, 9.25 -4.05, 0.26 -0.6 M28.51 -10.71 C21.08 -7.08, 13.93 -5.01, 0.26 -0.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(923.1541645475963 143.95062934659063) rotate(0 80.12984538319643 0)"><path d="M28.4 9.81 C17.73 4.91, 9.35 2.29, 0.26 -0.6 M28.4 9.81 C20.93 8.22, 13.81 5.08, 0.26 -0.6" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(923.1541645475963 143.95062934659063) rotate(0 80.12984538319643 0)"><path d="M133.74 8.99 C142.47 3.83, 153.48 1.07, 161.72 -1.82 M133.74 8.99 C140.53 6.86, 147.68 3.62, 161.72 -1.82" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(923.1541645475963 143.95062934659063) rotate(0 80.12984538319643 0)"><path d="M133.34 -11.53 C142.08 -9.6, 153.22 -5.27, 161.72 -1.82 M133.34 -11.53 C140.3 -8.45, 147.54 -6.47, 161.72 -1.82" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(1400.9343562937381 63.9952919683202) rotate(0 84.5299301147461 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- commentId (PK)</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- videoId (shard)</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- content</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- author</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- createdAt (SK)</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">FB Live Comments Create Comment</span></div></div></div></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Commenter Client</strong>: The commenter client is a web or mobile application that allows users to post comments on a live video feed. It is responsible for authenticating the user and sending the comment to the Comment Management Service.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Comment Management Service</strong>: The comment management service is responsible for creating and querying comments. It receives comments from the commenter client and stores them in the comments database. It will also be responsible for retrieving comments from the comments database and sending them to the viewer client -- more on that later.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Comments Database</strong>: For the comments database, we'll choose DynamoDB because it is a fast, scalable, and highly available database. It's is a good fit for our use case because we are storing simple comments that don't require complex relationships or transactions, though, other databases like Postgres or MySQL would work here as well.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's walk through exactly what happens when a user posts a new comment.</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The users drafts a comment from their device (commenter client)</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The commenter client sends the comment to the comment management service via the <span class="MuiBox-root mui-1vu004u">POST /comments/:liveVideoId</span> API endpoint.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The comment management service receives the request and stores the comment in the comments database.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Great, that was easy, but things get a little more complicated when we start to consider how users will view comments.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-viewers-can-see-new-comments-being-posted-while-they-are-watching-the-live-video">2) Viewers can see new comments being posted while they are watching the live video.</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now that we've handled comment creation, we need to tackle the challenge of comment distribution - ensuring that when one user posts a comment, all other viewers of the live video can see it.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can start with the simplest approach: polling.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A working, though naive, approach is to have the clients poll for new comments every few seconds. We would use the <span class="MuiBox-root mui-1vu004u">GET /comments/:liveVideoId?since={last_comment_id}</span> endpoint, adding a <span class="MuiBox-root mui-1vu004u">since</span> parameter to the request that points to the last comment id that the client has seen. The server would then return all comments that were posted after the <span class="MuiBox-root mui-1vu004u">since</span> comment and the client would append them to the list of comments displayed on the screen.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 811 616.9716325835602">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="811" height="616.9716325835602" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 10) rotate(0 75 32.5)"><path d="M0 0 C58.01 0.75, 114.89 0.35, 150 0 M0 0 C43.52 0.45, 87.14 0.55, 150 0 M150 0 C150.99 17.97, 149.76 35.38, 150 65 M150 0 C150.48 15.95, 149.53 34.52, 150 65 M150 65 C112.39 62.32, 76.34 64.64, 0 65 M150 65 C93.27 62.82, 35.95 64.25, 0 65 M0 65 C0.62 45.14, 2.06 27.04, 0 0 M0 65 C-0.27 48.17, -1.4 30.5, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(10 457) rotate(0 75 32.5)"><path d="M0 0 C32.48 -0.57, 61.23 2.22, 150 0 M0 0 C34.9 0.39, 69.11 0.1, 150 0 M150 0 C150.75 15.9, 149.68 27.6, 150 65 M150 0 C150.63 25.35, 150.04 48.67, 150 65 M150 65 C116.75 64.9, 87.5 65.51, 0 65 M150 65 C119.45 64.63, 89.18 63.64, 0 65 M0 65 C1.73 49.91, -0.8 35.18, 0 0 M0 65 C-1.02 41.83, 0.68 18.82, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(268 10) rotate(0 75 32.5)"><path d="M0 0 C39.71 2.52, 78.45 0.87, 150 0 M0 0 C35.93 -0.05, 71.85 1.46, 150 0 M150 0 C149.29 21.15, 151.66 47.14, 150 65 M150 0 C149.42 12.73, 149.14 25.94, 150 65 M150 65 C116.96 67.25, 78.79 66.13, 0 65 M150 65 C115.77 65.79, 81.01 66.29, 0 65 M0 65 C-1.26 48.98, 0.6 30.06, 0 0 M0 65 C1.41 42.6, 0.32 19.11, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(268 457) rotate(0 75 32.5)"><path d="M0 0 C35.55 -1.23, 72.67 -0.98, 150 0 M0 0 C37.05 1.9, 76.11 1.29, 150 0 M150 0 C151.32 25.84, 147.84 47.87, 150 65 M150 0 C148.76 23.49, 148.93 47.76, 150 65 M150 65 C96.01 66.59, 44.48 65.84, 0 65 M150 65 C93.73 64.8, 38.33 65.52, 0 65 M0 65 C1.42 43.84, 1.32 19.83, 0 0 M0 65 C-0.78 44.08, -0.01 21.86, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(651 10) rotate(0 75 32.5)"><path d="M0 0 C56.69 0.26, 114.73 -0.81, 150 0 M0 0 C33.94 -0.99, 67.6 -1.52, 150 0 M150 0 C148.61 14.73, 151.95 28.26, 150 65 M150 0 C148.75 15.12, 149.91 32.24, 150 65 M150 65 C91.95 65, 38.2 65.27, 0 65 M150 65 C108.92 66.27, 68.71 65.01, 0 65 M0 65 C0.71 38.15, 0.14 16.35, 0 0 M0 65 C0.69 40.26, 0.41 15.87, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(651 457) rotate(0 75 32.5)"><path d="M0 0 C44.47 -1, 89.33 -1.76, 150 0 M0 0 C56.88 -0.6, 111.66 0.59, 150 0 M150 0 C150.82 24.54, 148.22 49.69, 150 65 M150 0 C150.02 15.81, 150.32 29.05, 150 65 M150 65 C103.2 64.71, 52.98 63.62, 0 65 M150 65 C102.02 66.08, 54.22 67.01, 0 65 M0 65 C0.17 45.31, 1.04 21.7, 0 0 M0 65 C-0.09 42.47, -0.65 21.9, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(60 85) rotate(0 154 19.5)"><path d="M0 0 C96.01 -0.25, 195.31 1.54, 308 0 M308 0 C306.79 13.79, 310.18 22.53, 308 39 M308 39 C214.54 36.46, 121.76 36.71, 0 39 M0 39 C1.37 27.71, 0.25 18.87, 0 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g stroke-linecap="round" transform="translate(368 398) rotate(0 166.5 25)"><path d="M0 0 C88.14 2.38, 174.44 2.65, 333 0 M333 0 C334.54 11.1, 332.65 27.44, 333 50 M333 50 C251.64 47.11, 171.33 48.69, 0 50 M0 50 C0.04 29.58, -0.71 13.46, 0 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g stroke-linecap="round"><g transform="translate(85 75) rotate(0 0 191)"><path d="M0 0 C1.86 86.24, 1.22 169.97, 0 382 M0 0 C2.18 145.15, 1.83 289.1, 0 382" stroke="#999" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(343 75) rotate(0 0 191)"><path d="M0 0 C-0.18 132.04, 1.24 266.97, 0 382 M0 0 C-0.33 77.9, -0.5 156.09, 0 382" stroke="#999" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(726 75) rotate(0 0 191)"><path d="M0 0 C0.03 141.77, -2.05 281.27, 0 382 M0 0 C-1.85 141.71, -1.75 283.89, 0 382" stroke="#999" stroke-width="1" fill="none"></path></g></g><mask></mask><g mask="url(#mask-6XC6kYRinxDNb3lHchqzX)" stroke-linecap="round"><g transform="translate(85.5 212) rotate(0 128.5 0)"><path d="M1.15 -1.14 C44.13 -1.16, 214.48 0.79, 257.01 0.86 M0.29 0.87 C43.19 0.45, 212.98 -0.7, 256.07 -0.8" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(85.5 212) rotate(0 128.5 0)"><path d="M227.93 9.6 C232.31 6.99, 242.03 3.45, 256.07 -0.8 M227.93 9.6 C234.13 6.67, 242.1 5.56, 256.07 -0.8" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(85.5 212) rotate(0 128.5 0)"><path d="M227.82 -10.92 C232.39 -8.89, 242.13 -7.78, 256.07 -0.8 M227.82 -10.92 C233.88 -8.89, 241.87 -5.04, 256.07 -0.8" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask id="mask-6XC6kYRinxDNb3lHchqzX"><rect x="0" y="0" fill="#fff" width="443.5" height="312"></rect><rect x="136.71484375" y="192" fill="#000" width="154.5703125" height="40" opacity="1"></rect></mask><g mask="url(#mask-ZpFz86Z_VwzaFTk5bxa8Y)" stroke-linecap="round"><g transform="translate(348.5 264) rotate(0 188.5 0)"><path d="M0.01 0.86 C62.53 0.94, 313.64 -0.42, 376.3 -0.7 M-1.45 0.27 C61.37 0.59, 315.35 0.51, 378.64 0.47" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(348.5 264) rotate(0 188.5 0)"><path d="M350.45 10.74 C363.14 5.51, 371.69 0.89, 378.64 0.47 M350.45 10.74 C357.51 9.34, 364.32 5.2, 378.64 0.47" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(348.5 264) rotate(0 188.5 0)"><path d="M350.45 -9.78 C362.94 -6.89, 371.49 -3.4, 378.64 0.47 M350.45 -9.78 C357.36 -6.44, 364.17 -5.85, 378.64 0.47" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask id="mask-ZpFz86Z_VwzaFTk5bxa8Y"><rect x="0" y="0" fill="#fff" width="826.5" height="364"></rect><rect x="455.46875" y="254" fill="#000" width="163.0625" height="20" opacity="1"></rect></mask><g mask="url(#mask-pqD9FFv_iR1-PHWlgNAF-)" stroke-linecap="round"><g transform="translate(720.5 316) rotate(0 -186 0)"><path d="M-0.7 -0.7 C-62.88 -0.98, -311.02 -0.82, -373.04 -0.83" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(720.5 316) rotate(0 -186 0)"><path d="M-344.85 -11.1 C-354.41 -9.9, -363.11 -6.47, -373.04 -0.83" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g><g transform="translate(720.5 316) rotate(0 -186 0)"><path d="M-344.84 9.43 C-354.56 4.45, -363.25 1.71, -373.04 -0.83" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g></g><mask id="mask-pqD9FFv_iR1-PHWlgNAF-"><rect x="0" y="0" fill="#fff" width="1193.5" height="416"></rect><rect x="477.84375" y="306" fill="#000" width="113.3125" height="20" opacity="1"></rect></mask><g mask="url(#mask-HaiWKe_Nr7SW8oONbU-yf)" stroke-linecap="round"><g transform="translate(337.5 368) rotate(0 -126 0)"><path d="M-1.04 -0.83 C-43.06 -0.83, -211.1 -1.02, -252.83 -0.72" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(337.5 368) rotate(0 -126 0)"><path d="M-224.66 -11.05 C-232.91 -10.18, -239.54 -5.37, -252.83 -0.72" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g><g transform="translate(337.5 368) rotate(0 -126 0)"><path d="M-224.61 9.47 C-232.75 5.38, -239.39 5.24, -252.83 -0.72" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g></g><mask id="mask-HaiWKe_Nr7SW8oONbU-yf"><rect x="0" y="0" fill="#fff" width="690.5" height="468"></rect><rect x="140.1796875" y="358" fill="#000" width="142.640625" height="20" opacity="1"></rect></mask><g stroke-linecap="round" transform="translate(338 222) rotate(0 5 78)"><path d="M0.55 -0.72 L10.81 -0.79 L10.39 155.83 L-0.43 155.97" stroke="none" stroke-width="0" fill="#e9ecef"></path><path d="M0 0 C1.83 0.27, 4.67 0.42, 10 0 M0 0 C1.99 0.21, 4.05 -0.03, 10 0 M10 0 C11.11 38.23, 9.85 76.65, 10 156 M10 0 C9.82 56.39, 10.67 112.87, 10 156 M10 156 C6.87 156.16, 3.93 155.88, 0 156 M10 156 C6.93 155.87, 4.31 156.13, 0 156 M0 156 C0.85 117.56, 0.57 80.42, 0 0 M0 156 C-0.4 102.58, -1.06 49.68, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(721 276) rotate(0 5 25)"><path d="M0.81 -0.79 L10.39 -0.17 L9.57 49.97 L0.59 50.02" stroke="none" stroke-width="0" fill="#e9ecef"></path><path d="M0 0 C2.71 0.36, 4.13 0.08, 10 0 M0 0 C2.27 -0.11, 4.42 0.02, 10 0 M10 0 C9.91 14.55, 10.84 27.64, 10 50 M10 0 C10.23 18.12, 9.69 35.69, 10 50 M10 50 C5.95 49.87, 2.88 49.79, 0 50 M10 50 C7.8 50.14, 4.95 49.83, 0 50 M0 50 C0.01 38.06, 0.3 27.69, 0 0 M0 50 C-0.56 31.35, 0.18 12.86, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(75 134) rotate(0 333 0)"><path d="M0 0 C230.28 -1.89, 461.55 -2.19, 666 0" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(741 134) rotate(0 0 127)"><path d="M0 0 C-3.17 95.61, -0.85 191.69, 0 254" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(75 388) rotate(0 333 0)"><path d="M0 0 C214.71 0.4, 428.06 -0.03, 666 0" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(75 134) rotate(0 0 127)"><path d="M0 0 C1.02 71.23, 1.83 143.89, 0 254" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g transform="translate(362.1640625 142) rotate(0 77.1679458618164 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">[Poll for comments]</text></g><g stroke-linecap="round" transform="translate(75 134) rotate(0 20 15)"><path d="M-0.95 -0.35 L40.69 -0.91 L40.44 30.52 L0.9 30.54" stroke="none" stroke-width="0" fill="#e9ecef"></path><path d="M0 0 C10.65 0.4, 19.1 0.93, 40 0 M0 0 C14.01 0.02, 29.29 0.24, 40 0 M40 0 C39.37 8.63, 39.05 16.43, 40 30 M40 0 C39.74 8.7, 40.43 18.15, 40 30 M40 30 C30.75 29.01, 20.83 29.46, 0 30 M40 30 C26.59 29.75, 12.34 29.87, 0 30 M0 30 C-0.68 19.74, -0.06 8.27, 0 0 M0 30 C0.34 21.18, -0.49 12.08, 0 0" stroke="#adb5bd" stroke-width="2" fill="none"></path></g><g transform="translate(61.93359375 32.5) rotate(0 23.06640625 10)"><text x="23.06640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Viewer</text></g><g transform="translate(61.93359375 479.5) rotate(0 23.06640625 10)"><text x="23.06640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Viewer</text></g><g transform="translate(322.12109375 32.5) rotate(0 20.87890625 10)"><text x="20.87890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Server</text></g><g transform="translate(322.12109375 479.5) rotate(0 20.87890625 10)"><text x="20.87890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Server</text></g><g transform="translate(696.68359375 32.5) rotate(0 29.31640625 10)"><text x="29.31640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text></g><g transform="translate(696.68359375 479.5) rotate(0 29.31640625 10)"><text x="29.31640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Database</text></g><g transform="translate(112.2890625 94.5) rotate(0 101.7109375 10)"><text x="101.7109375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Viewer polls every few seconds</text></g><g transform="translate(379.6640625 413) rotate(0 154.8359375 10)"><text x="154.8359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">This can lead to a heavy load with more viewers</text></g><g transform="translate(136.71484375 192) rotate(0 77.43405432231722 19.865510298718988)"><text x="77.28515625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">GET </text><text x="77.28515625" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">/comments/:liveVideoId</text></g><g transform="translate(455.46875 254) rotate(0 81.62910592310129 10.084972113376324)"><text x="81.53125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Query for new comments</text></g><g transform="translate(477.84375 306) rotate(0 55.78709122948351 9.217481253617535)"><text x="56.65625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Return comments</text></g><g transform="translate(140.1796875 358) rotate(0 70.38723929934207 9.191840746324203)"><text x="71.3203125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">List of new comments</text></g><g transform="translate(80.77734375 139) rotate(0 14.22265625 10)"><text x="14.22265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">loop</text></g><g transform="translate(16.57015305709774 556.9716325835602) rotate(0 253.56979370117188 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Note: This diagram is illustrative, you would never </text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">draw this in a real interview</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Polling</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This is a start, but it doesn't scale. As the number of comments and viewers grows, the polling frequency will need to increase to keep up with the demand. This will put a lot of strain on the database and will result in many unnecessary requests (since most of the times there will be no new comments to fetch). In order to meet our requirements of "near real-time" comments, we would need to poll the database every few milliseconds, which isn't feasible.</div>
<div class="my-6"><div class="MuiBox-root mui-o9fqh4"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In your interview, if you already know the more accurate, yet complex, solution, you can jump right to it. Just make sure you justify your decision and explain the tradeoffs.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In the case that you are seeing a problem for the first time, starting simple like this is great and sets a foundation for you to build upon in the deep dives.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-viewers-can-see-comments-made-before-they-joined-the-live-feed">3) Viewers can see comments made before they joined the live feed</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user joins a live video, they need two things:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">They should immediately start seeing new comments as they are posted in real-time</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">They should see a history of comments that were posted before they joined</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For the history of comments, users should be able to scroll up to view progressively older comments - this UI pattern is called "<a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://builtin.com/ux-design/infinite-scroll" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">infinite scrolling</a>" and is commonly used in chat applications.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can fetch the initial set of recent comments using our <span class="MuiBox-root mui-1vu004u">GET /comments/:liveVideoId</span> endpoint. While we could use the <span class="MuiBox-root mui-1vu004u">since</span> parameter we added earlier, that would give us comments newer than a timestamp - the opposite of what we want for loading historical comments. What we really want is something that will "give me the N most recent comments that occurred before a certain timestamp".</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To do that, we can introduce pagination. Pagination is a common technique used to break up a large set of results into smaller chunks. It is typically used in conjunction with infinite scrolling to allow users to load more results as they scroll down the page.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Whenever you have a requirement that involves loading a large set of results, you should consider pagination.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When it comes to implementing pagination, there are two main approaches: offset pagination and cursor pagination.</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Offset Pagination</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The simplest approach is to use offset pagination. Offset pagination is a technique that uses an offset to specify the starting point for fetching a set of results. Initially, the offset is set to 0 to load the most recent comments, and it increases by the number of comments fetched each time the user scrolls to load more (known as the page size). While this approach is straightforward to implement, it poses significant challenges in the context of a fast-moving, high-volume comment feed.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Example request: <span class="MuiBox-root mui-1vu004u">GET /comments/:liveVideoId?offset=0&amp;pagesize=10</span></div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">First, offset pagination is inefficient as the volume of comments grows. The database must count through all rows preceding the offset for each query, leading to slower response times with larger comment volumes. Most importantly, offset pagination is not stable. If a comment is added or deleted while the user is scrolling, the offset will be incorrect and the user will see duplicate or missing comments.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Cursor Pagination</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach-1">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A better approach is to use cursor pagination. Cursor pagination is a technique that uses a cursor to specify the starting point for fetching a set of results. The cursor is a unique identifier that points to a specific item in the list of results. Initially, the cursor is set to the most recent comment, and it is updated each time the user scrolls to load more. This approach is more efficient than offset pagination because the database does not need to count through all rows preceding the cursor for each query (assuming we built an index on the cursor field). Additionally, cursor pagination is stable, meaning that if a comment is added or deleted while the user is scrolling, the cursor will still point to the correct item in the list of results.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Example request: <span class="MuiBox-root mui-1vu004u">GET /comments/:liveVideoId?cursor={last_comment_id}&amp;pageSize=10</span></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Since we chose DynamoDB for our comments database, we can use the <span class="MuiBox-root mui-1vu004u">last_comment_id</span> as the cursor via DynamoDB's <span class="MuiBox-root mui-1vu004u">LastEvaluatedKey</span> feature. The query will look something like this:</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"TableName"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"comments"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"KeyConditionExpression"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"liveVideoId = :liveVideoId"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"ScanIndexForward"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">false</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"Limit"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> `pagSize`</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"ExclusiveStartKey"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>        </span><span class="token" style="color: rgb(228, 86, 73);">"liveVideoId"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"liveVideoId"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>        </span><span class="token" style="color: rgb(228, 86, 73);">"last_comment_id"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"last_comment_id"</span><span>
</span><span>    </span><span class="token" style="color: rgb(56, 58, 66);">}</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span></code></div></div></pre><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges-1">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While cursor pagination reduces database load compared to offset pagination, it still requires a database query for each new page of results, which can be significant in a high-traffic environment like ours.</div></div></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cursor based pagination is a better fit for our use case. Unlike offset pagination, it's more efficient as we don't need to scan through all preceding rows. It's stable - new comments won't disrupt the cursor's position during scrolling. It works well with DynamoDB's LastEvaluatedKey feature, and it scales better since performance remains consistent as comment volume grows.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="potential-deep-dives"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#deep-dives-10-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Potential Deep Dives</a></h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-how-can-we-ensure-comments-are-broadcasted-to-viewers-in-real-time">1) How can we ensure comments are broadcasted to viewers in real-time?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our simple polling solution was a good start, but it's not going to pass the interview. Instead of having the client "guess" when new comments are ready and requesting them, we can use a push based model. This way the server can push new comments to the client as soon as they are created.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">There are two main ways we can implement this. Websockets and Server Sent Events (SSE). Let's weigh the pros and cons of each.</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Websockets</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach-2">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Websockets are a two-way communication channel between a client and a server. The client opens a connection to the server and keeps it open. The server keeps a connection open and sends new data to the client without requiring additional requests. When a new comment arrives, the Comment Management Server distributes it to all clients, enabling them to update the comment feed. This is much more efficient as it eliminates polling and enables the server to immediately push new comments to the client upon creation.</div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges-2">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Websockets are a good solution, and for real-time chat applications that have a more balanced read/write ratio, they are optimal. However, for our use case, the read/write ratio is not balanced. Comment creation is a relatively infrequent event, so while most viewers will never post a comment, they will be viewing/reading all comments.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Because of this imbalance, it doesn't make sense to open a two-way communication channel for each viewer, given that the overhead of maintaining the connection is high.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 527.1395874023438 653.8546914575481">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="527.1395874023438" height="653.8546914575481" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(13.546791687099358 10) rotate(0 75 32.5)"><path d="M0 0 C39.79 -0.86, 80.27 0.78, 150 0 M0 0 C45.44 -1.12, 91.78 -1.41, 150 0 M150 0 C149.06 15.04, 150.41 33.1, 150 65 M150 0 C149.3 16.56, 150.16 34.35, 150 65 M150 65 C110.43 65.31, 76.43 65.85, 0 65 M150 65 C90.8 63.78, 29.51 63.74, 0 65 M0 65 C0.56 41.86, -1.29 19.34, 0 0 M0 65 C0.12 44.9, 0.24 24.21, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(13.546791687099358 503) rotate(0 75 32.5)"><path d="M0 0 C35.56 1.22, 74.22 1.53, 150 0 M0 0 C55.54 -0.3, 112.01 -0.94, 150 0 M150 0 C150.9 27.23, 149.13 51.22, 150 65 M150 0 C150.02 19.2, 149.18 38.68, 150 65 M150 65 C116.62 67.8, 81.63 65.28, 0 65 M150 65 C109.02 63.12, 70.12 64.34, 0 65 M0 65 C-1.28 40.06, -0.15 16.49, 0 0 M0 65 C0.13 39.47, 0.09 15.13, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(341.54679168709936 10) rotate(0 75 32.5)"><path d="M0 0 C32.72 0.3, 66.6 -1.63, 150 0 M0 0 C44.62 -0.51, 91.34 0.25, 150 0 M150 0 C149.57 16.18, 150.14 32.48, 150 65 M150 0 C149.74 17.32, 149.57 31.94, 150 65 M150 65 C97.32 65.69, 40.03 67.65, 0 65 M150 65 C116.51 64.28, 82.84 64.26, 0 65 M0 65 C0.45 47.57, 1.87 30.71, 0 0 M0 65 C0.01 46.01, -0.24 28.94, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(341.54679168709936 503) rotate(0 75 32.5)"><path d="M0 0 C46.35 -1.86, 89.71 -1.7, 150 0 M0 0 C41.81 1.21, 81.23 1.89, 150 0 M150 0 C149.57 22.8, 148.81 48.34, 150 65 M150 0 C149.03 20.47, 150.33 43.72, 150 65 M150 65 C90.62 65.76, 31.05 62.85, 0 65 M150 65 C117.34 66.1, 82.89 65.17, 0 65 M0 65 C1.51 48.21, -0.44 31.59, 0 0 M0 65 C-0.21 52.28, 0.67 39.62, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(63.54679168709936 85) rotate(0 189 19.5)"><path d="M0 0 C118.76 0.98, 237.16 1.21, 378 0 M378 0 C377.54 9.11, 379.71 15.44, 378 39 M378 39 C274.88 38.26, 173.26 37.25, 0 39 M0 39 C1.54 25.65, 2.09 10.7, 0 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g stroke-linecap="round" transform="translate(326.54679168709936 238) rotate(0 90 25)"><path d="M0 0 C38.59 0.23, 76.44 3.31, 180 0 M180 0 C181.12 13.39, 179.21 28.11, 180 50 M180 50 C135.77 49.65, 92.13 49.32, 0 50 M0 50 C1.51 41.68, -1.01 28.77, 0 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g stroke-linecap="round" transform="translate(113.54679168709936 395) rotate(0 139 25)"><path d="M0 0 C61.26 2.71, 125.1 0.54, 278 0 M278 0 C277.76 17.34, 277.31 34.1, 278 50 M278 50 C186.24 47.95, 90.31 49.95, 0 50 M0 50 C-1.14 29.88, 0.82 9.57, 0 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g stroke-linecap="round" transform="translate(63.54679168709936 444) rotate(0 189 25)"><path d="M0 0 C92.18 -2.76, 185.38 -1.44, 378 0 M378 0 C376.84 12.16, 378.56 26.79, 378 50 M378 50 C281.9 49.28, 189.16 49.61, 0 50 M0 50 C1.45 28.58, -1.46 8.56, 0 0" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g stroke-linecap="round"><g transform="translate(88.54679168709936 75) rotate(0 0 214)"><path d="M0 0 C0.14 171.23, -0.77 340.77, 0 428 M0 0 C-0.95 124.61, -1.39 249.37, 0 428" stroke="#999" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(416.54679168709936 75) rotate(0 0 214)"><path d="M0 0 C0.73 110.01, 1.03 220.08, 0 428 M0 0 C0.52 108.7, 0.44 215.99, 0 428" stroke="#999" stroke-width="1" fill="none"></path></g></g><mask></mask><g mask="url(#mask-Qem2omyseohqmc2jNsqDL)" stroke-linecap="round"><g transform="translate(89.04679168709936 166) rotate(0 163.5 0)"><path d="M-0.34 -0.11 C53.92 -0.13, 271.76 -0.64, 326.39 -0.57 M1.68 -1.21 C56.27 -1.04, 274.58 0.77, 328.78 0.68" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(89.04679168709936 166) rotate(0 163.5 0)"><path d="M300.55 10.83 C310.75 6.17, 320.34 4.17, 328.78 0.68 M300.55 10.83 C309.24 6.29, 319.84 4.79, 328.78 0.68" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(89.04679168709936 166) rotate(0 163.5 0)"><path d="M300.63 -9.7 C310.72 -6.83, 320.28 -1.31, 328.78 0.68 M300.63 -9.7 C309.2 -7.47, 319.77 -2.22, 328.78 0.68" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask id="mask-Qem2omyseohqmc2jNsqDL"><rect x="0" y="0" fill="#fff" width="517.0467916870994" height="266"></rect><rect x="146.09366668709936" y="156" fill="#000" width="212.90625" height="20" opacity="1"></rect></mask><g mask="url(#mask-MzgKZQ0h6u1Xpv2IB7BJY)" stroke-linecap="round"><g transform="translate(411.04679168709936 218) rotate(0 -161 0)"><path d="M-0.61 -0.57 C-54.15 -0.49, -267.92 0.08, -321.58 0.35" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(411.04679168709936 218) rotate(0 -161 0)"><path d="M-293.43 -10.01 C-302.02 -6.64, -308.12 -5.51, -321.58 0.35" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g><g transform="translate(411.04679168709936 218) rotate(0 -161 0)"><path d="M-293.35 10.51 C-301.94 8.31, -308.07 3.88, -321.58 0.35" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g></g><mask id="mask-MzgKZQ0h6u1Xpv2IB7BJY"><rect x="0" y="0" fill="#fff" width="834.0467916870994" height="318"></rect><rect x="166.73429168709936" y="208" fill="#000" width="166.625" height="20" opacity="1"></rect></mask><g mask="url(#mask-AtDSKx3JlpK08c5kUrMqh)" stroke-linecap="round"><g transform="translate(416.04679168709936 365) rotate(0 -163.5 0)"><path d="M0.42 0.35 C-54.08 0.62, -272.88 1.31, -327.59 1.06 M-0.82 -0.51 C-54.86 -0.5, -271.1 -0.53, -325.18 -0.51" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.04679168709936 365) rotate(0 -163.5 0)"><path d="M-296.99 -10.77 C-303.47 -9.09, -309.31 -6.87, -325.18 -0.51 M-296.99 -10.77 C-301.81 -7.42, -308.87 -6.62, -325.18 -0.51" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.04679168709936 365) rotate(0 -163.5 0)"><path d="M-296.99 9.75 C-303.37 6.32, -309.22 3.43, -325.18 -0.51 M-296.99 9.75 C-301.94 8.88, -309.01 5.46, -325.18 -0.51" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask id="mask-AtDSKx3JlpK08c5kUrMqh"><rect x="0" y="0" fill="#fff" width="844.0467916870994" height="465"></rect><rect x="174.56241668709936" y="355" fill="#000" width="155.96875" height="20" opacity="1"></rect></mask><g stroke-linecap="round" transform="translate(411.54679168709936 176) rotate(0 5 26)"><path d="M0.22 -0.32 L10.53 -0.33 L10.54 51.1 L-0.76 51.42" stroke="none" stroke-width="0" fill="#e9ecef"></path><path d="M0 0 C3.79 -0.3, 6.23 0.35, 10 0 M0 0 C3.81 -0.13, 7.95 -0.23, 10 0 M10 0 C10.25 12.07, 10.23 22.35, 10 52 M10 0 C9.83 13.39, 9.91 25.91, 10 52 M10 52 C6.44 51.94, 3.85 52.38, 0 52 M10 52 C6.47 52.13, 2.78 51.89, 0 52 M0 52 C-0.09 37.14, 0.72 24.93, 0 0 M0 52 C0.63 37.03, 0.59 22.93, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(78.54679168709936 287) rotate(0 174 0)"><path d="M0 0 C86.19 2.33, 176.02 2.69, 348 0" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(426.54679168709936 287) rotate(0 0 49)"><path d="M0 0 C0.87 24.81, 1.06 45.28, 0 98" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(78.54679168709936 385) rotate(0 174 0)"><path d="M0 0 C128.11 -2.53, 253.21 -1.25, 348 0" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(78.54679168709936 287) rotate(0 0 49)"><path d="M0 0 C0.32 39.65, -0.51 75.12, 0 98" stroke="#adb5bd" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g transform="translate(155.08585418709936 295) rotate(0 129.81591796875 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">[When new comments are posted]</text></g><g stroke-linecap="round" transform="translate(78.54679168709936 287) rotate(0 20 15)"><path d="M0.83 0.18 L39.09 -0.25 L40.38 30.53 L0.42 30.14" stroke="none" stroke-width="0" fill="#e9ecef"></path><path d="M0 0 C13.78 0.61, 29.56 0.88, 40 0 M0 0 C13.5 0.13, 27.35 0.49, 40 0 M40 0 C38.98 9.23, 39.17 18.1, 40 30 M40 0 C39.98 9.62, 40.47 20.32, 40 30 M40 30 C24.96 29.6, 9.24 29.11, 0 30 M40 30 C24.5 30.01, 9.99 29.56, 0 30 M0 30 C-0.34 18.74, -0.35 6.97, 0 0 M0 30 C0.22 24.05, 0.55 17.85, 0 0" stroke="#adb5bd" stroke-width="2" fill="none"></path></g><g transform="translate(65.48038543709936 32.5) rotate(0 23.06640625 10)"><text x="23.06640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Viewer</text></g><g transform="translate(65.48038543709936 525.5) rotate(0 23.06640625 10)"><text x="23.06640625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Viewer</text></g><g transform="translate(395.66788543709936 32.5) rotate(0 20.87890625 10)"><text x="20.87890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Server</text></g><g transform="translate(395.66788543709936 525.5) rotate(0 20.87890625 10)"><text x="20.87890625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Server</text></g><g transform="translate(135.87101043709936 94.5) rotate(0 116.67578125 10)"><text x="116.67578125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Establishing WebSocket Connection</text></g><g transform="translate(339.00382293709936 253) rotate(0 77.54296875 10)"><text x="77.54296875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Connection is kept open</text></g><g transform="translate(127.69522918709936 410) rotate(0 124.8515625 10)"><text x="124.8515625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Client processes new data immediately</text></g><g transform="translate(89.47647918709936 449) rotate(0 163.0703125 20)"><text x="163.0703125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">No need for polling, server pushes updates as they </text><text x="163.0703125" y="20" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">happen</text></g><g transform="translate(146.09366668709936 156) rotate(0 107.17014272161761 9.732553535970553)"><text x="106.453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Establish WebSocket Connection</text></g><g transform="translate(166.73429168709936 208) rotate(0 83.21624124832454 9.893797872588038)"><text x="83.3125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Acknowledge Connection</text></g><g transform="translate(174.56241668709936 355) rotate(0 77.90148269720376 10.298458633626268)"><text x="77.984375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Push new comment data</text></g><g transform="translate(84.32413543709936 292) rotate(0 14.22265625 10)"><text x="14.22265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#000" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">loop</text></g><g transform="translate(10 593.8546914575481) rotate(0 253.56979370117188 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Note: This diagram is illustrative, you would never </text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">draw this in a real interview</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Websockets</span></div></div></div></div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Server Sent Events (SSE)</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach-3">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A better approach is to use Server Sent Events (SSE). SSE is a persistent connection that operates over standard HTTP, making it simpler to implement than WebSockets. The server can push data to the client in real-time, while client-to-server communication happens through regular HTTP requests.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This is a better solution given our read/write ratio imbalance. The infrequent comment creation can use standard HTTP POST requests, while the frequent reads benefit from SSE's efficient one-way streaming.</div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges-3">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">SSE introduces several infrastructure challenges that need careful consideration. Some proxies and load balancers lack support for streaming responses, leading to buffering issues that can be difficult to track down. Browsers also impose limits on concurrent SSE connections per domain, which creates problems for users trying to watch multiple live videos simultaneously. The long-lived nature of SSE connections complicates monitoring and debugging efforts.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">SSE connections typically only last 30-60 seconds before needing to reconnect. This short lifespan could create gaps in the comment stream, but modern browsers provide robust solutions. The EventSource API handles reconnection automatically and tracks the last received event ID. This allows clients to request any missed comments when reconnecting, ensuring a smooth viewing experience even through brief disconnections.</div></div></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1597.62097094825 327.03997627164154">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1597.62097094825" height="327.03997627164154" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 98.51688253954103) rotate(0 128.0182913190058 84.77455315625434)"><path d="M32 0 C78.08 -1.99, 123.85 -0.05, 224.04 0 M32 0 C86.79 0.81, 141.92 -0.31, 224.04 0 M224.04 0 C246.19 -1.88, 257.5 9.08, 256.04 32 M224.04 0 C246.59 -0.97, 256.19 9.98, 256.04 32 M256.04 32 C257.44 64.28, 256.39 97.9, 256.04 137.55 M256.04 32 C254.85 55.84, 254.88 80.15, 256.04 137.55 M256.04 137.55 C255.14 158.76, 247.1 169.6, 224.04 169.55 M256.04 137.55 C254.03 156.74, 245.12 169.61, 224.04 169.55 M224.04 169.55 C176.7 165.87, 125.33 166.51, 32 169.55 M224.04 169.55 C168.38 168.63, 114.14 168.8, 32 169.55 M32 169.55 C10.95 170.76, 1.36 157.78, 0 137.55 M32 169.55 C11.67 171.28, 0.84 159.58, 0 137.55 M0 137.55 C0.06 111.45, 0.81 82.37, 0 32 M0 137.55 C-0.45 102.01, -0.05 68.36, 0 32 M0 32 C1.35 11.37, 10.1 -0.85, 32 0 M0 32 C-2.06 10.64, 11.28 1.46, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(63.86301788150581 170.79143569579537) rotate(0 74.1552734375 12.5)"><text x="74.1552734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commenter Client</text></g><g mask="url(#mask-Xa0CaWOltwetIFuhey0HF)" stroke-linecap="round"><g transform="translate(289.9586521006023 136.5482643330722) rotate(0 123.1463414244705 1.931271818146115)"><path d="M0.54 -0.17 C41.72 0.39, 205.56 3, 246.48 3.82 M-0.64 -1.3 C40.46 -0.58, 204.66 4.64, 245.63 5.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 136.5482643330722) rotate(0 123.1463414244705 1.931271818146115)"><path d="M28.89 -9.98 C21.62 -7.11, 14.81 -5.33, 0.54 -0.17 M28.89 -9.98 C18.67 -7.35, 8.35 -3.52, 0.54 -0.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 136.5482643330722) rotate(0 123.1463414244705 1.931271818146115)"><path d="M28.56 10.54 C21.3 8.33, 14.57 5.02, 0.54 -0.17 M28.56 10.54 C18.46 5.48, 8.27 1.61, 0.54 -0.17" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 136.5482643330722) rotate(0 123.1463414244705 1.931271818146115)"><path d="M217.19 14.89 C223.92 12.71, 231.18 9.69, 245.63 5.34 M217.19 14.89 C228.27 10.47, 239.25 7.04, 245.63 5.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006023 136.5482643330722) rotate(0 123.1463414244705 1.931271818146115)"><path d="M217.71 -5.63 C224.4 -2.72, 231.53 -0.65, 245.63 5.34 M217.71 -5.63 C228.59 -2.35, 239.39 1.91, 245.63 5.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-Xa0CaWOltwetIFuhey0HF"><rect x="0" y="0" fill="#fff" width="636.2513349495433" height="240.41080796936444"></rect><rect x="382.5434700875728" y="125.97953615121833" fill="#000" width="61.123046875" height="25" opacity="1"></rect></mask><g transform="translate(382.5434700875728 125.97953615121833) rotate(0 30.336690130699424 12.590096391327677)"><text x="30.5615234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">HTTPS</text></g><g stroke-linecap="round" transform="translate(563.8319125759335 73.28495701370639) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C113.92 0.25, 197.52 -0.06, 308.62 0 M32 0 C103.43 1.23, 175.33 0.86, 308.62 0 M308.62 0 C329.3 -0.46, 340.68 9.32, 340.62 32 M308.62 0 C328.31 -1.42, 339.62 9.08, 340.62 32 M340.62 32 C339.2 70.45, 339.37 103.69, 340.62 173.16 M340.62 32 C339.99 60.95, 339.53 91.02, 340.62 173.16 M340.62 173.16 C338.73 192.79, 328.7 204.89, 308.62 205.16 M340.62 173.16 C340.85 193.75, 328.47 204.47, 308.62 205.16 M308.62 205.16 C222.98 206.51, 134.63 206.13, 32 205.16 M308.62 205.16 C204.44 205.04, 100.92 205.43, 32 205.16 M32 205.16 C11.2 204.91, -1.92 195.04, 0 173.16 M32 205.16 C10.91 206.48, -0.79 192.27, 0 173.16 M0 173.16 C0.77 129.45, -0.79 85.07, 0 32 M0 173.16 C-1.34 130.82, -0.92 87.77, 0 32 M0 32 C1.27 8.8, 11.87 0.57, 32 0 M0 32 C-1.97 12.68, 9.83 1.52, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(607.5100987813474 163.36447670760253) rotate(0 126.630859375 12.5)"><text x="126.630859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment Management Service</text></g><g stroke-linecap="round" transform="translate(1106.401946794454 49.68229322763091) rotate(0 133.62108660928106 133.6788415220053)"><path d="M141.87 -0.09 C155.55 -1.51, 171.01 4.64, 184.23 10.08 C197.44 15.52, 210.35 23.07, 221.15 32.55 C231.95 42.02, 241.85 54.31, 249.02 66.93 C256.19 79.54, 261.53 94.03, 264.19 108.24 C266.85 122.45, 266.92 137.65, 264.97 152.18 C263.03 166.71, 258.94 182.63, 252.51 195.44 C246.08 208.25, 236.95 219.16, 226.39 229.04 C215.83 238.92, 202.28 248.53, 189.18 254.72 C176.07 260.9, 162.02 264.75, 147.75 266.14 C133.48 267.53, 117.56 266.36, 103.56 263.06 C89.55 259.75, 76.11 253.89, 63.72 246.3 C51.34 238.72, 38.51 228.61, 29.25 217.57 C19.98 206.54, 13.06 193.67, 8.14 180.09 C3.22 166.52, 0.07 150.58, -0.29 136.12 C-0.65 121.66, 1.56 106.99, 5.97 93.33 C10.38 79.67, 17.41 65.7, 26.18 54.17 C34.95 42.64, 46.73 32.3, 58.58 24.16 C70.43 16.02, 82.16 9.14, 97.29 5.32 C112.41 1.49, 139.64 1.43, 149.33 1.21 C159.02 0.98, 155.94 1.84, 155.4 3.97 M99.26 4.53 C112.02 -0.72, 130.12 0.44, 144.69 1.31 C159.26 2.18, 173.43 4.11, 186.67 9.76 C199.9 15.41, 213.21 25.06, 224.11 35.18 C235.02 45.3, 245.28 57.85, 252.09 70.48 C258.9 83.1, 262.98 96.74, 264.98 110.92 C266.98 125.09, 266.32 141.01, 264.09 155.54 C261.86 170.08, 258.48 185.44, 251.6 198.14 C244.71 210.84, 233.6 222.34, 222.76 231.74 C211.93 241.15, 199.42 248.95, 186.59 254.57 C173.75 260.2, 159.85 263.97, 145.73 265.49 C131.6 267.02, 116.24 266.81, 101.84 263.72 C87.45 260.64, 71.72 254.78, 59.36 246.97 C47 239.16, 36.41 228.57, 27.7 216.87 C19 205.17, 11.73 190.61, 7.12 176.78 C2.51 162.94, 0.21 148.22, 0.04 133.87 C-0.12 119.53, 1.48 104.65, 6.12 90.71 C10.76 76.76, 18.88 61.63, 27.88 50.19 C36.88 38.74, 47.78 29.76, 60.1 22.04 C72.43 14.31, 94.71 6.52, 101.82 3.83 C108.94 1.13, 102.19 3.84, 102.79 5.88" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1177.8120944527975 158.33591940826443) rotate(0 62.2265625 25)"><text x="62.2265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comments DB </text><text x="62.2265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(926.5259697886572 183.78760920704144) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M1.03 0.35 C27.65 0.14, 133.33 -0.15, 159.87 -0.36 M0.11 -0.51 C26.53 -0.62, 132.15 0.95, 158.72 1.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(926.5259697886572 183.78760920704144) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M29.18 -10.03 C21.07 -7.19, 11.24 -3.25, 1.03 0.35 M29.18 -10.03 C22.13 -8.48, 15.62 -6.29, 1.03 0.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(926.5259697886572 183.78760920704144) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M29.27 10.49 C20.97 6.93, 11.11 4.47, 1.03 0.35 M29.27 10.49 C22.34 7.27, 15.81 4.69, 1.03 0.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(926.5259697886572 183.78760920704144) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M130.43 11.03 C139.77 7.02, 147.54 4.61, 158.72 1.04 M130.43 11.03 C136.65 8.19, 143.26 5.64, 158.72 1.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(926.5259697886572 183.78760920704144) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M130.63 -9.49 C140.06 -7.1, 147.77 -3.11, 158.72 1.04 M130.63 -9.49 C136.65 -7.56, 143.21 -5.34, 158.72 1.04" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(346.4042316370311 93.25502840522063) rotate(0 66.38994598388672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- for /create</text></g><g transform="translate(357.1651627552587 237.72114562489412) rotate(0 67.81993865966797 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- for comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"> broadcasting</text></g><g mask="url(#mask-RhyAIyJ4K8Fu4XDKBfShE)" stroke-linecap="round"><g transform="translate(297.72576824410885 213.99409994721168) rotate(0 120.91652068618482 1.6462241357955918)"><path d="M-0.52 -0.83 C39.85 -0.34, 201.05 1.52, 241.35 2.19 M1.41 1.35 C41.65 2.01, 200.35 2.63, 240.16 3.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(297.72576824410885 213.99409994721168) rotate(0 120.91652068618482 1.6462241357955918)"><path d="M27.79 -10.75 C19.88 -9.4, 12.96 -7.24, -0.52 -0.83 M27.79 -10.75 C18.69 -8.76, 11.14 -4.89, -0.52 -0.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(297.72576824410885 213.99409994721168) rotate(0 120.91652068618482 1.6462241357955918)"><path d="M27.55 9.77 C19.82 6.43, 12.96 3.91, -0.52 -0.83 M27.55 9.77 C18.34 5.73, 10.86 3.58, -0.52 -0.83" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(297.72576824410885 213.99409994721168) rotate(0 120.91652068618482 1.6462241357955918)"><path d="M211.88 13.18 C217.02 10.22, 223.03 7.82, 240.16 3.15 M211.88 13.18 C219.23 9.3, 228.29 7.31, 240.16 3.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(297.72576824410885 213.99409994721168) rotate(0 120.91652068618482 1.6462241357955918)"><path d="M212.05 -7.34 C217.02 -5.62, 222.99 -3.32, 240.16 3.15 M212.05 -7.34 C219.52 -5.19, 228.54 -1.15, 240.16 3.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-RhyAIyJ4K8Fu4XDKBfShE"><rect x="0" y="0" fill="#fff" width="639.5588096164785" height="317.28654821880286"></rect><rect x="399.7423026632038" y="203.14032408300727" fill="#000" width="37.79997253417969" height="25" opacity="1"></rect></mask><g transform="translate(399.7423026632038 203.14032408300727) rotate(0 18.401331483945256 12.014716413300476)"><text x="18.899986267089844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">SSE</text></g><g transform="translate(521.0624975672813 10) rotate(0 231.78981018066406 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- When a new comment is posted, persist in DB</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">and sent over SSE to connected clients</text></g><g transform="translate(1418.5611107187578 98.29253465178743) rotate(0 84.5299301147461 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- commentId (PK)</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- videoId (shard)</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- content</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- author</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- createdAt (SK)</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">SSE</span></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here is our updated flow:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User posts a comment and it is persisted to the database (as explained above)</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">In order for all viewers to see the comment, the Comment Management Service will send the comment over SSE to all connected clients that are subscribed to that live video.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Commenter Client will receive the comment and add it to the comment feed for the viewer to see.</div></li>
</ol>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Astute readers have probably recognized that this solution does not scale. You're right. We'll get to that in the next deep dive.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-how-will-the-system-scale-to-support-millions-of-concurrent-viewers">2) How will the system scale to support millions of concurrent viewers?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We landed on Server Sent Events (SSE) being the appropriate technology. Now we need to figure out how to scale it. With SSE, we need to maintain an open connection for each viewer. Modern servers and operating systems can handle large numbers of concurrent connectionsâ€”commonly in the range of 100k to 1Mâ€”on a single listening port. Realistically, system resources like CPU, memory, and file descriptors become the bottleneck before you hit any theoretical limit. If we want to support many millions of concurrent viewers, we simply wonâ€™t be able to do it on a single machine. We must scale horizontally by adding more servers.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The question then becomes how do we distribute the load across multiple servers and ensure each server knows which comments to send to which viewers?</div>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Contrary to a common misconception, the capacity isnâ€™t limited to 65,535 connections. That number refers to the range of port numbers, not the number of connections a single server port can handle. Each TCP connection is identified by a unique combination of source IP, source port, destination IP, and destination port. With proper OS tuning and resource allocation, a single listening port can handle hundreds of thousands or even millions of concurrent SSE connections.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In practice, however, the serverâ€™s hardware and OS limitsâ€”rather than the theoretical port limitâ€”determine the maximum number of simultaneous connections.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Before we dive into solutions, let's understand the core challenge with horizontal scaling:</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When we add more servers to handle the load, viewers watching the same live video may end up connected to different servers. For example:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">UserA is watching Live Video 1 and connected to Server 1</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">UserB is watching Live Video 1 but connected to Server 2</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now imagine a new comment is posted on Live Video 1. If this comment request hits Server 1:</div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Server 1 can easily send it to UserA since they're directly connected</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">But Server 1 has no way to send it to UserB, who is connected to Server 2</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This is our key challenge: How do we ensure all viewers see new comments, regardless of which server they're connected to?</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Horizontal Scaling with Load Balancer and Pub/Sub</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach-4">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The first thing we need to do is separate out the write and read traffic by creating Realtime Messaging Servers that are responsible for sending comments to viewers. We separate this out because the write traffic is much lower than the read traffic and we need to be able to scale the read traffic independently.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To distribute incoming traffic evenly across our multiple servers we can use a simple load balancing algorithm like <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.nginx.com/resources/glossary/round-robin-load-balancing/#:~:text=What%20Is%20Round%2DRobin%20Load,to%20each%20server%20in%20turn" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">round robin</a>. Upon connecting to a Realtime Messaging Server through the load balancer, the client needs to send a message informing the server of which live video it is watching. The Realtime Messaging Server then updates a mapping in local memory with this information. This map would look something like this:</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"liveVideoId1"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection1"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection2"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection3"</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"liveVideoId2"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection4"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection5"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection6"</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"liveVideoId3"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">[</span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection7"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection8"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"sseConnection9"</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span></code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Where <span class="MuiBox-root mui-1vu004u">sseConnection{N}</span> is a pointer to the SSE connection for that viewer. Now, anytime a new comment is created, the server can loop through the list of viewers for that live video and send the comment to each one.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The question then becomes how does each Realtime Messaging Server know that a new comment was created? The most common solution is to introduce pub/sub.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A pub/sub system is a messaging system that uses a publish/subscribe model. Publishers send messages to a channel or topic, and subscribers receive messages from a channel or topic. In our case, the comment management service would publish a message to a channel whenever a new comment is created. The Realtime Messaging Servers would all subscribe to this channel and receive the message. They would then send the comment to all the viewers that are watching the live video.</div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges-4">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach works, but it is not very efficient. Each Realtime Messaging Server needs to process every comment, even if it is not broadcasting the live video. This leads to inefficiency, slow performance, and high compute intensity thatâ€™s impractical at FB scale.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1853.7756918915254 837.9561143875326">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1853.7756918915254" height="837.9561143875326" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 251.446901748639) rotate(0 128.0182913190058 84.77455315625434)"><path d="M32 0 C70.04 -2.75, 110.58 0.64, 224.04 0 M32 0 C104.27 -1.23, 176.15 -1.66, 224.04 0 M224.04 0 C243.54 0.59, 256.39 9.9, 256.04 32 M224.04 0 C245.41 1.76, 256.95 9.05, 256.04 32 M256.04 32 C256.44 64.45, 256.26 92.55, 256.04 137.55 M256.04 32 C256.32 53.56, 256.76 74.26, 256.04 137.55 M256.04 137.55 C254.94 159.24, 243.72 169.91, 224.04 169.55 M256.04 137.55 C256.02 157.62, 246.84 168.64, 224.04 169.55 M224.04 169.55 C154.07 172.11, 84.94 170.97, 32 169.55 M224.04 169.55 C165.88 167.89, 107.94 169.32, 32 169.55 M32 169.55 C11.65 171.28, 0.42 160.45, 0 137.55 M32 169.55 C9.95 169.76, 1.35 159.95, 0 137.55 M0 137.55 C0.42 113.67, -0.47 87.49, 0 32 M0 137.55 C-0.15 95.67, 1.46 55.49, 0 32 M0 32 C0.81 10.05, 12.53 0.63, 32 0 M0 32 C0.41 8.68, 12.41 -0.23, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(63.86301788150581 323.72145490489333) rotate(0 74.1552734375 12.5)"><text x="74.1552734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commenter Client</text></g><g mask="url(#mask-M-332mNwVK0Dd5SGZHjZP)" stroke-linecap="round"><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M1.15 0.91 C42.48 1.71, 206.21 4.08, 247.08 4.55 M0.29 0.34 C41.61 0.82, 205.65 2.02, 246.54 2.79" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M29.49 -8.92 C24.57 -5.11, 17.78 -4.03, 1.15 0.91 M29.49 -8.92 C20.44 -5.96, 13.41 -3.83, 1.15 0.91" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M29.18 11.6 C24.37 10.76, 17.65 7.19, 1.15 0.91 M29.18 11.6 C20.26 8.68, 13.32 4.94, 1.15 0.91" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M218.23 12.7 C226.18 11.5, 232.22 8.11, 246.54 2.79 M218.23 12.7 C225.45 10.32, 234.64 6.8, 246.54 2.79" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M218.48 -7.82 C226.33 -4.37, 232.32 -3.12, 246.54 2.79 M218.48 -7.82 C225.58 -4.33, 234.71 -1.97, 246.54 2.79" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-M-332mNwVK0Dd5SGZHjZP"><rect x="0" y="0" fill="#fff" width="636.2513349495434" height="393.3408271784624"></rect><rect x="382.5434700875729" y="278.9095553603163" fill="#000" width="61.123046875" height="25" opacity="1"></rect></mask><g transform="translate(382.5434700875729 278.9095553603163) rotate(0 31.10192937355953 13.014939530151892)"><text x="30.5615234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">HTTPS</text></g><g stroke-linecap="round" transform="translate(563.0339881173552 10.486329565606866) rotate(0 52.987237405710914 314.61157847145796)"><path d="M26.49 0 C45.59 -0.49, 64.12 -1.87, 79.48 0 M26.49 0 C43.98 0.97, 61.83 -0.5, 79.48 0 M79.48 0 C96.98 1.93, 105.95 8.22, 105.97 26.49 M79.48 0 C99.06 -0.91, 104.82 6.53, 105.97 26.49 M105.97 26.49 C107.2 189.74, 106.86 351.08, 105.97 602.73 M105.97 26.49 C104.07 209.34, 104.33 392.48, 105.97 602.73 M105.97 602.73 C107.26 621.29, 97.85 629.18, 79.48 629.22 M105.97 602.73 C108.14 621.26, 98 629.26, 79.48 629.22 M79.48 629.22 C65.39 628.44, 55.35 630.07, 26.49 629.22 M79.48 629.22 C58.69 629.73, 39.1 630.1, 26.49 629.22 M26.49 629.22 C7.58 628.79, -1.31 620.58, 0 602.73 M26.49 629.22 C10.2 628.41, 0.08 622.4, 0 602.73 M0 602.73 C-1.7 465.33, -1.13 326.93, 0 26.49 M0 602.73 C-2.07 447.37, -1.84 292.66, 0 26.49 M0 26.49 C0.14 9.91, 9.53 -1.65, 26.49 0 M0 26.49 C1.45 9.09, 10.58 -0.36, 26.49 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(580.488998960566 300.0979080370648) rotate(0 35.5322265625 25)"><text x="35.5322265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Load </text><text x="35.5322265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Balancer</text></g><g stroke-linecap="round" transform="translate(829.0716441099037 73.28495701370684) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C109.28 2.22, 185.04 1.97, 308.62 0 M32 0 C136.03 2.24, 240.18 1.26, 308.62 0 M308.62 0 C331.62 -0.79, 339.61 8.67, 340.62 32 M308.62 0 C329.54 0.88, 341.7 11.65, 340.62 32 M340.62 32 C340.98 85.65, 340.99 142.6, 340.62 173.16 M340.62 32 C342.16 67.02, 341.87 101.13, 340.62 173.16 M340.62 173.16 C342.5 195.25, 330.69 205.19, 308.62 205.16 M340.62 173.16 C339.32 193.21, 329.34 203.8, 308.62 205.16 M308.62 205.16 C235.88 206.54, 161.67 205.73, 32 205.16 M308.62 205.16 C222.67 205.99, 137.19 206.23, 32 205.16 M32 205.16 C11.86 204.46, 0.07 196.24, 0 173.16 M32 205.16 C9.28 206.06, -1.82 192.2, 0 173.16 M0 173.16 C-0.21 121.02, 1.03 65.52, 0 32 M0 173.16 C-1 143.57, -0.72 112.07, 0 32 M0 32 C1.26 10.89, 12.19 -0.31, 32 0 M0 32 C-1.37 8.48, 10.75 1.39, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(872.7498303153175 163.364476707603) rotate(0 126.630859375 12.5)"><text x="126.630859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment Management Service</text></g><g stroke-linecap="round"><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M0.02 0.92 C20.27 0.93, 101.53 -0.49, 121.72 -0.37 M-1.43 0.35 C18.69 0.54, 100.73 0.8, 121.02 0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M28.09 -9.67 C20.66 -5.52, 8.82 -3.11, 0.02 0.92 M28.09 -9.67 C17.8 -5.96, 5.33 -2.36, 0.02 0.92" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M28.33 10.85 C20.9 8.49, 8.99 4.38, 0.02 0.92 M28.33 10.85 C17.94 6.43, 5.38 1.89, 0.02 0.92" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M92.83 10.98 C103.34 8.51, 109.36 4.3, 121.02 0.73 M92.83 10.98 C104.84 6.6, 114.68 1.94, 121.02 0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M92.84 -9.55 C103.27 -5.5, 109.29 -3.2, 121.02 0.73 M92.84 -9.55 C104.84 -5.78, 114.68 -2.31, 121.02 0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(1371.6416783284237 49.68229322763091) rotate(0 133.62108660928106 133.6788415220053)"><path d="M127.7 0.95 C141.11 -1.81, 157.51 1.08, 171.26 5.03 C185.01 8.98, 198.28 16.09, 210.19 24.65 C222.1 33.21, 234.05 44.44, 242.7 56.39 C251.35 68.35, 258.02 82.67, 262.09 96.36 C266.16 110.06, 267.77 124.4, 267.14 138.56 C266.51 152.73, 263.53 167.79, 258.31 181.36 C253.09 194.93, 245.29 208.71, 235.83 220 C226.37 231.29, 214.07 241.58, 201.55 249.11 C189.04 256.63, 174.72 262.2, 160.74 265.13 C146.75 268.07, 131.93 268.43, 117.64 266.7 C103.35 264.97, 88.01 261.1, 75 254.76 C61.99 248.41, 49.81 239.12, 39.58 228.64 C29.35 218.17, 20.15 205.01, 13.63 191.91 C7.12 178.81, 2.38 164.36, 0.48 150.04 C-1.42 135.73, -0.96 120.05, 2.23 106.02 C5.42 91.98, 11.99 78.17, 19.63 65.82 C27.27 53.48, 37.04 41.44, 48.06 31.94 C59.07 22.45, 71.64 14.09, 85.74 8.87 C99.85 3.64, 124.03 1.72, 132.67 0.59 C141.3 -0.54, 137.58 0.07, 137.55 2.09 M140.05 1.46 C153.57 0.2, 168.85 5.16, 182.08 10.04 C195.31 14.92, 208.11 21.48, 219.44 30.73 C230.77 39.98, 242.46 52.9, 250.08 65.55 C257.7 78.2, 262.28 92.28, 265.18 106.61 C268.08 120.94, 269.44 137.32, 267.5 151.53 C265.57 165.73, 260.04 179, 253.56 191.85 C247.08 204.71, 238.95 218.14, 228.64 228.65 C218.32 239.17, 204.78 248.87, 191.65 254.96 C178.52 261.05, 164.05 263.61, 149.83 265.2 C135.61 266.79, 120.35 267.4, 106.32 264.5 C92.28 261.61, 78.32 255.59, 65.64 247.84 C52.95 240.09, 39.68 228.91, 30.22 218 C20.76 207.09, 13.67 195.77, 8.89 182.39 C4.1 169, 2.2 152.51, 1.49 137.69 C0.78 122.87, 0.45 106.99, 4.63 93.47 C8.8 79.95, 17.78 68.03, 26.54 56.58 C35.31 45.12, 45.71 33.49, 57.21 24.73 C68.7 15.96, 81.61 8.2, 95.53 3.98 C109.45 -0.25, 133.21 -0.31, 140.74 -0.62 C148.27 -0.92, 141.04 -0.12, 140.73 2.14" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1443.0518259867672 158.33591940826443) rotate(0 62.2265625 24.999999999999996)"><text x="62.2265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comments DB </text><text x="62.2265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(1191.765701322627 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M-0.02 -0.37 C26.88 -0.65, 134.65 -0.4, 161.26 -0.56 M-1.48 -1.61 C25.35 -1.22, 134.16 0.56, 160.84 0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M28.16 -10.66 C19.43 -5.99, 11.04 -5.67, -0.02 -0.37 M28.16 -10.66 C22.97 -8.06, 17.78 -6.43, -0.02 -0.37" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M28.19 9.86 C19.25 8.54, 10.85 2.88, -0.02 -0.37 M28.19 9.86 C23.03 8.35, 17.83 5.88, -0.02 -0.37" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M132.53 10.65 C140.07 9.43, 148.15 3.86, 160.84 0.73 M132.53 10.65 C138.68 8.98, 144.8 6.58, 160.84 0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M132.78 -9.87 C140.45 -5.11, 148.45 -4.69, 160.84 0.73 M132.78 -9.87 C138.84 -7.43, 144.91 -5.73, 160.84 0.73" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(346.4042316370312 246.18504761431905) rotate(0 66.38994598388672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- for /create</text></g><g transform="translate(786.302229101251 10) rotate(0 231.78981018066406 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- When a new comment is posted, persist in DB</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">and broadcast via pub/sub</text></g><g stroke-linecap="round" transform="translate(817.0863844340765 509.02210954911425) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C110.68 0.42, 188.04 -1.85, 308.62 0 M32 0 C119.88 -0.81, 208.26 -0.69, 308.62 0 M308.62 0 C331.23 0.9, 341.33 10.63, 340.62 32 M308.62 0 C332.11 0.87, 341.47 10.7, 340.62 32 M340.62 32 C338.65 65.74, 341.52 101.76, 340.62 173.16 M340.62 32 C340.61 86.66, 341.5 141.61, 340.62 173.16 M340.62 173.16 C339.37 194.06, 328.64 205.35, 308.62 205.16 M340.62 173.16 C341.99 193.68, 330.04 207.17, 308.62 205.16 M308.62 205.16 C240.8 204.74, 175.62 204.1, 32 205.16 M308.62 205.16 C234.34 205.16, 160.37 205.75, 32 205.16 M32 205.16 C10.81 206.24, 0.7 192.84, 0 173.16 M32 205.16 C12.12 205.42, 1.75 194.13, 0 173.16 M0 173.16 C2.55 141.09, 0.46 103.7, 0 32 M0 173.16 C-0.75 142.84, -1.62 111.18, 0 32 M0 32 C1 9.64, 11.82 -0.9, 32 0 M0 32 C-0.71 9.88, 12.11 0.86, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(835.9349895555401 523.4753466695638) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C127.98 -2.81, 224.2 -3.24, 308.62 0 M32 0 C120.47 0.87, 208.44 1.52, 308.62 0 M308.62 0 C330.66 -0.04, 342.5 11.43, 340.62 32 M308.62 0 C330.8 0.03, 339.32 9.39, 340.62 32 M340.62 32 C341.47 71.58, 341.51 109.62, 340.62 173.16 M340.62 32 C340.77 85.87, 339.55 138.59, 340.62 173.16 M340.62 173.16 C339.31 194.68, 331.14 204.46, 308.62 205.16 M340.62 173.16 C340.7 196.5, 328.56 206.06, 308.62 205.16 M308.62 205.16 C247.07 207.55, 185.94 208.36, 32 205.16 M308.62 205.16 C217.57 203.23, 125.4 203.73, 32 205.16 M32 205.16 C11.37 203.51, 1.26 194.72, 0 173.16 M32 205.16 C12.42 204.8, -1.37 192.31, 0 173.16 M0 173.16 C-1.73 128.75, -2.53 89.04, 0 32 M0 173.16 C-1.02 117.99, 0 64.1, 0 32 M0 32 C1.16 9.76, 10.05 -0.68, 32 0 M0 32 C1.44 11.53, 12.92 1.01, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(858.1692159750826 542.5285409922753) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C140.65 -0.11, 249.02 1.16, 308.62 0 M32 0 C100.25 1.19, 167.78 0.83, 308.62 0 M308.62 0 C331.83 0.76, 341.36 10.7, 340.62 32 M308.62 0 C328.65 -1.28, 340.01 9.31, 340.62 32 M340.62 32 C343.54 70.23, 343.37 106.98, 340.62 173.16 M340.62 32 C340.82 75.39, 340.79 119.32, 340.62 173.16 M340.62 173.16 C341.81 193.79, 330.03 206.91, 308.62 205.16 M340.62 173.16 C339.23 195.39, 328.13 202.87, 308.62 205.16 M308.62 205.16 C202.33 207.47, 97.47 206.31, 32 205.16 M308.62 205.16 C249.63 205.36, 190.79 204.31, 32 205.16 M32 205.16 C11.93 205.38, 1.52 194.18, 0 173.16 M32 205.16 C9.3 202.98, 0.08 195.88, 0 173.16 M0 173.16 C-1.05 119.11, 2.31 62.65, 0 32 M0 173.16 C1.23 127.15, 1.31 81.7, 0 32 M0 32 C-0.62 9.98, 11.92 0.75, 32 0 M0 32 C2.26 11.68, 8.75 1.81, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(946.5495506179964 620.1080606861715) rotate(0 81.9287109375 25)"><text x="81.9287109375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Realtime Messaging</text><text x="81.9287109375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"> Service</text></g><g mask="url(#mask-CSQzXUQ2mHlHsWH1TUVS2)" stroke-linecap="round"><g transform="translate(283.73397110146374 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M0 0 C112.6 55.25, 225.57 109.99, 518.93 251.67 M0 0 C179.72 87, 358.47 173.66, 518.93 251.67" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.73397110146374 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M29.84 3.1 C22.24 3.7, 16.06 3.03, 0 0 M29.84 3.1 C20.48 2.4, 9.62 0.97, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.73397110146374 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M20.87 21.56 C15.19 18.14, 10.96 13.46, 0 0 M20.87 21.56 C14.53 14.5, 6.77 6.7, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-CSQzXUQ2mHlHsWH1TUVS2"><rect x="0" y="0" fill="#fff" width="902.6645805905071" height="718.5567601014213"></rect><rect x="525.9678305334853" y="480.21988123919095" fill="#000" width="34.462890625" height="25" opacity="1"></rect></mask><g transform="translate(525.9678305334853 480.21988123919095) rotate(0 17.2314453125 12.5)"><text x="17.2314453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">SSE</text></g><g stroke-linecap="round" transform="translate(976.3476131470784 336.59414485526395) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.99 10.14 C4.45 6.14, 6.5 3.07, 9.52 0.33 M0.99 10.14 C5.03 6.56, 7.42 2.63, 9.52 0.33 M0.73 16.54 C4.4 11.2, 6.54 6.55, 15.16 -0.07 M0.73 16.54 C5.54 12.27, 8.58 5.4, 15.16 -0.07 M1.13 22.18 C4.92 17.69, 12.12 8.4, 20.15 0.29 M1.13 22.18 C7.8 13.89, 15.96 5.63, 20.15 0.29 M0.86 28.58 C7.45 18.04, 17.44 9.98, 25.14 0.65 M0.86 28.58 C5.71 22.66, 11.88 15.35, 25.14 0.65 M1.26 34.22 C11.1 25.28, 20.53 11.77, 30.78 0.26 M1.26 34.22 C7.92 26.8, 14.13 19.64, 30.78 0.26 M1 40.62 C11.54 29.28, 21.73 16.46, 34.46 2.13 M1 40.62 C9.08 33.41, 15.55 25.03, 34.46 2.13 M0.74 47.02 C16.73 31.08, 29.9 14.3, 37.48 4.75 M0.74 47.02 C8.91 36.63, 19.82 26.15, 37.48 4.75 M1.13 52.66 C11.07 39.11, 22.29 28.1, 40.49 7.38 M1.13 52.66 C15.44 35.99, 29.34 19.13, 40.49 7.38 M0.87 59.06 C14.12 44.69, 26.46 29.02, 40.23 13.77 M0.87 59.06 C7.64 50.05, 17.46 41.28, 40.23 13.77 M1.26 64.7 C10.53 55.86, 18.41 45.83, 40.63 19.42 M1.26 64.7 C13.95 50.52, 25.17 37.39, 40.63 19.42 M1 71.1 C13.01 55.28, 29.4 38.08, 40.37 25.81 M1 71.1 C12.75 56.2, 26.56 41.75, 40.37 25.81 M1.4 76.74 C9.31 64.93, 19.13 57.02, 40.76 31.46 M1.4 76.74 C15.7 60.73, 29.96 45.67, 40.76 31.46 M1.14 83.14 C10.84 71.93, 23.02 56.95, 40.5 37.86 M1.14 83.14 C15.67 65.46, 30.2 47.6, 40.5 37.86 M1.53 88.78 C11.41 80.11, 16.18 68.21, 40.89 43.5 M1.53 88.78 C13.17 76.55, 25.13 62.13, 40.89 43.5 M1.27 95.18 C15.44 79.79, 28.66 63.65, 40.63 49.9 M1.27 95.18 C9.67 83.8, 18.56 74.76, 40.63 49.9 M1.01 101.58 C15.7 85.63, 32 66.79, 40.37 56.29 M1.01 101.58 C9.64 89.73, 18.7 79.11, 40.37 56.29 M1.4 107.22 C13.02 93.09, 26.38 79.99, 40.77 61.94 M1.4 107.22 C9.16 95.96, 18.64 87.26, 40.77 61.94 M1.14 113.62 C9.94 99.1, 22.33 89.23, 40.5 68.34 M1.14 113.62 C15.54 96.14, 31.79 78.59, 40.5 68.34 M0.88 120.02 C11.07 109.81, 21.47 97.68, 40.9 73.98 M0.88 120.02 C9.81 110.52, 19.15 99.45, 40.9 73.98 M3.24 123.39 C13.02 110.85, 24.91 100.61, 40.64 80.38 M3.24 123.39 C12.87 110.72, 24.97 99.92, 40.64 80.38 M6.26 126.02 C18.96 109.84, 30.7 96.57, 41.03 86.02 M6.26 126.02 C20.64 110.77, 33.56 93.57, 41.03 86.02 M11.9 125.62 C21.88 113.89, 30.57 104.87, 40.77 92.42 M11.9 125.62 C19.96 116.25, 29.68 106.59, 40.77 92.42 M16.89 125.98 C22.54 119.26, 31.16 109.25, 41.17 98.06 M16.89 125.98 C26.3 115.99, 35.63 103.81, 41.17 98.06 M22.53 125.59 C28.94 119.1, 31.19 113.94, 40.9 104.46 M22.53 125.59 C29.57 117.56, 35.85 110.75, 40.9 104.46 M27.52 125.95 C34.27 119.92, 38.39 112.71, 40.64 110.86 M27.52 125.95 C32.21 120.17, 38 115.64, 40.64 110.86 M33.16 125.55 C36.45 122.04, 39.12 119.65, 40.38 117.25 M33.16 125.55 C35.14 122.98, 37.02 120.91, 40.38 117.25" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C17.52 0.56, 23.64 1.69, 28.93 0 M9.64 0 C15.61 -0.54, 22.42 -0.57, 28.93 0 M28.93 0 C34.71 1.69, 39.55 4.95, 38.57 9.64 M28.93 0 C35.84 1.8, 37.85 3.42, 38.57 9.64 M38.57 9.64 C38.63 46.43, 39.25 87.04, 38.57 115.91 M38.57 9.64 C38 38.18, 37.82 64.94, 38.57 115.91 M38.57 115.91 C40.22 121.76, 36.17 124.93, 28.93 125.55 M38.57 115.91 C40.71 123.06, 35.77 123.56, 28.93 125.55 M28.93 125.55 C22.73 126.24, 12.85 126.78, 9.64 125.55 M28.93 125.55 C22.35 124.61, 16.96 126.1, 9.64 125.55 M9.64 125.55 C5.09 124.67, -1.56 120.66, 0 115.91 M9.64 125.55 C5.01 127.49, 0.82 122.85, 0 115.91 M0 115.91 C-0.08 90.72, 0.05 62.6, 0 9.64 M0 115.91 C0.32 88.1, -1.5 60.21, 0 9.64 M0 9.64 C0.83 4.28, 4.72 1.97, 9.64 0 M0 9.64 C-2.21 2.39, 5.35 0.42, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(996.6877395421593 293.1552376740756) rotate(0 0 15.383788003548034)"><path d="M0.19 -0.01 C0.22 5.11, 0.52 25.85, 0.52 30.98 M-0.37 -0.49 C-0.4 4.44, 0.3 24.81, 0.35 30.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6877395421593 293.1552376740756) rotate(0 0 15.383788003548034)"><path d="M-5.24 15.79 C-3.19 21.72, -0.85 26.5, 0.35 30.12 M-5.24 15.79 C-3.7 19.9, -2.03 24.77, 0.35 30.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6877395421593 293.1552376740756) rotate(0 0 15.383788003548034)"><path d="M5.28 15.54 C3.5 21.58, 2.01 26.45, 0.35 30.12 M5.28 15.54 C3.65 19.7, 2.14 24.64, 0.35 30.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(996.2389632297436 468.0196078765648) rotate(0 0 14.436737991317386)"><path d="M0.52 0.21 C0.52 5.02, 0.34 24.16, 0.2 28.88 M0.12 -0.16 C0.05 4.75, 0.03 24.72, -0.12 29.58" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.2389632297436 468.0196078765648) rotate(0 0 14.436737991317386)"><path d="M-4.87 15.95 C-3 20.77, -1.68 24.67, -0.12 29.58 M-4.87 15.95 C-3.84 19.6, -2.39 22.94, -0.12 29.58" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.2389632297436 468.0196078765648) rotate(0 0 14.436737991317386)"><path d="M5.01 16.09 C3.56 20.91, 1.57 24.76, -0.12 29.58 M5.01 16.09 C3.62 19.68, 2.66 22.98, -0.12 29.58" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(1033.1904128358626 355.30415729201195) rotate(0 129.82989501953125 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Redis Pub/Sub</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- broadcast new comments</text></g><g transform="translate(819.0374467461397 777.9561143875326) rotate(0 193.97984313964844 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- needs to process EVERY new comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">and it computationally overwhelmed </text></g><g transform="translate(1674.7158316620332 95.26372876310069) rotate(0 84.5299301147461 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- commentId (PK)</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- videoId (shard)</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- content</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- author</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- createdAt (SK)</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Simple Pub/Sub</span></div></div></div></div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Pub/Sub Partitioning into Channels per Live Video</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach-5">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To improve upon the previous approach, we can partition the comment stream into different channels based on the live video. Each Realtime Messaging Server would subscribe only to the channels it needs, determined by the viewers connected to it.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Since having a channel per live video will consume a lot of resources and, in some cases like with Kafka may even be infeasible, we can use a hashing function to distribute the load across multiple channels.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can create N channels and determine which channel to broadcast a comment to based on <span class="MuiBox-root mui-1vu004u">hash(liveVideoId) % N</span>.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This ensures there is a reasonable upper bound on the number of channels.</div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges-5">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While this approach is more efficient, it is not perfect. With the load balancer using round robin, there's a risk that a server could end up with viewers subscribed to many different streams, replicating the issue from the previous approach.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1859.956650989362 837.4024881631581">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1859.956650989362" height="837.4024881631581" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 251.446901748639) rotate(0 128.0182913190058 84.77455315625434)"><path d="M32 0 C96.07 2.68, 154.93 -0.13, 224.04 0 M32 0 C94.73 0.8, 158.04 -0.73, 224.04 0 M224.04 0 C244.19 -1.22, 254.17 8.78, 256.04 32 M224.04 0 C244.39 1.24, 254.42 8.67, 256.04 32 M256.04 32 C254.73 70.7, 254.8 104.2, 256.04 137.55 M256.04 32 C256.63 70.79, 257.6 111.34, 256.04 137.55 M256.04 137.55 C257.84 159.17, 245.7 169.49, 224.04 169.55 M256.04 137.55 C256.63 160.7, 243.77 169.83, 224.04 169.55 M224.04 169.55 C182.51 167.74, 143.17 169.27, 32 169.55 M224.04 169.55 C176.65 170.49, 131.54 170.87, 32 169.55 M32 169.55 C12.15 169.58, -0.12 158.95, 0 137.55 M32 169.55 C11.24 167.83, 0.32 159.63, 0 137.55 M0 137.55 C-1.86 100.08, 0.72 63.22, 0 32 M0 137.55 C1.05 107.9, 1 77.5, 0 32 M0 32 C1.52 10.13, 8.92 0.38, 32 0 M0 32 C1.61 10.8, 10.44 -2.22, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(63.86301788150581 323.72145490489333) rotate(0 74.1552734375 12.5)"><text x="74.1552734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commenter Client</text></g><g mask="url(#mask-ZAvQFxypSqjgHa3H2FpDX)" stroke-linecap="round"><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M-1.1 0.34 C39.87 1.1, 205.27 3.07, 246.42 3.79 M0.52 -0.52 C41.3 0.5, 204.83 4.74, 245.54 5.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M27.23 -9.53 C17.86 -6.13, 7.28 -3.7, -1.1 0.34 M27.23 -9.53 C16.18 -6.74, 5.4 -3.44, -1.1 0.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M26.95 10.99 C17.8 7.23, 7.32 2.51, -1.1 0.34 M26.95 10.99 C16.04 6.22, 5.37 1.97, -1.1 0.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M217.14 14.96 C227.68 12.06, 236.89 7.68, 245.54 5.29 M217.14 14.96 C227.03 11.03, 237.15 7.13, 245.54 5.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M217.57 -5.55 C227.83 -1.3, 236.89 1.47, 245.54 5.29 M217.57 -5.55 C227.26 -1.93, 237.22 1.73, 245.54 5.29" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-ZAvQFxypSqjgHa3H2FpDX"><rect x="0" y="0" fill="#fff" width="636.2513349495434" height="393.3408271784624"></rect><rect x="382.5434700875729" y="278.9095553603163" fill="#000" width="61.123046875" height="25" opacity="1"></rect></mask><g transform="translate(382.5434700875729 278.9095553603163) rotate(0 30.07452576719224 12.952481928803024)"><text x="30.5615234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">HTTPS</text></g><g stroke-linecap="round" transform="translate(563.033988117355 10.486329565606866) rotate(0 52.987237405710914 314.61157847145796)"><path d="M26.49 0 C44.32 -0.21, 57.71 -0.97, 79.48 0 M26.49 0 C38.74 1.04, 51.14 -0.37, 79.48 0 M79.48 0 C98.14 0.36, 107.31 7.34, 105.97 26.49 M79.48 0 C99.21 -1.64, 104.12 10.53, 105.97 26.49 M105.97 26.49 C107.17 248, 108.04 469.13, 105.97 602.73 M105.97 26.49 C106.45 207.97, 106.07 388.85, 105.97 602.73 M105.97 602.73 C104.18 620.91, 96.09 628.09, 79.48 629.22 M105.97 602.73 C105.05 620.31, 97.99 627.88, 79.48 629.22 M79.48 629.22 C64.04 629.28, 50.38 630.18, 26.49 629.22 M79.48 629.22 C63.75 628.5, 47.66 629.57, 26.49 629.22 M26.49 629.22 C9.91 630.03, 0.36 618.95, 0 602.73 M26.49 629.22 C8.7 630.54, 0.45 620.04, 0 602.73 M0 602.73 C0.78 480.1, 0.5 357.94, 0 26.49 M0 602.73 C2.3 445.4, 1.98 287.64, 0 26.49 M0 26.49 C-1.22 8.87, 9.62 0.6, 26.49 0 M0 26.49 C0.19 8.08, 8.59 -0.84, 26.49 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(580.4889989605658 300.0979080370648) rotate(0 35.5322265625 25)"><text x="35.5322265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Load </text><text x="35.5322265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Balancer</text></g><g stroke-linecap="round" transform="translate(829.0716441099039 73.28495701370684) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C108.21 -0.18, 184.84 0.61, 308.62 0 M32 0 C130.29 2, 228.33 1.28, 308.62 0 M308.62 0 C331.75 -1.43, 339.01 12.15, 340.62 32 M308.62 0 C331.87 1.74, 339.96 9.1, 340.62 32 M340.62 32 C341.48 84.36, 341.13 136.58, 340.62 173.16 M340.62 32 C338.74 85.78, 339.11 138.48, 340.62 173.16 M340.62 173.16 C339.81 194.42, 330.69 203.99, 308.62 205.16 M340.62 173.16 C339.98 196.22, 327.66 203.99, 308.62 205.16 M308.62 205.16 C217.6 206.65, 126.59 207.13, 32 205.16 M308.62 205.16 C246.67 206.17, 184.02 205.3, 32 205.16 M32 205.16 C10.56 206.3, 0.39 194.19, 0 173.16 M32 205.16 C8.66 204.7, 0.29 195.41, 0 173.16 M0 173.16 C-0.6 127.89, 0.31 87.52, 0 32 M0 173.16 C-0.48 130.01, 0.53 87.11, 0 32 M0 32 C0.17 10.02, 10.46 -0.73, 32 0 M0 32 C2.03 9.53, 10.77 -0.9, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(872.7498303153177 163.364476707603) rotate(0 126.630859375 12.5)"><text x="126.630859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment Management Service</text></g><g stroke-linecap="round"><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M-0.51 0.65 C19.74 0.74, 100.01 -0.58, 120.4 -0.57 M1.42 -0.06 C22.15 0.25, 102.68 0.06, 122.67 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M27.57 -9.91 C22.75 -9.25, 14.12 -4.67, -0.51 0.65 M27.57 -9.91 C19.61 -7.47, 8.98 -2.67, -0.51 0.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M27.79 10.61 C23.11 7.03, 14.44 7.37, -0.51 0.65 M27.79 10.61 C19.62 6.52, 8.92 4.8, -0.51 0.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M94.42 10.49 C101.43 7.13, 104.45 7.44, 122.67 0.42 M94.42 10.49 C104.23 6.79, 111.51 5.04, 122.67 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.03302553662797) rotate(0 60.622670454105105 0.2366320119174361)"><path d="M94.55 -10.03 C101.34 -9.15, 104.34 -4.6, 122.67 0.42 M94.55 -10.03 C104.46 -7.21, 111.7 -2.44, 122.67 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(1371.641678328424 49.68229322763091) rotate(0 133.62108660928106 133.6788415220053)"><path d="M165.7 4.99 C179.39 6.08, 193.66 13.07, 206.01 20.97 C218.37 28.88, 230.7 40.92, 239.82 52.43 C248.95 63.93, 256.31 76.35, 260.77 90.01 C265.22 103.67, 266.62 119.72, 266.56 134.39 C266.5 149.06, 264.96 164.41, 260.4 178.01 C255.84 191.61, 248.15 204.66, 239.2 215.97 C230.24 227.28, 218.66 238.09, 206.66 245.86 C194.66 253.63, 181.19 259.22, 167.19 262.58 C153.2 265.93, 137.18 267.17, 122.68 266 C108.18 264.83, 93.54 261.29, 80.18 255.56 C66.82 249.83, 53.23 241.26, 42.54 231.61 C31.85 221.96, 22.94 210.35, 16.06 197.65 C9.17 184.94, 3.48 169.88, 1.23 155.38 C-1.01 140.88, 0.18 124.83, 2.58 110.66 C4.97 96.48, 8.87 82.76, 15.61 70.32 C22.35 57.89, 32.29 45.91, 43.02 36.05 C53.75 26.2, 66.71 17.08, 79.98 11.19 C93.26 5.3, 107.92 1.75, 122.65 0.7 C137.38 -0.34, 160.26 3.62, 168.38 4.94 C176.49 6.27, 171.75 6.51, 171.35 8.67 M86.84 8.34 C98.75 1.33, 113.96 0.04, 128.4 -0.24 C142.83 -0.53, 159.42 2.27, 173.47 6.62 C187.52 10.98, 200.86 17.51, 212.69 25.89 C224.52 34.27, 236.41 45, 244.43 56.91 C252.45 68.82, 256.88 83.36, 260.82 97.36 C264.77 111.36, 268.68 126.73, 268.1 140.89 C267.53 155.05, 263.11 168.91, 257.36 182.31 C251.62 195.72, 242.98 210.08, 233.62 221.32 C224.27 232.57, 213.56 242.61, 201.23 249.78 C188.89 256.95, 173.91 261.71, 159.6 264.35 C145.28 266.98, 129.48 267.58, 115.35 265.58 C101.22 263.57, 87.7 258.84, 74.82 252.32 C61.94 245.8, 48.48 236.85, 38.08 226.47 C27.68 216.1, 18.69 202.87, 12.43 190.07 C6.18 177.27, 2.26 163.98, 0.54 149.68 C-1.18 135.38, -1.18 118.49, 2.12 104.27 C5.42 90.06, 12.55 76.62, 20.34 64.39 C28.13 52.17, 37.65 40.27, 48.84 30.93 C60.03 21.59, 81.04 11.41, 87.46 8.35 C93.89 5.28, 86.94 10.55, 87.38 12.54" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1443.0518259867674 158.33591940826443) rotate(0 62.2265625 25)"><text x="62.2265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comments DB </text><text x="62.2265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(1191.7657013226271 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M0.8 -0.9 C27.59 -1.09, 134.92 -1.22, 161.34 -0.94 M-0.23 1.25 C26.44 1.17, 133.97 0.54, 160.96 0.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M28.98 -11.2 C17.65 -5.61, 7.87 -5.42, 0.8 -0.9 M28.98 -11.2 C18.24 -7.82, 8.68 -2.88, 0.8 -0.9" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M29.01 9.32 C17.64 7.73, 7.84 0.75, 0.8 -0.9 M29.01 9.32 C18.09 5.03, 8.52 2.3, 0.8 -0.9" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M132.86 10.68 C141.17 8.61, 151.06 1.52, 160.96 0.15 M132.86 10.68 C142.99 5.85, 154.47 3, 160.96 0.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.787609207041) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M132.67 -9.84 C141.09 -4.74, 151.04 -4.65, 160.96 0.15 M132.67 -9.84 C143.05 -7, 154.59 -2.18, 160.96 0.15" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(1681.2967846563542 102.70819098893753) rotate(0 84.3299331665039 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- commentId</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- videoId (PK)</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- content</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- author</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- createdAt (SK)</text></g><g transform="translate(346.4042316370312 246.18504761431905) rotate(0 66.38994598388672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- for /create</text></g><g transform="translate(786.3022291012512 10) rotate(0 231.78981018066406 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- When a new comment is posted, persist in DB</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">and sent over SSE to connected clients</text></g><g stroke-linecap="round" transform="translate(817.0863844340765 509.0221095491138) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C137.02 1.67, 244.76 2, 308.62 0 M32 0 C119.16 0.67, 205.39 0.15, 308.62 0 M308.62 0 C328.16 0.52, 339.57 9.53, 340.62 32 M308.62 0 C329.03 -0.08, 341.46 9.32, 340.62 32 M340.62 32 C340.67 71.03, 341.44 110.37, 340.62 173.16 M340.62 32 C340.78 73.83, 340.67 117.48, 340.62 173.16 M340.62 173.16 C341.7 195.3, 330.32 203.72, 308.62 205.16 M340.62 173.16 C340.49 195.81, 330.4 204.81, 308.62 205.16 M308.62 205.16 C250.33 205.56, 190.89 206.6, 32 205.16 M308.62 205.16 C233.62 205.61, 157.47 204.82, 32 205.16 M32 205.16 C9.44 205.2, 0.78 195.09, 0 173.16 M32 205.16 C10.86 204.41, -0.24 193.65, 0 173.16 M0 173.16 C-0.09 117.78, -0.47 63.19, 0 32 M0 173.16 C1.45 121.18, 1.23 68.7, 0 32 M0 32 C1.22 10.37, 10.52 1.96, 32 0 M0 32 C-1.78 9.48, 9.76 -0.74, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(835.9349895555401 523.4753466695634) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C107.72 -0.07, 182.41 -1.21, 308.62 0 M32 0 C113.69 -1.6, 195.76 -1.49, 308.62 0 M308.62 0 C328.9 -1.13, 339.81 10.6, 340.62 32 M308.62 0 C330.8 -1.34, 339.98 12.39, 340.62 32 M340.62 32 C339.66 61.8, 339.94 88.51, 340.62 173.16 M340.62 32 C341.11 75.18, 341.51 118.11, 340.62 173.16 M340.62 173.16 C340.98 193.05, 329.84 206.3, 308.62 205.16 M340.62 173.16 C341.06 194.14, 327.95 204.7, 308.62 205.16 M308.62 205.16 C222.2 206.51, 135.23 203.99, 32 205.16 M308.62 205.16 C220.32 204.54, 131.7 205.3, 32 205.16 M32 205.16 C11.45 205.76, 0.17 193.84, 0 173.16 M32 205.16 C10.43 204.32, 2.03 193.36, 0 173.16 M0 173.16 C-0.62 129.76, 1.97 85.75, 0 32 M0 173.16 C-0.4 134.84, -0.03 95.98, 0 32 M0 32 C-0.15 12.63, 9.12 -1.03, 32 0 M0 32 C-0.91 9.92, 11.96 -1.33, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(858.1692159750828 542.5285409922758) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C134.19 -1.68, 235.9 -1.53, 308.62 0 M32 0 C136.19 -0.06, 241.36 -0.7, 308.62 0 M308.62 0 C329.15 -0.07, 341.35 9.5, 340.62 32 M308.62 0 C329.32 1.73, 338.33 9.5, 340.62 32 M340.62 32 C340.48 78.34, 340.52 125.42, 340.62 173.16 M340.62 32 C341.35 64.23, 341 94.93, 340.62 173.16 M340.62 173.16 C340.51 195.63, 330.34 204.85, 308.62 205.16 M340.62 173.16 C338.62 194.03, 330.24 206.08, 308.62 205.16 M308.62 205.16 C222.92 205.43, 138.35 207.86, 32 205.16 M308.62 205.16 C223.54 203.11, 139.71 203.32, 32 205.16 M32 205.16 C10.83 204.51, -0.21 193.76, 0 173.16 M32 205.16 C12.69 204.02, 0.11 193.59, 0 173.16 M0 173.16 C2.24 133.61, 0.28 97.8, 0 32 M0 173.16 C0.28 125.81, -0.4 79.74, 0 32 M0 32 C-1.55 9.64, 9.88 -0.65, 32 0 M0 32 C1.3 9.34, 9.13 0.69, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(946.5495506179966 620.1080606861719) rotate(0 81.9287109375 25)"><text x="81.9287109375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Realtime Messaging</text><text x="81.9287109375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"> Service</text></g><g mask="url(#mask-ICjgZoxjzX0PWLqpPYGDN)" stroke-linecap="round"><g transform="translate(283.7339711014638 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M0 0 C164.77 78.53, 328.4 157.99, 518.93 251.67 M0 0 C168.43 83.18, 337.85 164.98, 518.93 251.67" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.7339711014638 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M29.85 3.01 C21.99 0.74, 11.21 -0.61, 0 0 M29.85 3.01 C19.73 1.83, 10.78 0.3, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.7339711014638 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M20.93 21.49 C15.9 13.36, 7.94 6.16, 0 0 M20.93 21.49 C13.82 14.34, 7.77 6.78, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-ICjgZoxjzX0PWLqpPYGDN"><rect x="0" y="0" fill="#fff" width="902.6645805905071" height="718.5567601014213"></rect><rect x="525.9678305334854" y="480.21988123919095" fill="#000" width="34.462890625" height="25" opacity="1"></rect></mask><g transform="translate(525.9678305334854 480.21988123919095) rotate(0 17.2314453125 12.5)"><text x="17.2314453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">SSE</text></g><g stroke-linecap="round" transform="translate(976.3476131470784 336.59414485526395) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.99 10.14 C3.59 7.17, 7.15 2.67, 9.52 0.33 M0.99 10.14 C3.21 7.67, 5.64 4.78, 9.52 0.33 M0.73 16.54 C4.75 10.83, 12.73 3.01, 15.16 -0.07 M0.73 16.54 C4.43 11.83, 7.72 8.22, 15.16 -0.07 M1.13 22.18 C4.75 18.2, 11.37 12.71, 20.15 0.29 M1.13 22.18 C7.33 13.23, 14.89 5.83, 20.15 0.29 M0.86 28.58 C9.67 18.61, 20.27 8.22, 25.14 0.65 M0.86 28.58 C8.58 19.25, 16.97 9.94, 25.14 0.65 M1.26 34.22 C13.73 21.73, 21.64 11.4, 30.78 0.26 M1.26 34.22 C8.57 26.56, 14.98 20.31, 30.78 0.26 M1 40.62 C12.03 28.15, 20.91 18.21, 34.46 2.13 M1 40.62 C12.29 27.85, 21.93 14.71, 34.46 2.13 M0.74 47.02 C15.21 32.84, 26.68 17.6, 37.48 4.75 M0.74 47.02 C14.73 30.51, 29.18 14.03, 37.48 4.75 M1.13 52.66 C15.15 37.36, 26.03 20.67, 40.49 7.38 M1.13 52.66 C13.12 39.2, 23.39 25.71, 40.49 7.38 M0.87 59.06 C9.83 48.24, 23.65 34.17, 40.23 13.77 M0.87 59.06 C14.18 43.24, 27.24 29.18, 40.23 13.77 M1.26 64.7 C15.64 47.7, 28.46 32.38, 40.63 19.42 M1.26 64.7 C14.45 48.49, 27.92 32.88, 40.63 19.42 M1 71.1 C9.81 57.01, 24.07 44.95, 40.37 25.81 M1 71.1 C16.87 53.15, 30.57 37.29, 40.37 25.81 M1.4 76.74 C14.22 60.8, 31.05 43.34, 40.76 31.46 M1.4 76.74 C18.35 59.06, 33.71 40.32, 40.76 31.46 M1.14 83.14 C11.84 68.35, 22.77 55.68, 40.5 37.86 M1.14 83.14 C15.65 67.82, 29.7 51.98, 40.5 37.86 M1.53 88.78 C8.98 80.31, 21.07 67.66, 40.89 43.5 M1.53 88.78 C11.11 78.33, 21.06 65.22, 40.89 43.5 M1.27 95.18 C14.37 81.72, 26.15 64.78, 40.63 49.9 M1.27 95.18 C14.3 78.55, 28.63 64.2, 40.63 49.9 M1.01 101.58 C13.05 89.38, 25.15 75.45, 40.37 56.29 M1.01 101.58 C11.3 89.58, 24 75.8, 40.37 56.29 M1.4 107.22 C9.45 98.32, 20.95 86.26, 40.77 61.94 M1.4 107.22 C14.62 90.8, 29.3 76.14, 40.77 61.94 M1.14 113.62 C17.78 95.85, 29.22 79.73, 40.5 68.34 M1.14 113.62 C14.92 96.96, 30.15 80.03, 40.5 68.34 M0.88 120.02 C11.46 106.23, 22.88 92.03, 40.9 73.98 M0.88 120.02 C10.83 108.89, 20.07 99.18, 40.9 73.98 M3.24 123.39 C13.6 110.89, 26.41 97.19, 40.64 80.38 M3.24 123.39 C15.88 106.89, 30.14 93.21, 40.64 80.38 M6.26 126.02 C13.58 116.93, 23.52 103.65, 41.03 86.02 M6.26 126.02 C18.44 111.5, 29.98 99.5, 41.03 86.02 M11.9 125.62 C17.9 118.35, 24.88 106.51, 40.77 92.42 M11.9 125.62 C22.39 113.05, 31.63 101.72, 40.77 92.42 M16.89 125.98 C21.56 118.21, 27.38 111.99, 41.17 98.06 M16.89 125.98 C23.82 117.46, 31.54 108.41, 41.17 98.06 M22.53 125.59 C28.66 118.24, 37.08 107.38, 40.9 104.46 M22.53 125.59 C27.31 119.88, 33.51 112.63, 40.9 104.46 M27.52 125.95 C30.35 121.6, 37.61 115.08, 40.64 110.86 M27.52 125.95 C30.76 122.63, 34.53 117.4, 40.64 110.86 M33.16 125.55 C34.84 122.19, 36.85 121.34, 40.38 117.25 M33.16 125.55 C35.71 122.8, 38.06 120.11, 40.38 117.25" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C14.58 -0.84, 17.44 -0.6, 28.93 0 M9.64 0 C15.09 0.84, 20.12 -0.38, 28.93 0 M28.93 0 C35.94 -0.24, 40.05 3.25, 38.57 9.64 M28.93 0 C35.22 0.08, 39.14 1.5, 38.57 9.64 M38.57 9.64 C39.72 43.37, 37.48 76.25, 38.57 115.91 M38.57 9.64 C37.9 47.39, 38.9 85.93, 38.57 115.91 M38.57 115.91 C38.73 122.43, 36.87 125.01, 28.93 125.55 M38.57 115.91 C36.56 122.77, 36.97 125.69, 28.93 125.55 M28.93 125.55 C23.37 126.19, 18.31 125.59, 9.64 125.55 M28.93 125.55 C24.62 125, 18.65 125.1, 9.64 125.55 M9.64 125.55 C2.62 124.38, -0.4 123.75, 0 115.91 M9.64 125.55 C1.59 124.93, 1.04 123.13, 0 115.91 M0 115.91 C-0.5 81.41, 1.75 45.65, 0 9.64 M0 115.91 C0.98 88.92, -0.25 63.39, 0 9.64 M0 9.64 C-1.54 4.74, 5.21 0.56, 9.64 0 M0 9.64 C-1.96 4.42, 1.64 -1.2, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(985.6317952776518 386.8700313802517) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v3</text></g><g stroke-linecap="round"><g transform="translate(996.6877395421593 293.1552376740756) rotate(0 0 15.383788003548034)"><path d="M-0.22 -0.02 C-0.14 5.11, 0.19 25.25, 0.2 30.45 M0.67 -0.5 C0.72 4.71, 0.08 25.84, -0.13 30.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6877395421593 293.1552376740756) rotate(0 0 15.383788003548034)"><path d="M-4.9 16.36 C-3.78 20.27, -3.03 23.39, -0.13 30.98 M-4.9 16.36 C-3.07 21.81, -1.11 27.35, -0.13 30.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6877395421593 293.1552376740756) rotate(0 0 15.383788003548034)"><path d="M5.62 16.71 C4.13 20.51, 2.29 23.55, -0.13 30.98 M5.62 16.71 C3.51 22, 1.52 27.41, -0.13 30.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(996.2389632297436 468.0196078765648) rotate(0 0 14.436737991317386)"><path d="M0.2 -0.32 C0.21 4.56, -0.03 24.47, -0.15 29.29 M-0.36 0.7 C-0.41 5.44, -0.8 23.81, -0.66 28.53" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.2389632297436 468.0196078765648) rotate(0 0 14.436737991317386)"><path d="M-5.61 14.97 C-4.75 18.29, -2.5 21.29, -0.66 28.53 M-5.61 14.97 C-4.09 18.36, -3.14 21.75, -0.66 28.53" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.2389632297436 468.0196078765648) rotate(0 0 14.436737991317386)"><path d="M4.26 14.96 C2.56 18.3, 2.24 21.31, -0.66 28.53 M4.26 14.96 C3.32 18.35, 1.81 21.74, -0.66 28.53" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(1162.5252690422562 347.446550002212) rotate(0 131.44989013671875 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Redis Pub/Sub</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- broadcast new comments</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- partition by live videoId </text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">    (so topic per video)</text></g><g transform="translate(789.3795927790156 777.4024881631581) rotate(0 251.31976318359375 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Subscribe only to the topics with comments from </text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">    live videos that your clients are watching</text></g><g stroke-linecap="round" transform="translate(921.0440831593521 336.1969815445191) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.99 10.14 C5.09 7.82, 6.37 3.46, 9.52 0.33 M0.99 10.14 C4.51 6.63, 8.13 1.84, 9.52 0.33 M0.73 16.54 C7.81 9.87, 10.6 5.78, 15.16 -0.07 M0.73 16.54 C6.75 10.56, 11.35 2.6, 15.16 -0.07 M1.13 22.18 C7.69 17.76, 11.66 10.52, 20.15 0.29 M1.13 22.18 C8.95 13.34, 15.44 5.24, 20.15 0.29 M0.86 28.58 C8.08 17.25, 20.1 7.89, 25.14 0.65 M0.86 28.58 C6.52 21.22, 13.38 14.66, 25.14 0.65 M1.26 34.22 C11.76 22.29, 23.72 8.37, 30.78 0.26 M1.26 34.22 C10.87 24.09, 20.01 13.1, 30.78 0.26 M1 40.62 C6.89 30.91, 16.32 24.88, 34.46 2.13 M1 40.62 C12.3 27.33, 22.15 15.68, 34.46 2.13 M0.74 47.02 C8.97 36.66, 18.12 27.35, 37.48 4.75 M0.74 47.02 C9.64 38.02, 17.35 29.01, 37.48 4.75 M1.13 52.66 C12.76 40.11, 20.15 30.74, 40.49 7.38 M1.13 52.66 C13.56 37.04, 27.23 21.38, 40.49 7.38 M0.87 59.06 C12 44.5, 23.3 32.17, 40.23 13.77 M0.87 59.06 C9.22 49.03, 17.38 38.66, 40.23 13.77 M1.26 64.7 C11.2 53.81, 20.24 39.41, 40.63 19.42 M1.26 64.7 C16.81 46.64, 32.43 29.12, 40.63 19.42 M1 71.1 C11.25 61.42, 17.57 50.71, 40.37 25.81 M1 71.1 C11.88 57.48, 25.52 43.8, 40.37 25.81 M1.4 76.74 C15.97 60.96, 29.27 42.51, 40.76 31.46 M1.4 76.74 C10.16 66.03, 21.03 55.27, 40.76 31.46 M1.14 83.14 C14.01 67.23, 29.33 50.6, 40.5 37.86 M1.14 83.14 C16.73 65.81, 31.04 49.8, 40.5 37.86 M1.53 88.78 C12.44 77.48, 23.32 65.76, 40.89 43.5 M1.53 88.78 C12.75 76.5, 22.92 62.84, 40.89 43.5 M1.27 95.18 C12.07 80.2, 25.99 67.66, 40.63 49.9 M1.27 95.18 C17.67 76.66, 31.25 60.88, 40.63 49.9 M1.01 101.58 C12.33 86.26, 25.09 73.75, 40.37 56.29 M1.01 101.58 C14.53 85.98, 26.89 70.46, 40.37 56.29 M1.4 107.22 C18.46 90.76, 34.4 71.02, 40.77 61.94 M1.4 107.22 C9.32 98.06, 16.03 89.18, 40.77 61.94 M1.14 113.62 C11.17 104.99, 18.21 92.67, 40.5 68.34 M1.14 113.62 C9.83 104, 19.98 92.6, 40.5 68.34 M0.88 120.02 C14.86 106, 25.39 91.24, 40.9 73.98 M0.88 120.02 C13.59 105.3, 26.17 88.7, 40.9 73.98 M3.24 123.39 C15.79 111.85, 25.26 97.81, 40.64 80.38 M3.24 123.39 C15.2 111.05, 26.35 97.02, 40.64 80.38 M6.26 126.02 C18.07 112.75, 28.77 99.67, 41.03 86.02 M6.26 126.02 C14.43 116.99, 21.19 108.65, 41.03 86.02 M11.9 125.62 C20.13 118.44, 24.91 108.84, 40.77 92.42 M11.9 125.62 C17.72 119.04, 23.06 112.17, 40.77 92.42 M16.89 125.98 C22.56 120.73, 27.16 113.76, 41.17 98.06 M16.89 125.98 C24.74 116.79, 31.23 109.46, 41.17 98.06 M22.53 125.59 C28.31 118.07, 33.69 111.73, 40.9 104.46 M22.53 125.59 C29.26 117.95, 35.25 111.5, 40.9 104.46 M27.52 125.95 C33.66 119.21, 35.41 114.43, 40.64 110.86 M27.52 125.95 C30.28 121.85, 33.36 119.23, 40.64 110.86 M33.16 125.55 C35.09 123.46, 36 121.81, 40.38 117.25 M33.16 125.55 C35.4 123.46, 37.57 121.44, 40.38 117.25" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C13.28 1.37, 17.41 -0.17, 28.93 0 M9.64 0 C15.63 0.46, 21.87 0.53, 28.93 0 M28.93 0 C35.72 -1.44, 38.46 4.36, 38.57 9.64 M28.93 0 C35.8 -0.35, 36.57 2.75, 38.57 9.64 M38.57 9.64 C39.08 44.39, 38.45 74.34, 38.57 115.91 M38.57 9.64 C39.22 42.57, 38.7 77.45, 38.57 115.91 M38.57 115.91 C39.35 122.94, 35.52 124.9, 28.93 125.55 M38.57 115.91 C38.33 121.5, 37.38 124.41, 28.93 125.55 M28.93 125.55 C21.92 125.11, 18.54 124.13, 9.64 125.55 M28.93 125.55 C23.89 125.8, 18.99 125.47, 9.64 125.55 M9.64 125.55 C3.07 127.51, -1.55 121.31, 0 115.91 M9.64 125.55 C2.31 124.81, 1.3 121.01, 0 115.91 M0 115.91 C1.2 93.12, 0.25 64.63, 0 9.64 M0 115.91 C1.31 79.13, 1.56 40.22, 0 9.64 M0 9.64 C-1.78 1.23, 5.07 -1.88, 9.64 0 M0 9.64 C1.49 4.09, 5.05 0.62, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(930.3282652899255 386.47286806950683) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v2</text></g><g stroke-linecap="round" transform="translate(864.4527990134711 336.7991714727864) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.34 10.89 C5.29 5.64, 6.45 2.82, 9.52 0.33 M0.34 10.89 C3.85 6.74, 6.14 4.28, 9.52 0.33 M0.08 17.29 C5.85 13.1, 9.19 9.09, 15.16 -0.07 M0.08 17.29 C5.53 10.98, 12.01 5.29, 15.16 -0.07 M-0.19 23.69 C9.27 15.14, 16.15 6.86, 20.15 0.29 M-0.19 23.69 C5.37 17.36, 10.33 11.49, 20.15 0.29 M0.21 29.33 C4.94 23.81, 10.47 15.25, 25.14 0.65 M0.21 29.33 C6.42 23.65, 11.49 16.14, 25.14 0.65 M-0.05 35.73 C9.9 24.77, 20.22 13.96, 30.78 0.26 M-0.05 35.73 C9.7 22.86, 21.98 10.17, 30.78 0.26 M0.34 41.37 C7.72 32.37, 16.54 25.49, 34.46 2.13 M0.34 41.37 C8.08 32.37, 17.41 22.36, 34.46 2.13 M0.08 47.77 C8.48 34.51, 20.46 25.77, 37.48 4.75 M0.08 47.77 C10.03 35.06, 20.91 23.79, 37.48 4.75 M0.47 53.41 C11.54 42.27, 21.47 28.99, 37.87 10.39 M0.47 53.41 C10.28 42.51, 20.98 30.91, 37.87 10.39 M0.21 59.81 C7.47 50.3, 18.95 39.4, 38.26 16.04 M0.21 59.81 C11.08 46.56, 22.26 34.19, 38.26 16.04 M0.61 65.45 C15.49 49.51, 28.39 36.64, 38 22.44 M0.61 65.45 C9.09 55.68, 19.96 44.59, 38 22.44 M0.35 71.85 C14.96 56.52, 31.01 37.47, 38.4 28.08 M0.35 71.85 C13.87 56.16, 26.47 41.14, 38.4 28.08 M0.74 77.5 C11.96 62.65, 26.34 47.65, 38.14 34.48 M0.74 77.5 C14.07 63.11, 25.15 47.1, 38.14 34.48 M0.48 83.89 C16 67.19, 27 53.28, 38.53 40.12 M0.48 83.89 C10.67 70.95, 21.62 59.63, 38.53 40.12 M0.22 90.29 C12.8 73.88, 27.38 60.01, 38.27 46.52 M0.22 90.29 C13.53 76.27, 26.24 60.19, 38.27 46.52 M0.61 95.93 C11.56 84.25, 18.97 76.16, 38.66 52.16 M0.61 95.93 C9.19 86.92, 16.18 76.67, 38.66 52.16 M0.35 102.33 C11.41 90.71, 21.78 79.92, 38.4 58.56 M0.35 102.33 C11.18 91.43, 20.87 80.86, 38.4 58.56 M0.75 107.97 C13.08 92.49, 31.26 74.74, 38.14 64.96 M0.75 107.97 C12.92 94.28, 25.94 79.8, 38.14 64.96 M0.48 114.37 C14.44 96.54, 29.51 78.41, 38.54 70.6 M0.48 114.37 C14.69 99.1, 28.68 82.67, 38.54 70.6 M0.88 120.02 C14.33 105.57, 27.64 89.97, 38.27 77 M0.88 120.02 C14.7 105.71, 27.41 90.25, 38.27 77 M3.24 123.39 C17.26 105.38, 31.97 92.34, 38.67 82.64 M3.24 123.39 C15.76 110.17, 27.17 95.35, 38.67 82.64 M6.92 125.26 C15.51 111.35, 28.84 102.91, 38.41 89.04 M6.92 125.26 C13.32 116.87, 20.52 109.69, 38.41 89.04 M12.56 124.87 C19.98 114.98, 31.18 103.93, 38.8 94.68 M12.56 124.87 C20.89 114.78, 31.25 104.61, 38.8 94.68 M17.55 125.23 C25.62 114.64, 33.31 107.59, 38.54 101.08 M17.55 125.23 C22.66 119.01, 27.21 114.33, 38.54 101.08 M23.19 124.83 C28.93 119.02, 31.75 114.72, 38.94 106.72 M23.19 124.83 C27.64 119.17, 31.59 116.12, 38.94 106.72 M28.18 125.19 C29.32 124.09, 33.54 119.95, 38.67 113.12 M28.18 125.19 C30.45 122.76, 33.61 119.42, 38.67 113.12 M33.16 125.55 C34.68 123.4, 37.26 122.02, 38.41 119.52 M33.16 125.55 C34.84 123.25, 36.96 121.29, 38.41 119.52" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C16.92 0.49, 22.63 0.28, 28.93 0 M9.64 0 C16.23 -0.77, 22.42 0.47, 28.93 0 M28.93 0 C35.74 -0.31, 36.83 2.81, 38.57 9.64 M28.93 0 C35.65 0.92, 38.76 3.32, 38.57 9.64 M38.57 9.64 C38.66 50.99, 38.4 89.35, 38.57 115.91 M38.57 9.64 C38.31 31.54, 38 52.52, 38.57 115.91 M38.57 115.91 C38.36 121.61, 37.12 124.56, 28.93 125.55 M38.57 115.91 C38.67 121.44, 34.67 124.21, 28.93 125.55 M28.93 125.55 C23 126.29, 18.78 125.86, 9.64 125.55 M28.93 125.55 C22.7 126.47, 15.86 125.03, 9.64 125.55 M9.64 125.55 C2.42 124.91, 1.13 121.18, 0 115.91 M9.64 125.55 C1.68 126.24, -1.77 124.09, 0 115.91 M0 115.91 C0.75 72.07, -1.34 32.13, 0 9.64 M0 115.91 C-1.78 76.14, 0.04 37.41, 0 9.64 M0 9.64 C1.29 3.97, 4.81 0.54, 9.64 0 M0 9.64 C1 2.01, 4.3 0.77, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(873.7369811440445 387.07505799777414) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v1</text></g><g stroke-linecap="round" transform="translate(1031.079723438883 334.76920865008196) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.34 10.89 C3.08 9.24, 3.15 7.02, 9.52 0.33 M0.34 10.89 C2.11 8.33, 4.75 6.83, 9.52 0.33 M0.08 17.29 C6.04 10.29, 7.98 5.88, 15.16 -0.07 M0.08 17.29 C5.31 12.04, 9.19 7.69, 15.16 -0.07 M-0.19 23.69 C5.39 15.9, 12.4 9.2, 20.15 0.29 M-0.19 23.69 C3.79 19.26, 8.82 12.52, 20.15 0.29 M0.21 29.33 C8.25 20.31, 18.06 9.54, 25.14 0.65 M0.21 29.33 C10.1 18.82, 19 7.23, 25.14 0.65 M-0.05 35.73 C10.63 25.24, 19.53 11.25, 30.78 0.26 M-0.05 35.73 C7.16 27.21, 16.3 17.14, 30.78 0.26 M0.34 41.37 C7.93 29.74, 18.52 18.81, 34.46 2.13 M0.34 41.37 C12 27.85, 24.27 12.76, 34.46 2.13 M0.08 47.77 C8.48 39.26, 16.87 26.81, 37.48 4.75 M0.08 47.77 C9.09 35.92, 19.65 26.58, 37.48 4.75 M0.47 53.41 C12.08 39.16, 23.51 24.72, 37.87 10.39 M0.47 53.41 C11.37 39.77, 23.53 25.36, 37.87 10.39 M0.21 59.81 C12.47 44.63, 23.87 30.03, 38.26 16.04 M0.21 59.81 C9.34 49.1, 16.63 41.06, 38.26 16.04 M0.61 65.45 C7.72 57.33, 15.63 44.78, 38 22.44 M0.61 65.45 C15.31 47.83, 29.67 32.3, 38 22.44 M0.35 71.85 C14.68 58.16, 28.55 41.7, 38.4 28.08 M0.35 71.85 C11.43 59.08, 21.16 46.44, 38.4 28.08 M0.74 77.5 C10.61 68.02, 20.19 58.14, 38.14 34.48 M0.74 77.5 C14.4 62.32, 27.5 49.31, 38.14 34.48 M0.48 83.89 C10.03 71.86, 22.39 60.34, 38.53 40.12 M0.48 83.89 C9.94 73.62, 19.25 62.69, 38.53 40.12 M0.22 90.29 C10.3 78.19, 17.45 68.62, 38.27 46.52 M0.22 90.29 C13.56 74.98, 28.07 59.62, 38.27 46.52 M0.61 95.93 C8.51 82.7, 21.92 73.83, 38.66 52.16 M0.61 95.93 C13.64 80.35, 27.92 66.38, 38.66 52.16 M0.35 102.33 C11.29 88.09, 22.22 76.48, 38.4 58.56 M0.35 102.33 C12.38 89.74, 22.97 74.66, 38.4 58.56 M0.75 107.97 C14.88 89.96, 29.29 74.72, 38.14 64.96 M0.75 107.97 C15.98 90.89, 29.35 74.31, 38.14 64.96 M0.48 114.37 C12.75 103.11, 21.7 90.77, 38.54 70.6 M0.48 114.37 C15.9 96.39, 30.95 79.75, 38.54 70.6 M0.88 120.02 C13.67 104.83, 22.48 93.05, 38.27 77 M0.88 120.02 C15.67 103.46, 29.1 88.31, 38.27 77 M3.24 123.39 C11.42 116.04, 16.12 107.19, 38.67 82.64 M3.24 123.39 C16.53 107.88, 29.81 92.85, 38.67 82.64 M6.92 125.26 C11.73 118.53, 17.72 109.02, 38.41 89.04 M6.92 125.26 C15.3 115.46, 22.37 106.31, 38.41 89.04 M12.56 124.87 C21.68 113.68, 30.17 104.08, 38.8 94.68 M12.56 124.87 C21.12 115.02, 28.99 106.31, 38.8 94.68 M17.55 125.23 C20.79 118.66, 27.8 114.84, 38.54 101.08 M17.55 125.23 C21.7 119.45, 26.52 115.83, 38.54 101.08 M23.19 124.83 C26.89 119.57, 33.06 115.32, 38.94 106.72 M23.19 124.83 C25.69 120.33, 29.19 116.19, 38.94 106.72 M28.18 125.19 C31.21 120.56, 36.56 115.38, 38.67 113.12 M28.18 125.19 C32.01 120.12, 36.21 116.34, 38.67 113.12 M33.16 125.55 C34.9 124.51, 36.71 122.06, 38.41 119.52 M33.16 125.55 C34.66 123.94, 35.92 122.19, 38.41 119.52" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C16.54 1.01, 22.95 0.32, 28.93 0 M9.64 0 C14.23 -0.26, 17.6 -0.3, 28.93 0 M28.93 0 C35.61 0.8, 38.73 3.31, 38.57 9.64 M28.93 0 C37.1 -0.62, 36.56 3.65, 38.57 9.64 M38.57 9.64 C36.7 47.75, 38.67 89.09, 38.57 115.91 M38.57 9.64 C38.55 44.34, 39.54 79.27, 38.57 115.91 M38.57 115.91 C38.66 121.55, 34.76 124.38, 28.93 125.55 M38.57 115.91 C38.11 123.96, 33.73 124.93, 28.93 125.55 M28.93 125.55 C22.64 126.78, 15.33 125.45, 9.64 125.55 M28.93 125.55 C20.87 125.14, 14.12 124.9, 9.64 125.55 M9.64 125.55 C1.88 126.15, -1.54 123.86, 0 115.91 M9.64 125.55 C5.51 126.2, -1.96 123.54, 0 115.91 M0 115.91 C1.85 92.97, -1.1 64.91, 0 9.64 M0 115.91 C-0.34 94.97, -0.19 73.55, 0 9.64 M0 9.64 C0.87 2.17, 4.16 0.67, 9.64 0 M0 9.64 C0.09 3.05, 2.78 0.53, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1040.3639055694566 385.0450951750697) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v4</text></g><g stroke-linecap="round" transform="translate(1088.229490179527 335.28884028173024) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.99 10.14 C3 5.71, 8.21 2.69, 9.52 0.33 M0.99 10.14 C3.41 7.79, 5.91 5.05, 9.52 0.33 M0.73 16.54 C4.02 14.27, 8.63 10.89, 15.16 -0.07 M0.73 16.54 C5.29 11.72, 10.01 5.99, 15.16 -0.07 M1.13 22.18 C5.66 16.53, 11.18 7.51, 20.15 0.29 M1.13 22.18 C9.09 13.17, 15.52 4.96, 20.15 0.29 M0.86 28.58 C11.83 17.82, 19.22 7.89, 25.14 0.65 M0.86 28.58 C9.91 18.8, 18.96 8.98, 25.14 0.65 M1.26 34.22 C10.69 23.75, 20.43 9.48, 30.78 0.26 M1.26 34.22 C12.15 22.24, 24.12 7.75, 30.78 0.26 M1 40.62 C10.42 31.95, 17.76 21.02, 34.46 2.13 M1 40.62 C11.47 28.01, 24.21 15.11, 34.46 2.13 M0.74 47.02 C14.08 30.41, 30.41 13.64, 37.48 4.75 M0.74 47.02 C8.07 38.71, 14.55 29.51, 37.48 4.75 M1.13 52.66 C13.38 40.78, 24.5 24.88, 40.49 7.38 M1.13 52.66 C13.25 40.02, 24.59 26.09, 40.49 7.38 M0.87 59.06 C10.17 46.55, 21.44 35.94, 40.23 13.77 M0.87 59.06 C8.39 50.51, 17.22 40.12, 40.23 13.77 M1.26 64.7 C18.28 49.24, 32.89 31.8, 40.63 19.42 M1.26 64.7 C9.74 56.24, 16.55 46.32, 40.63 19.42 M1 71.1 C15.87 52.89, 31.93 35.85, 40.37 25.81 M1 71.1 C11.31 59.74, 21.35 47.6, 40.37 25.81 M1.4 76.74 C15.46 59.34, 26.13 46.5, 40.76 31.46 M1.4 76.74 C8.99 66.31, 18.21 56.83, 40.76 31.46 M1.14 83.14 C10.3 71.26, 22.44 59.28, 40.5 37.86 M1.14 83.14 C12.99 69.14, 26.28 54.51, 40.5 37.86 M1.53 88.78 C12.64 77.43, 19.85 65.76, 40.89 43.5 M1.53 88.78 C14.29 73.09, 28.89 56.96, 40.89 43.5 M1.27 95.18 C10.13 84.13, 16.23 75.05, 40.63 49.9 M1.27 95.18 C9.75 85.49, 18.87 74.59, 40.63 49.9 M1.01 101.58 C12.8 89.88, 25.55 76.98, 40.37 56.29 M1.01 101.58 C17.01 85.12, 31.9 67.03, 40.37 56.29 M1.4 107.22 C10.62 98.32, 18.09 91.28, 40.77 61.94 M1.4 107.22 C11.09 95.36, 20.66 85.28, 40.77 61.94 M1.14 113.62 C16.14 98.65, 28.85 84.31, 40.5 68.34 M1.14 113.62 C11.39 102.27, 21.17 90.47, 40.5 68.34 M0.88 120.02 C11.44 108.89, 19.97 101.55, 40.9 73.98 M0.88 120.02 C9.16 109.48, 20.11 98.65, 40.9 73.98 M3.24 123.39 C18.58 106.62, 30.97 92.21, 40.64 80.38 M3.24 123.39 C10.46 114.58, 20.61 103.56, 40.64 80.38 M6.26 126.02 C17.72 111.39, 31.83 99.2, 41.03 86.02 M6.26 126.02 C14.52 117.37, 22.13 108.44, 41.03 86.02 M11.9 125.62 C18.5 120.17, 24.89 112.26, 40.77 92.42 M11.9 125.62 C18.06 117.43, 26.11 108.64, 40.77 92.42 M16.89 125.98 C21.17 119.65, 28.48 111.45, 41.17 98.06 M16.89 125.98 C21.68 119.54, 27.32 113.69, 41.17 98.06 M22.53 125.59 C26.08 119.68, 34.8 111.5, 40.9 104.46 M22.53 125.59 C28.19 120.9, 31.86 114.47, 40.9 104.46 M27.52 125.95 C32.62 122.47, 35.47 117.2, 40.64 110.86 M27.52 125.95 C29.86 123.75, 33.24 120.21, 40.64 110.86 M33.16 125.55 C35.31 123.07, 38.36 119.83, 40.38 117.25 M33.16 125.55 C35.42 123.43, 37.23 121.24, 40.38 117.25" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C15.08 -0.14, 24.39 0.34, 28.93 0 M9.64 0 C15.25 0.42, 20.7 0.08, 28.93 0 M28.93 0 C36.87 -0.54, 36.82 3.59, 38.57 9.64 M28.93 0 C36.97 0.13, 38.35 0.99, 38.57 9.64 M38.57 9.64 C39.19 35.18, 37.94 60.18, 38.57 115.91 M38.57 9.64 C39.55 37.25, 39.21 65.06, 38.57 115.91 M38.57 115.91 C38.17 123.75, 33.94 125.01, 28.93 125.55 M38.57 115.91 C39.61 123.13, 35.89 126, 28.93 125.55 M28.93 125.55 C23.85 124.04, 14.01 124.78, 9.64 125.55 M28.93 125.55 C23.12 125.73, 17.86 126.17, 9.64 125.55 M9.64 125.55 C5.21 126.12, -1.7 123.38, 0 115.91 M9.64 125.55 C1.64 124.36, 1.34 123.83, 0 115.91 M0 115.91 C-1.11 77.01, -1 35.7, 0 9.64 M0 115.91 C-0.41 79.48, -0.37 44.43, 0 9.64 M0 9.64 C0.08 3.07, 2.84 0.46, 9.64 0 M0 9.64 C0.83 1.57, 2.07 -1.51, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1097.5136723101004 385.564726806718) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v5</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Partitioned Pub/Sub</span></div></div></div></div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Partitioned Pub/Sub with Layer 7 Load Balancer</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach-6">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To address the issue of servers handling viewers from many different live videos, we need a more intelligent allocation strategy. The goal is to have each server primarily handle viewers of the same live video, making it easier to limit the number of topics or channels each server needs to subscribe to.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">There are two ways we can achieve this allocation, both require some scripting or configuration.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Option 1: Intelligent Routing via Scripts or Configuration</strong>
A Layer 7 load balancer or API gateway can leverage consistent hashing based on the <span class="MuiBox-root mui-1vu004u">liveVideoId</span>. By inspecting the requestâ€”such as a header or path parameter that includes the <span class="MuiBox-root mui-1vu004u">liveVideoId</span>â€”the load balancer can apply a hashing function that always routes viewers of the same video to the same server. Tools like NGINX or Envoy can be scripted with Lua or configuration directives to achieve this content-based routing, reducing overhead and keeping related viewers together.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Option 2: Dynamic Lookup via a Coordination Service (e.g., Zookeeper)</strong>
Instead of relying on hashing alone, we can store a dynamic mapping of <span class="MuiBox-root mui-1vu004u">liveVideoId</span> to a specific server in a coordination service like Zookeeper. The load balancer or custom proxy layer queries Zookeeper to determine the correct server for each <span class="MuiBox-root mui-1vu004u">liveVideoId</span>. As traffic patterns change, new servers can register themselves or existing mappings can be updated in Zookeeper, and the load balancer will route future requests accordingly. This approach offers more flexibility but introduces operational complexity and requires caching and careful failure handling.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The reality is this is pretty complex, and you would not be expected to go into too much detail here in an interview. Just explaining that you need a way to colocate viewers of the same live video to the same server is good enough. Then mention what some high level options would be.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1852.3853381739032 912.4024881631576">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1852.3853381739032" height="912.4024881631576" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 251.446901748639) rotate(0 128.0182913190058 84.77455315625434)"><path d="M32 0 C91.4 1.28, 152.31 1.57, 224.04 0 M32 0 C95.51 0.51, 158.22 0.75, 224.04 0 M224.04 0 C246.82 1.74, 255.47 8.79, 256.04 32 M224.04 0 C243.87 -0.98, 256.9 8.49, 256.04 32 M256.04 32 C255.57 57.2, 254.33 80.84, 256.04 137.55 M256.04 32 C254.19 58.1, 256.02 85, 256.04 137.55 M256.04 137.55 C257.84 159.6, 243.62 169.92, 224.04 169.55 M256.04 137.55 C254.08 158.04, 246.07 169.05, 224.04 169.55 M224.04 169.55 C172.33 167.17, 126.23 168.46, 32 169.55 M224.04 169.55 C184.9 170.73, 146 170.4, 32 169.55 M32 169.55 C10.1 168.47, 1.94 157.43, 0 137.55 M32 169.55 C9.25 171.42, 1.95 157.98, 0 137.55 M0 137.55 C-1.32 95.41, 0.28 54.4, 0 32 M0 137.55 C-0.16 108.68, -0.84 80.99, 0 32 M0 32 C-1.29 12.08, 9.68 -0.42, 32 0 M0 32 C0.85 9.58, 11.55 -0.28, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(63.86301788150581 323.72145490489333) rotate(0 74.1552734375 12.5)"><text x="74.1552734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commenter Client</text></g><g mask="url(#mask-N3_C9SCTQa9ZkfYzsQCHN)" stroke-linecap="round"><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M1.17 0.37 C41.91 0.91, 204.56 2.72, 245.42 3.18 M0.33 -0.49 C41.35 0.2, 206.79 3.6, 247.67 4.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M29.48 -9.57 C19.24 -6.94, 6.66 -1.6, 1.17 0.37 M29.48 -9.57 C23.28 -6.39, 15.42 -5.79, 1.17 0.37" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M29.24 10.95 C19.11 5.72, 6.62 3.2, 1.17 0.37 M29.24 10.95 C23.24 9.17, 15.44 4.79, 1.17 0.37" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M219.29 14.07 C230.77 8.62, 239.9 6.44, 247.67 4.36 M219.29 14.07 C226.95 12.68, 232.82 8.53, 247.67 4.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.9586521006024 289.4782835421702) rotate(0 123.1463414244705 1.931271818146115)"><path d="M219.69 -6.45 C231.01 -4.04, 239.98 1.64, 247.67 4.36 M219.69 -6.45 C227.11 -2.87, 232.88 -2.06, 247.67 4.36" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-N3_C9SCTQa9ZkfYzsQCHN"><rect x="0" y="0" fill="#fff" width="636.2513349495434" height="393.3408271784624"></rect><rect x="382.5434700875729" y="278.9095553603163" fill="#000" width="61.123046875" height="25" opacity="1"></rect></mask><g transform="translate(382.5434700875729 278.9095553603163) rotate(0 31.415202590906986 12.506414108937605)"><text x="30.5615234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">HTTPS</text></g><g stroke-linecap="round" transform="translate(563.033988117355 10.629021465668302) rotate(0 52.987237405710914 314.61157847145796)"><path d="M26.49 0 C37.38 -1.44, 49.9 1.42, 79.48 0 M26.49 0 C46.35 0.07, 67.88 -0.45, 79.48 0 M79.48 0 C95.64 -1.09, 106.17 8.94, 105.97 26.49 M79.48 0 C98.86 -1.3, 107.59 7.66, 105.97 26.49 M105.97 26.49 C104.5 152.32, 104.98 277.49, 105.97 602.73 M105.97 26.49 C103.61 219.96, 104.07 413.64, 105.97 602.73 M105.97 602.73 C105.17 618.45, 96.59 627.39, 79.48 629.22 M105.97 602.73 C103.85 622.62, 96.49 626.96, 79.48 629.22 M79.48 629.22 C65.71 627.88, 52.27 628.45, 26.49 629.22 M79.48 629.22 C65.83 629.65, 54.26 628.45, 26.49 629.22 M26.49 629.22 C10.7 630.2, 1.8 619.59, 0 602.73 M26.49 629.22 C8.12 630.14, -0.12 619.61, 0 602.73 M0 602.73 C0.6 429.86, 0.92 257.84, 0 26.49 M0 602.73 C1.28 389.08, 1.29 175.77, 0 26.49 M0 26.49 C-0.61 9.05, 9.06 1.63, 26.49 0 M0 26.49 C-1.94 8.56, 8.88 1.2, 26.49 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(568.5456395855658 275.24059993712626) rotate(0 47.4755859375 50)"><text x="47.4755859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Load </text><text x="47.4755859375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Balancer</text><text x="47.4755859375" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- layer 7 for</text><text x="47.4755859375" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">SSE</text></g><g stroke-linecap="round" transform="translate(829.0716441099039 73.28495701370593) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C96.76 -1.98, 157.39 -2.55, 308.62 0 M32 0 C102.62 1.6, 174.47 2.07, 308.62 0 M308.62 0 C331.44 -1.13, 342.03 9.65, 340.62 32 M308.62 0 C328.05 -1.3, 338.39 10.18, 340.62 32 M340.62 32 C341.87 84.66, 341.53 139.13, 340.62 173.16 M340.62 32 C340.64 68.2, 340.77 105.43, 340.62 173.16 M340.62 173.16 C338.77 196.43, 329.38 203.19, 308.62 205.16 M340.62 173.16 C339.26 196.51, 329.04 204.01, 308.62 205.16 M308.62 205.16 C240.48 206.06, 172.88 203.61, 32 205.16 M308.62 205.16 C203.81 204.7, 98.26 204.01, 32 205.16 M32 205.16 C10.05 205.96, -0.1 193.82, 0 173.16 M32 205.16 C10.64 203.94, -0.41 192.71, 0 173.16 M0 173.16 C1.93 141.82, 0.1 113.19, 0 32 M0 173.16 C-0.85 137.61, -0.43 102.65, 0 32 M0 32 C-1.69 10.43, 10.71 1.04, 32 0 M0 32 C-0.95 8.96, 11.67 -0.18, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(872.7498303153177 163.36447670760208) rotate(0 126.630859375 12.5)"><text x="126.630859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment Management Service</text></g><g stroke-linecap="round"><g transform="translate(685.65572717853 192.13573834723684) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M-0.78 -0.51 C19.56 -0.44, 101.51 -0.76, 121.7 -0.71 M1.01 -1.83 C21.26 -1.55, 100.69 -0.2, 120.99 0.23" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.13573834723684) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M27.39 -10.82 C18.79 -7.45, 10.09 -6.91, -0.78 -0.51 M27.39 -10.82 C21.23 -8.84, 14.27 -6.25, -0.78 -0.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.13573834723684) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M27.43 9.7 C19 7.49, 10.29 2.46, -0.78 -0.51 M27.43 9.7 C21.24 6.64, 14.27 4.19, -0.78 -0.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.13573834723684) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M92.61 9.96 C99.56 8.25, 106.23 3.35, 120.99 0.23 M92.61 9.96 C100.31 6.99, 107.24 4.66, 120.99 0.23" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.65572717853 192.13573834723684) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M92.99 -10.56 C99.65 -6.69, 106.21 -6.02, 120.99 0.23 M92.99 -10.56 C100.62 -8.49, 107.45 -5.78, 120.99 0.23" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(1371.641678328424 49.68229322763) rotate(0 133.62108660928106 133.6788415220053)"><path d="M84.53 10.12 C96.53 3.2, 112.56 1.77, 126.92 0.85 C141.27 -0.08, 156.77 0.77, 170.65 4.55 C184.53 8.34, 198.34 14.92, 210.2 23.56 C222.06 32.19, 233.18 44.31, 241.8 56.35 C250.41 68.4, 257.6 82.29, 261.89 95.85 C266.18 109.41, 268.08 123.54, 267.51 137.71 C266.95 151.88, 263.83 167.15, 258.51 180.85 C253.2 194.55, 244.98 208.75, 235.62 219.91 C226.25 231.07, 214.82 240.43, 202.33 247.8 C189.84 255.16, 174.93 261.16, 160.68 264.11 C146.42 267.06, 130.83 267.21, 116.79 265.48 C102.75 263.76, 89.49 260, 76.46 253.76 C63.43 247.52, 48.88 238.25, 38.59 228.05 C28.3 217.85, 21.06 205.51, 14.72 192.55 C8.39 179.58, 2.75 164.59, 0.61 150.26 C-1.53 135.93, -1.01 120.49, 1.89 106.57 C4.78 92.65, 10.62 79.27, 17.98 66.75 C25.34 54.23, 34.44 41.03, 46.06 31.46 C57.69 21.88, 80.43 12.69, 87.73 9.28 C95.04 5.87, 89.15 8.9, 89.87 11 M106.81 2.19 C119.93 -2.85, 136.52 -1.43, 150.83 0.32 C165.14 2.08, 179.92 6.27, 192.67 12.73 C205.42 19.19, 217.27 28.44, 227.33 39.09 C237.38 49.75, 246.63 63.59, 253 76.66 C259.38 89.73, 263.59 103.45, 265.56 117.53 C267.53 131.6, 267.63 146.92, 264.8 161.09 C261.98 175.26, 256.26 189.99, 248.62 202.53 C240.99 215.06, 230.13 226.78, 218.98 236.31 C207.83 245.84, 195.34 254.56, 181.71 259.69 C168.07 264.82, 151.65 266.64, 137.17 267.09 C122.7 267.54, 108.58 266.74, 94.85 262.38 C81.12 258.02, 66.41 249.57, 54.79 240.95 C43.17 232.33, 33.15 222.38, 25.12 210.66 C17.08 198.95, 10.57 184.27, 6.58 170.64 C2.59 157, 0.78 143.34, 1.17 128.86 C1.56 114.37, 3.97 97.27, 8.9 83.71 C13.83 70.14, 21.27 58.29, 30.76 47.48 C40.24 36.67, 52.85 26.19, 65.79 18.85 C78.72 11.51, 101.31 5.64, 108.39 3.45 C115.46 1.26, 107.88 3.69, 108.26 5.72" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1443.0518259867674 158.33591940826352) rotate(0 62.2265625 25)"><text x="62.2265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comments DB </text><text x="62.2265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(1191.7657013226271 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M0.11 0.07 C27.12 0.05, 134.32 -0.63, 161.15 -0.76 M-1.28 -0.95 C25.72 -0.76, 133.66 0.22, 160.68 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M28.25 -10.33 C21.99 -6.48, 14.42 -4.23, 0.11 0.07 M28.25 -10.33 C20.18 -8.11, 14.99 -4.93, 0.11 0.07" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M28.36 10.19 C22.18 9.43, 14.59 7.08, 0.11 0.07 M28.36 10.19 C20.43 7.29, 15.22 5.36, 0.11 0.07" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M132.4 10.45 C138.92 9.66, 144.03 7.33, 160.68 0.42 M132.4 10.45 C138.56 7.9, 147.43 5.99, 160.68 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.7657013226271 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M132.57 -10.07 C138.94 -6.25, 144.01 -3.97, 160.68 0.42 M132.57 -10.07 C138.52 -7.51, 147.35 -4.3, 160.68 0.42" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(346.4042316370312 246.18504761431905) rotate(0 66.38994598388672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- for /create</text></g><g transform="translate(786.3022291012512 10) rotate(0 231.78981018066406 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- When a new comment is posted, persist in DB</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">and sent over SSE to connected clients</text></g><g stroke-linecap="round" transform="translate(817.0863844340765 509.02210954911243) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C91.74 3.39, 152.73 3.46, 308.62 0 M32 0 C124.29 -0.68, 218.12 -0.57, 308.62 0 M308.62 0 C329.15 -1.94, 340.07 8.84, 340.62 32 M308.62 0 C327.82 2.23, 339.97 8.41, 340.62 32 M340.62 32 C340.86 64.9, 340.19 99.5, 340.62 173.16 M340.62 32 C341.37 67.55, 342.84 101.07, 340.62 173.16 M340.62 173.16 C342.49 195.47, 331.75 204.35, 308.62 205.16 M340.62 173.16 C339.91 195.41, 329.83 204.38, 308.62 205.16 M308.62 205.16 C224.76 203.47, 142.73 203.78, 32 205.16 M308.62 205.16 C206.43 204.34, 103.98 204.61, 32 205.16 M32 205.16 C10.05 205.38, 0.23 196.12, 0 173.16 M32 205.16 C8.73 204.89, 0.05 195.69, 0 173.16 M0 173.16 C0.89 138.25, 0.37 101.43, 0 32 M0 173.16 C-0.44 118.07, 0.44 62.25, 0 32 M0 32 C1.99 11.66, 11.78 0.54, 32 0 M0 32 C1.65 10.41, 8.93 -2.29, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(835.9349895555401 523.4753466695638) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C88.77 -0.43, 144.92 -3.18, 308.62 0 M32 0 C120.41 0.61, 208.03 0.03, 308.62 0 M308.62 0 C329.4 -1.83, 338.77 12.6, 340.62 32 M308.62 0 C329.3 -2.26, 339.26 12.68, 340.62 32 M340.62 32 C338.25 68.21, 338.84 107.48, 340.62 173.16 M340.62 32 C340.6 63.69, 340.68 96.65, 340.62 173.16 M340.62 173.16 C342.42 193.69, 329.34 205.96, 308.62 205.16 M340.62 173.16 C340.5 193.71, 329.92 203.94, 308.62 205.16 M308.62 205.16 C229.95 202.35, 153.52 202.58, 32 205.16 M308.62 205.16 C231.78 204.05, 154.11 204.23, 32 205.16 M32 205.16 C10.89 206.79, -1.69 194.25, 0 173.16 M32 205.16 C10.71 206.36, -0.95 192.78, 0 173.16 M0 173.16 C-0.57 126.05, 1.98 75.54, 0 32 M0 173.16 C1.25 137.86, 2.28 102.57, 0 32 M0 32 C1.11 11.2, 12.1 -0.22, 32 0 M0 32 C-1.73 8.38, 9.72 1.33, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(858.1692159750828 542.5285409922744) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C139.19 -3.28, 245.56 -3.24, 308.62 0 M32 0 C104.53 -0.28, 177.48 -0.24, 308.62 0 M308.62 0 C328.1 1.94, 340.05 8.7, 340.62 32 M308.62 0 C328.6 2.01, 339.71 9.52, 340.62 32 M340.62 32 C338.37 68.29, 337.99 99.46, 340.62 173.16 M340.62 32 C342.75 86.34, 342.72 139.3, 340.62 173.16 M340.62 173.16 C340 195.29, 329.85 204.48, 308.62 205.16 M340.62 173.16 C340.59 193.28, 329.54 203.37, 308.62 205.16 M308.62 205.16 C250.23 203.02, 189.34 204.35, 32 205.16 M308.62 205.16 C238.5 204.98, 168.94 205.52, 32 205.16 M32 205.16 C8.98 204.92, 0.04 195.54, 0 173.16 M32 205.16 C9.72 203.45, 1 194.31, 0 173.16 M0 173.16 C2.35 118.62, -0.49 63.6, 0 32 M0 173.16 C1.04 124.41, 0.6 74.94, 0 32 M0 32 C1.44 10.44, 9.16 -1.99, 32 0 M0 32 C-0.95 12, 12.68 2.03, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(946.5495506179966 620.1080606861706) rotate(0 81.9287109375 25)"><text x="81.9287109375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Realtime Messaging</text><text x="81.9287109375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"> Service</text></g><g mask="url(#mask-6fVt_7I6sp-P5PyhuCXqe)" stroke-linecap="round"><g transform="translate(283.5912792014027 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M0 0 C110.06 55.44, 220.35 108.3, 518.93 251.67 M0 0 C104.65 53.36, 210.21 103.65, 518.93 251.67" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.5912792014027 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M29.83 3.15 C22.76 2.84, 16.72 0.75, 0 0 M29.83 3.15 C22.86 3.21, 17.45 0.62, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.5912792014027 366.8830023769606) rotate(0 259.46530474452163 125.83687886223038)"><path d="M20.83 21.59 C15.63 17.44, 11.51 11.44, 0 0 M20.83 21.59 C15.74 17.99, 12.15 11.66, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-6fVt_7I6sp-P5PyhuCXqe"><rect x="0" y="0" fill="#fff" width="902.521888690446" height="718.5567601014213"></rect><rect x="415.36615425842433" y="467.71988123919095" fill="#000" width="255.380859375" height="50" opacity="1"></rect></mask><g transform="translate(415.36615425842433 467.71988123919095) rotate(0 127.6904296875 25)"><text x="127.6904296875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">SSE</text><text x="127.6904296875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- connect based on LiveVideoId</text></g><g stroke-linecap="round" transform="translate(976.3476131470784 336.59414485526395) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.34 10.89 C2.91 7.18, 4.18 4.79, 9.52 0.33 M0.34 10.89 C3.7 6.27, 7.4 2.95, 9.52 0.33 M0.08 17.29 C5.42 12.04, 12.77 4.23, 15.16 -0.07 M0.08 17.29 C5.04 11.8, 9.25 7.17, 15.16 -0.07 M-0.19 23.69 C6.95 16.77, 13.99 6.33, 20.15 0.29 M-0.19 23.69 C8.34 15.02, 14.95 6.03, 20.15 0.29 M0.21 29.33 C10.92 17.37, 18.26 5.47, 25.14 0.65 M0.21 29.33 C7.13 22.42, 12.98 15.51, 25.14 0.65 M-0.05 35.73 C8.93 25.6, 16.59 12.36, 30.78 0.26 M-0.05 35.73 C8.42 25.33, 16.96 16.11, 30.78 0.26 M0.34 41.37 C12.66 25.98, 23.56 13.8, 34.46 2.13 M0.34 41.37 C13.13 27.27, 26.84 11.48, 34.46 2.13 M0.08 47.77 C11.23 32.29, 23.15 19.74, 37.48 4.75 M0.08 47.77 C9.48 36.15, 21.43 23.39, 37.48 4.75 M0.47 53.41 C11.31 44.01, 21.32 32.11, 37.87 10.39 M0.47 53.41 C9.07 42.2, 18.75 31.39, 37.87 10.39 M0.21 59.81 C13.94 43.82, 30.34 26.92, 38.26 16.04 M0.21 59.81 C11.4 45.81, 23.47 33.26, 38.26 16.04 M0.61 65.45 C11.03 54.32, 22.13 43.41, 38 22.44 M0.61 65.45 C12.12 52.99, 23.72 40.71, 38 22.44 M0.35 71.85 C13.74 53.91, 28.48 38.51, 38.4 28.08 M0.35 71.85 C13.66 55.28, 27.66 39.4, 38.4 28.08 M0.74 77.5 C15.97 63.82, 25.37 47.68, 38.14 34.48 M0.74 77.5 C10.5 64.58, 21.56 52, 38.14 34.48 M0.48 83.89 C11.75 70.08, 22.77 58.07, 38.53 40.12 M0.48 83.89 C13.27 67.99, 27.04 51.69, 38.53 40.12 M0.22 90.29 C12.75 79.32, 24.12 66.22, 38.27 46.52 M0.22 90.29 C11.11 77.04, 20.89 65.28, 38.27 46.52 M0.61 95.93 C16.11 79.06, 28.63 63.51, 38.66 52.16 M0.61 95.93 C11.17 84.08, 22.26 70.57, 38.66 52.16 M0.35 102.33 C8.67 90.75, 18.75 83.28, 38.4 58.56 M0.35 102.33 C8.5 93.83, 15.65 82.9, 38.4 58.56 M0.75 107.97 C13.26 93.67, 28.52 76.96, 38.14 64.96 M0.75 107.97 C10.53 96.62, 19.78 87.22, 38.14 64.96 M0.48 114.37 C14.34 99.47, 29.49 81.32, 38.54 70.6 M0.48 114.37 C14.37 97.47, 26.94 82.53, 38.54 70.6 M0.88 120.02 C16.2 105.59, 27.6 89.51, 38.27 77 M0.88 120.02 C10.59 109.89, 20.86 97.82, 38.27 77 M3.24 123.39 C10.58 113.08, 19.29 104.65, 38.67 82.64 M3.24 123.39 C12.75 112.52, 22.62 101.53, 38.67 82.64 M6.92 125.26 C16.52 112.24, 30.96 97.58, 38.41 89.04 M6.92 125.26 C13.82 117.09, 20.37 109.96, 38.41 89.04 M12.56 124.87 C20.32 115.79, 26.8 107.52, 38.8 94.68 M12.56 124.87 C22.44 113.87, 31.87 102.21, 38.8 94.68 M17.55 125.23 C20.83 121.39, 24.45 113.96, 38.54 101.08 M17.55 125.23 C24.48 117.7, 32.09 108.66, 38.54 101.08 M23.19 124.83 C30.26 118.19, 36.12 111.69, 38.94 106.72 M23.19 124.83 C27.19 120.49, 32.37 115.31, 38.94 106.72 M28.18 125.19 C30.6 120.39, 32.97 120.33, 38.67 113.12 M28.18 125.19 C31.74 121.11, 34.17 117.54, 38.67 113.12 M33.16 125.55 C35.1 123.98, 36.59 120.78, 38.41 119.52 M33.16 125.55 C35.47 123.4, 36.94 120.97, 38.41 119.52" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C14.14 -0.45, 20.62 -1.71, 28.93 0 M9.64 0 C16.73 1.03, 24.57 -0.29, 28.93 0 M28.93 0 C34.22 -1.66, 38 2.13, 38.57 9.64 M28.93 0 C37.58 -1.67, 37.15 5.09, 38.57 9.64 M38.57 9.64 C39.13 52.34, 37.35 90.83, 38.57 115.91 M38.57 9.64 C38.5 45.23, 38.34 81.09, 38.57 115.91 M38.57 115.91 C36.87 121.59, 34.06 126.96, 28.93 125.55 M38.57 115.91 C37.43 121.85, 36.2 124.46, 28.93 125.55 M28.93 125.55 C22.61 125.71, 17.44 123.87, 9.64 125.55 M28.93 125.55 C22.97 124.94, 18.23 125.58, 9.64 125.55 M9.64 125.55 C4.85 124.88, 1.37 124.21, 0 115.91 M9.64 125.55 C2.45 124.44, -2.08 123.46, 0 115.91 M0 115.91 C0.74 85.44, 0.27 54.2, 0 9.64 M0 115.91 C0.39 85.8, 1.68 55.41, 0 9.64 M0 9.64 C-0.14 2.2, 1.75 -1.37, 9.64 0 M0 9.64 C-2.12 4.49, 1.49 1.69, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(985.6317952776518 386.8700313802517) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v3</text></g><g stroke-linecap="round"><g transform="translate(996.6877395421593 293.15523767407467) rotate(0 0 15.383788003548034)"><path d="M-0.51 0.53 C-0.51 5.65, -0.19 25.11, -0.16 30.23 M0.23 0.33 C0.16 5.54, -0.77 25.63, -0.67 30.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6877395421593 293.15523767407467) rotate(0 0 15.383788003548034)"><path d="M-5.67 16.1 C-3.63 19.87, -3.77 23.6, -0.67 30.65 M-5.67 16.1 C-3.98 21.43, -1.93 27.18, -0.67 30.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6877395421593 293.15523767407467) rotate(0 0 15.383788003548034)"><path d="M4.85 16.29 C4.02 19.96, 1.02 23.64, -0.67 30.65 M4.85 16.29 C2.46 21.52, 0.44 27.2, -0.67 30.65" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(996.2389632297436 468.0196078765639) rotate(0 0 14.436737991317386)"><path d="M-0.16 -0.54 C-0.13 4.26, -0.31 24.5, -0.32 29.35 M0.77 0.37 C1.02 5.26, 0.98 23.86, 0.74 28.64" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.2389632297436 468.0196078765639) rotate(0 0 14.436737991317386)"><path d="M-3.9 14.97 C-3.58 17.38, -1.27 20.36, 0.74 28.64 M-3.9 14.97 C-2.88 18.21, -1.26 21.56, 0.74 28.64" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.2389632297436 468.0196078765639) rotate(0 0 14.436737991317386)"><path d="M5.97 15.18 C4.24 17.54, 4.5 20.47, 0.74 28.64 M5.97 15.18 C4.53 18.33, 3.67 21.63, 0.74 28.64" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(1162.5252690422562 347.44655000221155) rotate(0 131.44989013671875 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Redis Pub/Sub</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- broadcast new comments</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- partition by live videoId </text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g transform="translate(789.2369008789547 777.4024881631576) rotate(0 286.7998046875 62.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Subscribe only to the topics with comments from </text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">    live videos that your clients are watching</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- Viewers of same video end up on same box based </text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">    on layer 7 LB. Leads to fewer topics to subscribe to</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">    per server</text></g><g stroke-linecap="round" transform="translate(921.0440831593519 336.1969815445191) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.34 10.89 C2.42 8.14, 4.6 6.44, 9.52 0.33 M0.34 10.89 C4.15 7.2, 7.09 3.38, 9.52 0.33 M0.08 17.29 C5.27 9.53, 10.1 6.75, 15.16 -0.07 M0.08 17.29 C4.14 12.25, 8.3 8.82, 15.16 -0.07 M-0.19 23.69 C4.26 18.07, 12.59 9.14, 20.15 0.29 M-0.19 23.69 C4.96 18.42, 10.35 13.03, 20.15 0.29 M0.21 29.33 C10.77 18.23, 17.56 9.68, 25.14 0.65 M0.21 29.33 C5.55 24.37, 10.93 16.97, 25.14 0.65 M-0.05 35.73 C10.47 23.75, 20.92 10.34, 30.78 0.26 M-0.05 35.73 C6.92 27.72, 12.97 21.07, 30.78 0.26 M0.34 41.37 C15.65 26.57, 26.91 8.79, 34.46 2.13 M0.34 41.37 C10.36 31.3, 18.35 20.54, 34.46 2.13 M0.08 47.77 C14.35 29.98, 29.84 16.57, 37.48 4.75 M0.08 47.77 C13.75 32.49, 27.87 14.67, 37.48 4.75 M0.47 53.41 C10.52 38.3, 21.59 28.27, 37.87 10.39 M0.47 53.41 C11.55 40.57, 21.91 27.4, 37.87 10.39 M0.21 59.81 C11.32 46.74, 21.33 36.18, 38.26 16.04 M0.21 59.81 C12.06 45.27, 26.39 29.83, 38.26 16.04 M0.61 65.45 C16.02 47.96, 27.71 31.29, 38 22.44 M0.61 65.45 C8.46 54.8, 16.67 44.78, 38 22.44 M0.35 71.85 C6.75 62.25, 17.97 54.98, 38.4 28.08 M0.35 71.85 C8.77 63.51, 15.73 53.02, 38.4 28.08 M0.74 77.5 C12.47 64.92, 21.7 53.06, 38.14 34.48 M0.74 77.5 C13.15 63.92, 24.58 49.1, 38.14 34.48 M0.48 83.89 C8.55 73.23, 19.58 65.33, 38.53 40.12 M0.48 83.89 C14.54 68.04, 29.7 49.56, 38.53 40.12 M0.22 90.29 C10.73 79.33, 23.57 64.74, 38.27 46.52 M0.22 90.29 C14.19 75.49, 26.8 60.74, 38.27 46.52 M0.61 95.93 C11.89 81.94, 25.21 65.78, 38.66 52.16 M0.61 95.93 C14.74 80.77, 28.31 65.54, 38.66 52.16 M0.35 102.33 C8.5 93.13, 16.9 83.47, 38.4 58.56 M0.35 102.33 C14.1 87.34, 26.89 72.18, 38.4 58.56 M0.75 107.97 C13.44 92.89, 27.36 77.79, 38.14 64.96 M0.75 107.97 C14.82 93.08, 28.07 76.16, 38.14 64.96 M0.48 114.37 C10.95 101.75, 20.62 94.2, 38.54 70.6 M0.48 114.37 C9.75 102.49, 19.75 92.68, 38.54 70.6 M0.88 120.02 C13.75 106.01, 22.96 93.01, 38.27 77 M0.88 120.02 C10.14 108.27, 20.74 96.79, 38.27 77 M3.24 123.39 C16.08 108.84, 25.63 95.71, 38.67 82.64 M3.24 123.39 C16.97 107.76, 29.43 93.53, 38.67 82.64 M6.92 125.26 C12.79 115.14, 22.01 107.09, 38.41 89.04 M6.92 125.26 C17.78 114.48, 26.52 103.61, 38.41 89.04 M12.56 124.87 C17.4 119.02, 23.63 112.01, 38.8 94.68 M12.56 124.87 C18.43 117.55, 23.54 112.65, 38.8 94.68 M17.55 125.23 C23.63 117.43, 31.98 109.96, 38.54 101.08 M17.55 125.23 C25.98 115.62, 32.9 107.9, 38.54 101.08 M23.19 124.83 C27.48 119.86, 33.92 109.94, 38.94 106.72 M23.19 124.83 C27.3 119.58, 31.11 115.47, 38.94 106.72 M28.18 125.19 C31.78 121.99, 32.85 121.13, 38.67 113.12 M28.18 125.19 C31.57 122.61, 34.49 119.1, 38.67 113.12 M33.16 125.55 C34.86 124.69, 34.79 122.11, 38.41 119.52 M33.16 125.55 C34.37 124.09, 35.57 122.67, 38.41 119.52" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C13.06 -0.43, 18.65 1.98, 28.93 0 M9.64 0 C14.84 -0.53, 19.31 0.31, 28.93 0 M28.93 0 C37.15 -0.81, 37.95 4.01, 38.57 9.64 M28.93 0 C35.23 -0.78, 38.54 2, 38.57 9.64 M38.57 9.64 C37 38.35, 39.15 68.66, 38.57 115.91 M38.57 9.64 C39.34 39.15, 38.65 69.02, 38.57 115.91 M38.57 115.91 C38.8 123.97, 33.67 125.31, 28.93 125.55 M38.57 115.91 C38.62 123.54, 34.41 123.84, 28.93 125.55 M28.93 125.55 C21.65 127.03, 17.49 125.07, 9.64 125.55 M28.93 125.55 C24.04 125.88, 20.18 126.13, 9.64 125.55 M9.64 125.55 C4.32 126.09, 1.44 122.11, 0 115.91 M9.64 125.55 C1.48 123.26, -0.95 123.67, 0 115.91 M0 115.91 C-1.95 73.28, -2.3 31.73, 0 9.64 M0 115.91 C0.15 78.8, 1.45 40.87, 0 9.64 M0 9.64 C0.19 2.82, 3.83 -1.6, 9.64 0 M0 9.64 C-0.87 5.13, 3.31 0.22, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(930.3282652899253 386.47286806950683) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v2</text></g><g stroke-linecap="round" transform="translate(864.4527990134711 336.79917147278593) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.34 10.89 C3.75 8, 5.86 5.8, 9.52 0.33 M0.34 10.89 C3.26 7.92, 6.08 4.83, 9.52 0.33 M0.08 17.29 C2.29 13.44, 8.37 10.33, 15.16 -0.07 M0.08 17.29 C3.22 13.2, 7.56 8.71, 15.16 -0.07 M-0.19 23.69 C5.86 13.52, 13.59 6.97, 20.15 0.29 M-0.19 23.69 C6.45 16.76, 12.29 10.09, 20.15 0.29 M0.21 29.33 C4.61 20.22, 12.11 14.72, 25.14 0.65 M0.21 29.33 C10.26 18.06, 20.19 7.15, 25.14 0.65 M-0.05 35.73 C7.98 25.86, 21.04 14.71, 30.78 0.26 M-0.05 35.73 C9.38 25.42, 17.17 16.76, 30.78 0.26 M0.34 41.37 C11.42 28.07, 23.02 16.39, 34.46 2.13 M0.34 41.37 C13.72 26.83, 24.77 12.89, 34.46 2.13 M0.08 47.77 C9.7 38.52, 15.14 27.56, 37.48 4.75 M0.08 47.77 C15 30.2, 30.61 13.48, 37.48 4.75 M0.47 53.41 C8.29 45.67, 16.12 36.31, 37.87 10.39 M0.47 53.41 C11.51 41.44, 22.55 28.57, 37.87 10.39 M0.21 59.81 C10.64 50.37, 19.09 35.79, 38.26 16.04 M0.21 59.81 C14.7 44.52, 28.53 28.78, 38.26 16.04 M0.61 65.45 C9.39 55.06, 22.08 41.68, 38 22.44 M0.61 65.45 C9.36 54.59, 20.1 43.52, 38 22.44 M0.35 71.85 C8.72 59.57, 20.71 48.12, 38.4 28.08 M0.35 71.85 C15.11 54.33, 30.06 38.73, 38.4 28.08 M0.74 77.5 C10.44 66.42, 20.29 56.43, 38.14 34.48 M0.74 77.5 C14.44 60.77, 29.06 44.72, 38.14 34.48 M0.48 83.89 C12.11 72.95, 20.21 59.52, 38.53 40.12 M0.48 83.89 C14.43 66.96, 29.57 51.05, 38.53 40.12 M0.22 90.29 C14.76 73.26, 27.55 59.33, 38.27 46.52 M0.22 90.29 C13.01 75.25, 24.49 60.56, 38.27 46.52 M0.61 95.93 C13.34 83.53, 21.77 70.93, 38.66 52.16 M0.61 95.93 C12.51 80.28, 26.54 65.9, 38.66 52.16 M0.35 102.33 C14.67 86.81, 26.22 73.19, 38.4 58.56 M0.35 102.33 C10.74 91.69, 20.87 79.08, 38.4 58.56 M0.75 107.97 C14.49 92.3, 27.13 79.89, 38.14 64.96 M0.75 107.97 C13.54 92.48, 28.44 77.65, 38.14 64.96 M0.48 114.37 C7.33 106.04, 15.39 94.91, 38.54 70.6 M0.48 114.37 C9.79 103.81, 18.19 93.83, 38.54 70.6 M0.88 120.02 C9.83 109.95, 19.12 97.2, 38.27 77 M0.88 120.02 C11.39 108.07, 21.73 97.25, 38.27 77 M3.24 123.39 C14.51 110.85, 21.32 102.2, 38.67 82.64 M3.24 123.39 C9.83 116, 17.36 106.28, 38.67 82.64 M6.92 125.26 C13.64 116.2, 21.94 111.93, 38.41 89.04 M6.92 125.26 C17.51 112.83, 28.43 98.57, 38.41 89.04 M12.56 124.87 C20.18 112.76, 32.1 103.75, 38.8 94.68 M12.56 124.87 C18.4 118.11, 24.56 111.48, 38.8 94.68 M17.55 125.23 C24.97 118.17, 29.24 112.36, 38.54 101.08 M17.55 125.23 C23.05 119.91, 26.94 113.31, 38.54 101.08 M23.19 124.83 C28.09 120.21, 35.46 112.21, 38.94 106.72 M23.19 124.83 C25.82 120.83, 30.84 117.52, 38.94 106.72 M28.18 125.19 C30.42 120.92, 35.12 119.77, 38.67 113.12 M28.18 125.19 C31.66 120.74, 35.71 116.11, 38.67 113.12 M33.16 125.55 C34.56 123, 37.48 121.19, 38.41 119.52 M33.16 125.55 C34.73 124.12, 36.51 122.31, 38.41 119.52" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C13.48 -1.37, 21.7 1.45, 28.93 0 M9.64 0 C15.54 -0.48, 19.4 0.29, 28.93 0 M28.93 0 C35.25 -0.68, 38.54 2.16, 38.57 9.64 M28.93 0 C34.95 -1.79, 36.61 2.36, 38.57 9.64 M38.57 9.64 C38.89 35.39, 38.37 60.44, 38.57 115.91 M38.57 9.64 C38.36 41.03, 37.4 70.66, 38.57 115.91 M38.57 115.91 C38.61 123.38, 34.53 124.07, 28.93 125.55 M38.57 115.91 C39.57 122.16, 37.23 124.78, 28.93 125.55 M28.93 125.55 C20.89 123.74, 15.66 125.43, 9.64 125.55 M28.93 125.55 C23.2 125.91, 17.1 125.54, 9.64 125.55 M9.64 125.55 C1.71 123.56, -0.83 123.5, 0 115.91 M9.64 125.55 C5.22 127.58, -0.16 121.18, 0 115.91 M0 115.91 C1.84 90.33, 2.2 66.46, 0 9.64 M0 115.91 C-0.6 76.55, -0.39 36.78, 0 9.64 M0 9.64 C-0.76 4.88, 3.3 0.19, 9.64 0 M0 9.64 C-1.69 2.52, 4.77 -0.78, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(873.7369811440445 387.0750579977737) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v1</text></g><g stroke-linecap="round" transform="translate(1031.0797234388833 334.76920865008105) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.34 10.89 C3.18 8.34, 5.77 4.59, 9.52 0.33 M0.34 10.89 C2.5 7.5, 6.44 4.07, 9.52 0.33 M0.08 17.29 C3.09 13.83, 9.21 6.37, 15.16 -0.07 M0.08 17.29 C4.87 12.95, 8.08 6.92, 15.16 -0.07 M-0.19 23.69 C4.56 20.22, 9.15 14.52, 20.15 0.29 M-0.19 23.69 C6.14 15.58, 13.75 6.84, 20.15 0.29 M0.21 29.33 C7.25 23.7, 9.49 18.25, 25.14 0.65 M0.21 29.33 C6.97 21.45, 13.11 12.85, 25.14 0.65 M-0.05 35.73 C10.29 23.05, 23.15 11.92, 30.78 0.26 M-0.05 35.73 C8.59 25.63, 15.79 16, 30.78 0.26 M0.34 41.37 C11.32 28.54, 20.95 20.48, 34.46 2.13 M0.34 41.37 C9.21 31.07, 20.17 20.35, 34.46 2.13 M0.08 47.77 C14.3 32.69, 23.65 20, 37.48 4.75 M0.08 47.77 C6.62 38.17, 15.92 29.8, 37.48 4.75 M0.47 53.41 C13.63 37.04, 26.09 22.31, 37.87 10.39 M0.47 53.41 C13.38 38.07, 27.48 23.14, 37.87 10.39 M0.21 59.81 C16.02 43.76, 30.04 28.36, 38.26 16.04 M0.21 59.81 C13.31 43, 27.05 26.98, 38.26 16.04 M0.61 65.45 C12.1 49.05, 24.63 34.29, 38 22.44 M0.61 65.45 C9.86 55.54, 20.39 42.58, 38 22.44 M0.35 71.85 C13.73 56.95, 22.85 44.49, 38.4 28.08 M0.35 71.85 C8.7 61.71, 17.38 51.55, 38.4 28.08 M0.74 77.5 C11.93 64.38, 20.47 53.25, 38.14 34.48 M0.74 77.5 C9.58 67.86, 19.77 57.57, 38.14 34.48 M0.48 83.89 C15.8 69.06, 25.94 52.1, 38.53 40.12 M0.48 83.89 C9.33 75.25, 16.51 65.09, 38.53 40.12 M0.22 90.29 C10.21 79.32, 20.35 69.13, 38.27 46.52 M0.22 90.29 C10.55 78.84, 19.61 68.16, 38.27 46.52 M0.61 95.93 C13.78 82.32, 27.11 66.48, 38.66 52.16 M0.61 95.93 C9.79 85.27, 18.88 75.91, 38.66 52.16 M0.35 102.33 C11.35 90.32, 22.17 76.84, 38.4 58.56 M0.35 102.33 C14.6 86.06, 29.01 70.39, 38.4 58.56 M0.75 107.97 C11.17 97.93, 17.38 84.95, 38.14 64.96 M0.75 107.97 C9.97 96.6, 21.9 83.37, 38.14 64.96 M0.48 114.37 C12.92 98.34, 29.63 83.62, 38.54 70.6 M0.48 114.37 C12.7 99.37, 25.26 85.17, 38.54 70.6 M0.88 120.02 C12.75 105.81, 25.28 92.65, 38.27 77 M0.88 120.02 C9.95 107.96, 19.88 98.39, 38.27 77 M3.24 123.39 C9.6 113.91, 18.98 103.55, 38.67 82.64 M3.24 123.39 C16 108.4, 29.72 92.63, 38.67 82.64 M6.92 125.26 C14.77 117, 22.21 107.56, 38.41 89.04 M6.92 125.26 C19.61 111.28, 31.5 97.35, 38.41 89.04 M12.56 124.87 C16.86 117.25, 25.9 110.96, 38.8 94.68 M12.56 124.87 C19.88 116.86, 27.5 108.2, 38.8 94.68 M17.55 125.23 C22.55 117.37, 31.35 111.74, 38.54 101.08 M17.55 125.23 C25.46 116.95, 30.84 108.55, 38.54 101.08 M23.19 124.83 C27.99 118.12, 35.05 108.51, 38.94 106.72 M23.19 124.83 C27.53 119.32, 33.4 113.31, 38.94 106.72 M28.18 125.19 C32.06 123.44, 34.03 118.28, 38.67 113.12 M28.18 125.19 C32.39 120.2, 34.83 116.18, 38.67 113.12 M33.16 125.55 C34.37 123.93, 35.63 122.62, 38.41 119.52 M33.16 125.55 C35.52 122.94, 37.06 120.87, 38.41 119.52" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C13.49 1.64, 19.78 1.57, 28.93 0 M9.64 0 C14.6 -0.4, 19.65 -0.59, 28.93 0 M28.93 0 C35 -1.55, 36.87 2.47, 38.57 9.64 M28.93 0 C33.87 1.62, 37.43 2.73, 38.57 9.64 M38.57 9.64 C37.82 44.81, 38.29 81.44, 38.57 115.91 M38.57 9.64 C37.69 50.69, 37.26 89.96, 38.57 115.91 M38.57 115.91 C39.44 122.18, 36.99 124.88, 28.93 125.55 M38.57 115.91 C40.14 124.49, 34.59 124.44, 28.93 125.55 M28.93 125.55 C25.36 127.47, 21.81 126.62, 9.64 125.55 M28.93 125.55 C21.9 124.57, 15.92 126.09, 9.64 125.55 M9.64 125.55 C4.96 127.31, -0.14 121.33, 0 115.91 M9.64 125.55 C1.53 123.98, -2.12 123.62, 0 115.91 M0 115.91 C0.59 93.3, 0.33 68.26, 0 9.64 M0 115.91 C-0.71 86.94, -0.29 56.41, 0 9.64 M0 9.64 C-1.47 2.61, 4.57 -0.68, 9.64 0 M0 9.64 C-1.49 1.64, 3.32 -1.58, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1040.3639055694566 385.0450951750688) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v4</text></g><g stroke-linecap="round" transform="translate(1088.2294901795271 335.2888402817298) rotate(0 19.284182130573413 62.775886524987754)"><path d="M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M2.57 2.23 C2.57 2.23, 2.57 2.23, 2.57 2.23 M0.34 10.89 C3.84 8.01, 7.14 1.91, 9.52 0.33 M0.34 10.89 C2.79 8.61, 5.56 4.67, 9.52 0.33 M0.08 17.29 C5.73 12.1, 10.56 4.87, 15.16 -0.07 M0.08 17.29 C4.53 10.86, 10.78 5.49, 15.16 -0.07 M-0.19 23.69 C8.27 14.74, 17.22 4.69, 20.15 0.29 M-0.19 23.69 C4.82 16.67, 11.66 10.97, 20.15 0.29 M0.21 29.33 C7.69 21.5, 16.01 11.45, 25.14 0.65 M0.21 29.33 C8.21 21.98, 15.5 12.61, 25.14 0.65 M-0.05 35.73 C8.8 24.72, 20.78 13.94, 30.78 0.26 M-0.05 35.73 C8.6 25.77, 17.91 16.77, 30.78 0.26 M0.34 41.37 C7.4 31.35, 15.52 21.74, 34.46 2.13 M0.34 41.37 C12.65 26.33, 24.23 13.66, 34.46 2.13 M0.08 47.77 C7.28 39.55, 16.35 25.65, 37.48 4.75 M0.08 47.77 C8.81 38.28, 16.82 28.53, 37.48 4.75 M0.47 53.41 C11.13 42.3, 20.13 31.02, 37.87 10.39 M0.47 53.41 C12.77 39.81, 22.57 27.14, 37.87 10.39 M0.21 59.81 C13.35 47.53, 25.46 31.18, 38.26 16.04 M0.21 59.81 C9.92 50.31, 18.03 38.66, 38.26 16.04 M0.61 65.45 C7.78 57.91, 14.74 47.62, 38 22.44 M0.61 65.45 C15.09 48.71, 30.14 32.81, 38 22.44 M0.35 71.85 C7.79 61.81, 19.17 51.03, 38.4 28.08 M0.35 71.85 C12.78 57.97, 25.59 43.78, 38.4 28.08 M0.74 77.5 C7.65 68.27, 15.9 58.59, 38.14 34.48 M0.74 77.5 C14.63 61.22, 27.47 46.56, 38.14 34.48 M0.48 83.89 C12.26 70.2, 26.4 55.6, 38.53 40.12 M0.48 83.89 C15.22 66.24, 31.38 49.38, 38.53 40.12 M0.22 90.29 C10.54 75.54, 21.35 64.01, 38.27 46.52 M0.22 90.29 C11.45 76.94, 22.36 65.91, 38.27 46.52 M0.61 95.93 C11.21 83.21, 24.02 68.86, 38.66 52.16 M0.61 95.93 C9.71 84.52, 19.92 73.88, 38.66 52.16 M0.35 102.33 C16.4 86.94, 28.72 69.91, 38.4 58.56 M0.35 102.33 C10.73 89.9, 22.9 77.15, 38.4 58.56 M0.75 107.97 C13.79 94.6, 28.46 76.37, 38.14 64.96 M0.75 107.97 C15.42 91.21, 28.84 74.41, 38.14 64.96 M0.48 114.37 C10.76 101.43, 21.85 89.97, 38.54 70.6 M0.48 114.37 C10.75 102.85, 19.58 91.62, 38.54 70.6 M0.88 120.02 C10.82 108.82, 23.09 94.67, 38.27 77 M0.88 120.02 C8.19 109.76, 17.44 100.26, 38.27 77 M3.24 123.39 C15.34 111, 22.89 98.01, 38.67 82.64 M3.24 123.39 C14.44 110.76, 27.87 97.01, 38.67 82.64 M6.92 125.26 C17.76 112.47, 24.73 104.37, 38.41 89.04 M6.92 125.26 C13.71 117.17, 22.19 107.05, 38.41 89.04 M12.56 124.87 C19.33 117.86, 26.24 108.2, 38.8 94.68 M12.56 124.87 C22.16 113.42, 32.38 101.95, 38.8 94.68 M17.55 125.23 C23.98 117.69, 27.76 113.19, 38.54 101.08 M17.55 125.23 C24.52 118.95, 29.65 111.4, 38.54 101.08 M23.19 124.83 C28.55 120.1, 35.36 112.29, 38.94 106.72 M23.19 124.83 C27.4 120.07, 33.64 114.38, 38.94 106.72 M28.18 125.19 C32.77 119.42, 36.98 117.2, 38.67 113.12 M28.18 125.19 C30.05 123.24, 32.59 120.16, 38.67 113.12 M33.16 125.55 C35.33 124.32, 36.74 122.89, 38.41 119.52 M33.16 125.55 C34.82 124.05, 35.71 122.49, 38.41 119.52" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M9.64 0 C16.45 -0.77, 25.58 -0.27, 28.93 0 M9.64 0 C14.6 -0.65, 19.09 -0.26, 28.93 0 M28.93 0 C34.06 1.41, 37.58 2.79, 38.57 9.64 M28.93 0 C36.2 -1.09, 39.45 2.93, 38.57 9.64 M38.57 9.64 C40.31 36.57, 38.45 66.91, 38.57 115.91 M38.57 9.64 C38.57 46.99, 38.95 84.15, 38.57 115.91 M38.57 115.91 C39.93 124.21, 34.69 124.59, 28.93 125.55 M38.57 115.91 C36.49 123.46, 35.29 126.12, 28.93 125.55 M28.93 125.55 C21.74 127.04, 13.3 124.2, 9.64 125.55 M28.93 125.55 C25.9 126.51, 21.12 125.18, 9.64 125.55 M9.64 125.55 C1.75 124.19, -1.84 123.45, 0 115.91 M9.64 125.55 C1.49 127.24, -1.48 123.91, 0 115.91 M0 115.91 C-0.98 77.68, -2.19 37.45, 0 9.64 M0 115.91 C-0.78 74.86, 0.63 34.08, 0 9.64 M0 9.64 C-1.3 1.85, 3.31 -1.37, 9.64 0 M0 9.64 C-1.82 2.32, 5.46 -1.2, 9.64 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1097.5136723101004 385.56472680671754) rotate(0 10 12.5)"><text x="10" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">v5</text></g><g transform="translate(1673.325477944411 90.33603861711129) rotate(0 84.5299301147461 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- commentId (PK)</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- videoId (shard)</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- content</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- author</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- createdAt (SK)</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Pub/Sub with Layer 7 Load Balancer</span></div></div></div></div></div></div></div></div></div></div><div class="my-6"><div class="MuiBox-root mui-8d9r5j"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Advanced candidates may point out the tradeoffs in different pub/sub systems. For example, Kafka is a popular pub/sub system that is highly scalable and fault-tolerant, but it has a hard time adapting to scenarios where dynamic subscription and unsubscription based on user interactions, such as scrolling through a live feed or switching live videos, is required. This is due to its pull-based model leading to degraded latency, limited scalability as consumers need to subscribe to all topics, and operational complexity. Redis, on the other hand, is a more suitable option for scenarios requiring dynamic subscription and unsubscription thanks to its efficient in-memory storage and support for both blocking and non-blocking consumption methods, leading to improved latency.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">However, the main concern with Redis is its potential for data loss due to periodic disk writes and the challenges of memory limitation, which could be a bottleneck for scalability. Additionally, while Redis offers high availability configurations like Redis Sentinel or Redis Active-Active, these add to the operational complexity of managing a Redis-based system. The pub/sub solution is the "correct academic answer" and should clearly pass the interview, but the reality is choosing the right pub/sub system is a complex decision that requires a deep understanding of the system's requirements and tradeoffs.</div></div><div class="MuiBox-root mui-fx3t84"></div><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textError MuiButton-sizeSmall MuiButton-textSizeSmall MuiButton-colorError MuiButton-disableElevation MuiButton-root MuiButton-text MuiButton-textError MuiButton-sizeSmall MuiButton-textSizeSmall MuiButton-colorError MuiButton-disableElevation mui-tggf3w" tabindex="0" type="button">Show More<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Scalable Dispatcher Instead of Pub/Sub</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach-7">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">All our previous approaches relied on a pub/sub system, where each Realtime Messaging Server subscribes to topics and receives comments as they're published. This means the comment creation service doesnâ€™t need to know the destination server; it just publishes messages and the right servers pick them up. While standard and effective, this approach adds complexity in managing subscriptions and scaling read-heavy workloads.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">An alternative approach inverts the model: the service creating comments directly routes each new comment to the correct Realtime Messaging Server. To achieve this, we introduce a Dispatcher Service. Instead of broadcasting to topics, the Dispatcher Service determines the exact server responsible for the viewers of a given live video and sends the comment there.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">So when a new comment comes in, the receiving server asks the Dispatcher Service, "What are all the other servers I should send this comment to?"</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">At a high-level, here is how it works:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Maintaining Dynamic Mappings:</strong> The Dispatcher Service keeps a dynamic map of which Realtime Messaging Server is responsible for which liveVideoId. This can be stored in memory and periodically refreshed from a consistent store (like Zookeeper or etcd), or updated via heartbeats and registration protocols as servers join or leave.</div>
</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Registration &amp; Discovery:</strong> When a Realtime Messaging Server comes online, it registers with the Dispatcher Service (or the coordination store it consults). The Dispatcher updates its internal mapping to reflect which server is now serving particular live videos. Likewise, if a server scales down or fails, the Dispatcher updates the mapping accordingly.</div>
</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Direct Routing:</strong> Upon receiving a new comment, the comment management service calls the Dispatcher Service to determine the correct server. The Dispatcher uses its current mapping and forwards the comment directly to the responsible Realtime Messaging Server, which then sends it to connected viewers.</div>
</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Scalability &amp; Redundancy:</strong> In high-demand scenarios, multiple Dispatcher instances can run in parallel behind a load balancer. They all consult the same coordination data, ensuring consistency. This replication adds redundancy, making the system more resilient to failures.</div>
</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1849.5423110409486 797.0434770683614">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1849.5423110409486" height="797.0434770683614" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 251.4469017486408) rotate(0 128.0182913190058 84.77455315625434)"><path d="M32 0 C96.07 0.7, 163.2 -1.16, 224.04 0 M32 0 C78.57 2.39, 124.93 2.24, 224.04 0 M224.04 0 C245.26 1.5, 254.6 11.6, 256.04 32 M224.04 0 C243.55 1.32, 257.12 12.14, 256.04 32 M256.04 32 C254.92 73.04, 257.67 115.2, 256.04 137.55 M256.04 32 C254.53 72.92, 254.59 111.2, 256.04 137.55 M256.04 137.55 C257.36 159.11, 243.41 171.3, 224.04 169.55 M256.04 137.55 C256.88 158.81, 243.13 169, 224.04 169.55 M224.04 169.55 C169.34 169.83, 112.68 169.54, 32 169.55 M224.04 169.55 C154.13 168.96, 86.08 169.59, 32 169.55 M32 169.55 C10.16 168.69, 1.4 159.77, 0 137.55 M32 169.55 C11.11 167.76, -1.66 159.89, 0 137.55 M0 137.55 C0.27 104.92, 1.06 70.82, 0 32 M0 137.55 C0.13 100.4, -0.6 64.68, 0 32 M0 32 C1.2 8.67, 12.62 0.1, 32 0 M0 32 C0.72 10.69, 11.94 -0.21, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(63.86301788150581 323.72145490489515) rotate(0 74.1552734375 12.5)"><text x="74.1552734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Commenter Client</text></g><g mask="url(#mask-kKeg6MHn2XD--uVSqapw8)" stroke-linecap="round"><g transform="translate(289.95865210060197 289.478283542172) rotate(0 123.1463414244705 1.931271818146115)"><path d="M-0.27 -0.7 C40.67 -0.16, 205.37 2.03, 246.5 2.98 M1.79 1.54 C42.51 2.24, 204.98 3.76, 245.66 4.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.95865210060197 289.478283542172) rotate(0 123.1463414244705 1.931271818146115)"><path d="M28.06 -10.57 C16.37 -6.63, 5.57 -2.95, -0.27 -0.7 M28.06 -10.57 C16.73 -5.65, 4.77 -2, -0.27 -0.7" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.95865210060197 289.478283542172) rotate(0 123.1463414244705 1.931271818146115)"><path d="M27.77 9.95 C16.24 6.29, 5.55 2.36, -0.27 -0.7 M27.77 9.95 C16.52 6.69, 4.68 2.16, -0.27 -0.7" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.95865210060197 289.478283542172) rotate(0 123.1463414244705 1.931271818146115)"><path d="M217.38 14.08 C226.72 10.78, 236.91 7.08, 245.66 4.06 M217.38 14.08 C228.59 10.6, 239.2 6.32, 245.66 4.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(289.95865210060197 289.478283542172) rotate(0 123.1463414244705 1.931271818146115)"><path d="M217.56 -6.44 C226.78 -2.14, 236.9 1.77, 245.66 4.06 M217.56 -6.44 C228.73 -1.74, 239.27 2.16, 245.66 4.06" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-kKeg6MHn2XD--uVSqapw8"><rect x="0" y="0" fill="#fff" width="636.251334949543" height="393.3408271784642"></rect><rect x="382.5434700875725" y="278.9095553603181" fill="#000" width="61.123046875" height="25" opacity="1"></rect></mask><g transform="translate(382.5434700875725 278.9095553603181) rotate(0 30.529661873355536 12.24878224303015)"><text x="30.5615234375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">HTTPS</text></g><g stroke-linecap="round" transform="translate(563.0339881173547 10.629021465669211) rotate(0 52.987237405710914 314.61157847145796)"><path d="M26.49 0 C45.28 0.22, 61.79 -0.21, 79.48 0 M26.49 0 C45.57 0.33, 66.7 0.4, 79.48 0 M79.48 0 C98.99 0.58, 105.85 7.41, 105.97 26.49 M79.48 0 C96.74 1.53, 106.44 10.64, 105.97 26.49 M105.97 26.49 C107.77 166.96, 106.43 309.34, 105.97 602.73 M105.97 26.49 C103.87 205.84, 103.33 385.11, 105.97 602.73 M105.97 602.73 C105.78 621.84, 96.91 630.22, 79.48 629.22 M105.97 602.73 C106.56 620.45, 97.39 630.58, 79.48 629.22 M79.48 629.22 C58.68 628.54, 40.17 628.2, 26.49 629.22 M79.48 629.22 C66.06 628.68, 51.52 629.89, 26.49 629.22 M26.49 629.22 C8.97 628.7, 0.26 620.39, 0 602.73 M26.49 629.22 C8.56 630.12, -2.23 621.53, 0 602.73 M0 602.73 C1.2 432.84, 2.13 264.49, 0 26.49 M0 602.73 C-2.13 487.33, -2.03 371.88, 0 26.49 M0 26.49 C0.34 8.7, 7.94 1.02, 26.49 0 M0 26.49 C-1.3 9.78, 9.45 -0.38, 26.49 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(568.5456395855656 275.2405999371272) rotate(0 47.4755859375 50)"><text x="47.4755859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Load </text><text x="47.4755859375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Balancer</text><text x="47.4755859375" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- layer 7 for</text><text x="47.4755859375" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">SSE</text></g><g stroke-linecap="round" transform="translate(829.0716441099037 73.28495701370775) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C120.5 -0.99, 207.4 -1.1, 308.62 0 M32 0 C131.59 -1.15, 229.7 -1.92, 308.62 0 M308.62 0 C329.6 1.33, 341.02 12.24, 340.62 32 M308.62 0 C328.69 1.02, 338.49 12.89, 340.62 32 M340.62 32 C339.85 60.23, 341.38 93.11, 340.62 173.16 M340.62 32 C339.14 74.62, 339.13 116.29, 340.62 173.16 M340.62 173.16 C341.13 194.54, 330.17 206.34, 308.62 205.16 M340.62 173.16 C342.29 194.42, 327.71 203.96, 308.62 205.16 M308.62 205.16 C227.33 205.71, 148.06 204.92, 32 205.16 M308.62 205.16 C247.23 205.89, 185.84 206.09, 32 205.16 M32 205.16 C10.43 205.94, -1.94 195.48, 0 173.16 M32 205.16 C10.53 203.75, 0.14 193.89, 0 173.16 M0 173.16 C-3.27 142.11, -1.17 107.78, 0 32 M0 173.16 C-0.61 130.61, -1.23 88.71, 0 32 M0 32 C-1.13 11.49, 11.2 -0.33, 32 0 M0 32 C1.54 11.86, 12.47 1.87, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(872.7498303153175 163.3644767076039) rotate(0 126.630859375 12.5)"><text x="126.630859375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment Management Service</text></g><g stroke-linecap="round"><g transform="translate(685.6557271785293 192.13573834723866) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M-0.95 0.69 C19.5 0.8, 101.26 1.18, 121.81 1.2 M0.76 0.01 C21.17 -0.27, 100.92 -0.29, 121.16 -0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.6557271785293 192.13573834723866) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M27.29 -9.44 C22.04 -6.41, 15.73 -3.2, -0.95 0.69 M27.29 -9.44 C17.82 -5.65, 8.92 -2.2, -0.95 0.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.6557271785293 192.13573834723866) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M27.2 11.08 C21.87 9.43, 15.58 7.96, -0.95 0.69 M27.2 11.08 C17.77 8.13, 8.9 4.83, -0.95 0.69" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.6557271785293 192.13573834723866) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M93.02 9.89 C100.55 8.68, 107.1 7.2, 121.16 -0.52 M93.02 9.89 C102.1 7.33, 111.73 4.03, 121.16 -0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(685.6557271785293 192.13573834723866) rotate(0 60.622670454105105 0.2147864390281029)"><path d="M92.92 -10.63 C100.56 -7.16, 107.14 -3.95, 121.16 -0.52 M92.92 -10.63 C102.02 -6.44, 111.68 -3, 121.16 -0.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(1371.6416783284237 49.68229322763) rotate(0 133.62108660928106 133.6788415220053)"><path d="M192.37 13.79 C205.67 18.06, 218.97 29.73, 229.38 39.97 C239.79 50.2, 248.59 62.34, 254.82 75.19 C261.06 88.04, 265.04 102.75, 266.76 117.07 C268.49 131.39, 268.43 146.68, 265.18 161.09 C261.93 175.5, 254.89 191.14, 247.27 203.5 C239.64 215.87, 230.27 226.03, 219.44 235.26 C208.6 244.49, 195.8 253.72, 182.27 258.89 C168.74 264.06, 152.89 265.88, 138.25 266.3 C123.61 266.73, 108.14 265.53, 94.43 261.45 C80.73 257.38, 67.6 250.28, 56 241.85 C44.41 233.43, 33.32 222.7, 24.88 210.91 C16.43 199.12, 9.36 184.92, 5.34 171.11 C1.31 157.29, 0.06 142.66, 0.74 128.03 C1.42 113.39, 4.26 96.89, 9.42 83.31 C14.58 69.73, 22.25 57.4, 31.69 46.54 C41.13 35.68, 53.58 25.35, 66.07 18.15 C78.55 10.96, 92.38 6.18, 106.61 3.37 C120.84 0.57, 134.9 -1.61, 151.44 1.33 C167.99 4.27, 194.79 15.71, 205.87 21.01 C216.96 26.32, 219.08 31.15, 217.95 33.16 M132.15 0.74 C145.9 -1.62, 162.96 1.81, 176.9 6.32 C190.84 10.83, 204.51 18.52, 215.77 27.78 C227.03 37.05, 236.43 49.97, 244.48 61.9 C252.53 73.82, 260.08 85.54, 264.05 99.35 C268.01 113.16, 269.52 130.1, 268.25 144.77 C266.99 159.44, 262.38 174.16, 256.46 187.37 C250.55 200.59, 242.6 213.44, 232.77 224.07 C222.94 234.7, 210.45 244.1, 197.49 251.14 C184.52 258.18, 169.41 263.8, 154.96 266.3 C140.51 268.8, 124.88 268.7, 110.8 266.15 C96.71 263.61, 82.86 257.87, 70.45 251.01 C58.03 244.15, 46 235.41, 36.33 225.01 C26.66 214.61, 18.24 202.05, 12.44 188.61 C6.65 175.18, 2.95 158.96, 1.56 144.43 C0.16 129.89, 0.75 115.55, 4.06 101.38 C7.37 87.22, 13.37 71.55, 21.42 59.42 C29.47 47.28, 40.82 37.19, 52.35 28.56 C63.88 19.93, 77.09 12.31, 90.62 7.63 C104.14 2.95, 126.36 1.36, 133.51 0.48 C140.66 -0.4, 133.63 0.36, 133.51 2.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1443.0518259867672 158.33591940826352) rotate(0 62.2265625 25)"><text x="62.2265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comments DB </text><text x="62.2265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(DynamoDB)</text></g><g stroke-linecap="round"><g transform="translate(1191.765701322627 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M-0.07 -0.85 C26.42 -0.79, 133.28 0.43, 160.05 0.72 M-1.57 1.31 C24.65 1.01, 132.08 -0.6, 158.99 -0.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M28.21 -10.85 C15.72 -7.3, 7.39 -2.62, -0.07 -0.85 M28.21 -10.85 C16.53 -5.98, 5.88 -3.86, -0.07 -0.85" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M28.02 9.67 C15.55 5.17, 7.29 1.8, -0.07 -0.85 M28.02 9.67 C16.52 6.78, 5.95 1.13, -0.07 -0.85" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M130.95 9.69 C140.49 5.17, 154.25 1.74, 158.99 -0.98 M130.95 9.69 C140.69 6.49, 151.37 0.79, 158.99 -0.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(1191.765701322627 183.78760920704008) rotate(0 80.12992170582652 -0.03953793054711241)"><path d="M130.65 -10.83 C140.37 -7.31, 154.24 -2.68, 158.99 -0.98 M130.65 -10.83 C140.4 -6.26, 151.19 -4.2, 158.99 -0.98" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g transform="translate(346.4042316370312 246.18504761431905) rotate(0 66.38994598388672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- for /create</text></g><g transform="translate(786.302229101251 10) rotate(0 231.78981018066406 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- When a new comment is posted, persist in DB</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">and send to dispatcher</text></g><g stroke-linecap="round" transform="translate(816.6794355356983 548.5749169946866) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C101.25 0.65, 166.44 3, 308.62 0 M32 0 C118.38 -1.9, 203.45 -2.06, 308.62 0 M308.62 0 C329.75 1.45, 340.38 11.67, 340.62 32 M308.62 0 C330.54 0.05, 340.86 12.02, 340.62 32 M340.62 32 C339.53 84.46, 340.78 136.77, 340.62 173.16 M340.62 32 C341.8 67.5, 340.89 105, 340.62 173.16 M340.62 173.16 C340.76 193.97, 330.21 205.16, 308.62 205.16 M340.62 173.16 C340.35 195.39, 327.72 206.3, 308.62 205.16 M308.62 205.16 C226.92 204.27, 147.41 206.22, 32 205.16 M308.62 205.16 C253.46 205.27, 198.25 205.2, 32 205.16 M32 205.16 C11 205.03, -0.89 195.52, 0 173.16 M32 205.16 C9.36 206.1, 0.62 194.11, 0 173.16 M0 173.16 C0.9 122.85, -1.15 69.57, 0 32 M0 173.16 C0.85 126.33, 0.58 79.27, 0 32 M0 32 C-0.12 11.31, 10.55 -0.44, 32 0 M0 32 C-1.27 9.12, 12.61 -1.97, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(835.5280406571615 562.8246796659487) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C88.29 2.86, 146.92 0.33, 308.62 0 M32 0 C138.47 -0.12, 246.37 0.63, 308.62 0 M308.62 0 C329.71 1, 341.13 10.71, 340.62 32 M308.62 0 C330.2 1.36, 342.29 10.59, 340.62 32 M340.62 32 C340.09 60.06, 339.02 90.54, 340.62 173.16 M340.62 32 C340.17 81.02, 340.96 128.92, 340.62 173.16 M340.62 173.16 C340.87 194.49, 329.72 205.94, 308.62 205.16 M340.62 173.16 C338.39 195.63, 329.81 203.75, 308.62 205.16 M308.62 205.16 C225.31 204.67, 137.67 205.25, 32 205.16 M308.62 205.16 C224.69 205.11, 140.04 205.13, 32 205.16 M32 205.16 C9.77 206.18, -1.13 195.31, 0 173.16 M32 205.16 C11.29 204.78, 1.54 195.68, 0 173.16 M0 173.16 C-1.56 119.69, -0.48 65.86, 0 32 M0 173.16 C-0.5 142.02, -0.83 110.7, 0 32 M0 32 C-0.12 10.22, 9.56 -1.34, 32 0 M0 32 C1.94 8.7, 8.67 -0.09, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(857.7622670767046 581.8844376805691) rotate(0 170.30904558041385 102.57951969389615)"><path d="M32 0 C91.33 -2.92, 151.66 -0.84, 308.62 0 M32 0 C114.02 1.07, 196.11 0.9, 308.62 0 M308.62 0 C330.46 0.05, 340.83 11.85, 340.62 32 M308.62 0 C331.63 -0.08, 338.37 9.47, 340.62 32 M340.62 32 C339.91 74.55, 341.65 114.67, 340.62 173.16 M340.62 32 C339.67 63.09, 339.73 94.71, 340.62 173.16 M340.62 173.16 C340.38 195.27, 328.01 206.15, 308.62 205.16 M340.62 173.16 C340.48 193.08, 330.09 204.56, 308.62 205.16 M308.62 205.16 C242.41 207.95, 179.35 206.92, 32 205.16 M308.62 205.16 C225.5 204.92, 141.78 205.36, 32 205.16 M32 205.16 C9.53 205.98, 0.54 194.16, 0 173.16 M32 205.16 C12.2 206.35, 1.81 196.36, 0 173.16 M0 173.16 C0.96 120.03, -1.26 68.87, 0 32 M0 173.16 C-0.44 127.75, -0.44 81.47, 0 32 M0 32 C-1.11 9.32, 12.36 -1.71, 32 0 M0 32 C-2 10.57, 11.41 -1.94, 32 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(946.1426017196184 659.4639573744653) rotate(0 81.9287109375 25)"><text x="81.9287109375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Realtime Messaging</text><text x="81.9287109375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"> Service</text></g><g mask="url(#mask-_VbW9xOjU3t7yqdDfAkrE)" stroke-linecap="round"><g transform="translate(283.59127920140213 372.86882311313093) rotate(0 259.26183029533263 139.98272095370612)"><path d="M0 0 C105.76 55.05, 210.41 112.33, 518.52 279.97 M0 0 C193.02 103.2, 386.01 207.66, 518.52 279.97" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.59127920140213 372.86882311313093) rotate(0 259.26183029533263 139.98272095370612)"><path d="M29.69 4.29 C23.59 1.59, 17.17 2.47, 0 0 M29.69 4.29 C18.9 2.86, 7.69 1.83, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(283.59127920140213 372.86882311313093) rotate(0 259.26183029533263 139.98272095370612)"><path d="M19.99 22.37 C15.69 15.98, 11.24 13.2, 0 0 M19.99 22.37 C12.83 14.17, 5.24 6.4, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-_VbW9xOjU3t7yqdDfAkrE"><rect x="0" y="0" fill="#fff" width="902.1149397920674" height="752.8342650205432"></rect><rect x="415.16267980923476" y="487.85154406683705" fill="#000" width="255.380859375" height="50" opacity="1"></rect></mask><g transform="translate(415.16267980923476 487.85154406683705) rotate(0 127.6904296875 25)"><text x="127.6904296875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">SSE</text><text x="127.6904296875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- connect based on LiveVideoId</text></g><g stroke-linecap="round"><g transform="translate(996.6938264309986 293.1552376740765) rotate(0 -0.1515113488744646 15.718536290923112)"><path d="M-0.05 0.4 C-0.03 5.7, -0.35 26.54, -0.37 31.71 M-0.75 0.13 C-0.75 5.28, -0.88 25.57, -0.83 30.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6938264309986 293.1552376740765) rotate(0 -0.1515113488744646 15.718536290923112)"><path d="M-6.22 16.12 C-4.58 19.02, -3.66 22.31, -0.83 30.89 M-6.22 16.12 C-4.3 20.56, -3.34 24.83, -0.83 30.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(996.6938264309986 293.1552376740765) rotate(0 -0.1515113488744646 15.718536290923112)"><path d="M4.53 16.11 C4 19.01, 2.73 22.3, -0.83 30.89 M4.53 16.11 C3.21 20.58, 0.91 24.86, -0.83 30.89" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g mask="url(#mask-wX6G0pwRdt-ST2D44H2uq)" stroke-linecap="round"><g transform="translate(995.9190917586873 468.4725026183078) rotate(0 -0.05581749773227784 35.86438597959386)"><path d="M-0.14 0.6 C-0.09 12.42, 0.17 59.78, 0.19 71.76 M-1.68 -0.13 C-1.74 11.82, -0.76 61.54, -0.59 73.31" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(995.9190917586873 468.4725026183078) rotate(0 -0.05581749773227784 35.86438597959386)"><path d="M-11.33 45.3 C-7.01 53.94, -4.85 61.77, -0.59 73.31 M-11.33 45.3 C-8.25 54.83, -3.5 65.52, -0.59 73.31" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(995.9190917586873 468.4725026183078) rotate(0 -0.05581749773227784 35.86438597959386)"><path d="M9.19 44.95 C7.56 53.67, 3.76 61.6, -0.59 73.31 M9.19 44.95 C4.91 54.6, 2.29 65.41, -0.59 73.31" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask id="mask-wX6G0pwRdt-ST2D44H2uq"><rect x="0" y="0" fill="#fff" width="1096.0307267541518" height="640.2012745774955"></rect><rect x="909.193352385955" y="491.83688859790163" fill="#000" width="173.33984375" height="25" opacity="1"></rect></mask><g transform="translate(909.193352385955 491.83688859790163) rotate(0 85.98308262729904 13.225301619637747)"><text x="86.669921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">HTTPS (not pub/sub)</text></g><g stroke-linecap="round" transform="translate(839.0626549933211 340.1215670212987) rotate(0 157.18401199848017 58.059136783904705)"><path d="M7.07 7.47 C7.07 7.47, 7.07 7.47, 7.07 7.47 M7.07 7.47 C7.07 7.47, 7.07 7.47, 7.07 7.47 M2.22 19.15 C5.15 14.17, 11.05 10.74, 16.65 2.55 M2.22 19.15 C7.87 12.79, 13.88 6.06, 16.65 2.55 M0.64 27.06 C8.67 19.64, 15.23 7.08, 22.95 1.4 M0.64 27.06 C5.71 21.45, 11.35 15.09, 22.95 1.4 M0.38 33.46 C11.62 21.44, 24.53 6.39, 29.25 0.25 M0.38 33.46 C10.64 22.81, 21.23 10.64, 29.25 0.25 M0.78 39.1 C10.85 27.54, 22.33 15.41, 34.89 -0.14 M0.78 39.1 C13.6 23.21, 27.31 9.65, 34.89 -0.14 M0.52 45.5 C15.49 29.18, 28.57 15.5, 39.88 0.22 M0.52 45.5 C11.19 34.39, 20.01 22.48, 39.88 0.22 M0.91 51.14 C19 32.2, 35.04 13.46, 44.87 0.58 M0.91 51.14 C9.96 41.41, 18.62 31.36, 44.87 0.58 M0.65 57.54 C13.23 42.81, 24.16 30.23, 50.51 0.18 M0.65 57.54 C14.67 41.43, 28.35 25.36, 50.51 0.18 M0.39 63.94 C12.91 48.08, 26.53 31.62, 55.5 0.54 M0.39 63.94 C19.62 42.98, 37.24 22.61, 55.5 0.54 M0.78 69.58 C16.35 52.05, 34.13 34.77, 61.14 0.15 M0.78 69.58 C12.67 56.03, 25.18 42.11, 61.14 0.15 M0.52 75.98 C23.01 49.47, 45.62 25.69, 66.13 0.51 M0.52 75.98 C17.27 56.89, 36.51 35.45, 66.13 0.51 M0.91 81.62 C18.62 61.37, 35.68 42.49, 71.77 0.11 M0.91 81.62 C26.91 52.45, 52.65 21.58, 71.77 0.11 M0.65 88.02 C18.29 68.84, 32.07 48.57, 76.76 0.47 M0.65 88.02 C24.3 59.81, 49.6 32.66, 76.76 0.47 M0.39 94.42 C17.5 74.73, 32.06 55.04, 82.4 0.08 M0.39 94.42 C24.03 67.82, 48.19 39.42, 82.4 0.08 M2.1 98.55 C20.82 73.25, 41.26 53.76, 87.39 0.44 M2.1 98.55 C24.73 72.28, 48.57 47.53, 87.39 0.44 M3.81 102.68 C33.5 66.78, 63.21 32.11, 93.03 0.04 M3.81 102.68 C29.47 74.69, 55.12 45.52, 93.03 0.04 M5.51 106.82 C28.9 80.41, 51.58 55.82, 98.02 0.4 M5.51 106.82 C29.56 80.22, 53.67 53.39, 98.02 0.4 M8.53 109.44 C34.74 82.83, 58.98 53.89, 103.66 0.01 M8.53 109.44 C28.77 86.13, 48.59 63.42, 103.66 0.01 M11.55 112.07 C36.94 86.09, 60.71 57.96, 108.65 0.37 M11.55 112.07 C41.45 78.18, 73.03 41.09, 108.65 0.37 M15.22 113.94 C49.89 70.52, 84.95 32.59, 114.29 -0.03 M15.22 113.94 C48.86 73.13, 83.04 32.79, 114.29 -0.03 M19.56 115.05 C44.56 85.89, 67.11 61.17, 119.28 0.33 M19.56 115.05 C47.79 84.23, 75.19 52.57, 119.28 0.33 M23.89 116.17 C46.51 90.09, 70.42 60.3, 124.92 -0.06 M23.89 116.17 C57.31 78.42, 90.6 39.79, 124.92 -0.06 M28.87 116.53 C60.04 83.59, 86.1 47.48, 129.91 0.3 M28.87 116.53 C49.81 92.07, 72.66 65.28, 129.91 0.3 M34.52 116.13 C64.06 85.3, 88.66 51.95, 135.55 -0.09 M34.52 116.13 C71.53 70.95, 111.78 27, 135.55 -0.09 M39.5 116.49 C65.71 89.03, 93.49 59.16, 140.54 0.27 M39.5 116.49 C62 90.77, 85.33 64.14, 140.54 0.27 M45.15 116.1 C70.9 86.56, 98.07 54.73, 146.18 -0.13 M45.15 116.1 C75.47 81.28, 105.13 48.08, 146.18 -0.13 M50.13 116.46 C86.57 77.71, 120.87 36.94, 151.17 0.23 M50.13 116.46 C72.08 89.2, 95.88 62.09, 151.17 0.23 M55.78 116.06 C94.4 70.4, 133.08 26.29, 156.15 0.59 M55.78 116.06 C84.06 83.28, 112.23 51.54, 156.15 0.59 M60.76 116.42 C89.2 82.11, 119.16 48.6, 161.8 0.2 M60.76 116.42 C99.85 70.71, 140.34 24.6, 161.8 0.2 M66.41 116.03 C87.86 92.33, 109.79 69.32, 166.78 0.56 M66.41 116.03 C91.41 88.13, 116.6 58.43, 166.78 0.56 M71.39 116.39 C108.72 70.04, 148.94 26.96, 172.43 0.16 M71.39 116.39 C102.76 81.66, 133.36 45.1, 172.43 0.16 M77.04 115.99 C111.28 78.73, 144.39 40.28, 177.41 0.52 M77.04 115.99 C116.18 71.57, 154.32 29.01, 177.41 0.52 M82.02 116.35 C106.33 90.59, 130.67 59.11, 183.06 0.13 M82.02 116.35 C119.02 74.26, 156.57 30.79, 183.06 0.13 M87.67 115.96 C114.52 87.5, 142.29 55.73, 188.04 0.49 M87.67 115.96 C126.7 71.9, 163.62 28.65, 188.04 0.49 M92.65 116.32 C119.32 86.86, 146.27 56.68, 193.69 0.09 M92.65 116.32 C117.58 88.94, 143.1 59.3, 193.69 0.09 M98.3 115.92 C119.18 90.99, 142.36 63.14, 198.67 0.45 M98.3 115.92 C134.13 76.36, 168.23 36.55, 198.67 0.45 M103.28 116.28 C135.9 76.14, 170.59 39.14, 204.32 0.06 M103.28 116.28 C123.62 91.27, 144.38 68.48, 204.32 0.06 M108.93 115.89 C143.85 79.8, 175.99 37.58, 209.3 0.42 M108.93 115.89 C144.51 74.76, 179.14 35.09, 209.3 0.42 M113.91 116.25 C152.21 72.62, 186.92 30.42, 214.95 0.02 M113.91 116.25 C151.35 73.32, 188.19 31.23, 214.95 0.02 M119.56 115.85 C154.9 74.45, 191.77 32, 219.93 0.38 M119.56 115.85 C147.87 85.1, 175.79 53.04, 219.93 0.38 M124.54 116.21 C158.64 76.96, 191.44 40.82, 225.58 -0.01 M124.54 116.21 C147.65 87.7, 171.84 61.54, 225.58 -0.01 M129.53 116.57 C155.92 87.2, 179.24 57.08, 230.56 0.35 M129.53 116.57 C162.19 78.32, 194.35 42.24, 230.56 0.35 M135.17 116.18 C158.14 88.74, 181.4 67.15, 236.21 -0.05 M135.17 116.18 C154.44 91.35, 176.03 68.01, 236.21 -0.05 M140.16 116.54 C176.74 78.09, 211.44 35.38, 241.19 0.32 M140.16 116.54 C175.96 77.06, 209.22 36.25, 241.19 0.32 M145.8 116.15 C173.79 82.73, 205.05 46.02, 246.84 -0.08 M145.8 116.15 C170.2 86.5, 197.06 55.88, 246.84 -0.08 M150.79 116.51 C190.32 70.54, 228.17 27.09, 251.82 0.28 M150.79 116.51 C181.97 79.1, 214.16 42.63, 251.82 0.28 M156.43 116.11 C183.6 84.38, 209.45 58.08, 257.47 -0.11 M156.43 116.11 C181.08 87.88, 204.24 61.35, 257.47 -0.11 M161.42 116.47 C190.19 84.05, 219.31 47.21, 262.45 0.25 M161.42 116.47 C186.52 88.72, 210.81 60.68, 262.45 0.25 M167.06 116.08 C192.6 87.06, 215.73 57.26, 268.1 -0.15 M167.06 116.08 C204.28 74.62, 239.81 33.43, 268.1 -0.15 M172.05 116.44 C210.86 67.83, 251.63 23.32, 273.08 0.21 M172.05 116.44 C195.66 87.64, 219.11 60.59, 273.08 0.21 M177.69 116.04 C201.66 88.56, 229.02 60.93, 278.07 0.57 M177.69 116.04 C212.68 75.05, 248.4 35.52, 278.07 0.57 M182.68 116.4 C206.98 87.82, 232.81 58.48, 283.71 0.18 M182.68 116.4 C211.25 85.87, 239.13 53.11, 283.71 0.18 M188.32 116.01 C216.85 80.77, 246.53 48.17, 288.05 1.29 M188.32 116.01 C217.11 81.28, 246.93 48.6, 288.05 1.29 M193.31 116.37 C224.09 80.5, 257.45 39.88, 293.03 1.65 M193.31 116.37 C219.7 88.42, 243.56 59.06, 293.03 1.65 M198.95 115.97 C225.3 81.72, 254.91 50.93, 298.02 2.01 M198.95 115.97 C233.38 73.28, 270.37 33.34, 298.02 2.01 M203.94 116.33 C240.97 72.5, 278.64 31.03, 301.69 3.88 M203.94 116.33 C231.12 85.72, 257.89 54, 301.69 3.88 M209.58 115.94 C239.34 78.04, 271.61 43.87, 305.37 5.75 M209.58 115.94 C236.41 82.48, 265.67 51.39, 305.37 5.75 M214.57 116.3 C240.83 83.19, 269.88 53.98, 308.39 8.38 M214.57 116.3 C234.12 93.88, 252.47 70.94, 308.39 8.38 M220.22 115.9 C253.83 75.31, 289.87 38.27, 310.75 11.75 M220.22 115.9 C250.78 81.29, 279.28 48.3, 310.75 11.75 M225.2 116.26 C260.54 74.36, 293.56 35.58, 312.46 15.89 M225.2 116.26 C251.72 84.56, 280.37 51.92, 312.46 15.89 M230.85 115.87 C255.03 86.65, 279.04 61.55, 313.51 20.78 M230.85 115.87 C254 89.25, 275.62 63.73, 313.51 20.78 M235.83 116.23 C263.22 83.12, 294.79 50.68, 314.56 25.66 M235.83 116.23 C255.12 95.68, 273.54 73.75, 314.56 25.66 M240.82 116.59 C261.99 90.81, 281.8 68.8, 314.3 32.06 M240.82 116.59 C270.53 84.31, 299.51 50.07, 314.3 32.06 M246.46 116.2 C269.38 90.26, 290.55 65.03, 314.69 37.71 M246.46 116.2 C272.27 87.04, 298.79 56.35, 314.69 37.71 M251.45 116.56 C269.39 96.7, 289.2 72.85, 314.43 44.1 M251.45 116.56 C275.61 88.37, 299.24 60.56, 314.43 44.1 M257.09 116.16 C275.42 95.92, 295.9 74.62, 314.83 49.75 M257.09 116.16 C276.29 95.58, 296.22 72.82, 314.83 49.75 M262.08 116.52 C277.34 98.95, 289.32 84.22, 314.56 56.14 M262.08 116.52 C281.77 93.28, 301.17 71.72, 314.56 56.14 M267.72 116.13 C279.67 99.22, 293.91 85.94, 314.96 61.79 M267.72 116.13 C280.68 100.18, 293 84.39, 314.96 61.79 M272.71 116.49 C288.05 98.78, 304.48 77.59, 314.7 68.19 M272.71 116.49 C285.9 102.02, 297.73 87.83, 314.7 68.19 M278.35 116.09 C289.74 103.56, 299.06 94.27, 315.09 73.83 M278.35 116.09 C292.48 100.76, 306.39 86.45, 315.09 73.83 M283.34 116.45 C293.6 106.3, 303.53 96.18, 314.83 80.23 M283.34 116.45 C294.13 103.06, 306.03 89.5, 314.83 80.23 M288.98 116.06 C298.62 104.32, 306.96 95.33, 315.22 85.87 M288.98 116.06 C298.8 106.83, 306.1 95.86, 315.22 85.87 M294.63 115.66 C302.61 110.08, 307.14 101.81, 314.31 93.02 M294.63 115.66 C301.01 108.07, 309.11 99.65, 314.31 93.02 M302.89 112.25 C304.67 109.98, 306.95 107.45, 313.39 100.17 M302.89 112.25 C305.55 108.21, 309.67 106.08, 313.39 100.17" stroke="#ffffff" stroke-width="0.5" fill="none"></path><path d="M29.03 0 C113.41 0.95, 195.84 -1.8, 285.34 0 M29.03 0 C92.35 -0.56, 156.65 0.14, 285.34 0 M285.34 0 C305.08 -1.56, 312.93 10.55, 314.37 29.03 M285.34 0 C304.85 -0.6, 314.66 9.68, 314.37 29.03 M314.37 29.03 C315.58 45.65, 313.37 62.63, 314.37 87.09 M314.37 29.03 C314.58 43.93, 314.96 60.88, 314.37 87.09 M314.37 87.09 C314.99 106.46, 305.8 115.94, 285.34 116.12 M314.37 87.09 C314.75 106.29, 303.66 117.3, 285.34 116.12 M285.34 116.12 C222.72 117.75, 161.47 117.94, 29.03 116.12 M285.34 116.12 C187.59 115.96, 89.68 115.06, 29.03 116.12 M29.03 116.12 C10.76 116.6, 0.53 106.95, 0 87.09 M29.03 116.12 C9.54 116.86, -0.14 105.93, 0 87.09 M0 87.09 C-1.32 71.15, 0.31 59.33, 0 29.03 M0 87.09 C-0.48 73.63, -1.2 62.71, 0 29.03 M0 29.03 C1.73 8.84, 11.5 1.79, 29.03 0 M0 29.03 C0.23 9.37, 11.86 -2.11, 29.03 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(854.0689326168012 360.6807038052034) rotate(0 142.177734375 37.5)"><text x="142.177734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Dispatcher</text><text x="142.177734375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- responsible for sending to correct </text><text x="142.177734375" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">messaging servers</text></g><g transform="translate(1670.4824508114564 97.90624941825877) rotate(0 84.5299301147461 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Comment</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- commentId (PK)</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- videoId (shard)</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- content</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- author</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">- createdAt (SK)</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Dispatcher Service</span></div></div></div></div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges-6">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The main challenge is ensuring the Dispatcher Serviceâ€™s mapping is accurate and up-to-date. Rapid changes in viewer distribution (e.g., a viral stream causing a sudden influx of viewers) require that the Dispatcherâ€™s view of the system be refreshed frequently. This might involve coordination services like Zookeeper or etcd, which must efficiently propagate changes to all Dispatcher instances.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Another difficulty is maintaining consistency across multiple Dispatcher instances. If they each cache routing information, updates must be coordinated to prevent stale mappings. Strong consistency can be achieved through a distributed coordination service, careful cache invalidation policies, and possibly a leader election mechanism to manage updates safely.</div></div></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Both the pub/sub approach with viewer co-location and the dispatcher service approach are great solutions. The pub/sub is typically easier with fewer corner cases, so it is the one I would use in an interview, but both are "correct" answers.</div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="what-is-expected-at-each-level"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/blog/the-system-design-interview-what-is-expected-at-each-level" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">What is Expected at Each Level?</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Ok, that was a lot. You may be thinking, â€œhow much of that is actually required from me in an interview?â€ Letâ€™s break it down.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="mid-level">Mid-level</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Breadth vs. Depth:</strong> A mid-level candidate will be mostly focused on breadth (80% vs 20%). You should be able to craft a high-level design that meets the functional requirements you've defined, but many of the components will be abstractions with which you only have surface-level familiarity.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Probing the Basics:</strong> Your interviewer will spend some time probing the basics to confirm that you know what each component in your system does. For example, if you add an API Gateway, expect that they may ask you what it does and how it works (at a high level). In short, the interviewer is not taking anything for granted with respect to your knowledge.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Mixture of Driving and Taking the Backseat:</strong> You should drive the early stages of the interview in particular, but the interviewer doesnâ€™t expect that you are able to proactively recognize problems in your design with high precision. Because of this, itâ€™s reasonable that they will take over and drive the later stages of the interview while probing your design.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for FB Live Comments:</strong> For this question, I expect that candidates proactively realize the limitations with a polling approach and start to reason around a push based model. With only minor hints they should be able to come up with the pub/sub solution and should be able to scale it with some help from the interviewer.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="senior">Senior</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Depth of Expertise</strong>: As a senior candidate, expectations shift towards more in-depth knowledge â€” about 60% breadth and 40% depth. This means you should be able to go into technical details in areas where you have hands-on experience. It's crucial that you demonstrate a deep understanding of key concepts and technologies relevant to the task at hand.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design</strong>: You should be familiar with advanced system design principles. For example, knowing how to use pub/sub for broadcasting messages. Youâ€™re also expected to understand some of the challenges that come with it and discuss detailed scaling strategies (itâ€™s ok if this took some probing/hints from the interviewer). Your ability to navigate these advanced topics with confidence and clarity is key.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Articulating Architectural Decisions</strong>: You should be able to clearly articulate the pros and cons of different architectural choices, especially how they impact scalability, performance, and maintainability. You justify your decisions and explain the trade-offs involved in your design choices.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Problem-Solving and Proactivity</strong>: You should demonstrate strong problem-solving skills and a proactive approach. This includes anticipating potential challenges in your designs and suggesting improvements. You need to be adept at identifying and addressing bottlenecks, optimizing performance, and ensuring system reliability.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Fb Live Comments:</strong> For this question, E5 candidates are expected to speed through the initial high level design so you can spend time discussing, in detail, how to scale the system. You should be able to reason through the limitations of the initial design and come up with a pub/sub solution with minimal hints. You should proactively lead the scaling discussion and be able to reason through the trade-offs of different solutions.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="staff">Staff+</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Emphasis on Depth</strong>: As a staff+ candidate, the expectation is a deep dive into the nuances of system design â€” I'm looking for about 40% breadth and 60% depth in your understanding. This level is all about demonstrating that, while you may not have solved this particular problem before, you have solved enough problems in the real world to be able to confidently design a solution backed by your experience.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You should know which technologies to use, not just in theory but in practice, and be able to draw from your past experiences to explain how theyâ€™d be applied to solve specific problems effectively. The interviewer knows you know the small stuff (REST API, data normalization, etc) so you can breeze through that at a high level so you have time to get into what is interesting.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>High Degree of Proactivity</strong>: At this level, an exceptional degree of proactivity is expected. You should be able to identify and solve issues independently, demonstrating a strong ability to recognize and address the core challenges in system design. This involves not just responding to problems as they arise but anticipating them and implementing preemptive solutions. Your interviewer should intervene only to focus, not to steer.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Practical Application of Technology</strong>: You should be well-versed in the practical application of various technologies. Your experience should guide the conversation, showing a clear understanding of how different tools and systems can be configured in real-world scenarios to meet specific requirements.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Complex Problem-Solving and Decision-Making</strong>: Your problem-solving skills should be top-notch. This means not only being able to tackle complex technical challenges but also making informed decisions that consider various factors such as scalability, performance, reliability, and maintenance.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design and Scalability</strong>: Your approach to system design should be advanced, focusing on scalability and reliability, especially under high load conditions. This includes a thorough understanding of distributed systems, load balancing, caching strategies, and other advanced concepts necessary for building robust, scalable systems.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for FB Live Comments:</strong> For a staff+ candidate, expectations are high regarding depth and quality of solutions, particularly when it comes to scaling the broadcasting of comments. I expect staff+ candidates to not only identify the pub/sub solution but proactively call out the limitations around reliability or scalability and suggest solutions. They likely have a good understanding of the exact technology they would use and can discuss the trade-offs of different solutions in detail.</div>
</body>
</html>
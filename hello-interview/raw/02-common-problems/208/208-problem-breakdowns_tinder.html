<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tinder System Design Interview Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Common Problems</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Design a Dating App Like Tinder</h1></div><div class="flex flex-col md:flex-row gap-2 md:items-center justify-between"><div class="flex flex-col lg:flex-row gap-4 md:items-center"><a target="_blank" rel="noopener noreferrer" class="flex flex-row gap-2 items-center" href="https://www.linkedin.com/in/joseph-antonakakis-323b92a8/" style="text-decoration: none;"><img class="rounded-full" src="https://hellointerview-files.s3.us-west-2.amazonaws.com/public-media/joe-headshot.jpeg" alt="Joseph Antonakakis" width="40" height="40"><div class="flex flex-col"><div class="flex flex-row gap-2 items-center"><p class="MuiTypography-root MuiTypography-body2 mui-ltrqv0">Joseph Antonakakis</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeInherit mui-70s7oy" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></div><span class="MuiTypography-root MuiTypography-caption mui-1eozzb8">SWE at Notion, ex-Meta Staff SWE</span></div></a><div class="flex flex-row gap-4 md:gap-8 items-center"><div class="flex flex-row gap-1 items-center" aria-label="Difficulty"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-su24yt">medium</p></div><div class="flex flex-row gap-1 items-center" aria-label="Average time allowed in interview"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-1pb8xyp">35 min</p></div></div></div><a class="MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation mui-1c7cv5a" tabindex="0" href="/practice/system-design/start/tinder" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"></path></svg>Practice this problem<span class="MuiTouchRipple-root mui-w0pj6f"></span></a></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<div class="mb-4"><iframe class="w-full aspect-video" src="https://www.youtube.com/embed/18Fg5Akhkqw" title="System Design Interview: Design Tinder w/ a Ex-Meta Staff Engineer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="understand-the-problem">Understand the Problem</h2>
<div class="my-6"><div class="MuiBox-root mui-1fz7ihe"><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>❤️ What is <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://tinder.com/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Tinder</a></strong>
Tinder is a mobile dating app that helps people connect by allowing users to swipe right to like or left to pass on profiles. It uses location data and user-specified filters to suggest potential matches nearby.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#1-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users can create a profile with preferences (e.g. age range, interests) and specify a maximum distance.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users can view a stack of potential matches in line with their preferences and within max distance of their current location.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users can swipe right / left on profiles one-by-one, to express "yes" or "no" on other users.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users get a match notification if they mutually swipe on each other.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope)</strong></div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to upload pictures.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to chat via DM after matching.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users can send "super swipes" or purchase other premium features.</div></li>
</ul>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">It's worth noting that this question is mostly focused on the user recommendation "feed" and swiping experience, not on other auxiliary features. If you're unsure what features to focus on for an app like this, have some brief back and forth with the interviewer to figure out what part of the system they care the most about. It'll typically be the functionality that makes the app unique or the most complex.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="non-functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#2-non-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Non-Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should have strong consistency for swiping. If a user swipes "yes" on a user who already swiped "yes" on them, they should get a match notification.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should scale to lots of daily users / concurrent users (20M daily actives, ~100 swipes/user/day on average).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should load the potential matches stack with low latency (e.g. &lt; 300ms).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should avoid showing user profiles that the user has previously swiped on.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope)</strong></div>
<ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should protect against fake profiles.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should have monitoring / alerting.</div></li>
</ul>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here's how it might look on a whiteboard:</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/545b21f70535c0adff1634eabdd06b19"></div></div></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="the-set-up">The Set Up</h2>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="planning-the-approach">Planning the Approach</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Before you move on to designing the system, it's important to start by taking a moment to plan your strategy. Fortunately, for these <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/introduction#product-design" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">product design</a> style questions, the plan should be straightforward: build your design up sequentially, going one by one through your functional requirements. This will help you stay focused and ensure you don't get lost in the weeds as you go.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Once we've satisfied the functional requirements, you'll rely on your non-functional requirements to guide you through the deep dives.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="defining-the-core-entities"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#core-entities-2-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Defining the Core Entities</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's start by defining the set of core entities. Initially, establishing these key entities will guide our thought process and lay a solid foundation as we progress towards defining the API. We don't need to know every field or column at this point, but if you have a good idea of what they might be, feel free to jot them down.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For Tinder, the primary entities are pretty straightforward:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>User</strong>: This represents both a user using the app and a profile that might be shown to the user. We typically omit the "user" concept when listing entities, but because users are swiping on other users, we'll include it here.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Swipe</strong>: Expression of "yes" or "no" on a user profile; belongs to a user (<span class="MuiBox-root mui-1vu004u">swiping_user</span>) and is about another user (<span class="MuiBox-root mui-1vu004u">target_user</span>).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Match</strong>: A connection between 2 users as a result of them both swiping "yes" on each other.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In the actual interview, this can be as simple as a short list like this. Just make sure you talk through the entities with your interviewer to ensure you are on the same page.</div>
<div class="my-4 flex-col w-full max-w-[200px]"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/8dac1a406e75492265137204c091af7c"></div></div></div></div></div></div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">As you move onto the design, your objective is simple: create a system that meets all functional and non-functional requirements. To do this, I recommend you start by satisfying the functional requirements and then layer in the non-functional requirements afterward. This will help you stay focused and ensure you don't get lost in the weeds as you go.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="the-api"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#api-design-5-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">The API</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The API is the primary interface that users will interact with. You'll want to define the API early on, as it will guide your high-level design. We just need to define an endpoint for each of our functional requirements.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The first endpoint we need is an endpoint to create a profile for a user. Of course, this would include images, bio, etc, but we're going to focus just on their match preferences for this question.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>POST /profile
</span>{
  "age_min": 20,
  "age_max": 30,
  "distance": 10,
  "interestedIn": "female" | "male" | "both",
  ... 
}

Next we need an endpoint to get the "feed" of user profiles to swipe on, this way we have a "stack" of profiles ready for the user:

```plaintext
GET /feed?lat={}&amp;long={}&amp;distance={} -&gt; User[]</code></div></div></pre>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We don't need to pass in other filters like age, interests, etc. because we're assuming the user has already specified these in the app settings, and we can load them server-side.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Unless you pay for the premium version (out of scope), Tinder will show users within a specific radius of your current location. Given that this can always change, we pass it in client-side as opposed to persisting server-side.</div></div></div></div></div>
<div class="my-6"><div class="MuiBox-root mui-o9fqh4"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You might be tempted to proactively consider pagination for the feed endpoint. This is actually superfluous for Tinder b/c we're really generating recommendations. Rather than "paging", the app can just hit the endpoint again for more recommendations if the current list is exhausted.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll also need an endpoint to power swiping:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>POST /swipe/{userId}
</span>Request:
{
  decision: "yes" | "no"
}</code></div></div></pre>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With each of these requests, the user information will be passed in the headers (either via session token or JWT). This is a common pattern for APIs and is a good way to ensure that the user is authenticated and authorized to perform the action while preserving security. You should avoid passing user information in the request body, as this can be easily manipulated by the client.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In the interview, you may want to just denote which endpoints require user authentication and which don't. In our case, all endpoints will require authentication.</div></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="high-level-design"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#high-level-design-10-15-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">High-Level Design</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll start our design by going one-by-one through our functional requirements and designing a single system to satisfy them. Once we have this in place, we'll layer on depth via our deep dives.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-users-can-create-a-profile-with-preferences-eg-age-range-interests-and-specify-a-maximum-distance">1) Users can create a profile with preferences (e.g. age range, interests) and specify a maximum distance.</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The first thing we need to do in a dating site like Tinder is allow users to tell us about their preferences. This way we can increase the probability of them finding love by only showing them profiles that match these preferences.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll need to take the post request to <span class="MuiBox-root mui-1vu004u">POST /profile</span> and persist these settings in a database.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can do this with a simple client-server-database architecture.</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/28804bc5afa751ef03a1fcd2f41173be"></div></div></div></div></div></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Client</strong>: Users interact with the system through a mobile application.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>API Gateway</strong>: Routes incoming requests to the appropriate services. In this case, the Profile Service.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Profile Service</strong>: Handles incoming profile requests by updating the user's profile preferences in the database.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Database</strong>: Stores information about user profiles, preferences, and other relevant information.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user creates a profile:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The client sends a POST request to <span class="MuiBox-root mui-1vu004u">/profile</span> with the profile information as the request body.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The API Gateway routes this request to the Profile Service.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Profile Service updates the user's profile preferences in the database.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The results are returned to the client via the API Gateway.</div></li>
</ol>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-users-can-view-a-stack-of-potential-matches">2) Users can view a stack of potential matches</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user enters the app, they are immediately served a stack of profiles to swipe on. These profiles abide by filters that the user specified (e.g. age, interests) as well as the user's location (e.g. &lt; 2 miles away, &lt; 5 miles away, &lt; 15 miles away).</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Serving up this feed efficiently is going to be a key challenge of the system, but we'll start simple and optimize later during the deep dive.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The easiest thing we can do it just query the database for a list of users that match the user's preferences and return them to the client. We'll need to also consider the users current location as to make sure they only get serves profiles close to them.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The simple query would look something like this:</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">SELECT</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">*</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">FROM</span><span> users
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">WHERE</span><span> age </span><span class="token" style="color: rgb(64, 120, 242);">BETWEEN</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">18</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">35</span><span>
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> interestedIn </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">'female'</span><span>
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> lat </span><span class="token" style="color: rgb(64, 120, 242);">BETWEEN</span><span> userLat </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span> maxDistance </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> userLat </span><span class="token" style="color: rgb(64, 120, 242);">+</span><span> maxDistance
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> long </span><span class="token" style="color: rgb(64, 120, 242);">BETWEEN</span><span> userLong </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span> maxDistance </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> userLong </span><span class="token" style="color: rgb(64, 120, 242);">+</span><span> maxDistance</span></code></div></div></pre>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/e91ff29b08e36422e68f9eb4ed27456b"></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user requests a new set of profiles:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The client sends a GET request to <span class="MuiBox-root mui-1vu004u">/feed</span> with the user's location as a query parameter.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The API Gateway routes this request to the Profile Service.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Profile Service queries the User Database for a list of users that match the user's preferences and location.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The results are returned to the client via the API Gateway.</div></li>
</ol>
<div class="my-6"><div class="MuiBox-root mui-o9fqh4"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">If you read any of our other write-ups you know this by now, this query would be incredibly inefficient. Searching by location in particular, even with basic indexing, would be incredibly slow. We'll need to look into more sophisticated indexing and querying techniques to improve the performance during our deep dives.</div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-users-can-swipe-right--left-on-profiles-one-by-one-to-express-yes-or-no-on-other-users">3) Users can swipe right / left on profiles one-by-one, to express "yes" or "no" on other users</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Once users have their "stack" of profiles they're ready to find love! They just need to swipe right if they like the person and left if they don't. The system needs to record each swipe and tell the user that they have a match if anyone they swipe right on has previously swiped right on them.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We need a way to persist swipes and check if they're a match. Again, we'll start with something simple and inefficient and improve upon it during our deep dives.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll introduce two new components:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Swipe Service</strong>: Persists swipes and checks for matches.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Swipe Database</strong>: Stores swipe data for users.</div></li>
</ol>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Notice how we opt for a separate service and a separate DB this time, why?</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">My justification here would be that profile view and creation happens far less frequently than swipe writes. So by separating the services, we allow for the swipe service to scale up independently. Similarly, for the database, this is going to be a lot of swipe data. With <span class="MuiBox-root mui-1vu004u">20M DAU x 100 swipes/day x 100 bytes per swipe</span> we're looking at ~200GB of data a day! Not only will this do best with a write optimized database like Cassandra (maybe not the right fit for our profile database), but this allows us to scale and optimize swipe operations independently. It also enables us to implement swipe-specific logic and caching strategies without affecting the profile service.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Separating isn't the right choice for all systems, but for this one the pros outweigh the cons.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Given that the swipe interaction is so effortless, we can assume we're going to get a lot of writes to the DB. Additionally, there is going to be a lot of swipe data. If we assume 20M daily active users doing 200 swipes a day on average, that nets us 4B swipes a day. This certainly means we'll need to partition the data.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/deep-dives/cassandra" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Cassandra</a> is a good fit as a database here. We can partition by swiping_user_id. This means an access pattern to see if user A swiped on user B will be fast, because we can predictably query a single partition for that data. Additionally, Cassandra is extremely capable of massive writes, due to its write-optimized storage engine (CommitLog + Memtables + SSTables). A con of using Cassandra here is the element of eventual consistency of swipe data we inherit from using it. We'll discuss ways to avoid this con in later deep dives.</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/09df0054ee1155b50d800fad1f42060e"></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user swipes:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The client sends a POST request to <span class="MuiBox-root mui-1vu004u">/swipe</span> with the profile ID and the swipe direction (right or left) as parameters.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The API Gateway routes this request to the Swipe Service.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Swipe Service updates the Swipe Database with the swipe data.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The Swipe Service checks if there is an inverse swipe in the Swipe Database and, if so, returns a match to the client.</div></li>
</ol>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="4-users-get-a-match-notification-if-they-mutually-swipe-on-each-other">4) Users get a match notification if they mutually swipe on each other</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a match occurs, both people need to be notified that there is a match. To make things clear, let's call the first person who like the other <span class="MuiBox-root mui-1vu004u">Person A</span>. The second person will be called <span class="MuiBox-root mui-1vu004u">Person B</span>.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Notifying <span class="MuiBox-root mui-1vu004u">Person B</span> is easy! In fact, we've already done it. Since they're the second person to swipe, immediately after they swipe right, we check to see if <span class="MuiBox-root mui-1vu004u">Person A</span> also liked them and, if they did, we show a "You matched!" graphic on <span class="MuiBox-root mui-1vu004u">Person B</span>'s device.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">But what about <span class="MuiBox-root mui-1vu004u">Person A</span>? They might have swiped on <span class="MuiBox-root mui-1vu004u">Person B</span> weeks ago. We need to send them a push notification informing them that they have a new connection waiting for them.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To do this, we're just going to rely on device native push notifications like Apple Push Notification Service (APNS) or Firebase Cloud Messaging (FCM).</div>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/76f628eefa93c1b772cb057c0af19390"></div></div></div></div></div></div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">APNS and FCM are both push notification services that we can use to send push notifications to user devices. They both have their own set of native APIs and SDKs that we can use to send users push notifications.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's quickly recap the full swipe process again, now that we've introduced push notifications into the flow.</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Some time in the past, <span class="MuiBox-root mui-1vu004u">Person A</span> swiped right on <span class="MuiBox-root mui-1vu004u">Person B</span> and we persisted this swipe in our Swipe DB.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><span class="MuiBox-root mui-1vu004u">Person B</span> swipes right on <span class="MuiBox-root mui-1vu004u">Person A</span>.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The server checks for an inverse swipe and finds that it does, indeed, exist.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We display a "You Matched!" message to <span class="MuiBox-root mui-1vu004u">Person B</span> immediately after swiping.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We send a push notification via APNS or FCM to <span class="MuiBox-root mui-1vu004u">Person A</span> informing them that they have a new match.</div></li>
</ol>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Since this design is less concerned with the after-match flow, we can avoid diving into the match storage details. Additionally, we can make an assumption that an external service can support push notifications. Be sure to clarify these assumptions with your interviewer!</div></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="potential-deep-dives"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#deep-dives-10-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Potential Deep Dives</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">At this point, we have a basic, functioning system that satisfies the functional requirements. However, there are a number of areas we could dive deeper into to improve the system's performance, scalability, etc. Depending on your seniority, you'll be expected to drive the conversation toward these deeper topics of interest.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-how-can-we-ensure-that-swiping-is-consistent-and-low-latency">1) How can we ensure that swiping is consistent and low latency?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's start by considering the failure scenario. Imagine <span class="MuiBox-root mui-1vu004u">Person A</span> and <span class="MuiBox-root mui-1vu004u">Person B</span> both swipe right (like) on each other at roughly the same time. Our order of operations could feasibly look something like this:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><span class="MuiBox-root mui-1vu004u">Person A</span> swipe hits the server and we check for inverse swipe. Nothing.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><span class="MuiBox-root mui-1vu004u">Person B</span> swipe hits the server and we check for inverse swipe. Nothing.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We save <span class="MuiBox-root mui-1vu004u">Person A</span> swipe on <span class="MuiBox-root mui-1vu004u">Person B</span>.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We save <span class="MuiBox-root mui-1vu004u">Person B</span> swipe on <span class="MuiBox-root mui-1vu004u">Person A</span>.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Now, we've saved the swipe to our database, but we've lost the opportunity to notify <span class="MuiBox-root mui-1vu004u">Person A</span> and <span class="MuiBox-root mui-1vu004u">Person B</span> that they have a new match. They will both go on forever not knowing that they matched and true love may never be discovered.</div>
<div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">It's worth mentioning that you could solve this problem without strong consistency. You could have some reconciliation process that runs periodically to ensure all matching swipes have been processed as a match. For those that haven't, just send both <span class="MuiBox-root mui-1vu004u">Person A</span> and <span class="MuiBox-root mui-1vu004u">Person B</span> a notification. They won't be any the wiser and will just assume the other person swiped on them in that moment. This would allow you to prioritize availability over consistency and would be an interesting trade-off to discuss in the interview. It makes the problem slightly less challenging, though, so there is a decent chance the interviewer will appreciate the conversation but suggest you stick with prioritizing consistency.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Given that we need to notify the last swiper of the match immediately, we need to ensure the system is consistent. Here are a few approaches we could take to ensure this consistency:</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: Database Polling for Matches</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The first thing that comes to mind is to periodically poll the database to check for reciprocal swipes and create matches accordingly. This obviously does not meet our requirement of being able to notify users of a match immediately, so it's a non-starter, though worth mentioning.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach introduces latency due to the intervals between polls, meaning users would not receive immediate feedback upon swiping. The lack of instant gratification can significantly diminish user engagement, as the timely dopamine hit associated with immediate match notifications is a critical component of the user experience. Additionally, frequent polling can place unnecessary load on the database, leading to scalability issues.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Transactions</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-1">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">If we need consistency, our mind should immediately jump to database transactions. We can make sure that both the swipe and the check for a reciprocal swipe happen in the same transaction, so that we either successfully save both or neither.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Cassandra does have basic support for what they call "lightweight transactions" (LWT), but they are not as powerful as true ACID transactions. LWTs use a Paxos consensus protocol to provide linearizable consistency for specific operations, but only within a single partition. Unlike true ACID transactions, they don't support multi-partition atomicity, isolation levels, or rollbacks. They also come with significant performance overhead since they require multiple round trips between nodes to achieve consensus. This makes them suitable for simple conditional updates but not complex transactional workflows.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-1">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The main challenge thus becomes an issue of scale. With 20M DAU and 100 swipes per day, that's 2B swipes a day! There is no way this all fits on a single partition which means that transactions will need to span multiple partitions (something unsupported by LWTs).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In the next deep dive, we'll discuss how we can solve this problem by ensuring that reciprocal swipes are always in the same partition.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Sharded Cassandra with Single-Partition Transactions</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-2">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can leverage Cassandra's single-partition transactions to atomically handle swipes. The key is to ensure that all swipes between two users are stored in the same partition.</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">First, create a table with a compound primary key that ensures swipes between the same users are in one partition:</div></li>
</ol><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">CREATE</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">TABLE</span><span> swipes </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>
</span><span>    user_pair </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>      </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- partition key: smaller_id:larger_id</span><span>
</span><span>    from_user uuid</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>      </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- clustering key</span><span>
</span><span>    to_user uuid</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>        </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">-- clustering key</span><span>
</span><span>    direction </span><span class="token" style="color: rgb(166, 38, 164);">text</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    created_at </span><span class="token" style="color: rgb(166, 38, 164);">timestamp</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(166, 38, 164);">PRIMARY</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">KEY</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>user_pair</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> from_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> to_user</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">;</span></code></div></div></pre><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">When a user swipes, we create the user_pair key by sorting the IDs to ensure consistency:</div></li>
</ol><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">def</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">get_user_pair</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>user_a</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> user_b</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span>
</span><span>    </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Sort IDs so (A-&gt;B) and (B-&gt;A) are in same partition</span><span>
</span><span>    sorted_ids </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">sorted</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span>user_a</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> user_b</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>    </span><span class="token" style="color: rgb(166, 38, 164);">return</span><span> </span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">sorted_ids</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">[</span><span class="token string-interpolation interpolation" style="color: rgb(183, 107, 1);">0</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">]</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">:</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">sorted_ids</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">[</span><span class="token string-interpolation interpolation" style="color: rgb(183, 107, 1);">1</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">]</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">"</span><span>
</span>
<span></span><span class="token" style="color: rgb(166, 38, 164);">def</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">handle_swipe</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>from_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> to_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> direction</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span>
</span><span>    user_pair </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> get_user_pair</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>from_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> to_user</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span>    
<span>    </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Both operations happen atomically in same partition</span><span>
</span><span>    batch </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">"""
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">    BEGIN BATCH
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">        INSERT INTO swipes (user_pair, from_user, to_user, direction, created_at)
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">        VALUES (?, ?, ?, ?, ?);
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">        
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">        SELECT direction FROM swipes 
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">        WHERE user_pair = ? 
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">        AND from_user = ? 
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">        AND to_user = ?;
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">    APPLY BATCH;
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">    """</span></code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This approach is effective because Cassandra's single-partition transactions provide the atomicity guarantees we need. By ensuring all swipes between two users are stored in the same partition, we can atomically check for matches without worrying about distributed transaction complexities. The partition key design eliminates the need for cross-partition operations, making the solution both performant and reliable.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-2">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While this solution elegantly handles the core matching functionality, it does introduce some operational challenges. As user pairs accumulate swipe history over time, partition sizes can grow significantly, potentially impacting performance. Additionally, highly active users could create hot partitions that receive a disproportionate amount of traffic. To address these issues, we need a robust cleanup strategy to archive or delete old swipe data, preventing partitions from growing unbounded while preserving important historical data.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Redis for Atomic Operations</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-3">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Redis is a better fit for handling the consistency requirements of our swipe matching logic. While Cassandra excels at durability and storing large amounts of data, it's not designed for the kind of atomic operations we need for real-time match detection. Instead, we can use Redis to handle the atomic swipe operations while still using Cassandra as our durable storage layer.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The key insight remains the same as before - we need swipes between the same users to land on the same shard. We can achieve this by creating keys that combine both user IDs in a consistent way.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The key:value structure we'll use is as follows:</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>Key</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"swipes:123:456"</span><span>
</span><span>Value</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(56, 58, 66);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"123_swipe"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"right"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// or yes/no</span><span>
</span><span>    </span><span class="token" style="color: rgb(228, 86, 73);">"456_swipe"</span><span class="token" style="color: rgb(64, 120, 242);">:</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">"left"</span><span>   </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;">// or yes/no</span><span>
</span><span></span><span class="token" style="color: rgb(56, 58, 66);">}</span></code></div></div></pre><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">def</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">get_key</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>user_a</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> user_b</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span>
</span><span>    </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Sort IDs so (A-&gt;B) and (B-&gt;A) map to same key</span><span>
</span><span>    sorted_ids </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">sorted</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span>user_a</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> user_b</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span><span>    </span><span class="token" style="color: rgb(166, 38, 164);">return</span><span> </span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"swipes:</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">sorted_ids</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">[</span><span class="token string-interpolation interpolation" style="color: rgb(183, 107, 1);">0</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">]</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">:</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">sorted_ids</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">[</span><span class="token string-interpolation interpolation" style="color: rgb(183, 107, 1);">1</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">]</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">"</span><span>
</span>
<span></span><span class="token" style="color: rgb(166, 38, 164);">def</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">handle_swipe</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>from_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> to_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> direction</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span>
</span><span>    key </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> get_key</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>from_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> to_user</span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span>    
<span>    </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Use Redis hash to store both users' swipes</span><span>
</span><span>    </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Each hash has two fields: user1_swipe and user2_swipe</span><span>
</span><span>    script </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">"""
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">    redis.call('HSET', KEYS[1], ARGV[1], ARGV[2])
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">    return redis.call('HGET', KEYS[1], ARGV[3])
</span><span class="token triple-quoted-string" style="color: rgb(80, 161, 79);">    """</span><span>
</span>    
<span>    </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># Execute atomically using Lua script</span><span>
</span><span>    other_swipe </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> redis</span><span class="token" style="color: rgb(56, 58, 66);">.</span><span class="token" style="color: rgb(80, 161, 79);">eval</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>
</span><span>        script</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>        keys</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span>key</span><span class="token" style="color: rgb(56, 58, 66);">]</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>
</span><span>        args</span><span class="token" style="color: rgb(64, 120, 242);">=</span><span class="token" style="color: rgb(56, 58, 66);">[</span><span>
</span><span>            </span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">from_user</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">_swipe"</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>  </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># field to set</span><span>
</span><span>            direction</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span>             </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># our swipe</span><span>
</span><span>            </span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">f"</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">{</span><span class="token string-interpolation interpolation">to_user</span><span class="token string-interpolation interpolation" style="color: rgb(56, 58, 66);">}</span><span class="token string-interpolation" style="color: rgb(80, 161, 79);">_swipe"</span><span>     </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># field to check</span><span>
</span><span>        </span><span class="token" style="color: rgb(56, 58, 66);">]</span><span>
</span><span>    </span><span class="token" style="color: rgb(56, 58, 66);">)</span><span>
</span>    
<span>    </span><span class="token" style="color: rgb(160, 161, 167); font-style: italic;"># If other user swiped right too, it's a match!</span><span>
</span><span>    </span><span class="token" style="color: rgb(166, 38, 164);">if</span><span> direction </span><span class="token" style="color: rgb(64, 120, 242);">==</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">'right'</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">and</span><span> other_swipe </span><span class="token" style="color: rgb(64, 120, 242);">==</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">'right'</span><span class="token" style="color: rgb(56, 58, 66);">:</span><span>
</span><span>        create_match</span><span class="token" style="color: rgb(56, 58, 66);">(</span><span>from_user</span><span class="token" style="color: rgb(56, 58, 66);">,</span><span> to_user</span><span class="token" style="color: rgb(56, 58, 66);">)</span></code></div></div></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">By using Redis's atomic operations via Lua scripts, we can ensure that swipe recording and match checking happen as a single operation. This gives us the consistency we need while maintaining low latency due to Redis's in-memory nature. The system scales horizontally as we can add more Redis nodes, with consistent hashing ensuring related swipes stay together.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/f87dabf92880514ec337d782ea239650"></div></div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-3">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The main challenge with this approach is managing the Redis cluster effectively. While Redis provides excellent performance for atomic operations, we need to carefully handle node failures and rebalancing of the consistent hashing ring. However, these operational challenges are more manageable than trying to achieve consistency in Cassandra.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Memory management is another consideration, but since we're using Cassandra as our durable storage layer, we can be aggressive about expiring data from Redis. We can periodically flush swipe data to Cassandra and maintain only recent swipes in Redis. If we ever lose Redis data due to a node failure, we're only losing the ability to detect matches for very recent swipes - users can always swipe again, and we're not losing the historical record in Cassandra.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This hybrid approach gives us the best of both worlds: Redis's strong consistency and atomic operations for real-time match detection, combined with Cassandra's durability and storage capabilities for historical data. The system remains highly available and scalable while meeting our core requirement of consistent, immediate match detection.</div></div></div></div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-how-can-we-ensure-low-latency-for-feedstack-generation">2) How can we ensure low latency for feed/stack generation?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user open the app, they want to immediately start swiping. They don't want to have to wait for us to generate a feed for them.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">As we discussed in our high-level design, our current design has us running a slow query every time we want a new stack of users.</div>
<pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span class="token" style="color: rgb(166, 38, 164);">SELECT</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">*</span><span> </span><span class="token" style="color: rgb(166, 38, 164);">FROM</span><span> users
</span><span></span><span class="token" style="color: rgb(166, 38, 164);">WHERE</span><span> age </span><span class="token" style="color: rgb(64, 120, 242);">BETWEEN</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">18</span><span> </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> </span><span class="token" style="color: rgb(183, 107, 1);">35</span><span>
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> interestedIn </span><span class="token" style="color: rgb(64, 120, 242);">=</span><span> </span><span class="token" style="color: rgb(80, 161, 79);">'female'</span><span>
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> lat </span><span class="token" style="color: rgb(64, 120, 242);">BETWEEN</span><span> userLat </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span> maxDistance </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> userLat </span><span class="token" style="color: rgb(64, 120, 242);">+</span><span> maxDistance
</span><span></span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> long </span><span class="token" style="color: rgb(64, 120, 242);">BETWEEN</span><span> userLong </span><span class="token" style="color: rgb(64, 120, 242);">-</span><span> maxDistance </span><span class="token" style="color: rgb(64, 120, 242);">AND</span><span> userLong </span><span class="token" style="color: rgb(64, 120, 242);">+</span><span> maxDistance</span></code></div></div></pre>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This certainly won't meet our non-functional requirement of low latency stack generation. Let's see what else we can do.</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Use of Indexed Databases for Real-Time Querying</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-4">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One method to achieve low latency is by utilizing indexed databases for real-time querying. By creating indexes on the fields most commonly used in feed generation—such as user preferences, age range, and especially geospatial data like location—we can significantly speed up query response times. Implementing a geospatial index allows the system to efficiently retrieve users within a specific geographic area.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To handle the scale and performance requirements of an application like Tinder, a search-optimized database such as Elasticsearch or OpenSearch can be employed. These databases are designed for fast, full-text search and complex querying, making them suitable for handling large volumes of data with minimal latency.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">By leveraging the powerful indexing and querying capabilities of these databases, we can generate user feeds in real-time while keeping response times low. This approach ensures that users receive up-to-date matches that align closely with their current preferences and location.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/f55ad3fae65caa5f90a262bca4b9c14f"></div></div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-4">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The main challenge here is maintaining data consistency between the primary transactional database and the indexed search database can be complex. Any delay or failure in synchronizing data updates may result in users seeing outdated profiles or missing out on new potential matches.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This can be solved via change data capture (CDC) mechanisms that keep the indexed database in sync with the primary transactional database. Depending on the rate of updates, we may want to use a batching strategy to reduce the number of writes to the indexed database, since Elasticsearch is optimized for read-heavy workloads, not write-heavy workloads.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Pre-computation and Caching</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-5">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Another strategy is to pre-compute and cache user feeds asynchronously. Periodic background jobs can generate feeds based on users’ preferences and locations, storing them in a cache for instant retrieval when the user opens the app. This ensures that the feed is readily available without the need for real-time computation.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">By serving these cached feeds, users experience immediate access to potential matches, enhancing their satisfaction. The pre-computation can be scheduled during off-peak hours to reduce the impact on system resources, and frequent updates ensure that the feeds remain relevant.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/b273cefc73efd9cf42b89fa095181800"></div></div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-5">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The primary challenge with this approach is that highly active users may quickly exhaust their cached feeds, leading to delays while new matches are generated or fetched. Additionally, pre-computed feeds may not reflect the most recent changes in user profiles, preferences, or the addition of new users to the platform. This could result in less relevant matches and a diminished user experience.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">What's worse is that if the user swipes through their pre-computed cached stack, we need to run the expensive query again to load new matches for them, which would be inefficient and slow.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Combination of Pre-computation and Indexed Database</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-6">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The good news is we can have the best of both worlds by combining the benefits of both pre-computation and real-time querying using an indexed database.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We periodically pre-compute and cache feeds for users based on their preferences and locations. When a user opens the app, they receive this cached feed instantly, allowing for immediate interaction without any delay.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">As users swipe through and potentially exhaust their cached feed, the system seamlessly transitions to generating additional matches in real-time. This is achieved by leveraging Elasticsearch of the indexed database we discussed above.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">By combining the two methods, we maintain low latency throughout the user’s session. The initial cached feed provides instant access, while the indexed database ensures that even the most active users receive fresh and relevant matches without noticeable delays.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can also trigger the refresh of the stack when a user has a few profiles left to swipe through. This way, as far as the user is concerned, the stack seemed infinite.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/12cfef2931e8f0fdb459a65943674cd7"></div></div></div></div></div></div></div></div></div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Astute readers may realize that by pre-computing and caching a feed, we just introduced a new issue: stale feeds.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>How do we avoid stale feeds?</strong></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Caching feeds of users might result in us suggesting "stale" profiles. A stale profile is defined as one that no longer fits the filter criteria for a user. Below are some examples of the ways a profile in a feed might become stale:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">A user suggested in the feed might have changed locations and is no longer close enough to fit the feed filter criteria.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">A user suggested in the feed might change their profile (e.g. changed interests) and no longer fits the feed filter criteria.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The above are real problems that might lead to a bad UX if the user sees a profile that doesn't actually match their preferred filters. To solve this issue, we might consider having a strict TTL for cached feeds (&lt; 1h) and re-compute the feed via a background job on a schedule. We also might pre-computing feeds only for truly active users, vs. for all users. Doing upfront work for a user feed several times a day will be expensive at scale, so we might "warm" these caches only for users we know will eventually use the cached profiles. <strong>A benefit of this approach is that several parameters are tunable: the TTL for cached profiles, the number of profiles cached, the set of users we are caching feeds for, etc.</strong></div>
<div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When designing a system, it's very useful if the system has parameters that can be tuned without changing the overall logic of the system. These parameters can be modified to find an efficient configuration for the scale / use-case of the system and can be adjusted over time. This gives the operators of the system strong control over the health of the system without having to rework the system itself.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A few user-triggered actions might also lead to stale profiles in the feed:</div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The user being served the feed changes their filter criteria, resulting in profiles in the cached feed becoming stale.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The user being served the feed changes their location significantly (e.g. they go to a different neighborhood or city), resulting in profiles in the cached feed becoming stale.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">All of the above are interactions that could trigger a feed refresh in the background, so that the feed is ready for the user if they choose to start swiping shortly after.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-how-can-the-system-avoid-showing-user-profiles-that-the-user-has-previously-swiped-on">3) How can the system avoid showing user profiles that the user has previously swiped on?</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">It would be a pretty poor experience if users were re-shown profiles they had swiped on. It could give the user the impression that their "yes" swipes were not recorded, or it could annoy users to see people they previously said "no" to as suggestions again.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We should design a solution to prevent this bad user experience.</div>
<div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-ifi55z"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-1ev8i4f" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Bad Solution: DB Query + Contains Check</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-7">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Given our previous design, we can consider having our feed builder service query the swipe database and do a contains check to filter out users who have been swiped on before. The query to get all the swiped-on profiles will be efficient because it will be routed to the appropriate partition based on <span class="MuiBox-root mui-1vu004u">swiping_user_id</span>.</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-6">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">There's 2 challenges this approach presents:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">If we're dealing with a system that prioritizes availability over consistency, not all swipe data might have "landed" in all replicas of a partition by the time a feed is being generated. This means we might risk missing swipes, and are at risk of re-showing profiles.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">If a user has an extensive swipe history, there might be a lot of user IDs returned, and the contains check will get progressively more expensive.</div></li>
</ol></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Cache + DB Query + Contains Check</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-8">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Building off the previous approach, we might consider doing contains queries on the backend and adding a cache that houses recent user swipes to avoid the problems presented with an availability-skewing system. <em>However</em>, we wouldn't manage this cache on the backend. We'd manage it client-side.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Managing a cache on the backend merely to store data before it "lands" on all partitions in a NoSQL system would be expensive. We can take advantage of the fact that the client is part of the system and have the client store recent swipe data (perhaps the K most recent swipes). This will allow the client to filter out profiles that might be suggested in a feed that have already been swiped on recently.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This cache is doubly useful in the situation where a user is close to depleting their initial stack of profiles while swiping. Imagine a user swiping through 200 pre-fetched profiles. When the user gets to profile ~150, the client can:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Ping the backend to generate a new feed for the user.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Request that feed once the backend is done generating the feed.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Filter out any profiles that the user eventually swipes on.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The client works as a part of this system because we can make the assumption that the user is only using this app on one device. Therefore, we can leverage the client as a place to manage and store data.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/37d07a820161c1ed310125f2f8e0f395"></div></div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-7">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">This solution is still subjected to the problems created by users with extensive swipe histories and large user ID contains checks that get slower as the user swipes more.</div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Cache + Contains Check + Bloom Filter</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-9">Approach</h5><div class="my-6"><div class="MuiBox-root mui-o9fqh4"><div class="MuiBox-root mui-3t6lyr"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">this approach skews somewhat "over-engineered", but is a legit usecase for a bloom filter to support feed building for users with large swipe histories.</div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We might consider building on top of our previous approach even more. For users with large swipe histories, we might consider storing a <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.geeksforgeeks.org/bloom-filters-introduction-and-python-implementation/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">bloom filter</a>. If a user exceeds a swipe history of a certain size (a size that would make storage in a cache unwieldy or "contains" checks slow during a query), we can build and cache a bloom filter for that user and use it in the filtering process.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A bloom filter would sometimes yield false positives for swipes, meaning we'd sometimes assume a user swiped on a profile that they didn't swipe on. However, the bloom filter would <em>never</em> generate false negatives, meaning we'd never say a user hadn't swiped on a profile they actually <em>did</em> swipe on. This means we'd successfully avoid re-showing profiles, but there might be a small number of profiles that we might never show the user, due to false positives. Bloom filters have tunable error percentages that are usually tied to how much space they take up, so this is something that could be tuned to promote low false positives, reasonable space consumption, and fast filtering of profiles during feed building.</div><div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/39050a75d96d148050eeb006ef5da3a5"></div></div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-8">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The main challenge here is managing the bloom filter cache. It will need to be updated and also recovered if the cache goes down. A bloom filter is easy to re-create with the swipe data, but this would be expensive at scale in the event of a node outage.</div></div></div></div></div></div></div></div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="final-design">Final Design</h3>
<div class="my-4 flex-col w-full undefined"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><div class="w-full"><img class="w-full max-w-full max-h-full" src="https://d248djf5mc6iku.cloudfront.net/excalidraw/39050a75d96d148050eeb006ef5da3a5" alt="Final Design"></div></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Final Design</span></div></div></div></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="what-is-expected-at-each-level"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/blog/the-system-design-interview-what-is-expected-at-each-level" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">What is Expected at Each Level?</a></h2>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Ok, that was a lot. You may be thinking, “how much of that is actually required from me in an interview?” Let’s break it down.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="mid-level">Mid-level</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Breadth vs. Depth:</strong> A mid-level candidate will be mostly focused on breadth (80% vs 20%). You should be able to craft a high-level design that meets the functional requirements you've defined, but many of the components will be abstractions with which you only have surface-level familiarity.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Probing the Basics:</strong> Your interviewer will spend some time probing the basics to confirm that you know what each component in your system does. For example, if you add an API Gateway, expect that they may ask you what it does and how it works (at a high level). In short, the interviewer is not taking anything for granted with respect to your knowledge.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Mixture of Driving and Taking the Backseat:</strong> You should drive the early stages of the interview in particular, but the interviewer doesn’t expect that you are able to proactively recognize problems in your design with high precision. Because of this, it’s reasonable that they will take over and drive the later stages of the interview while probing your design.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Tinder:</strong> For this question, an E4 candidate will have clearly defined the API endpoints and data model, landed on a high-level design that is functional for all of feed creation, swiping, and matching. I don't expect candidates to know in-depth information about specific technologies, but I do expect the candidate to design a solution that supports traditional filters and geo-spatial filters. I also expect the candidate to design a solution to avoid re-showing swiped-on profiles.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="senior">Senior</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Depth of Expertise</strong>: As a senior candidate, expectations shift towards more in-depth knowledge — about 60% breadth and 40% depth. This means you should be able to go into technical details in areas where you have hands-on experience. It's crucial that you demonstrate a deep understanding of key concepts and technologies relevant to the task at hand.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design</strong>: You should be familiar with advanced system design principles (different technologies, their use-cases, how they fit together). Your ability to navigate these advanced topics with confidence and clarity is key.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Articulating Architectural Decisions</strong>: You should be able to clearly articulate the pros and cons of different architectural choices, especially how they impact scalability, performance, and maintainability. You justify your decisions and explain the trade-offs involved in your design choices.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Problem-Solving and Proactivity</strong>: You should demonstrate strong problem-solving skills and a proactive approach. This includes anticipating potential challenges in your designs and suggesting improvements. You need to be adept at identifying and addressing bottlenecks, optimizing performance, and ensuring system reliability.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Tinder:</strong> For this question, E5 candidates are expected to quickly go through the initial high-level design so that they can spend time discussing, in detail, how to handle feed efficient / scalable feed generation and management and how to ensure successful match creation. I expect an E5 candidate to be proactive in calling out the different trade-offs for feed building and to have some knowledge of the type of index that could be used to successfully power the feed. I also expect this candidate to be aware of when feed caches might become "stale".</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="staff">Staff+</h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Emphasis on Depth</strong>: As a staff+ candidate, the expectation is a deep dive into the nuances of system design — I'm looking for about 40% breadth and 60% depth in your understanding. This level is all about demonstrating that, while you may not have solved this particular problem before, you have solved enough problems in the real world to be able to confidently design a solution backed by your experience.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">You should know which technologies to use, not just in theory but in practice, and be able to draw from your past experiences to explain how they’d be applied to solve specific problems effectively. The interviewer knows you know the small stuff (REST API, data normalization, etc.) so you can breeze through that at a high level so you have time to get into what is interesting.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>High Degree of Proactivity</strong>: At this level, an exceptional degree of proactivity is expected. You should be able to identify and solve issues independently, demonstrating a strong ability to recognize and address the core challenges in system design. This involves not just responding to problems as they arise but anticipating them and implementing preemptive solutions. Your interviewer should intervene only to focus, not to steer.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Practical Application of Technology</strong>: You should be well-versed in the practical application of various technologies. Your experience should guide the conversation, showing a clear understanding of how different tools and systems can be configured in real-world scenarios to meet specific requirements.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Complex Problem-Solving and Decision-Making</strong>: Your problem-solving skills should be top-notch. This means not only being able to tackle complex technical challenges but also making informed decisions that consider various factors such as scalability, performance, reliability, and maintenance.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Advanced System Design and Scalability</strong>: Your approach to system design should be advanced, focusing on scalability and reliability, especially under high load conditions. This includes a thorough understanding of distributed systems, load balancing, caching strategies, and other advanced concepts necessary for building robust, scalable systems.</div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>The Bar for Tinder:</strong> For a staff-level candidate, expectations are high regarding the depth and quality of solutions, especially for the complex scenarios discussed earlier. Exceptional candidates delve deeply into each of the topics mentioned above and may even steer the conversation in a different direction, focusing extensively on a topic they find particularly interesting or relevant. They are also expected to possess a solid understanding of the trade-offs between various solutions and to be able to articulate them clearly, treating the interviewer as a peer.</div>
</body>
</html>
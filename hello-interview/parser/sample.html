<div id="markdown" class="mui-46nw7a"><div><div class="flex flex-col gap-2 md:gap-4"><div class="flex flex-col"><h6 class="MuiTypography-root MuiTypography-h6 mui-zfm63x">Common Problems</h6><h1 class="MuiTypography-root MuiTypography-h2 mui-161snwm">Design a Collaborative Document Editor like Google Docs</h1></div><div class="flex flex-col md:flex-row gap-2 md:items-center justify-between"><div class="flex flex-col lg:flex-row gap-4 md:items-center"><a target="_blank" rel="noopener noreferrer" class="flex flex-row gap-2 items-center" href="https://www.linkedin.com/in/stefanmai/" style="text-decoration: none;"><img class="rounded-full" src="https://hellointerview-files.s3.us-west-2.amazonaws.com/public-media/stefan-headshot.png" alt="Stefan Mai" width="40" height="40"><div class="flex flex-col"><div class="flex flex-row gap-2 items-center"><p class="MuiTypography-root MuiTypography-body2 mui-ltrqv0">Stefan Mai</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeInherit mui-70s7oy" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></div><span class="MuiTypography-root MuiTypography-caption mui-1eozzb8">Ex-Meta &amp; Amazon Sr. Manager</span></div></a><div class="flex flex-row gap-4 md:gap-8 items-center"><div class="flex flex-row gap-1 items-center" aria-label="Difficulty"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-su24yt">medium</p></div><div class="flex flex-row gap-1 items-center" aria-label="Average time allowed in interview"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg><p class="MuiTypography-root MuiTypography-body2 mui-1pb8xyp">35 min</p></div></div></div><a class="MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation MuiButton-root MuiButton-contained MuiButton-containedPrimary MuiButton-sizeSmall MuiButton-containedSizeSmall MuiButton-colorPrimary MuiButton-disableElevation mui-1c7cv5a" tabindex="0" href="/practice/system-design/start/google-docs" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-5 h-5 mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"></path></svg>Practice this problem<span class="MuiTouchRipple-root mui-w0pj6f"></span></a></div></div><hr class="MuiDivider-root MuiDivider-fullWidth mui-1rvhejo"></div>
<h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="understanding-the-problem">Understanding the Problem</h2>
<div class="my-6"><div class="MuiBox-root mui-1fz7ihe"><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>ðŸ“„ What is <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://docs.google.com" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Google Docs</a>?</strong>
Google Docs is a browser-based collaborative document editor. Users can create rich text documents and collaborate with others in real-time.</div></div></div></div></div>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In this writeup we'll design a system that supports the core functionality of Google Docs, dipping into websockets and collaborative editing systems. We'll start with the requirements (like a real interview), then move on to complete the design following our <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/in-a-hurry/delivery" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Delivery Framework</a>.</div>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#1-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Functional Requirements</a></h3>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to create new documents.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Multiple users should be able to edit the same document concurrently.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to view each other's changes in real-time.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Users should be able to see the cursor position and presence of other users.</div></li>
</ol>
<div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Below the line (out of scope)</strong></div>
<ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Sophisticated document structure. We'll assume a simple text editor.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Permissions and collaboration levels (e.g. who has access to a document).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Document history and versioning.</div></li>
</ol>
<h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="non-functional-requirements"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#2-non-functional-requirements" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Non-Functional Requirements</a></h3>
<div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Core Requirements</strong></div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Documents should be eventually consistent (i.e. all users should eventually see the same document state).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Updates should be low latency (&lt; 100ms).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">The system should scale to millions of concurrent users across billions of documents.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">No more than 100 concurrent editors per document.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Documents should be durable and available even if the server restarts.</div></li>
</ol><div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Some non-functional requirements make your job <em>easier</em>! In this case, limiting the number of concurrent editors per document is a great constraint to have. It means we can avoid worrying massive throughput on a single document and instead focus on the core functionality.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For what it's worth, this is a choice that Google docs also made - beyond a certain number of concurrent users, everyone new can only join as readers (implying a bit about their architectural choices).</div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Here's how it might look on your whiteboard:</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 815.535662597181 170">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="815.535662597181" height="170" fill="#ffffff"></rect><g transform="translate(10 13.418723800079533) rotate(0 187.4498291015625 62.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Functional</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Users can create new documents</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Users can edit documents</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Users can get real-time updates</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Users can see each others' cursors</text></g><g transform="translate(410.29603857374354 10) rotate(0 197.61981201171875 75)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Non-Functional</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Documents are eventually consistent</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Updates are low latency (100ms)</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Millions of users, billions of documents</text><text x="0" y="100" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* No more than 100 concurrent editors</text><text x="0" y="125" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">* Durable documents</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Requirements</span></div></div></div></div><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="set-up">Set Up</h2><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="planning-the-approach">Planning the Approach</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Before we start designing the system, we need to think briefly through the approach we'll take.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For this problem, we'll start by designing a system which simply supports our functional requirements without much concern for scale or our non-functional requirements. Then, in our deep-dives, we'll bring back those concerns one by one.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To do this we'll start by enumerating the "nouns" of our system, build out an API, and then start drawing our boxes.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="defining-the-core-entities"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#core-entities-2-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Defining the Core Entities</a></h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">First we'll define some core entities. These help to define terms between you and the interviewer, understand the data central to your design, and gives us a clue as to our APIs and how the system will fit together. The easiest way to do this is to look over your functional requirements and think about what nouns are involved in satisfying them. Asking yourself deeper questions about the behavior of the system ("what happens when...") will help you uncover the entities that are important to your design.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For this problem, we'll need just a few entities on our whiteboard:</div><div class="mx-auto w-32"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 186.1759490966797 200">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="186.1759490966797" height="200" fill="#ffffff"></rect><g transform="translate(10 10) rotate(0 83.08797454833984 90)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="36px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Editor</text><text x="0" y="45" font-family="Virgil, Segoe UI Emoji" font-size="36px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="90" font-family="Virgil, Segoe UI Emoji" font-size="36px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Edit</text><text x="0" y="135" font-family="Virgil, Segoe UI Emoji" font-size="36px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Cursor</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Core Entities</span></div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll explain these to our interviewer as we go through the problem.</div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Editor</strong>: A user editing a document.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Document</strong>: A collection of text managed by an editor.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Edit</strong>: A change made to the document by an editor.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Cursor</strong>: The position of the editor's cursor in the document (and the presence of that user in a document).</div></li>
</ul><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="defining-the-api">Defining the API</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Next, we can move to the APIs we need to satisfy which will very closely track our functional requirements. For this problem, we probably want some REST APIs to manage the document itself. We also know we're going to need lots of bi-directional communication between each editor and the document they're collectively editing. In this case it makes sense to assume we'll need some sort of websocket-based approach for the editor experience, so we'll define a few of the messages that we'll send over the wire.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Each interviewer may put more of less emphasis on this step. Some interviewers may want to really understand the intricacies of the messages (veering into a low-level design question) while others may be happy to know that you have a few messages defined opaquely and can move on. We'll assume the latter here!</div><pre><div class="MuiBox-root mui-xnilmx"><div class="MuiBox-root mui-v2ritd"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4  cursor-pointer" aria-label="Copy"><path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"></path></svg></div><div style="background: rgb(250, 250, 250); color: rgb(56, 58, 66); font-family: &quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0px; overflow: auto; border-radius: 0.375rem; border: none;"><code font-size="18" style="white-space: pre;"><span>POST /docs
</span>{
  title: string
} -&gt; {
  docId
}

WS /docs/{docId}
  SEND {
    type: "insert"
    ....
  }

  SEND {
    type: "updateCursor"
    position: ...
  }

  SEND { 
    type: "delete"
    ...
  }

  RECV { 
    type: "update"
    ...
  }</code></div></div></pre><div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When your API involves websockets, you'll be talking about <em>messages</em> you send over the websocket vs endpoints you hit with HTTP. The notation is completely up to you, but having some way to describe the protocol or message schema is helpful to convey what is going over the wire.</div></div></div></div></div><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="high-level-design"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#high-level-design-10-15-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">High-Level Design</a></h2><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With a sketch of an API we'll move to our high-level design. Tactically, it can be helpful to tell your interviewer that you're sure there are more details of the API to work through but you'll come back to those later as you flesh out the problem.</div><div class="my-6"><div class="MuiBox-root mui-1147lff"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">While it's <em>awesome</em> to be able to polish a perfect answer, you're in a time crunch! Acknowledging issues that you might get to later and leaving space to adjust your design as you learn more is a great way to keep the interview moving productively.</div></div></div></div></div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-users-should-be-able-to-create-new-documents">1) Users should be able to create new documents.</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our first step in our document editor is to allow users to create new documents. This is a simple API that takes a title and returns a document ID. There's a lot of interesting metadata that we may want to hang off of the document (e.g. permissions, history, tags, etc.) so it's sensible for us to assume there will be some separation of the document itself and the metadata. For this API, we'll tackle the first part.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">From an interviewing perspective the pattern we're using here of a simple horizontally scaled CRUD service fronted by an API gateway is so common you should be able to sling them out really quickly! Don't spend too much time setting the stage.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1245.7691345214844 289">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1245.7691345214844" height="289" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 32.67578125) rotate(0 83.921875 108.06640625)"><path d="M32 0 C65.77 -2.17, 94.51 1.33, 135.84 0 M32 0 C68.75 0.25, 105.82 -0.88, 135.84 0 M135.84 0 C157.87 -0.66, 167.96 10.09, 167.84 32 M135.84 0 C158.65 1.36, 168.45 8.58, 167.84 32 M167.84 32 C165.84 88.27, 169.23 143.85, 167.84 184.13 M167.84 32 C168.52 81.15, 167.79 131.34, 167.84 184.13 M167.84 184.13 C168.72 207.02, 155.82 216.44, 135.84 216.13 M167.84 184.13 C169.28 206.36, 155.38 214.7, 135.84 216.13 M135.84 216.13 C93.21 215.25, 52.87 215.71, 32 216.13 M135.84 216.13 C107.62 215.57, 79.01 216.37, 32 216.13 M32 216.13 C12.64 216.84, -0.34 203.9, 0 184.13 M32 216.13 C10.78 214.96, 0.79 203.29, 0 184.13 M0 184.13 C0.26 143.8, -2.23 99.28, 0 32 M0 184.13 C-1.24 130.11, 0.07 77.72, 0 32 M0 32 C-1.1 10.33, 11.38 0.68, 32 0 M0 32 C-1.47 12.91, 10.95 1.07, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(75.0400390625 128.2421875) rotate(0 18.8818359375 12.5)"><text x="18.8818359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(246.1484375 41.53125) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C55.65 0.24, 78.18 -0.34, 142.62 0 M32 0 C73.72 0.1, 114.79 0.15, 142.62 0 M142.62 0 C165.24 1.18, 175.14 8.85, 174.62 32 M142.62 0 C165.56 -0.38, 173.42 8.65, 174.62 32 M174.62 32 C176.22 73.45, 175.75 116.4, 174.62 170.18 M174.62 32 C175.04 73.3, 173.92 113.2, 174.62 170.18 M174.62 170.18 C175.87 192.3, 162.39 200.94, 142.62 202.18 M174.62 170.18 C176.85 190.27, 165.93 200.56, 142.62 202.18 M142.62 202.18 C118.61 202.73, 95.89 200.9, 32 202.18 M142.62 202.18 C116.96 202.77, 89.16 201.63, 32 202.18 M32 202.18 C10.77 201.17, 0.68 189.63, 0 170.18 M32 202.18 C10.16 204.15, -0.17 193.31, 0 170.18 M0 170.18 C1.67 116.05, 0.02 59.09, 0 32 M0 170.18 C-1.4 136.17, -0.5 102.82, 0 32 M0 32 C-1.28 12.61, 10.91 0.93, 32 0 M0 32 C0.1 8.94, 11.59 -1.58, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(279.30859375 130.123046875) rotate(0 54.150390625 12.5)"><text x="54.150390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(549.6015625 44.3828125) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C94.45 1.24, 153.16 0.24, 203.29 0 M32 0 C78.4 1.08, 123.78 -0.42, 203.29 0 M203.29 0 C226.02 -0.33, 234.25 8.91, 235.29 32 M203.29 0 C224.63 1.88, 234.52 11.21, 235.29 32 M235.29 32 C235.15 71.06, 237.12 111.05, 235.29 163.26 M235.29 32 C235.02 81.95, 233.62 130.5, 235.29 163.26 M235.29 163.26 C237.23 183.51, 226.34 193.85, 203.29 195.26 M235.29 163.26 C233.25 183.98, 223.11 194.55, 203.29 195.26 M203.29 195.26 C139.77 192.91, 79.04 196.76, 32 195.26 M203.29 195.26 C145.91 193.41, 88.77 192.98, 32 195.26 M32 195.26 C10.22 196.97, -0.15 186.15, 0 163.26 M32 195.26 C12.9 194.19, -0.36 185.78, 0 163.26 M0 163.26 C-0.69 120.42, 1.47 74.01, 0 32 M0 163.26 C-1.11 127.06, -0.34 89.38, 0 32 M0 32 C0.09 9.16, 11.47 -1.38, 32 0 M0 32 C1.07 10.88, 9.79 0.79, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(585.888671875 117.013671875) rotate(0 81.35742187499997 25)"><text x="81.357421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="81.357421875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(846.6640625 10) rotate(0 137.23242187499994 134.5)"><path d="M141.75 0.32 C155.82 -1.4, 170.81 4.3, 184.58 9.29 C198.36 14.28, 212.97 21.1, 224.43 30.25 C235.89 39.4, 245.42 51.75, 253.34 64.19 C261.27 76.63, 268.58 90.69, 271.99 104.89 C275.41 119.1, 275.64 134.78, 273.85 149.42 C272.06 164.06, 267.68 179.58, 261.28 192.74 C254.87 205.9, 245.64 218, 235.43 228.38 C225.21 238.75, 213.1 248.56, 199.98 255.01 C186.86 261.46, 171.55 265.05, 156.71 267.07 C141.87 269.08, 125.57 269.92, 110.93 267.1 C96.29 264.28, 81.86 257.36, 68.88 250.13 C55.89 242.89, 42.92 234.41, 33.02 223.69 C23.12 212.98, 15.08 199.64, 9.49 185.84 C3.9 172.03, 0.25 155.67, -0.51 140.88 C-1.26 126.09, 0.83 110.85, 4.95 97.1 C9.08 83.35, 15.71 70.27, 24.23 58.38 C32.76 46.49, 44.17 34.63, 56.1 25.76 C68.03 16.89, 80.34 9.2, 95.82 5.15 C111.3 1.1, 138.91 1.69, 148.99 1.46 C159.08 1.24, 156.7 1.73, 156.34 3.81 M102.36 5.61 C115.36 0.51, 132.46 0.78, 147.57 1.56 C162.68 2.34, 179.38 4.59, 193 10.28 C206.62 15.98, 218.45 25.9, 229.29 35.73 C240.13 45.56, 251.02 56.76, 258.04 69.25 C265.06 81.75, 268.8 96.13, 271.41 110.68 C274.01 125.24, 275.97 142.11, 273.66 156.58 C271.35 171.05, 264.57 184.7, 257.52 197.5 C250.47 210.3, 242.24 223.16, 231.36 233.38 C220.47 243.59, 205.83 252.82, 192.2 258.78 C178.58 264.75, 164.25 268.3, 149.63 269.17 C135.01 270.03, 118.82 267.74, 104.47 263.97 C90.12 260.19, 75.9 254.21, 63.52 246.54 C51.14 238.86, 39.57 229.1, 30.18 217.93 C20.78 206.76, 12.31 193.26, 7.16 179.5 C2 165.74, -0.77 149.99, -0.74 135.37 C-0.7 120.75, 2.5 105.44, 7.35 91.78 C12.21 78.12, 19.33 64.93, 28.4 53.39 C37.48 41.86, 49.24 30.69, 61.8 22.6 C74.36 14.51, 96.8 7.67, 103.77 4.85 C110.75 2.03, 103.17 3.83, 103.65 5.69" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(900.0010863935344 119.39413793040933) rotate(0 83.857421875 25)"><text x="83.857421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata </text><text x="83.857421875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M0.77 0.71 C10.86 0.37, 50.55 -2.01, 60.61 -2.37 M-0.28 0.03 C9.67 -0.17, 49.65 -1.36, 59.83 -1.4" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M31.84 9.39 C41.61 6.43, 47.17 4, 59.83 -1.4 M31.84 9.39 C39.84 7.39, 47.44 3.75, 59.83 -1.4" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M31.45 -11.13 C41.28 -7.82, 46.96 -3.97, 59.83 -1.4 M31.45 -11.13 C39.45 -7.31, 47.16 -5.13, 59.83 -1.4" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(425.6328125 146.81187055264445) rotate(0 58.87109375 -2.7621410970089073)"><path d="M0.31 -1.09 C19.95 -2.16, 99.11 -4.81, 118.58 -5.72 M-0.98 0.96 C18.5 0.01, 98.57 -3.16, 118.07 -4.29" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.81187055264445) rotate(0 58.87109375 -2.7621410970089073)"><path d="M90.4 7.3 C98.59 4.4, 110.16 -2.25, 118.07 -4.29 M90.4 7.3 C95.93 4.85, 102.12 2.16, 118.07 -4.29" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.81187055264445) rotate(0 58.87109375 -2.7621410970089073)"><path d="M89.43 -13.2 C98.1 -8.63, 110.02 -7.83, 118.07 -4.29 M89.43 -13.2 C95.17 -11.31, 101.56 -9.65, 118.07 -4.29" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(432.4765625 94.89453125) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M-0.29 -0.48 C7.4 -0.1, 38.72 1.81, 46.49 2.2 M0.57 0.46 C8.15 0.7, 38.51 1.12, 46.06 1.46" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M23.99 8.81 C31.28 6.15, 41.13 3.1, 46.06 1.46 M23.99 8.81 C31.48 6.4, 38.26 4.52, 46.06 1.46" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M24.43 -7.09 C31.54 -3.87, 41.23 -1.04, 46.06 1.46 M24.43 -7.09 C31.78 -4.36, 38.41 -1.1, 46.06 1.46" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1143.44921875 96.13671875) rotate(0 46.15995788574219 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Basic Metadata</span></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our interviewer is likely to ask us what database we're going to use here. For this problem, let's assume a simple Postgres database for now because it gives us flexible querying and, if we need to scale, we can always partition and replicate later.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-multiple-users-should-be-able-to-edit-the-same-document-concurrently">2) Multiple users should be able to edit the same document concurrently.</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For our next requirement, we'll have to deal with writing to the document itself which has both consistency and scaling problems. This is where things start to get interesting. In a collaborative editor multiple users are making high frequency edits to the same document at the same time â€” a recipe for consistency problems and contention!</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We're going to defer the scaling concerns for our deep dive later in the interview, so we'll make a note to our interviewer that we'll come back to that so we can focus on consistency.</div><h4 class="MuiTypography-root MuiTypography-h5 mui-1jefea8" id="collaborative-edits-breakdown">Collaborative Edits Breakdown</h4><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">First, let me explain why achieving consistency in a collaborative editor is not easy by starting with a deficient solution and then building up to a more correct one.</div><div class="my-6"><div class="MuiBox-root mui-1ygn9bx"><div class="MuiBox-root mui-14185gn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">I'm going to walk through the fundamentals here to explain how we can solve the consistency problems here but, like before, this is a place where it's good to have the background knowledge to be able to field questions from your interviewer but you probably won't use the interview time to teach these concepts to your interviewer. Skip ahead if you already understand them!</div></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="sending-snapshots-wrong">Sending Snapshots (Wrong)</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Let's pretend on each edit the users send their entire document over to a <span class="MuiBox-root mui-1vu004u">Document Service</span>. The <span class="MuiBox-root mui-1vu004u">Document Service</span> will then store the document in a blob storage system like S3.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1245.7691345214844 520.21484375">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1245.7691345214844" height="520.21484375" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 32.67578125) rotate(0 83.921875 108.06640625)"><path d="M32 0 C60.04 -1.19, 87.02 -0.27, 135.84 0 M32 0 C62 -0.3, 91.72 0.1, 135.84 0 M135.84 0 C155.5 -0.19, 168.41 9.55, 167.84 32 M135.84 0 C158.34 2.1, 168.08 8.39, 167.84 32 M167.84 32 C167.47 69.68, 167.57 108.38, 167.84 184.13 M167.84 32 C167.39 79.24, 167.91 127, 167.84 184.13 M167.84 184.13 C167.29 205.02, 155.66 215.9, 135.84 216.13 M167.84 184.13 C166.65 205.66, 158.35 216.83, 135.84 216.13 M135.84 216.13 C93.96 214.96, 51.32 215.52, 32 216.13 M135.84 216.13 C103.03 216.15, 68.96 215.87, 32 216.13 M32 216.13 C12.48 215.57, -0.48 206.98, 0 184.13 M32 216.13 C12.51 217.39, 1.65 206.45, 0 184.13 M0 184.13 C0.09 149.97, -1.11 117.07, 0 32 M0 184.13 C0.42 142.48, -1.26 98.93, 0 32 M0 32 C1.66 10.36, 12.65 -0.14, 32 0 M0 32 C-0.93 10.6, 12.4 2.14, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(75.0400390625 128.2421875) rotate(0 18.8818359375 12.5)"><text x="18.8818359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(246.1484375 41.53125) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C58.18 0.78, 86.28 0.14, 142.62 0 M32 0 C69.56 -1.06, 109.07 -1.52, 142.62 0 M142.62 0 C164.97 1.82, 174.82 8.69, 174.62 32 M142.62 0 C162.78 -1.43, 175.87 11.33, 174.62 32 M174.62 32 C175.35 72.29, 175.05 111.92, 174.62 170.18 M174.62 32 C174.51 67.3, 174.03 102.93, 174.62 170.18 M174.62 170.18 C173.58 191.68, 164.97 202.79, 142.62 202.18 M174.62 170.18 C176.89 191.48, 162.71 201.6, 142.62 202.18 M142.62 202.18 C113.18 202.97, 81.6 202.68, 32 202.18 M142.62 202.18 C102.08 202.42, 59.49 203.46, 32 202.18 M32 202.18 C12.27 203.28, 1.44 192.38, 0 170.18 M32 202.18 C8.85 201.78, 0.72 191.32, 0 170.18 M0 170.18 C0.53 133.17, 0.79 96.75, 0 32 M0 170.18 C2 117.47, 2.16 64.99, 0 32 M0 32 C-0.81 10.61, 12.17 1.86, 32 0 M0 32 C0.06 11.56, 10.11 0.6, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(279.30859375 130.123046875) rotate(0 54.150390625 12.5)"><text x="54.150390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(549.6015625 44.3828125) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C89.56 -0.57, 146.96 -1.65, 203.29 0 M32 0 C82.24 1.87, 131.57 -0.03, 203.29 0 M203.29 0 C223.6 -1.24, 236.38 11.24, 235.29 32 M203.29 0 C224.44 0.77, 236.1 10.97, 235.29 32 M235.29 32 C234.41 71.17, 234.59 109.28, 235.29 163.26 M235.29 32 C233.77 68.52, 234.8 105.19, 235.29 163.26 M235.29 163.26 C237.26 184.56, 223.54 194.76, 203.29 195.26 M235.29 163.26 C234.59 182.57, 224.56 195.69, 203.29 195.26 M203.29 195.26 C146.41 194.25, 87.49 197.53, 32 195.26 M203.29 195.26 C157.51 197.11, 110.84 196.99, 32 195.26 M32 195.26 C9.08 194.91, 0.63 184.42, 0 163.26 M32 195.26 C10.02 193.69, 0.15 184.11, 0 163.26 M0 163.26 C1.71 118.63, -0.46 79.05, 0 32 M0 163.26 C-1.7 125.87, -0.55 89.46, 0 32 M0 32 C0.06 11.45, 10.18 0.52, 32 0 M0 32 C0.84 11.73, 9.89 1.41, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(585.888671875 117.013671875) rotate(0 81.357421875 25)"><text x="81.357421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="81.357421875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(846.6640625 10) rotate(0 137.23242187499994 134.5)"><path d="M157.62 1.46 C171.82 1.16, 185.8 7.55, 198.77 14.26 C211.74 20.97, 224.89 31.15, 235.41 41.7 C245.94 52.25, 255.46 64.42, 261.89 77.58 C268.33 90.74, 272.5 106.18, 274.04 120.67 C275.58 135.15, 274.51 150.41, 271.14 164.48 C267.76 178.55, 261.72 192.67, 253.79 205.06 C245.86 217.45, 235.12 229.61, 223.56 238.84 C212 248.06, 198.32 255.5, 184.42 260.4 C170.52 265.29, 154.97 267.91, 140.16 268.21 C125.35 268.5, 109.65 266.36, 95.55 262.16 C81.44 257.96, 67.39 251.44, 55.54 243.02 C43.68 234.59, 32.83 223.79, 24.41 211.62 C15.98 199.44, 9.06 184.2, 4.99 169.96 C0.92 155.72, -0.75 140.62, -0.01 126.17 C0.73 111.72, 3.72 96.63, 9.44 83.29 C15.17 69.94, 24.51 56.99, 34.34 46.11 C44.18 35.23, 55.47 25.39, 68.46 17.98 C81.45 10.57, 96.54 4.11, 112.29 1.65 C128.04 -0.82, 153.78 2.5, 162.94 3.2 C172.11 3.9, 167.67 3.66, 167.29 5.85 M173.07 4.73 C187.14 6.29, 203.27 15.52, 215.62 23.65 C227.98 31.79, 238.42 41.88, 247.19 53.55 C255.95 65.23, 263.6 79.69, 268.21 93.73 C272.81 107.76, 275.01 122.96, 274.83 137.77 C274.65 152.57, 272.57 168.97, 267.12 182.56 C261.67 196.16, 251.52 208.31, 242.1 219.33 C232.69 230.35, 222.8 240.98, 210.62 248.68 C198.45 256.39, 183.85 262.32, 169.05 265.57 C154.26 268.82, 136.69 269.49, 121.86 268.18 C107.03 266.86, 93.43 263.75, 80.1 257.67 C66.76 251.59, 52.74 242.01, 41.82 231.72 C30.9 221.43, 21.23 208.87, 14.57 195.91 C7.92 182.96, 3.99 168.32, 1.89 153.99 C-0.21 139.67, -0.79 124.44, 1.98 109.96 C4.74 95.47, 10.9 79.92, 18.49 67.1 C26.09 54.28, 36.33 42.6, 47.56 33.04 C58.79 23.48, 72.13 14.97, 85.9 9.74 C99.66 4.5, 115.58 2.27, 130.13 1.63 C144.69 0.99, 165.86 4.89, 173.22 5.9 C180.58 6.91, 174.62 5.66, 174.3 7.69" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(900.0010863935344 119.39413793040933) rotate(0 83.857421875 25)"><text x="83.857421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata </text><text x="83.857421875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M0.61 1.09 C10.62 0.8, 50.58 -1.95, 60.42 -2.47 M-0.53 0.62 C9.3 0.48, 49.68 -1.27, 59.54 -1.55" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M31.74 9.74 C42.76 6.09, 48.09 1.15, 59.54 -1.55 M31.74 9.74 C38.21 7.31, 45.25 4.42, 59.54 -1.55" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M30.99 -10.77 C42.14 -7.68, 47.71 -5.89, 59.54 -1.55 M30.99 -10.77 C37.75 -8.32, 44.97 -6.33, 59.54 -1.55" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(425.6328125 146.81187055264445) rotate(0 58.87109375 -2.7621410970089073)"><path d="M0.12 -1.19 C19.54 -2.41, 97.41 -5.61, 117.13 -6.27 M-1.27 0.81 C18.49 0.23, 99.64 -3.77, 119.52 -5.12" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.81187055264445) rotate(0 58.87109375 -2.7621410970089073)"><path d="M91.95 6.72 C99.53 1.51, 109.93 -0.53, 119.52 -5.12 M91.95 6.72 C101.37 2.87, 110.05 -1.18, 119.52 -5.12" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.81187055264445) rotate(0 58.87109375 -2.7621410970089073)"><path d="M90.79 -13.77 C98.96 -11.79, 109.77 -6.65, 119.52 -5.12 M90.79 -13.77 C100.58 -10.89, 109.63 -8.2, 119.52 -5.12" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(432.4765625 94.89453125) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M0.3 0.16 C8.09 0.54, 38.71 1.66, 46.44 1.94 M-0.21 -0.24 C7.52 0, 38.21 0.62, 45.99 1.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M23.86 8.22 C29.67 6.3, 35.22 4.95, 45.99 1.06 M23.86 8.22 C30.59 5.77, 37.79 3.57, 45.99 1.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M24.43 -7.68 C30.06 -5.64, 35.47 -3.04, 45.99 1.06 M24.43 -7.68 C30.99 -5.15, 38 -2.37, 45.99 1.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1143.44921875 96.13671875) rotate(0 46.15995788574219 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text></g><g stroke-linecap="round" transform="translate(528.80859375 317.91015625) rotate(0 128.2890625 85.94921875)"><path d="M32 0 C88.51 -0.75, 144.45 -1.47, 224.58 0 M32 0 C81.23 0.43, 130.25 0.53, 224.58 0 M224.58 0 C244.87 0.17, 257.6 11.28, 256.58 32 M224.58 0 C248.18 -0.04, 255.34 10.09, 256.58 32 M256.58 32 C256 61.89, 254.22 90.68, 256.58 139.9 M256.58 32 C256.69 72.15, 255.55 113.61, 256.58 139.9 M256.58 139.9 C258.19 162.32, 247.35 172.76, 224.58 171.9 M256.58 139.9 C254.76 160.83, 246.63 171.7, 224.58 171.9 M224.58 171.9 C171.83 172.57, 119.76 173.69, 32 171.9 M224.58 171.9 C152.16 171.21, 79.07 171.29, 32 171.9 M32 171.9 C9.86 171.84, 1.51 163.09, 0 139.9 M32 171.9 C10.73 172.79, -0.56 161.83, 0 139.9 M0 139.9 C0.73 103.97, -1.07 68.26, 0 32 M0 139.9 C0.09 110.23, -1.13 79.29, 0 32 M0 32 C1.05 10.82, 11.67 0.16, 32 0 M0 32 C-1.17 11.98, 12.82 0.86, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(582.95703125 391.359375) rotate(0 74.140625 12.5)"><text x="74.140625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Service</text></g><g stroke-linecap="round"><g transform="translate(416.265625 239.2109375) rotate(0 53.0859375 38.96366035566837)"><path d="M-0.48 -0.52 C17.25 12.41, 88.6 64.49, 106.32 77.52 M1.47 1.83 C19.06 14.92, 88.21 66.01, 105.45 78.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.265625 239.2109375) rotate(0 53.0859375 38.96366035566837)"><path d="M76.69 70.3 C84.36 73.19, 93.07 74.93, 105.45 78.85 M76.69 70.3 C84.09 72.79, 93.1 75.38, 105.45 78.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.265625 239.2109375) rotate(0 53.0859375 38.96366035566837)"><path d="M88.91 53.81 C92.95 61.55, 98.04 68.17, 105.45 78.85 M88.91 53.81 C92.79 60.87, 98.41 68.04, 105.45 78.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(438.3641074367159 225.5600597335042) rotate(0 49.989952087402344 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket</text></g><g stroke-linecap="round" transform="translate(856.6640625 297.08984375) rotate(0 114.958984375 106.5625)"><path d="M72.46 8.09 C84.08 2.29, 100.31 1.29, 114.13 0.99 C127.96 0.69, 142.55 1.98, 155.41 6.28 C168.27 10.58, 181.14 18.17, 191.31 26.8 C201.49 35.44, 210.11 46.55, 216.47 58.1 C222.84 69.64, 228.06 83.28, 229.5 96.09 C230.95 108.91, 228.69 122.79, 225.13 134.98 C221.57 147.16, 216.16 158.78, 208.12 169.21 C200.09 179.63, 188.78 190.57, 176.91 197.51 C165.04 204.46, 150.45 208.41, 136.92 210.87 C123.38 213.34, 109.2 214.38, 95.71 212.3 C82.22 210.23, 67.85 205.34, 55.95 198.43 C44.06 191.52, 32.91 181.06, 24.34 170.82 C15.77 160.59, 8.54 149.27, 4.53 137.05 C0.52 124.83, -0.75 110.32, 0.3 97.49 C1.36 84.67, 4.84 71.52, 10.87 60.07 C16.89 48.62, 25.23 37.74, 36.47 28.79 C47.71 19.85, 70.06 10.34, 78.29 6.38 C86.53 2.41, 85.31 3.34, 85.89 5.02 M105.55 0.27 C118.46 -2.06, 135.92 2.13, 149.28 5.94 C162.65 9.74, 175.05 15.4, 185.71 23.13 C196.38 30.86, 206.09 41.26, 213.28 52.29 C220.46 63.32, 226.52 76.59, 228.82 89.33 C231.13 102.06, 229.91 116.32, 227.11 128.71 C224.31 141.1, 219.28 153.04, 212.01 163.65 C204.74 174.26, 194.61 184.76, 183.49 192.36 C172.37 199.95, 158.65 205.64, 145.29 209.23 C131.93 212.82, 117.38 215.1, 103.34 213.91 C89.31 212.72, 73.37 208.22, 61.07 202.11 C48.78 195.99, 38.45 186.97, 29.58 177.22 C20.71 167.47, 12.93 155.52, 7.88 143.61 C2.82 131.7, -1.08 118.5, -0.75 105.74 C-0.42 92.98, 4.3 78.88, 9.83 67.07 C15.37 55.26, 22.97 44.37, 32.45 34.88 C41.93 25.39, 54.38 15.72, 66.71 10.13 C79.05 4.53, 99.83 2.41, 106.45 1.33 C113.07 0.25, 106.41 1.85, 106.44 3.63" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(909.0564491526192 391.30127737980854) rotate(0 62.7783203125 12.5)"><text x="62.7783203125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Blob Store (S3)</text></g><g stroke-linecap="round"><g transform="translate(790.1796875 404.13671875) rotate(0 30.513671875 -1.1328125)"><path d="M-0.62 0.1 C9.8 -0.19, 51.17 -1.5, 61.64 -1.9 M1.25 -0.89 C11.65 -1.55, 50.87 -3.82, 61.01 -3.83" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.1796875 404.13671875) rotate(0 30.513671875 -1.1328125)"><path d="M33.18 7.37 C39.6 6.02, 46.28 4.47, 61.01 -3.83 M33.18 7.37 C41.24 3.22, 49.81 0.94, 61.01 -3.83" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.1796875 404.13671875) rotate(0 30.513671875 -1.1328125)"><path d="M32.49 -13.14 C39.04 -9.89, 45.87 -6.85, 61.01 -3.83 M32.49 -13.14 C40.64 -11.17, 49.42 -7.33, 61.01 -3.83" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(239.50361283409063 283.76218308597424) rotate(0 110.24990844726562 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write Entire Document</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Deficient Solution</span></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Simple enough, right? Not so fast. First, this design is incredibly inefficient: we're transferring the entire document over the wire for every edit. For a fast typer, this could mean 100s of KBs per keystroke, yuck. But a more serious problem looms.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Assume User A and User B are editing the same document concurrently. The document starts with a single paragraph of text:</div><pre><span class="MuiBox-root mui-1vu004u">Hello!
</span></pre><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User A adds ", world" to produce <span class="MuiBox-root mui-1vu004u">Hello, world!</span> which they submit.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User B deletes the "!" to produce <span class="MuiBox-root mui-1vu004u">Hello</span> which they submit.</div></li>
</ul><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Both submit their edits at the same time. The actual document that gets stored to our blob storage is entirely dependent on which request arrives first. If User A's edit arrives first, the document will be <span class="MuiBox-root mui-1vu004u">Hello, world!</span> If User B's edit arrives first, the document will be <span class="MuiBox-root mui-1vu004u">Hello</span>. The user experience is terrible, we're losing all concurrent edits!</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="sending-edits-getting-warmer">Sending Edits (Getting Warmer)</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We can take a crack at solving these problems by recognizing that we're making <strong>edits</strong> to the document. Instead of transmitting the entire document over the wire, we can transmit just the edits themselves.</div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User A adds ", world" and sends <span class="MuiBox-root mui-1vu004u">INSERT(5, ", world")</span></div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">User B deletes the "!" and sends <span class="MuiBox-root mui-1vu004u">DELETE(6)</span></div></li>
</ul><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We solved our first problem! We're no longer transmitting the entire document over the wire, so now we don't need to send 100s of KB on every keystroke. But we have a new problem.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">User B's deletion assumes that the character at position 6 is an exclamation mark. If User A's edit arrives after User B's deletion, we'll end up with <span class="MuiBox-root mui-1vu004u">Hello, world</span> - ok, good. But if User B's edit arrives after User A's edit, we'll end up with <span class="MuiBox-root mui-1vu004u">Hello world!</span> - we deleted the comma instead of the exclamation mark!</div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="collaborative-editing-approaches">Collaborative Editing Approaches</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The critical missing piece here is that each edit is contextual: it's an edit based on a specific state of the document. Dealing with a stream of edits presents a bunch of consistency problems! We have two options to solve this problem:</div><div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Operational Transformation (OT)</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="approach">Approach</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One way to thread the needle is to reinterpret or <em>transform</em> each edit before it's applied. The idea here is that each user's edit can be adjusted based on the edits that came before it.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">We'll collect all of the edits to the document on a single server. From there, we can, in batches, transform each edit based on the edits that came before it. While an exhaustive treatment of OT is beyond the scope of this design (you can read more <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Operational_transformation" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">on the wikipedia page</a>), let's consider a simple worked example.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">User B's <span class="MuiBox-root mui-1vu004u">DELETE(6)</span> is trying to delete the character at position 6, which for them was a <span class="MuiBox-root mui-1vu004u">!</span> at the time the edit was created. The problem occurs when User A's edit <span class="MuiBox-root mui-1vu004u">INSERT(5, ", world")</span> arrives first. If we don't transform User B's edit, we'll end up with <span class="MuiBox-root mui-1vu004u">Hello, world</span> instead of <span class="MuiBox-root mui-1vu004u">Hello, world!</span>.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The OT approach is to transform the operations before they're applied (and, later, before they're sent back to the client). In this case, if User A's edit arrives before User B's deletion, we can transform User B's <span class="MuiBox-root mui-1vu004u">DELETE(6)</span> to <span class="MuiBox-root mui-1vu004u">DELETE(12)</span> so that when User A's edit is applied, it deletes the exclamation mark instead of the comma.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">OT is low memory and fast, but comes with a big tradeoff.</div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">OT requires a central server which can provide a final ordering of operations. This allows us to scale to a small number of collaborators, but not an enormous number. Our non-functional requirements help us here. OT is also tricky to implement correctly and easy to get wrong.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1016.7906799316406 291.02734375">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1016.7906799316406" height="291.02734375" fill="#ffffff"></rect><g transform="translate(10 146.596435546875) rotate(0 99.18993377685547 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">INSERT(5, ", world")</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DELETE(6)</text></g><g transform="translate(406.05078125 11.608154296875) rotate(0 61.64994812011719 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Initial Text:</text></g><g transform="translate(561.68359375 10) rotate(0 25.546875 13.5)"><text x="0" y="0" font-family="Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Hello!</text></g><g transform="translate(15.00390625 254.02734375) rotate(0 51.376953125 13.5)"><text x="0" y="0" font-family="Segoe UI Emoji" font-size="20px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Hello world!</text></g><g transform="translate(241.04551696777344 144.48046875) rotate(0 99.18993377685547 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DELETE(6)</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">INSERT(5, ", world")</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g transform="translate(249.5048965215683 249.265625) rotate(0 50.546875 13.5)"><text x="0" y="0" font-family="Segoe UI Emoji" font-size="20px" fill="#2f9e44" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Hello, world</text></g><g transform="translate(134.96484375 72.66015625) rotate(0 80.37396240234375 17.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Without OT</text></g><g transform="translate(707.7261316180229 75.4375) rotate(0 56.75597381591797 17.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">With OT</text></g><g transform="translate(515.0611419677734 145.69921875) rotate(0 99.18993377685547 25)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">INSERT(5, ", world")</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">-&gt; DELETE(12)</text></g><g transform="translate(780.4908294677734 144.421875) rotate(0 113.1499252319336 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DELETE(6)</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">-&gt; INSERT(5, ", world")</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"></text></g><g transform="translate(538.9373992681503 248.71875) rotate(0 50.546875 13.5)"><text x="0" y="0" font-family="Segoe UI Emoji" font-size="20px" fill="#2f9e44" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Hello, world</text></g><g transform="translate(817.9569305181503 244.5) rotate(0 50.546875 13.5)"><text x="0" y="0" font-family="Segoe UI Emoji" font-size="20px" fill="#2f9e44" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Hello, world</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Operation Transforms</span></div></div></div></div></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Conflict-free Replicated Data Types (CRDTs)</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-1">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The alternative to reinterpreting every edit is to make every edit commutative or, able to be applied in any order. This is the approach taken by Conflict-free Replicated Data Types (CRDTs).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">CRDTs allow us to represent edits as a set of operations that can be applied in any order but still produce the exact same output.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For simple text operations, CRDTs do this with two tricks:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">CRDTs represent positions using real numbers rather than integers. These positions <em>never change</em> even in light of insertions. If we need to create more "space", real numbers allow us to do so infinitely (like adding 1.5 between 1 and 2).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">CRDTs keep "tombstones" for deleted text. The text is never actually removed from the document, but we remember that it is deleted before displaying the document to the user.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Note: We won't be able to go into too much depth to explain CRDTs (a deep research topic!) though you're free to read more on <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">the wikipedia page</a>. But to give you some intuition, let's consider a simple worked example.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Assume we have two users looking at "Hello!" where each character has a position number under it:</div><pre><span class="MuiBox-root mui-1vu004u">H  e  l  l  o  !
</span></pre><pre><span class="MuiBox-root mui-1vu004u">0  1  2  3  4  5
</span></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Both users want to insert something after "Hello". User A wants to insert "," and User B wants to insert " there". This would be tricky in OT because we'd need to transform one edit based on the other. But with CRDTs, we just need to make sure each new character gets its own unique position number between 4 and 5.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When User A's wants to insert "," she picks an arbitrary number between 4 and 5 as the position for her comma, in this case she chooses 4.6:</div><pre><span class="MuiBox-root mui-1vu004u">H    e    l    l    o    ,    !
</span></pre><pre><span class="MuiBox-root mui-1vu004u">0    1    2    3    4    4.3    5
</span></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">User B does the same, assigning arbitrary numbers between 4 and 5 for each of the characters he wants to insert:</div><pre><span class="MuiBox-root mui-1vu004u">H     e     l     l     o         t     h     e     r     e    !
</span></pre><pre><span class="MuiBox-root mui-1vu004u">0     1     2     3     4    4.1  4.2   4.4   4.5   4.7   4.8  5
</span></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The magic is that these position numbers create a total ordering - no matter what order the edits arrive in, every client will sort the characters the same way and see the same final text.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In this case, the resulting string is "Hello t,here!" which is a consequence of both users editing in the same position. There are a lot of tricks to prevent conflicts like this, but the core guarantee of a CRDT is that no matter what order the edits arrive in, every client will converge on the same document.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">CRDTs are elegant in that they remove the need for a central server. As long as all updates eventually reach all clients, the clients will converge on the same document. This makes it a good solution for peer-to-peer applications. CRDTs are also more easily adaptable to offline use-cases - you can just keep all of the edits in local storage and add them to the bag of updates once the editor comes back online.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A great commercial implementation of CRDTs is <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://github.com/yjs/yjs" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Yjs</a> which I would highly recommend for lightweight collaborative applications.</div><h6 class="MuiTypography-root MuiTypography-body1 mui-1quhbks" id="challenges-1">Challenges</h6><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The benefits of CRDTs come with some big downsides. The memory usage is higher because we need to remember every edit, including tombstones for text that has long been deleted. This means our document only grows in size, never shrinks. CRDTs are also less efficient computationally, though there are workarounds! And finally the handling of conflicts can be inelegant. For most real-time use cases this isn't as much a problem, simply having a cursor indicator is enough for you and I to avoid editing the same part of the same document, but as clients need to buffer or go offline it can become a major issue.</div></div></div></div></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For this problem, we're going to use the Operational Transformation (OT) approach. This is the approach that Google Docs takes and it benefits from requiring low memory, being more adaptable to text in particular, and making use of a centralized server.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">If we needed to support a larger number of collaborators, or a Peer-to-Peer system (maybe using WebRTC!), we could use CRDTs. There are plenty of examples of industrial CRDTs which cut some corners (Figma being a notable one) - there's a healthy amount of research and development happening on both approaches.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With that in mind, we can update our design to solve the collaborative edit problem. Our updated design sends edits to a central server as operations, which are transformed by the server before being recorded in a database.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1258.8200243083375 621.41015625">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1258.8200243083375" height="621.41015625" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 32.67578125) rotate(0 83.921875 108.06640625)"><path d="M32 0 C61.22 1.37, 93.08 -0.99, 135.84 0 M32 0 C59.68 0.8, 87.23 -0.66, 135.84 0 M135.84 0 C157.79 -1.7, 167.37 9.47, 167.84 32 M135.84 0 C158.84 1.92, 168.62 12.54, 167.84 32 M167.84 32 C169.82 67.45, 170.2 101.81, 167.84 184.13 M167.84 32 C166.47 80.04, 166.41 127.94, 167.84 184.13 M167.84 184.13 C167.51 207.35, 157.8 214.29, 135.84 216.13 M167.84 184.13 C169.49 204.75, 157.81 214.46, 135.84 216.13 M135.84 216.13 C95.19 216.43, 57.99 216.65, 32 216.13 M135.84 216.13 C109.17 215.23, 80.95 215.56, 32 216.13 M32 216.13 C9.17 216.32, -0.63 205.56, 0 184.13 M32 216.13 C10.45 217.81, 2.13 203.35, 0 184.13 M0 184.13 C0.66 149.14, 0.8 110.92, 0 32 M0 184.13 C0.91 136.79, 0.18 90.91, 0 32 M0 32 C1.61 9.04, 12.38 -0.74, 32 0 M0 32 C1.29 11.72, 11.59 0.81, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(71.58189392089844 128.2421875) rotate(0 22.339981079101562 12.5)"><text x="22.339981079101562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(246.1484375 41.53125) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C72.56 -0.55, 113.81 0.17, 142.62 0 M32 0 C70.98 0.22, 109.12 0.48, 142.62 0 M142.62 0 C165.4 1.67, 175.29 12.29, 174.62 32 M142.62 0 C162.26 1.93, 176.67 11.47, 174.62 32 M174.62 32 C175.74 79.26, 174.21 127.81, 174.62 170.18 M174.62 32 C173.67 68.79, 174.15 102.77, 174.62 170.18 M174.62 170.18 C176.06 190.9, 164.51 200.73, 142.62 202.18 M174.62 170.18 C176.49 192.41, 163.8 200.99, 142.62 202.18 M142.62 202.18 C106.66 203.12, 70.76 204.09, 32 202.18 M142.62 202.18 C110.84 202.42, 80.24 202.37, 32 202.18 M32 202.18 C10.48 203.64, 1.85 189.68, 0 170.18 M32 202.18 C9.3 202.27, 1.95 192.34, 0 170.18 M0 170.18 C-0.43 116.85, 0.22 65.81, 0 32 M0 170.18 C1.56 133.98, 1.61 99.04, 0 32 M0 32 C1.12 11.58, 11.47 0.71, 32 0 M0 32 C-0.97 10.55, 8.77 -0.86, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(266.70902252197266 130.123046875) rotate(0 66.74996185302734 12.5)"><text x="66.74996185302734" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(549.6015625 44.3828125) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C75.39 -0.62, 114.85 0.89, 203.29 0 M32 0 C69.54 1.86, 105.97 1.84, 203.29 0 M203.29 0 C223.15 1.68, 237.07 11.36, 235.29 32 M203.29 0 C225.78 1.25, 236.36 11.09, 235.29 32 M235.29 32 C233.72 62.75, 232.62 95.42, 235.29 163.26 M235.29 32 C236.42 83.44, 235.98 134.77, 235.29 163.26 M235.29 163.26 C236.92 185.37, 224.48 194.22, 203.29 195.26 M235.29 163.26 C235.72 186.17, 225.3 194.45, 203.29 195.26 M203.29 195.26 C146.3 196.7, 90.35 195.12, 32 195.26 M203.29 195.26 C150.23 196.07, 98.29 194.42, 32 195.26 M32 195.26 C9.47 195.34, 1.7 185.31, 0 163.26 M32 195.26 C12.48 196.25, -0.08 184.79, 0 163.26 M0 163.26 C-1.41 129.11, 0.62 98.75, 0 32 M0 163.26 C-0.56 134.99, -0.72 106.16, 0 32 M0 32 C-0.85 10.56, 9.02 -0.74, 32 0 M0 32 C-1.42 9.16, 12.18 0.99, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(565.956169128418 117.013671875) rotate(0 101.28992462158203 25)"><text x="101.28992462158203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="101.28992462158203" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(846.6640625 10) rotate(0 137.23242187499994 134.5)"><path d="M121.88 1.27 C135.87 -2.71, 152.46 -0.87, 166.98 2.29 C181.5 5.45, 196.36 12.52, 209 20.25 C221.64 27.98, 233.33 37.58, 242.81 48.67 C252.3 59.76, 260.61 73.39, 265.91 86.8 C271.2 100.21, 274.22 114.76, 274.56 129.15 C274.9 143.53, 272.37 159.19, 267.95 173.12 C263.53 187.05, 256.81 200.86, 248.05 212.72 C239.29 224.57, 227.29 235.71, 215.37 244.24 C203.46 252.78, 190.83 259.72, 176.57 263.94 C162.32 268.16, 144.89 270.26, 129.85 269.57 C114.8 268.88, 100.07 265.14, 86.3 259.79 C72.53 254.44, 58.37 246.98, 47.21 237.45 C36.05 227.92, 26.82 215.26, 19.33 202.61 C11.83 189.96, 5.15 175.73, 2.24 161.53 C-0.67 147.32, -0.11 131.8, 1.84 117.39 C3.79 102.97, 7.57 87.99, 13.94 75.04 C20.31 62.08, 29.49 49.92, 40.08 39.64 C50.67 29.36, 63.39 20, 77.48 13.37 C91.57 6.74, 116.15 1.61, 124.6 -0.17 C133.05 -1.95, 127.98 0.34, 128.18 2.68 M185.31 8.91 C199.24 12.18, 214.7 22.35, 226.45 31.78 C238.2 41.21, 248.33 53.08, 255.8 65.47 C263.27 77.85, 268.45 91.86, 271.29 106.08 C274.12 120.3, 274.49 136.47, 272.81 150.79 C271.13 165.12, 267.66 178.88, 261.22 192.05 C254.77 205.21, 244.41 219.51, 234.14 229.79 C223.87 240.06, 212.54 247.44, 199.59 253.69 C186.65 259.94, 171.25 265.07, 156.46 267.29 C141.68 269.51, 125.55 269.72, 110.87 267.02 C96.2 264.31, 81.5 258.55, 68.44 251.06 C55.38 243.57, 42.5 233.3, 32.52 222.08 C22.53 210.86, 14.06 197.4, 8.51 183.73 C2.96 170.06, -0.41 154.38, -0.76 140.04 C-1.11 125.7, 1.89 111.66, 6.41 97.69 C10.93 83.73, 17.79 68.31, 26.36 56.25 C34.92 44.19, 45.87 33.73, 57.8 25.34 C69.73 16.95, 83.98 9.87, 97.93 5.91 C111.88 1.94, 126.8 1.03, 141.51 1.55 C156.21 2.08, 178.79 7.63, 186.16 9.06 C193.52 10.48, 186.4 8.09, 185.69 10.1" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(913.6585494672648 119.39413793040936) rotate(0 70.19995880126953 25)"><text x="70.19995880126953" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="70.19995880126953" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Metadata DB</text></g><g stroke-linecap="round"><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M0.87 1 C11.03 1.07, 50.95 -0.09, 60.7 -0.31 M-0.13 0.48 C9.93 0.29, 49.64 -1.49, 59.97 -1.92" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M32.24 9.54 C41.64 6.85, 49.26 1.54, 59.97 -1.92 M32.24 9.54 C43.28 5.59, 53.89 0.83, 59.97 -1.92" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M31.36 -10.96 C40.88 -8, 48.74 -7.64, 59.97 -1.92 M31.36 -10.96 C42.92 -7.05, 53.87 -3.93, 59.97 -1.92" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(425.6328125 146.811870552644) rotate(0 58.87109375 -2.7621410970089073)"><path d="M0.4 0.98 C19.73 0.06, 97.12 -3.51, 116.86 -4.52 M-0.85 0.44 C18.78 -0.27, 99.2 -4.83, 119.11 -6.11" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.811870552644) rotate(0 58.87109375 -2.7621410970089073)"><path d="M91.58 5.8 C103.36 -0.2, 113.66 -1.38, 119.11 -6.11 M91.58 5.8 C101.2 1.85, 109.38 -2.9, 119.11 -6.11" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.811870552644) rotate(0 58.87109375 -2.7621410970089073)"><path d="M90.36 -14.68 C102.76 -13.06, 113.52 -6.61, 119.11 -6.11 M90.36 -14.68 C100.49 -11.78, 109.08 -9.68, 119.11 -6.11" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(432.4765625 94.89453125) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M0.49 0.19 C8.35 0.46, 39.05 1.77, 46.76 2.05 M0.08 -0.19 C7.93 0.16, 38.73 0.79, 46.47 1.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M24.34 8.38 C29.67 7.17, 34.87 5.51, 46.47 1.24 M24.34 8.38 C31.16 5.97, 38.17 3.42, 46.47 1.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625 126.2890625) rotate(0 23.2421875 0.875)"><path d="M24.92 -7.52 C30.19 -5.13, 35.26 -3.18, 46.47 1.24 M24.92 -7.52 C31.51 -4.87, 38.34 -2.36, 46.47 1.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1143.44921875 96.13671875) rotate(0 46.15995788574219 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text></g><g stroke-linecap="round" transform="translate(528.80859375 317.91015625) rotate(0 128.2890625 85.94921875)"><path d="M32 0 C99.83 -2.04, 165.77 -1.9, 224.58 0 M32 0 C81.78 2.78, 132.22 0.91, 224.58 0 M224.58 0 C247.35 -0.62, 257.13 9.21, 256.58 32 M224.58 0 C247.78 0.89, 256.42 9.47, 256.58 32 M256.58 32 C256.61 66.99, 255.96 102.35, 256.58 139.9 M256.58 32 C255.88 62.36, 256.31 92.59, 256.58 139.9 M256.58 139.9 C256.39 162.69, 247.76 170.06, 224.58 171.9 M256.58 139.9 C255.21 161.32, 247.87 172.72, 224.58 171.9 M224.58 171.9 C151.76 170.87, 79.43 172.19, 32 171.9 M224.58 171.9 C176.06 172.2, 126.8 172.64, 32 171.9 M32 171.9 C11.79 172.81, 0.81 161.94, 0 139.9 M32 171.9 C9.69 171.78, -1.9 160.38, 0 139.9 M0 139.9 C1.57 116.03, -0.46 89.96, 0 32 M0 139.9 C-0.85 110.37, -0.6 79.01, 0 32 M0 32 C0.63 8.98, 11.45 -0.4, 32 0 M0 32 C-0.88 9.96, 11.51 0.37, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(572.177734375 391.359375) rotate(0 84.919921875 12.5)"><text x="84.919921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Service</text></g><g stroke-linecap="round"><g transform="translate(416.265625 239.2109375) rotate(0 53.0859375 38.96366035566837)"><path d="M-0.6 -0.49 C17.09 12.43, 87.73 63.53, 105.49 76.78 M1.28 -1.79 C19.43 11.29, 90.54 64.54, 107.85 77.72" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.265625 239.2109375) rotate(0 53.0859375 38.96366035566837)"><path d="M79.16 68.94 C85.26 70.09, 91.13 73.01, 107.85 77.72 M79.16 68.94 C91.21 72.36, 102.08 75.4, 107.85 77.72" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.265625 239.2109375) rotate(0 53.0859375 38.96366035566837)"><path d="M91.51 52.56 C94.52 57.62, 97.39 64.52, 107.85 77.72 M91.51 52.56 C98.75 62.32, 104.75 71.82, 107.85 77.72" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(365.76953125 282.12109375) rotate(0 49.989952087402344 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket</text></g><g stroke-linecap="round" transform="translate(856.6640625 297.08984375) rotate(0 114.958984375 106.5625)"><path d="M132.61 1.59 C145.91 1.87, 159.91 8.86, 172 15.25 C184.08 21.64, 196.44 30.01, 205.12 39.93 C213.8 49.84, 219.88 62.44, 224.09 74.74 C228.3 87.04, 231.23 100.9, 230.36 113.73 C229.5 126.55, 224.95 139.96, 218.9 151.69 C212.85 163.41, 204.01 175.21, 194.07 184.07 C184.13 192.93, 171.9 200.15, 159.27 204.86 C146.64 209.57, 132.09 212.03, 118.3 212.33 C104.51 212.63, 89.59 210.84, 76.53 206.65 C63.47 202.46, 50.34 195.36, 39.96 187.19 C29.58 179.02, 20.93 169.03, 14.25 157.63 C7.58 146.22, 1.69 131.51, -0.09 118.76 C-1.86 106, -0.04 93.32, 3.59 81.12 C7.22 68.92, 13.58 56.13, 21.68 45.53 C29.78 34.93, 40.65 24.8, 52.17 17.53 C63.68 10.26, 75.06 4.15, 90.77 1.92 C106.49 -0.31, 135.35 2.9, 146.47 4.15 C157.58 5.41, 157.95 7.65, 157.46 9.46 M70.42 9.34 C81.69 3.18, 97.82 1.19, 111.4 0.6 C124.99 0.01, 139.17 1.77, 151.95 5.79 C164.72 9.81, 177.53 16.56, 188.05 24.71 C198.56 32.85, 208.03 43.19, 215.02 54.66 C222 66.13, 227.8 80.8, 229.95 93.54 C232.11 106.29, 231.26 118.81, 227.97 131.12 C224.69 143.43, 218.29 156.74, 210.26 167.4 C202.22 178.07, 191.52 187.68, 179.77 195.11 C168.02 202.55, 153.39 209.17, 139.74 212.01 C126.1 214.85, 111.43 214.51, 97.89 212.15 C84.35 209.79, 70.41 204.31, 58.49 197.87 C46.57 191.43, 35.29 183.33, 26.38 173.51 C17.47 163.69, 9.3 151.07, 5.03 138.95 C0.75 126.84, 0.07 113.54, 0.73 100.82 C1.39 88.09, 3.41 74.46, 9 62.6 C14.59 50.74, 23.96 38.72, 34.27 29.66 C44.58 20.6, 64.76 11.66, 70.85 8.25 C76.95 4.83, 70.55 7.38, 70.85 9.18" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(919.7248222605293 366.30127737980854) rotate(0 52.109947204589844 37.5)"><text x="52.109947204589844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="52.109947204589844" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="52.109947204589844" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(790.1796875 404.13671875) rotate(0 30.513671875 -1.1328125)"><path d="M0.86 -0.37 C11.02 -0.71, 51.17 -2.9, 61.36 -3.14 M-0.15 -1.61 C9.85 -1.73, 50.27 -1.68, 60.58 -2.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.1796875 404.13671875) rotate(0 30.513671875 -1.1328125)"><path d="M32.56 8.63 C41.32 5.44, 49.77 2.97, 60.58 -2.06 M32.56 8.63 C42.24 5.84, 51.85 1.18, 60.58 -2.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.1796875 404.13671875) rotate(0 30.513671875 -1.1328125)"><path d="M32.24 -11.89 C40.92 -8.28, 49.48 -3.95, 60.58 -2.06 M32.24 -11.89 C42.02 -7.73, 51.73 -5.44, 60.58 -2.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(112.21484375 256.015625) rotate(0 201.03125 108.576171875)"><path d="M0.33 -0.87 C19 35.46, 45.95 191, 112.9 217.62 C179.84 244.24, 353.75 168.4, 401.98 158.85" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(112.21484375 256.015625) rotate(0 201.03125 108.576171875)"><path d="M378.07 176.97 C385.56 171.8, 396.68 163.29, 401.98 158.85" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(112.21484375 256.015625) rotate(0 201.03125 108.576171875)"><path d="M372.02 157.36 C381.69 159.46, 395.06 158.25, 401.98 158.85" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(158.73046875 506.36328125) rotate(0 83.86992645263672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write Just Edits</text></g><g stroke-linecap="round"><g transform="translate(633.0725529208003 499.3828125) rotate(0 35.84644563870097 32.92556599300451)"><path d="M-0.08 -0.62 C5.4 11.33, 21.84 73.04, 33.86 72.16 C45.88 71.28, 65.68 7.16, 72.05 -5.91 M-1.59 1.66 C3.67 13.24, 20.85 71.55, 33.03 70.47 C45.2 69.39, 64.89 7.86, 71.47 -4.82" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(633.0725529208003 499.3828125) rotate(0 35.84644563870097 32.92556599300451)"><path d="M70.24 25.16 C69.55 14.1, 72.43 2.88, 71.47 -4.82 M70.24 25.16 C71.26 17.04, 70.84 9.44, 71.47 -4.82" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(633.0725529208003 499.3828125) rotate(0 35.84644563870097 32.92556599300451)"><path d="M51.26 17.35 C57.84 9.28, 67.96 1.04, 71.47 -4.82 M51.26 17.35 C57.33 11.43, 61.92 5.89, 71.47 -4.82" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(591.421875 586.41015625) rotate(0 72.75993347167969 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Ops</text></g><g transform="translate(1118.4401262370484 349.07222846048717) rotate(0 65.18994903564453 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentId</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  data</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Document Service with Operational Transformation</span></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For our new <span class="MuiBox-root mui-1vu004u">Document Operations DB</span>, we want to use something that we can write very quickly in an append-only fashion (for now). Cassandra should do the trick. We'll partition by <span class="MuiBox-root mui-1vu004u">documentId</span> and order by timestamp (which will be set by our document service). Once the edit has been successfully recorded in the database, we can acknowledge/confirm it to the user. We satisfied our durability requirement!</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="3-users-should-be-able-to-view-each-others-changes-in-real-time">3) Users should be able to view each other's changes in real-time.</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Ok, now that we have a write path let's talk about the most important remaining component: reads! We need to handle two paths:</div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">First, when a document is just created or hasn't been viewed in a while, we need to be able to load the document from our database and transfer it to the connected editors.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Next, when another editor makes an edit, we need to get notified so that our document stays up-to-date.</div></li>
</ul><h4 class="MuiTypography-root MuiTypography-h5 mui-1jefea8" id="when-the-document-is-loaded">When the Document is Loaded</h4><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a user first connects, they need to get the latest version of the document. In this case when the Websocket connection is initially established for the document we can push to the connection all of the previous operations that have been applied. Since everyone is connecting to the same server, this allows us to assume that all connections are starting from the same place.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1289.7892072521038 679.19921875">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1289.7892072521038" height="679.19921875" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 32.67578125) rotate(0 83.921875 108.06640625)"><path d="M32 0 C62.39 -1.44, 93.6 -1.81, 135.84 0 M32 0 C61.45 -0.68, 92.1 0.01, 135.84 0 M135.84 0 C158.93 0.29, 169.08 9.17, 167.84 32 M135.84 0 C155.02 0.91, 166.65 10.79, 167.84 32 M167.84 32 C166.5 83.86, 169.9 132.49, 167.84 184.13 M167.84 32 C167.05 86.91, 167.79 140.92, 167.84 184.13 M167.84 184.13 C169.45 205.46, 158.78 216.28, 135.84 216.13 M167.84 184.13 C166.57 204.39, 156.36 216.26, 135.84 216.13 M135.84 216.13 C111.52 215.48, 91.04 215.5, 32 216.13 M135.84 216.13 C112.03 214.56, 86.72 214.87, 32 216.13 M32 216.13 C10.16 216.72, 0.31 206.94, 0 184.13 M32 216.13 C12.47 217.42, 0.24 204.82, 0 184.13 M0 184.13 C0.6 150.42, 1.3 114.01, 0 32 M0 184.13 C1.07 147.46, -0.19 111.73, 0 32 M0 32 C1.17 10.08, 10.71 -0.9, 32 0 M0 32 C0.44 8.63, 8.52 -0.73, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(75.0400390625 128.2421875) rotate(0 18.8818359375 12.5)"><text x="18.8818359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(246.1484375 41.53125) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C57.88 1.31, 85.07 0, 142.62 0 M32 0 C63.36 -0.34, 93.58 -1.24, 142.62 0 M142.62 0 C162.08 0.79, 173.58 10.77, 174.62 32 M142.62 0 C164.6 0.17, 175.64 9, 174.62 32 M174.62 32 C177.08 86.86, 174.12 140.75, 174.62 170.18 M174.62 32 C175.54 84.12, 175.54 136.32, 174.62 170.18 M174.62 170.18 C173.52 190.58, 163.24 202.29, 142.62 202.18 M174.62 170.18 C172.87 191.28, 165.05 200.94, 142.62 202.18 M142.62 202.18 C114.54 202.67, 87.51 203.48, 32 202.18 M142.62 202.18 C118.57 201.89, 95.17 202.33, 32 202.18 M32 202.18 C12.24 203.3, 0.21 190.95, 0 170.18 M32 202.18 C9.16 202.03, -0.13 192.08, 0 170.18 M0 170.18 C-2.09 114.26, 1.11 60.94, 0 32 M0 170.18 C1.88 137.29, 1.32 104.55, 0 32 M0 32 C0.38 8.89, 8.8 -0.63, 32 0 M0 32 C-1.84 9.54, 8.72 -1.49, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(279.30859375 130.123046875) rotate(0 54.150390625 12.5)"><text x="54.150390625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(549.6015625000002 44.3828125) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C86.33 1.35, 142.52 2.53, 203.29 0 M32 0 C84.93 1.68, 139.22 1.34, 203.29 0 M203.29 0 C225.18 0.15, 236.18 9.21, 235.29 32 M203.29 0 C226.88 2.23, 236.1 11.95, 235.29 32 M235.29 32 C235.63 70.39, 235.35 110.05, 235.29 163.26 M235.29 32 C235.79 70.85, 235.98 110.7, 235.29 163.26 M235.29 163.26 C233.76 184.39, 225.57 194.18, 203.29 195.26 M235.29 163.26 C233.97 186.51, 223.33 193.85, 203.29 195.26 M203.29 195.26 C140.74 197.76, 80.51 196.4, 32 195.26 M203.29 195.26 C147.69 197.08, 90.63 196.24, 32 195.26 M32 195.26 C9.36 195.12, -0.12 185.09, 0 163.26 M32 195.26 C12.91 196.63, 1.39 183.14, 0 163.26 M0 163.26 C-2.55 128.43, -1.93 98.53, 0 32 M0 163.26 C0.16 126.87, -0.96 91.95, 0 32 M0 32 C-1.6 9.69, 8.98 -1.29, 32 0 M0 32 C2.2 10.77, 9.57 0.14, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(585.8886718750002 117.013671875) rotate(0 81.357421875 25)"><text x="81.357421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="81.357421875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(846.6640625000002 10) rotate(0 137.23242187499994 134.5)"><path d="M179.26 5.82 C193.49 8.2, 207.25 17.97, 219.12 26.81 C230.99 35.65, 242.21 46.75, 250.48 58.87 C258.75 70.99, 264.63 85.53, 268.75 99.54 C272.87 113.56, 275.86 128.59, 275.18 142.94 C274.51 157.3, 270.65 172.37, 264.67 185.66 C258.7 198.95, 249.12 211.73, 239.34 222.68 C229.57 233.64, 218.66 243.94, 206.02 251.4 C193.38 258.86, 178.21 264.6, 163.49 267.44 C148.77 270.28, 132.48 270.73, 117.69 268.43 C102.89 266.13, 88.01 260.48, 74.72 253.65 C61.42 246.81, 48.22 237.96, 37.91 227.44 C27.61 216.92, 19.09 203.58, 12.88 190.52 C6.67 177.46, 2.31 163.54, 0.66 149.09 C-1 134.65, -0.54 118.21, 2.93 103.85 C6.41 89.49, 13.69 75.1, 21.52 62.92 C29.35 50.75, 38.66 39.74, 49.92 30.8 C61.17 21.85, 75.17 14.32, 89.07 9.26 C102.96 4.21, 116.32 0.22, 133.3 0.46 C150.28 0.7, 179.41 7.57, 190.95 10.7 C202.5 13.84, 203.24 17.04, 202.55 19.28 M174.21 5.14 C188.33 7.06, 203.29 16.18, 215.87 24.7 C228.44 33.21, 240.75 44.69, 249.65 56.25 C258.56 67.8, 265.31 80, 269.31 94 C273.31 108.01, 274.21 125.73, 273.66 140.28 C273.11 154.83, 271.39 168, 266.01 181.29 C260.62 194.57, 250.78 208.71, 241.35 219.99 C231.92 231.27, 221.88 241.43, 209.43 248.97 C196.98 256.5, 181.26 262.24, 166.65 265.21 C152.04 268.18, 136.78 268.42, 121.79 266.78 C106.79 265.15, 90.34 261.57, 76.69 255.39 C63.04 249.22, 50.46 240.02, 39.88 229.73 C29.3 219.45, 19.44 206.58, 13.23 193.7 C7.02 180.81, 4.53 166.67, 2.65 152.42 C0.77 138.17, -0.75 122.7, 1.95 108.19 C4.65 93.67, 11.32 78.02, 18.85 65.32 C26.38 52.61, 35.77 41.18, 47.12 31.95 C58.47 22.72, 73.24 15.3, 86.97 9.93 C100.69 4.56, 114.93 0.46, 129.49 -0.28 C144.05 -1.01, 166.61 3.98, 174.33 5.52 C182.04 7.05, 176.45 7.06, 175.78 8.94" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(900.0010863935346 119.39413793040936) rotate(0 83.857421875 25)"><text x="83.857421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata </text><text x="83.857421875" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M-1.12 0.47 C8.7 0.42, 49.38 -0.94, 59.68 -1.22 M0.49 -0.32 C10.64 -0.09, 52.14 0.27, 62.06 0.35" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M33.78 10.37 C44.88 5.97, 54.42 3.94, 62.06 0.35 M33.78 10.37 C43.42 8.46, 51.49 4.97, 62.06 0.35" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(178.38671875 132.94921875) rotate(0 30.150390625 -0.6415438895845682)"><path d="M33.96 -10.16 C44.84 -7.13, 54.31 -1.74, 62.06 0.35 M33.96 -10.16 C43.63 -5.75, 51.65 -2.93, 62.06 0.35" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(425.6328125 146.811870552644) rotate(0 58.87109375 -2.7621410970089073)"><path d="M-0.62 0.06 C19.24 -0.92, 98.26 -4.36, 118.08 -5.43 M1.25 -0.95 C21.09 -1.76, 97.88 -3.09, 117.31 -3.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.811870552644) rotate(0 58.87109375 -2.7621410970089073)"><path d="M89.4 7.17 C95.22 5.6, 101.02 3.66, 117.31 -3.85 M89.4 7.17 C95.99 4.95, 101.89 0.97, 117.31 -3.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(425.6328125 146.811870552644) rotate(0 58.87109375 -2.7621410970089073)"><path d="M88.85 -13.34 C94.86 -10.68, 100.78 -8.39, 117.31 -3.85 M88.85 -13.34 C95.76 -10.9, 101.79 -10.22, 117.31 -3.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(432.4765625 94.89453125) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(790.2265625000002 126.2890625) rotate(0 23.2421875 0.875)"><path d="M0.24 -0.4 C8.06 -0.03, 39.29 1.87, 47.03 2.28 M-0.29 0.58 C7.48 0.82, 39.08 1.5, 46.87 1.59" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625000002 126.2890625) rotate(0 23.2421875 0.875)"><path d="M24.88 9.16 C31.36 7.61, 40.27 4.5, 46.87 1.59 M24.88 9.16 C32.38 6.95, 40.58 4.19, 46.87 1.59" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(790.2265625000002 126.2890625) rotate(0 23.2421875 0.875)"><path d="M25.16 -6.75 C31.56 -3.08, 40.37 -0.97, 46.87 1.59 M25.16 -6.75 C32.55 -3.3, 40.65 -0.4, 46.87 1.59" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1143.4492187500002 96.13671875) rotate(0 46.15995788574219 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text></g><g stroke-linecap="round" transform="translate(515.9062500000002 375.69921875) rotate(0 128.2890625 85.94921875)"><path d="M32 0 C109.82 -0.86, 183.57 -2.01, 224.58 0 M32 0 C105.45 -1.23, 178.09 -1.15, 224.58 0 M224.58 0 C244.81 -0.94, 255.86 10.77, 256.58 32 M224.58 0 C244.16 -0.24, 257.67 9.42, 256.58 32 M256.58 32 C256.25 59.3, 256.08 86.31, 256.58 139.9 M256.58 32 C256.79 55.51, 257.19 79.17, 256.58 139.9 M256.58 139.9 C258.15 162.35, 246.12 171.34, 224.58 171.9 M256.58 139.9 C255.07 161.07, 245.78 172.46, 224.58 171.9 M224.58 171.9 C146.75 172.09, 73.37 173.71, 32 171.9 M224.58 171.9 C179.74 170.96, 133.75 170.81, 32 171.9 M32 171.9 C11.05 170.13, -1.87 160.6, 0 139.9 M32 171.9 C8.82 170.77, -1.94 159.74, 0 139.9 M0 139.9 C0.07 97.39, -1.9 53.88, 0 32 M0 139.9 C-1.11 112.32, -1.14 85.52, 0 32 M0 32 C1.8 12.14, 9.23 -1.85, 32 0 M0 32 C0.89 8.41, 10.31 0.25, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(570.0546875000002 449.1484375) rotate(0 74.140625 12.5)"><text x="74.140625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Service</text></g><g stroke-linecap="round"><g transform="translate(416.265625 239.2109375) rotate(0 62.515924629730534 65.05859375)"><path d="M-0.79 0.93 C20.08 22.92, 104 109.35, 125.13 130.88 M0.99 0.37 C21.72 22.12, 103.45 107.31, 124.24 129.16" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.265625 239.2109375) rotate(0 62.515924629730534 65.05859375)"><path d="M97.34 115.87 C106.59 120.08, 114.15 125.4, 124.24 129.16 M97.34 115.87 C104.95 119.36, 113.21 123.86, 124.24 129.16" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(416.265625 239.2109375) rotate(0 62.515924629730534 65.05859375)"><path d="M112.17 101.69 C116.98 109.93, 120.22 119.37, 124.24 129.16 M112.17 101.69 C115.46 109.44, 119.27 118.19, 124.24 129.16" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(334.625 298.07421875) rotate(0 49.989952087402344 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket</text></g><g stroke-linecap="round" transform="translate(891.5429687500002 342.34375) rotate(0 114.958984375 106.5625)"><path d="M159.3 8.07 C172.1 11.26, 185.04 20.23, 195.04 29.3 C205.04 38.37, 213.61 50.81, 219.29 62.5 C224.98 74.19, 228.15 86.8, 229.16 99.43 C230.17 112.07, 229.55 125.89, 225.34 138.31 C221.13 150.72, 212.84 163.67, 203.91 173.92 C194.97 184.17, 183.76 193.41, 171.74 199.81 C159.71 206.2, 145.39 210.53, 131.74 212.29 C118.09 214.06, 103.17 213.2, 89.83 210.4 C76.5 207.61, 63.08 202.46, 51.75 195.55 C40.42 188.63, 29.82 179.4, 21.87 168.92 C13.91 158.43, 7.58 145.34, 4.03 132.66 C0.49 119.97, -1.01 105.57, 0.59 92.81 C2.19 80.05, 6.97 67.12, 13.61 56.09 C20.25 45.06, 29.79 34.85, 40.41 26.61 C51.03 18.38, 64.44 11.17, 77.35 6.66 C90.26 2.15, 102.32 -1.52, 117.87 -0.44 C133.42 0.65, 160.78 9.94, 170.67 13.18 C180.56 16.41, 178.34 17.37, 177.21 18.98 M98.33 -0.17 C110.83 -3.57, 125.6 -0.78, 138.86 2.14 C152.11 5.06, 166.34 10.3, 177.86 17.37 C189.37 24.44, 199.57 33.92, 207.93 44.57 C216.3 55.22, 224.67 68.64, 228.06 81.28 C231.44 93.92, 230.24 107.93, 228.24 120.41 C226.24 132.89, 222.62 145.04, 216.04 156.18 C209.45 167.31, 199.2 178.65, 188.74 187.21 C178.27 195.78, 166.41 203.33, 153.27 207.57 C140.12 211.8, 123.98 213.08, 109.88 212.6 C95.77 212.13, 80.98 209.52, 68.62 204.7 C56.27 199.89, 45.68 192.97, 35.76 183.7 C25.85 174.44, 14.98 161.22, 9.15 149.1 C3.31 136.98, 1.38 123.54, 0.76 110.98 C0.13 98.43, 1.07 85.96, 5.4 73.79 C9.72 61.61, 17.87 47.99, 26.69 37.95 C35.51 27.91, 46.35 19.71, 58.33 13.56 C70.3 7.41, 91.76 2.85, 98.56 1.05 C105.37 -0.75, 98.7 0.87, 99.13 2.75" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(962.5584022776194 411.55518362980854) rotate(0 44.1552734375 37.5)"><text x="44.1552734375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="44.1552734375" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="44.1552734375" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(783.5390625000002 428.74345841988725) rotate(0 52.173828125 -1.3912604599437373)"><path d="M-0.66 -0.56 C16.5 -1.03, 86.57 -2.33, 103.92 -2.72 M1.19 1.76 C18.07 1.49, 85.3 -0.58, 102.75 -1.15" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(783.5390625000002 428.74345841988725) rotate(0 52.173828125 -1.3912604599437373)"><path d="M74.89 9.99 C84.53 5.2, 96.17 0.15, 102.75 -1.15 M74.89 9.99 C82.34 7.75, 90.42 3.07, 102.75 -1.15" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(783.5390625000002 428.74345841988725) rotate(0 52.173828125 -1.3912604599437373)"><path d="M74.25 -10.52 C84.15 -7.51, 96.03 -4.76, 102.75 -1.15 M74.25 -10.52 C81.98 -6.82, 90.25 -5.55, 102.75 -1.15" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(112.21484375 256.015625) rotate(0 194.580078125 108.576171875)"><path d="M-0.43 0.06 C18.18 36.33, 45.98 183.77, 111 217.03 C176.03 250.28, 343.48 202.22, 389.73 199.59" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(112.21484375 256.015625) rotate(0 194.580078125 108.576171875)"><path d="M363.57 214.28 C370.15 209.25, 376.24 208.13, 389.73 199.59" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(112.21484375 256.015625) rotate(0 194.580078125 108.576171875)"><path d="M360.25 194.03 C367.55 193.97, 374.45 197.81, 389.73 199.59" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(158.73046875 506.36328125) rotate(0 83.86992645263672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write Just Edits</text></g><g stroke-linecap="round"><g transform="translate(620.1702091708005 557.171875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M0.57 -0.65 C6.21 11.43, 21.21 73.27, 32.95 72.34 C44.69 71.41, 64.45 6.89, 71.02 -6.22 M-0.59 1.62 C5.53 13.39, 23.55 71.9, 35.3 70.74 C47.05 69.59, 63.62 7.44, 69.9 -5.29" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(620.1702091708005 557.171875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M69.81 24.71 C68.77 16.85, 71.55 10.16, 69.9 -5.29 M69.81 24.71 C70.62 16.7, 70.11 9.86, 69.9 -5.29" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(620.1702091708005 557.171875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M50.54 17.63 C53.82 11.26, 60.9 6.15, 69.9 -5.29 M50.54 17.63 C56 11.45, 60.08 6.29, 69.9 -5.29" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(578.5195312500002 644.19921875) rotate(0 72.75993347167969 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Ops</text></g><g transform="translate(778.4453125000002 378.00390625) rotate(0 55.01994323730469 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Applied Ops</text></g><g stroke-linecap="round"><g transform="translate(906.9804687500002 511.80859375) rotate(0 -63.373046875 -1.091796875)"><path d="M0.66 -0.84 C-20.16 -1.25, -104.44 -2.87, -125.59 -3.2 M-0.45 1.33 C-21.27 1.1, -104.89 -1.67, -125.94 -2.2" stroke="#1e1e1e" stroke-width="4" fill="none"></path></g><g transform="translate(906.9804687500002 511.80859375) rotate(0 -63.373046875 -1.091796875)"><path d="M-97.46 -11.63 C-105.86 -7.25, -113.1 -6.01, -125.94 -2.2 M-97.46 -11.63 C-104.36 -8.48, -110.76 -6.33, -125.94 -2.2" stroke="#1e1e1e" stroke-width="4" fill="none"></path></g><g transform="translate(906.9804687500002 511.80859375) rotate(0 -63.373046875 -1.091796875)"><path d="M-98.06 8.88 C-106.19 8.26, -113.28 4.49, -125.94 -2.2 M-98.06 8.88 C-104.76 6.97, -111.01 4.05, -125.94 -2.2" stroke="#1e1e1e" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(728.8632125854494 554.54296875) rotate(0 110.61392974853516 35)"><text x="110.61392974853516" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">On Initialization</text><text x="110.61392974853516" y="35" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Read all Ops</text></g><g stroke-linecap="round"><g transform="translate(662.2187500000002 369.5390625) rotate(0 -116.486328125 -85.177734375)"><path d="M0.51 -0.64 C-6.1 -14.84, 0.32 -58.08, -38.57 -86.22 C-77.45 -114.36, -200.54 -155.56, -232.79 -169.47" stroke="#1e1e1e" stroke-width="4.5" fill="none" stroke-dasharray="8 12"></path></g><g transform="translate(662.2187500000002 369.5390625) rotate(0 -116.486328125 -85.177734375)"><path d="M-202.79 -168.92 C-215.73 -169.51, -225.96 -168.92, -232.79 -169.47" stroke="#1e1e1e" stroke-width="4.5" fill="none"></path></g><g transform="translate(662.2187500000002 369.5390625) rotate(0 -116.486328125 -85.177734375)"><path d="M-210.17 -149.77 C-220.02 -157.98, -227.33 -164.97, -232.79 -169.47" stroke="#1e1e1e" stroke-width="4.5" fill="none"></path></g></g><mask></mask><g transform="translate(647.4577941894534 261.26171875) rotate(0 113.73594665527344 35)"><text x="113.73594665527344" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Send all Applied </text><text x="113.73594665527344" y="35" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops on Connect</text></g><g transform="translate(1149.4093091808147 398.0470819983502) rotate(0 65.18994903564453 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentId</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  data</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Loading a Document</span></div></div></div></div><h4 class="MuiTypography-root MuiTypography-h5 mui-1jefea8" id="when-updates-happen">When Updates Happen</h4><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When an edit is made successfully by another collaborator, every remaining connected editor needs to receive the updates. Since all of our editors are connected to the same server, this is straightforward: after we record the operation to our database, we can also send it to all clients who are currently connected to the same document.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The next step might surprise you: On the client, we <strong>also</strong> have to perform the operational transformation. Let's talk briefly about why this is.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When users make edits to their own document, they expect to see the changes <em>immediately</em>. In some sense, their changes are always applied first to their local document and then shipped off to the server. What happens if another user lands an edit on the server <em>after</em> we've applied our local change but <em>before</em> it can be recorded to the sever?</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Our OT gives us a way of handling out of order edits. Remember that OT takes a sequence of edits in an arbitrary order and rewrites them so they consistently return the same final document. We can do the same thing here!</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">So so if User A submits <span class="MuiBox-root mui-1vu004u">Ea</span> to the server, and User B submits <span class="MuiBox-root mui-1vu004u">Eb</span> (which arrives after <span class="MuiBox-root mui-1vu004u">Ea</span>), the perceived order of operations from each site is:</div><pre><span class="MuiBox-root mui-1vu004u">Server: Ea, Eb
User A: Ea, Eb
User B: Eb, Ea
</span></pre><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Regardless of the ordering, by applying OT to the operations we can guarantee that each user sees the same document!</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1354.4101607554064 822.7821227605909">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1354.4101607554064" height="822.7821227605909" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(89.14058979422475 176.25868526059094) rotate(0 83.921875 108.06640625)"><path d="M32 0 C60.53 -1.04, 93.53 -1.83, 135.84 0 M32 0 C57.53 -1.15, 82.18 0.46, 135.84 0 M135.84 0 C156.64 -0.23, 167.53 9.26, 167.84 32 M135.84 0 C158.33 2.03, 168.97 9.72, 167.84 32 M167.84 32 C170.28 73.51, 166.69 117.89, 167.84 184.13 M167.84 32 C169.62 89.5, 168.27 146.19, 167.84 184.13 M167.84 184.13 C169.16 204.81, 156.17 216.63, 135.84 216.13 M167.84 184.13 C166.69 204.26, 155.23 217.04, 135.84 216.13 M135.84 216.13 C110.67 214.55, 87.96 216.04, 32 216.13 M135.84 216.13 C107.17 215.71, 78.16 214.76, 32 216.13 M32 216.13 C10.3 216.11, -1.6 204.13, 0 184.13 M32 216.13 C10.24 215.29, -0.97 204.99, 0 184.13 M0 184.13 C-0.03 152.77, 0.8 124.8, 0 32 M0 184.13 C0.43 137.31, 0 88.54, 0 32 M0 32 C0.81 11.6, 9.88 -1.67, 32 0 M0 32 C-1.27 9.6, 10.69 -2.01, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(150.7224837151232 271.82509151059094) rotate(0 22.339981079101562 12.5)"><text x="22.339981079101562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(325.28902729422475 185.11415401059094) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C59.12 2.92, 89.23 1.99, 142.62 0 M32 0 C55.81 -0.98, 80.01 -1.56, 142.62 0 M142.62 0 C164.96 1.76, 175.6 9.84, 174.62 32 M142.62 0 C163.62 1.14, 173.19 12.6, 174.62 32 M174.62 32 C174.8 61.7, 172.97 90.38, 174.62 170.18 M174.62 32 C174.51 79.67, 173.34 128.24, 174.62 170.18 M174.62 170.18 C173.61 190.47, 162.26 202.97, 142.62 202.18 M174.62 170.18 C173.22 190.39, 163.99 201.79, 142.62 202.18 M142.62 202.18 C117.81 201.23, 92.28 202.29, 32 202.18 M142.62 202.18 C104.55 201.59, 66.05 200.94, 32 202.18 M32 202.18 C10.3 201.45, -0.84 191.1, 0 170.18 M32 202.18 C8.38 203.38, 1.5 192.39, 0 170.18 M0 170.18 C-0.88 134.44, 0.08 99.54, 0 32 M0 170.18 C0.36 122.59, -0.44 73.23, 0 32 M0 32 C-1.11 9.74, 10.68 -1.75, 32 0 M0 32 C-2.06 12.14, 12.41 2.22, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(345.8496123161974 273.70595088559094) rotate(0 66.74996185302734 12.5)"><text x="66.74996185302734" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(628.7421522942248 187.96571651059094) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C98.81 -0.55, 170.47 -1.45, 203.29 0 M32 0 C81.93 2.08, 131.34 0.79, 203.29 0 M203.29 0 C224.33 0.99, 234.05 12.35, 235.29 32 M203.29 0 C222.45 -2.19, 234.24 12.39, 235.29 32 M235.29 32 C236.02 78.79, 235.36 129.13, 235.29 163.26 M235.29 32 C234.12 66.53, 233.78 102.5, 235.29 163.26 M235.29 163.26 C234.07 183.62, 224.65 194.92, 203.29 195.26 M235.29 163.26 C233.45 186.62, 224.5 194.73, 203.29 195.26 M203.29 195.26 C160.43 195.07, 114.82 195.03, 32 195.26 M203.29 195.26 C151.93 193.75, 100.52 193.91, 32 195.26 M32 195.26 C8.68 196.3, 1.31 185.35, 0 163.26 M32 195.26 C9.72 197.09, 2.01 184.85, 0 163.26 M0 163.26 C0.18 123.66, -2.75 84.74, 0 32 M0 163.26 C-0.04 117.32, 0.52 71.42, 0 32 M0 32 C-1.79 11.95, 12.18 1.93, 32 0 M0 32 C1.52 8.86, 12.15 -0.61, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(645.0967589226427 260.59657588559094) rotate(0 101.28992462158203 25)"><text x="101.28992462158203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="101.28992462158203" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(925.8046522942248 153.58290401059094) rotate(0 137.23242187499994 134.5)"><path d="M127.47 0.89 C141.42 -2.4, 156.86 0.68, 171.18 4.14 C185.49 7.6, 200.76 13.76, 213.36 21.65 C225.97 29.54, 237.97 39.92, 246.79 51.48 C255.61 63.04, 261.56 76.95, 266.3 91.01 C271.03 105.07, 275.15 121.06, 275.21 135.83 C275.27 150.59, 271.58 166.05, 266.64 179.59 C261.7 193.14, 254.71 205.66, 245.58 217.08 C236.45 228.51, 224.47 240.22, 211.86 248.13 C199.25 256.04, 184.32 261.24, 169.92 264.54 C155.52 267.85, 140.29 269.31, 125.46 267.98 C110.63 266.65, 94.5 262.49, 80.95 256.55 C67.4 250.62, 55.05 242.16, 44.18 232.39 C33.31 222.62, 22.82 210.8, 15.72 197.94 C8.63 185.07, 3.73 169.55, 1.59 155.17 C-0.55 140.79, 0.36 125.93, 2.87 111.64 C5.38 97.35, 9.79 82.19, 16.64 69.44 C23.49 56.7, 32.89 44.93, 43.97 35.17 C55.06 25.41, 68.24 16.78, 83.16 10.89 C98.09 5.01, 123.83 1.34, 133.54 -0.15 C143.26 -1.64, 141.43 -0.28, 141.46 1.96 M110.68 3.04 C124.43 -1.42, 143.48 -0.18, 158.32 2.02 C173.15 4.22, 186.46 9.63, 199.71 16.25 C212.96 22.88, 227.42 31.3, 237.79 41.77 C248.16 52.25, 255.8 65.79, 261.91 79.11 C268.02 92.42, 272.96 107.57, 274.46 121.65 C275.96 135.74, 274.3 149.47, 270.91 163.64 C267.51 177.81, 262.08 194.32, 254.08 206.69 C246.08 219.05, 234.69 228.94, 222.9 237.85 C211.11 246.77, 197.19 255.23, 183.33 260.2 C169.48 265.16, 154.7 267.13, 139.76 267.67 C124.82 268.21, 107.66 267.47, 93.72 263.45 C79.77 259.44, 67.58 252.67, 56.08 243.59 C44.58 234.5, 33.11 221.28, 24.73 208.94 C16.35 196.59, 9.84 183.31, 5.81 169.5 C1.78 155.7, -0.45 140.45, 0.53 126.11 C1.5 111.76, 6.13 96.69, 11.66 83.44 C17.19 70.19, 24.2 57.82, 33.71 46.61 C43.21 35.4, 55.87 23.48, 68.7 16.18 C81.52 8.87, 103.6 4.67, 110.68 2.77 C117.76 0.86, 110.7 2.66, 111.18 4.74" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(992.7991392614896 262.97704194100027) rotate(0 70.19995880126953 25)"><text x="70.19995880126953" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="70.19995880126953" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Metadata DB</text></g><g stroke-linecap="round"><g transform="translate(257.52730854422475 276.53212276059094) rotate(0 30.150390625 -0.6415438895845682)"><path d="M0.6 1.06 C10.78 0.9, 50.97 -1.49, 60.89 -1.78 M-0.54 0.57 C9.55 0.65, 50.28 0.05, 60.25 -0.5" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(257.52730854422475 276.53212276059094) rotate(0 30.150390625 -0.6415438895845682)"><path d="M32.39 10.63 C42.16 8.3, 47.49 3.86, 60.25 -0.5 M32.39 10.63 C41.25 5.55, 51.48 3.36, 60.25 -0.5" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(257.52730854422475 276.53212276059094) rotate(0 30.150390625 -0.6415438895845682)"><path d="M31.75 -9.88 C41.55 -6.38, 47.07 -4.98, 60.25 -0.5 M31.75 -9.88 C40.71 -7.79, 51.16 -2.81, 60.25 -0.5" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(504.77340229422475 290.39477456323584) rotate(0 58.87109375 -2.7621410970089073)"><path d="M0.59 -0.5 C20.08 -1.49, 98.16 -4.26, 117.57 -4.93 M-0.56 -1.8 C18.7 -2.63, 96.51 -5.98, 116.52 -6.74" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(504.77340229422475 290.39477456323584) rotate(0 58.87109375 -2.7621410970089073)"><path d="M88.77 4.66 C97.57 0.24, 109.11 -4.7, 116.52 -6.74 M88.77 4.66 C99.09 1.29, 110.86 -4, 116.52 -6.74" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(504.77340229422475 290.39477456323584) rotate(0 58.87109375 -2.7621410970089073)"><path d="M87.94 -15.84 C97.21 -13.09, 109.04 -10.85, 116.52 -6.74 M87.94 -15.84 C98.38 -11.32, 110.47 -8.74, 116.52 -6.74" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(511.61715229422475 238.47743526059094) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(869.3671522942248 269.87196651059094) rotate(0 23.2421875 0.875)"><path d="M-0.34 0.46 C7.33 0.62, 38.2 0.94, 45.96 1.23 M0.48 0.23 C8.33 0.41, 39.39 1.48, 46.93 1.66" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(869.3671522942248 269.87196651059094) rotate(0 23.2421875 0.875)"><path d="M24.85 8.96 C31.97 6, 36.48 4.4, 46.93 1.66 M24.85 8.96 C33.49 6.48, 41.1 3.57, 46.93 1.66" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(869.3671522942248 269.87196651059094) rotate(0 23.2421875 0.875)"><path d="M25.32 -6.95 C32.35 -5.37, 36.72 -2.43, 46.93 1.66 M25.32 -6.95 C33.84 -3.47, 41.27 -0.41, 46.93 1.66" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1222.5898085442248 239.71962276059094) rotate(0 46.15995788574219 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text></g><g stroke-linecap="round" transform="translate(595.0468397942248 519.2821227605909) rotate(0 128.2890625 85.94921875)"><path d="M32 0 C73.08 2.18, 110.84 2.44, 224.58 0 M32 0 C99.55 -0.61, 165.28 -0.03, 224.58 0 M224.58 0 C244.9 -1.05, 254.89 11.46, 256.58 32 M224.58 0 C244.51 -1.12, 256.61 10.27, 256.58 32 M256.58 32 C257.07 54.85, 255.89 79.66, 256.58 139.9 M256.58 32 C256.21 68.94, 255.6 105.24, 256.58 139.9 M256.58 139.9 C256.21 160.5, 245.07 171.48, 224.58 171.9 M256.58 139.9 C254.3 162.43, 247.41 172.77, 224.58 171.9 M224.58 171.9 C174.92 173.63, 126.01 174.51, 32 171.9 M224.58 171.9 C158.01 170.46, 90.24 169.16, 32 171.9 M32 171.9 C9.56 170.97, 0.02 159.49, 0 139.9 M32 171.9 C8.61 173.37, 1.75 163.46, 0 139.9 M0 139.9 C0.32 100.72, 1.19 62.35, 0 32 M0 139.9 C-0.05 101.67, -0.36 65.42, 0 32 M0 32 C-1.98 10.44, 9.22 -0.39, 32 0 M0 32 C-0.81 9.67, 9.13 0.4, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(638.4159804192248 592.7313415105909) rotate(0 84.919921875 12.5)"><text x="84.919921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Service</text></g><g stroke-linecap="round"><g transform="translate(495.40621479422475 382.79384151059094) rotate(0 62.515924629730534 65.05859375)"><path d="M0.94 0.57 C21.54 22.32, 103.55 108.77, 124.36 130.29 M-0.02 -0.18 C20.9 21.81, 105.8 110.08, 126.72 131.92" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(495.40621479422475 382.79384151059094) rotate(0 62.515924629730534 65.05859375)"><path d="M27.79 13.94 C18.96 8.15, 8.5 5.71, 0.94 0.57 M27.79 13.94 C20.19 9.91, 12.67 7.26, 0.94 0.57" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(495.40621479422475 382.79384151059094) rotate(0 62.515924629730534 65.05859375)"><path d="M12.91 28.08 C9.54 17.01, 4.51 9.41, 0.94 0.57 M12.91 28.08 C9.35 20.24, 5.81 13.81, 0.94 0.57" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(495.40621479422475 382.79384151059094) rotate(0 62.515924629730534 65.05859375)"><path d="M99.79 118.69 C110.55 122.19, 119.72 129.45, 126.72 131.92 M99.79 118.69 C106.41 121.63, 113.26 126.08, 126.72 131.92" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(495.40621479422475 382.79384151059094) rotate(0 62.515924629730534 65.05859375)"><path d="M114.6 104.48 C119.92 113.28, 123.69 125.73, 126.72 131.92 M114.6 104.48 C117.19 111.25, 120.09 119.5, 126.72 131.92" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(413.76558979422475 441.65712276059094) rotate(0 49.989952087402344 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket</text></g><g stroke-linecap="round" transform="translate(970.6835585442248 485.92665401059094) rotate(0 114.958984375 106.5625)"><path d="M85.8 2.51 C98.11 -2.14, 115.12 -1.52, 128.87 0.13 C142.62 1.78, 156.18 6.45, 168.31 12.43 C180.45 18.4, 192.39 26.31, 201.69 36 C210.98 45.69, 219.4 58.42, 224.06 70.55 C228.72 82.69, 230.29 95.97, 229.65 108.82 C229.01 121.67, 225.46 135.76, 220.24 147.65 C215.03 159.54, 207.88 170.95, 198.34 180.17 C188.81 189.38, 175.66 197.63, 163.04 202.95 C150.43 208.27, 136.47 211.23, 122.64 212.09 C108.8 212.95, 93.3 211.86, 80.03 208.1 C66.76 204.34, 53.76 197.65, 43 189.52 C32.25 181.4, 22.34 170.24, 15.5 159.35 C8.66 148.45, 4.08 136.7, 1.98 124.13 C-0.12 111.55, -0.02 96.43, 2.91 83.91 C5.85 71.4, 12.05 59.72, 19.59 49.05 C27.13 38.39, 35.66 27.74, 48.15 19.94 C60.64 12.14, 85.49 5.11, 94.53 2.26 C103.57 -0.58, 102.31 1.13, 102.4 2.86 M140.62 2.17 C153.93 3.36, 168.76 9.89, 180.08 17.43 C191.41 24.97, 200.56 36.38, 208.56 47.44 C216.55 58.49, 224.5 71.63, 228.04 83.77 C231.58 95.91, 231.74 107.87, 229.78 120.26 C227.82 132.66, 223.15 146.72, 216.28 158.16 C209.4 169.6, 199.15 180.54, 188.51 188.9 C177.86 197.27, 165.74 204.11, 152.42 208.35 C139.1 212.6, 122.78 215.31, 108.6 214.38 C94.42 213.44, 80.1 208.1, 67.35 202.75 C54.59 197.41, 41.91 191.22, 32.06 182.3 C22.21 173.39, 13.75 161.16, 8.24 149.29 C2.74 137.41, -0.51 123.93, -0.97 111.03 C-1.43 98.13, 1.06 83.96, 5.49 71.89 C9.92 59.82, 16.84 48.57, 25.63 38.62 C34.41 28.67, 45.92 18.25, 58.21 12.18 C70.49 6.1, 85.57 3.55, 99.32 2.18 C113.07 0.81, 134.01 3.38, 140.71 3.96 C147.41 4.54, 139.9 4.06, 139.52 5.63" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(1033.744318304754 555.1380876403995) rotate(0 52.109947204589844 37.5)"><text x="52.109947204589844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="52.109947204589844" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="52.109947204589844" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(862.6796522942248 572.3263624304782) rotate(0 52.173828125 -1.3912604599437373)"><path d="M-0.6 -0.63 C16.72 -1.06, 85.96 -1.85, 103.33 -2.31 M1.28 1.65 C19.02 0.83, 88.04 -3.51, 105.51 -4.18" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(862.6796522942248 572.3263624304782) rotate(0 52.173828125 -1.3912604599437373)"><path d="M77.89 7.53 C83.71 3.06, 92.45 0.6, 105.51 -4.18 M77.89 7.53 C84.03 5.52, 91.71 1.47, 105.51 -4.18" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(862.6796522942248 572.3263624304782) rotate(0 52.173828125 -1.3912604599437373)"><path d="M76.83 -12.96 C82.96 -12.32, 91.96 -9.65, 105.51 -4.18 M76.83 -12.96 C83.23 -9.83, 91.18 -8.73, 105.51 -4.18" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(191.35543354422475 399.59852901059094) rotate(0 194.580078125 108.576171875)"><path d="M-1.01 0.47 C17.62 36.67, 46.15 183.31, 111.19 216.57 C176.22 249.83, 343.01 202.58, 389.18 200.03" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(191.35543354422475 399.59852901059094) rotate(0 194.580078125 108.576171875)"><path d="M18.76 23.03 C14.73 16.02, 8.03 11.63, -1.01 0.47" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(191.35543354422475 399.59852901059094) rotate(0 194.580078125 108.576171875)"><path d="M-0.37 30.47 C0.42 21.76, -1.51 15.52, -1.01 0.47" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(191.35543354422475 399.59852901059094) rotate(0 194.580078125 108.576171875)"><path d="M362.98 214.65 C370.39 210, 375.16 207.61, 389.18 200.03" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(191.35543354422475 399.59852901059094) rotate(0 194.580078125 108.576171875)"><path d="M359.71 194.39 C367.83 194.83, 373.42 197.49, 389.18 200.03" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(237.87105854422475 649.9461852605909) rotate(0 83.86992645263672 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write Just Edits</text></g><g stroke-linecap="round"><g transform="translate(699.310798965025 700.7547790105909) rotate(0 35.84644563870097 32.92556599300451)"><path d="M0.02 -0.21 C5.59 11.96, 20.74 73.32, 32.68 72.4 C44.61 71.47, 65.22 7.38, 71.63 -5.76 M-1.43 -1.36 C4.57 10.54, 22.84 71.37, 34.89 70.83 C46.93 70.29, 64.79 8.19, 70.83 -4.59" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(699.310798965025 700.7547790105909) rotate(0 35.84644563870097 32.92556599300451)"><path d="M70.58 25.41 C70.44 16.64, 72.61 10.96, 70.83 -4.59 M70.58 25.41 C70.86 17.53, 70.69 8.27, 70.83 -4.59" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(699.310798965025 700.7547790105909) rotate(0 35.84644563870097 32.92556599300451)"><path d="M51.36 18.23 C55.78 11.17, 62.54 7.21, 70.83 -4.59 M51.36 18.23 C56.93 12.49, 62.08 5.22, 70.83 -4.59" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(657.6601210442248 787.7821227605909) rotate(0 72.75993347167969 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Ops</text></g><g transform="translate(857.5859022942248 521.5868102605909) rotate(0 55.01994323730469 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Applied Ops</text></g><g stroke-linecap="round"><g transform="translate(986.1210585442248 655.3914977605909) rotate(0 -63.373046875 -1.091796875)"><path d="M-0.54 -0.99 C-21.64 -1.22, -105.58 -1.37, -126.65 -1.67 M1.38 1.11 C-19.86 0.54, -106.01 -3.04, -127.55 -3.53" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(986.1210585442248 655.3914977605909) rotate(0 -63.373046875 -1.091796875)"><path d="M-99.03 -12.84 C-109.1 -10.07, -115.01 -7.81, -127.55 -3.53 M-99.03 -12.84 C-106.91 -11.21, -113.36 -8.6, -127.55 -3.53" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(986.1210585442248 655.3914977605909) rotate(0 -63.373046875 -1.091796875)"><path d="M-99.71 7.67 C-109.53 4.4, -115.24 0.61, -127.55 -3.53 M-99.71 7.67 C-107.38 4.22, -113.66 1.75, -127.55 -3.53" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(846.7507735100451 681.1180602605909) rotate(0 79.00993347167969 25)"><text x="79.00993347167969" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">On Initialization</text><text x="79.00993347167969" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Read all Ops</text></g><g stroke-linecap="round"><g transform="translate(741.3593397942248 513.1219665105909) rotate(0 -116.486328125 -85.177734375)"><path d="M-0.2 -0.63 C-6.63 -15.14, 0.47 -58.16, -38.48 -86.59 C-77.44 -115.01, -201.48 -157.12, -233.93 -171.16" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(741.3593397942248 513.1219665105909) rotate(0 -116.486328125 -85.177734375)"><path d="M-203.94 -170.52 C-214.23 -171.14, -222.44 -172.56, -233.93 -171.16" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(741.3593397942248 513.1219665105909) rotate(0 -116.486328125 -85.177734375)"><path d="M-211.36 -151.39 C-219.45 -157.89, -225.38 -165.2, -233.93 -171.16" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(723.2254362908068 418.14149776059094) rotate(0 81.23993682861328 25)"><text x="81.23993682861328" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Send all Applied </text><text x="81.23993682861328" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops on Connect</text></g><g transform="translate(245.86511834532644 554.3016540105909) rotate(0 116.40995788574219 17.5)"><text x="116.40995788574219" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Receive All Edits</text></g><g stroke-linecap="round"><g transform="translate(159.61324604422475 170.39540401059094) rotate(0 24.068359375 -39.26171875)"><path d="M-0.22 -0.44 C2.1 -13.44, 5.11 -78.14, 12.97 -78.77 C20.83 -79.41, 40.95 -16.63, 46.95 -4.24 M-1.8 -1.72 C0.4 -14.46, 3.25 -76.61, 11.76 -77.37 C20.26 -78.12, 42.91 -18.64, 49.21 -6.25" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(159.61324604422475 170.39540401059094) rotate(0 24.068359375 -39.26171875)"><path d="M-7.2 -29.62 C-6.59 -24.02, -4.74 -18.74, -0.22 -0.44 M-7.2 -29.62 C-4.96 -18.58, -1.22 -8.99, -0.22 -0.44" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(159.61324604422475 170.39540401059094) rotate(0 24.068359375 -39.26171875)"><path d="M13.19 -27.27 C9.32 -22.23, 6.69 -17.46, -0.22 -0.44 M13.19 -27.27 C8.23 -16.98, 4.8 -8.22, -0.22 -0.44" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(159.61324604422475 170.39540401059094) rotate(0 24.068359375 -39.26171875)"><path d="M28.44 -27.89 C32.13 -23.93, 37.03 -20.31, 49.21 -6.25 M28.44 -27.89 C35.48 -19.55, 44.08 -12.62, 49.21 -6.25" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(159.61324604422475 170.39540401059094) rotate(0 24.068359375 -39.26171875)"><path d="M47.21 -36.19 C46.71 -30.43, 47.47 -24.98, 49.21 -6.25 M47.21 -36.19 C47.7 -24.86, 49.69 -15.01, 49.21 -6.25" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(10 10) rotate(0 142.0439453125 35)"><text x="142.0439453125" y="0" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Received </text><text x="142.0439453125" y="35" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops</text></g><g transform="translate(1214.0302626841174 544.622452445652) rotate(0 65.18994903564453 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentId</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  data</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Sending Updates to Clients</span></div></div></div></div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="4-users-should-be-able-to-see-the-cursor-position-and-presence-of-other-users">4) Users should be able to see the cursor position and presence of other users.</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One of the more important features of a collaborative editor is "awareness" or being able to see where your collaborators are editing. This helps to avoid situations where you're simultaneously editing the same content (always a mess!) or repeating work. Awareness is inherently transient, we only really care about where our collaborators' cursor is <strong>now</strong> not where it was an hour ago. We also don't care about where the user's cursor is when they aren't currenty connected - it doesn't make sense. This data is <strong>ephemeral</strong> with the connection.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">These properties help us to decide that we don't need to keep cursor position or the presence of other users in the document data itself. Instead, we can have users report changes to their cursor position to the <span class="MuiBox-root mui-1vu004u">Document Service</span> which can store it in memory and broadcast it to all other users via the same websocket. When a new user connects, the <span class="MuiBox-root mui-1vu004u">Document Service</span> can read the properties of other users out of memory and send them to the connecting user. Finally, the <span class="MuiBox-root mui-1vu004u">Document Service</span> can keep track of socket hangups/disconnects and remove those users from the list (sending a broadcast when it happens to any remaining users).</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">And with that, we have a functional collaborative editor which scales to a few thousand users!</div><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="potential-deep-dives"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/learn/system-design/in-a-hurry/delivery#deep-dives-10-minutes" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Potential Deep Dives</a></h2><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With the core functional requirements met, it's time to cover non-functional requirements and issues we introduced.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="1-how-do-we-scale-to-millions-of-websocket-connections">1) How do we scale to millions of websocket connections?</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One of the weakest assumptions we made as we built out the system is that we'll be able to serve everyone from a single <span class="MuiBox-root mui-1vu004u">Document Service</span> server. This won't scale to millions of concurrent users and introduces a single point of failure for availability.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Wwe need to scale the number of <span class="MuiBox-root mui-1vu004u">Document Service</span> servers to the number of concurrent connections. When I connect to the <span class="MuiBox-root mui-1vu004u">Document Service</span>, I either (a) need to be co-located with all other users connected to the same document or (b) know where all the other users are connected. (See <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="/learn/system-design/problem-breakdowns/whatsapp#1-how-can-we-handle-billons-of-simultaneous-users" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Whatsapp</a> for a similar problem.)</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 867.7202256747149 401.3685497775858">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="867.7202256747149" height="401.3685497775858" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(13.830078125 10) rotate(0 42.560546875 43.259765625)"><path d="M21.28 0 C33.51 -0.56, 45.62 -1.31, 63.84 0 M21.28 0 C37.83 -0.61, 53.56 -0.36, 63.84 0 M63.84 0 C76.11 -0.09, 86.22 8.07, 85.12 21.28 M63.84 0 C78.1 -1.56, 86.91 5.19, 85.12 21.28 M85.12 21.28 C84.15 31.2, 86.05 42.26, 85.12 65.24 M85.12 21.28 C84.21 34.18, 85.01 48.73, 85.12 65.24 M85.12 65.24 C85.2 77.62, 77.53 86.88, 63.84 86.52 M85.12 65.24 C87.25 79.76, 78.38 85.17, 63.84 86.52 M63.84 86.52 C52.21 86, 44.02 86.82, 21.28 86.52 M63.84 86.52 C47.68 87.47, 30.48 87.06, 21.28 86.52 M21.28 86.52 C8.27 84.57, 1.48 80.36, 0 65.24 M21.28 86.52 C5.34 85.7, -1.44 78.93, 0 65.24 M0 65.24 C0.85 56.74, 0.43 47.48, 0 21.28 M0 65.24 C0.23 50.35, 0.33 35.79, 0 21.28 M0 21.28 C-0.1 5.85, 8.01 -1.6, 21.28 0 M0 21.28 C0.1 9.22, 5.09 1.56, 21.28 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(22.490646362304688 40.759765625) rotate(0 33.89997863769531 12.5)"><text x="33.89997863769531" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User A</text></g><g stroke-linecap="round" transform="translate(12.87890625 141.111328125) rotate(0 42.560546875 43.259765625)"><path d="M21.28 0 C35.32 -1.55, 47.48 0.88, 63.84 0 M21.28 0 C31.71 -0.01, 44.6 0.52, 63.84 0 M63.84 0 C78.09 -1.36, 86.68 5.44, 85.12 21.28 M63.84 0 C76.56 1.18, 85.85 5.72, 85.12 21.28 M85.12 21.28 C85.6 32.71, 86.77 44.09, 85.12 65.24 M85.12 21.28 C85.18 29.21, 84.9 39.13, 85.12 65.24 M85.12 65.24 C86.98 79.71, 78.34 85.35, 63.84 86.52 M85.12 65.24 C84.05 78.15, 78.82 85.56, 63.84 86.52 M63.84 86.52 C54.46 87.13, 40.98 88.14, 21.28 86.52 M63.84 86.52 C47.48 85.79, 30.69 87.23, 21.28 86.52 M21.28 86.52 C5.56 85.81, -1.25 79, 0 65.24 M21.28 86.52 C5.22 85.22, 0.22 80.12, 0 65.24 M0 65.24 C0.68 49.88, -1.31 34.55, 0 21.28 M0 65.24 C-0.22 51.93, 0.28 39.07, 0 21.28 M0 21.28 C0.08 8.95, 5.35 1.36, 21.28 0 M0 21.28 C-2.09 5.21, 6.85 1.37, 21.28 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(20.82947540283203 171.87109375) rotate(0 34.60997772216797 12.5)"><text x="34.60997772216797" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User B</text></g><g stroke-linecap="round" transform="translate(10 267.14257812500006) rotate(0 42.560546875 43.259765625)"><path d="M21.28 0 C29.69 -0.42, 39.26 -2.06, 63.84 0 M21.28 0 C33.9 -0.89, 47.23 -1.03, 63.84 0 M63.84 0 C76.75 1.02, 85.75 5.9, 85.12 21.28 M63.84 0 C77.49 0.81, 85.36 7.46, 85.12 21.28 M85.12 21.28 C83.47 32.98, 84.79 44.56, 85.12 65.24 M85.12 21.28 C85.94 30.64, 85.17 39.13, 85.12 65.24 M85.12 65.24 C84.19 78.32, 78.71 85.69, 63.84 86.52 M85.12 65.24 C84.35 81.46, 78.21 88.78, 63.84 86.52 M63.84 86.52 C51.81 87.94, 37 88.03, 21.28 86.52 M63.84 86.52 C54.46 86.36, 45.97 86.5, 21.28 86.52 M21.28 86.52 C5.47 85.39, 0.19 80.03, 0 65.24 M21.28 86.52 C8.38 86.73, 1.69 80.25, 0 65.24 M0 65.24 C0.05 52.22, 0.47 37.53, 0 21.28 M0 65.24 C-0.16 55.7, -1.07 44.99, 0 21.28 M0 21.28 C-1.82 5.45, 6.88 1.2, 21.28 0 M0 21.28 C1.79 7.97, 6.86 0.26, 21.28 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(18.78057098388672 297.90234375000006) rotate(0 33.77997589111328 12.5)"><text x="33.77997589111328" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User C</text></g><g stroke-linecap="round" transform="translate(192.716796875 46.06640625) rotate(0 72.84765625 58.009765625)"><path d="M29 0 C54.04 1.94, 80.22 0.9, 116.69 0 M29 0 C48.72 1.24, 70.02 0.13, 116.69 0 M116.69 0 C135.56 0.71, 145.9 9.99, 145.7 29 M116.69 0 C135.19 1.71, 143.97 7.39, 145.7 29 M145.7 29 C143.7 46.22, 145.86 66.28, 145.7 87.01 M145.7 29 C145.32 46.69, 146.13 65.06, 145.7 87.01 M145.7 87.01 C145.03 108.12, 136.18 117.99, 116.69 116.02 M145.7 87.01 C146.36 106.16, 137.85 118.28, 116.69 116.02 M116.69 116.02 C83.69 118.02, 55.52 115, 29 116.02 M116.69 116.02 C92.7 115.27, 70.44 116.13, 29 116.02 M29 116.02 C10.78 116.2, 1.47 107.07, 0 87.01 M29 116.02 C9.99 114.56, 0.68 106.09, 0 87.01 M0 87.01 C-1.29 68.23, -1.65 47.71, 0 29 M0 87.01 C-0.41 63.42, 0.4 42.06, 0 29 M0 29 C1.56 10.43, 9.47 0.22, 29 0 M0 29 C2.24 8.16, 11.89 1.03, 29 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(227.00448608398438 91.576171875) rotate(0 38.559967041015625 12.5)"><text x="38.559967041015625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Server 1</text></g><g stroke-linecap="round" transform="translate(189.080078125 200.408203125) rotate(0 72.84765625 58.009765625)"><path d="M29 0 C58.77 1.53, 89.59 -1.3, 116.69 0 M29 0 C59.57 0.88, 90.7 0.68, 116.69 0 M116.69 0 C135.3 1.49, 144.2 7.69, 145.7 29 M116.69 0 C136.15 -0.76, 145.79 7.59, 145.7 29 M145.7 29 C146.09 45.28, 144.63 60.02, 145.7 87.01 M145.7 29 C145.56 44.08, 145.97 58.38, 145.7 87.01 M145.7 87.01 C146.27 106.18, 137.61 117.98, 116.69 116.02 M145.7 87.01 C146.94 107.67, 137.38 113.78, 116.69 116.02 M116.69 116.02 C83.17 114.1, 50.65 113.72, 29 116.02 M116.69 116.02 C95.88 116.37, 74.69 116.64, 29 116.02 M29 116.02 C9.95 114.75, 0.59 106.12, 0 87.01 M29 116.02 C10.58 116.24, -0.11 104.93, 0 87.01 M0 87.01 C2.32 65.23, 1.82 45.1, 0 29 M0 87.01 C0.84 74.75, -0.04 61.83, 0 29 M0 29 C1.95 8.35, 11.6 0.9, 29 0 M0 29 C1.63 10.73, 11.01 -0.19, 29 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(218.95777130126953 245.91796875) rotate(0 42.96996307373047 12.5)"><text x="42.96996307373047" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Server 2</text></g><g stroke-linecap="round"><g transform="translate(102.216796875 55.50390625) rotate(0 38.2109375 12.244140625)"><path d="M-0.76 0.61 C11.88 4.74, 63.98 19.72, 76.8 23.77 M1.04 -0.11 C13.47 4.25, 63.69 21.12, 76.05 24.93" stroke="#ffffff" stroke-width="2" fill="none"></path></g><g transform="translate(102.216796875 55.50390625) rotate(0 38.2109375 12.244140625)"><path d="M29.18 -1.17 C18.88 -0.05, 5.35 -0.48, -0.76 0.61 M29.18 -1.17 C18.78 0.22, 8.35 -0.91, -0.76 0.61" stroke="#ffffff" stroke-width="2" fill="none"></path></g><g transform="translate(102.216796875 55.50390625) rotate(0 38.2109375 12.244140625)"><path d="M23.32 18.5 C15.4 12.22, 4.08 4.37, -0.76 0.61 M23.32 18.5 C14.87 13.29, 6.4 5.55, -0.76 0.61" stroke="#ffffff" stroke-width="2" fill="none"></path></g><g transform="translate(102.216796875 55.50390625) rotate(0 38.2109375 12.244140625)"><path d="M46.07 25.98 C58.43 26.41, 67.53 24.91, 76.05 24.93 M46.07 25.98 C55.76 26.33, 65.43 24.24, 76.05 24.93" stroke="#ffffff" stroke-width="2" fill="none"></path></g><g transform="translate(102.216796875 55.50390625) rotate(0 38.2109375 12.244140625)"><path d="M52.41 6.47 C62.21 14.22, 68.92 20.1, 76.05 24.93 M52.41 6.47 C59.99 13.37, 67.53 17.82, 76.05 24.93" stroke="#ffffff" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(107.474609375 52.671875) rotate(0 39.236328125 19.974609375)"><path d="M0.38 -0.72 C13.54 5.91, 65.15 33.56, 78.19 40.37 M-0.88 1.52 C12.16 7.72, 63.97 31.8, 77.1 38.47" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(107.474609375 52.671875) rotate(0 39.236328125 19.974609375)"><path d="M30.1 3.36 C21.86 2.02, 16.74 1.73, 0.38 -0.72 M30.1 3.36 C19.98 1.31, 11.39 0.67, 0.38 -0.72" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(107.474609375 52.671875) rotate(0 39.236328125 19.974609375)"><path d="M20.52 21.51 C14.45 15.85, 11.6 11.28, 0.38 -0.72 M20.52 21.51 C13.49 13.65, 7.93 7.28, 0.38 -0.72" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(107.474609375 52.671875) rotate(0 39.236328125 19.974609375)"><path d="M47.25 35.44 C53.12 35.59, 62.08 36.99, 77.1 38.47 M47.25 35.44 C55.92 35.18, 66.15 36.8, 77.1 38.47" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(107.474609375 52.671875) rotate(0 39.236328125 19.974609375)"><path d="M56.18 16.96 C60.04 21.51, 66.88 27.27, 77.1 38.47 M56.18 16.96 C61.96 22.61, 69.37 30.07, 77.1 38.47" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(104.650390625 186.0078125) rotate(0 39.408203125 20.79296875)"><path d="M-0.28 0.42 C12.81 7.51, 65.83 34.77, 78.94 41.78 M1.77 -0.4 C14.68 6.97, 65.45 36.58, 78.06 43.42" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(104.650390625 186.0078125) rotate(0 39.408203125 20.79296875)"><path d="M29.46 4.36 C20.33 3.19, 10.08 0.96, -0.28 0.42 M29.46 4.36 C18.4 2.26, 7.25 0.22, -0.28 0.42" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(104.650390625 186.0078125) rotate(0 39.408203125 20.79296875)"><path d="M19.97 22.56 C14.09 15.38, 6.99 7.11, -0.28 0.42 M19.97 22.56 C12.6 13.74, 5.01 4.87, -0.28 0.42" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(104.650390625 186.0078125) rotate(0 39.408203125 20.79296875)"><path d="M48.47 38.46 C58.96 40.38, 68.38 41.09, 78.06 43.42 M48.47 38.46 C59.57 40.28, 70.64 41.56, 78.06 43.42" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(104.650390625 186.0078125) rotate(0 39.408203125 20.79296875)"><path d="M58.57 20.6 C65.6 28.42, 71.68 35.05, 78.06 43.42 M58.57 20.6 C65.75 29.01, 73.04 36.98, 78.06 43.42" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(101.630859375 316.78515625000006) rotate(0 38.04296875 -15.998046875)"><path d="M0.12 0.19 C12.78 -5.06, 63.14 -25.54, 75.65 -31.1 M-1.27 -0.75 C11.21 -6.37, 61.33 -27.46, 74.48 -32.75" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(101.630859375 316.78515625000006) rotate(0 38.04296875 -15.998046875)"><path d="M22.29 -20.02 C16.55 -15.13, 11.59 -10.32, 0.12 0.19 M22.29 -20.02 C17.89 -16.94, 13.14 -11.79, 0.12 0.19" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(101.630859375 316.78515625000006) rotate(0 38.04296875 -15.998046875)"><path d="M30.1 -1.04 C22.13 -1.4, 15.02 -1.83, 0.12 0.19 M30.1 -1.04 C24.11 -1.8, 17.8 -0.47, 0.12 0.19" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(101.630859375 316.78515625000006) rotate(0 38.04296875 -15.998046875)"><path d="M52.34 -12.5 C58.71 -18.85, 66 -25.22, 74.48 -32.75 M52.34 -12.5 C56.82 -17.4, 60.98 -20.39, 74.48 -32.75" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(101.630859375 316.78515625000006) rotate(0 38.04296875 -15.998046875)"><path d="M44.5 -31.47 C53.11 -32.58, 62.57 -33.71, 74.48 -32.75 M44.5 -31.47 C50.57 -32.53, 56.31 -31.71, 74.48 -32.75" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(856.181640625 183.44140625) rotate(0 -220.859375 1.677734375)"><path d="M-0.43 0.89 C-74.22 1.22, -369.08 1.82, -442.62 2.17 M1.54 0.32 C-71.89 0.73, -366.39 2.46, -440.38 3.08" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(856.181640625 183.44140625) rotate(0 -220.859375 1.677734375)"><path d="M-412.26 -7.37 C-419.48 -5.73, -431.67 -0.88, -440.38 3.08 M-412.26 -7.37 C-420 -4.66, -426.33 -1.91, -440.38 3.08" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(856.181640625 183.44140625) rotate(0 -220.859375 1.677734375)"><path d="M-412.12 13.15 C-419.41 8.42, -431.65 6.9, -440.38 3.08 M-412.12 13.15 C-419.91 10.38, -426.28 7.66, -440.38 3.08" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(423.2385406494141 107.84765625) rotate(0 176.54986572265622 25)"><text x="176.54986572265625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">I need to send message to User C,</text><text x="176.54986572265625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">which server do I connect to?</text></g><g stroke-linecap="round"><g transform="translate(399.130859375 311.18750000000006) rotate(0 -123.8203125 40.53125)"><path d="M0.06 -0.4 C-34.44 13.13, -166.61 76.16, -207.94 79.98 C-249.27 83.8, -241.51 32.11, -247.94 22.53" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(399.130859375 311.18750000000006) rotate(0 -123.8203125 40.53125)"><path d="M-232.08 48 C-236.06 42.35, -240.77 36.05, -247.94 22.53" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(399.130859375 311.18750000000006) rotate(0 -123.8203125 40.53125)"><path d="M-252.15 52.23 C-251.57 45.63, -251.77 38.37, -247.94 22.53" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(411.552734375 276.06640625000006) rotate(0 110.27989959716797 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket Connections</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Websocket Connections</span></div></div></div></div><div class="my-6"><div class="MuiBox-root mui-14bc8gt"><div class="MuiBox-root mui-zvu67g"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="w-6 h-6 heroicon-sw-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg></div><div class="MuiBox-root mui-79elbk"><div style="overflow: hidden; max-height: 300px;"><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When you introduce websockets into your design, you're probably doing it because they are <em>bi-directional</em>, you can send messages back to your clients. With a traditional client-server architecture you're mostly talking about left-to-right arrows: how can clients connect to the servers to send messages and receive a response. The jump that many candidates fail to make is to think about the <strong>right-to-left</strong> arrows on their diagrams: how do your internal services talk to the clients?</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Because the statefulness of websockets is a pain, it can be useful to handle them at the "edge" of your design. By terminating websockets early and exposing an "internal" API to the rest of our system, other systems can retain statelessness and don't need to concern themselves with the details of websocket connections.</div></div><div class="MuiBox-root mui-1gdegwm"></div><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeSmall MuiButton-textSizeSmall MuiButton-colorPrimary MuiButton-disableElevation MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeSmall MuiButton-textSizeSmall MuiButton-colorPrimary MuiButton-disableElevation mui-149rsyb" tabindex="0" type="button">Show More<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The solution here is to horizontally scale the <span class="MuiBox-root mui-1vu004u">Document Service</span> and use a consistent hash ring to distribute connections across servers. Each server in our system joins a the hash ring, with each server responsible for a range of hash values. This means we always know both which server is responsible for the document and all connections go there. We use Apache Zookeeper to maintain the hash ring configuration and coordinate between servers.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When a client needs to connect:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">They can initially open an HTTP connection to any of the document servers (potentially via round robin) with the document ID requested.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">That server will check the hash ring configuration for the given document ID and if it's not responsible for that hash range, it will respond with a redirect to the correct server's address. This way, clients eventually connect directly to the right server without an intermediary.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Once the correct server is found, the HTTP connection is upgraded to a websocket connection. The socket server maintains a map from the document ID to the corresponding websocket for use later.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">We load all the stored ops (if they aren't already loaded) from our <span class="MuiBox-root mui-1vu004u">Document Operations DB</span> and are ready to process operations.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Since all of the users of a document are connecting to the same server, when updates happen we can simply pass them to all connected clients.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The beauty of consistent hashing is that when we add or remove servers, only a small portion of connections need to be redistributed. Servers periodically check Zookeeper for ring changes and can initiate connection transfers when needed.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1310.9326695624572 853.0422005064656">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1310.9326695624572" height="853.0422005064656" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(46.112518310546875 151.203125) rotate(0 83.921875 108.06640625)"><path d="M32 0 C62.47 0.57, 97.31 -1.87, 135.84 0 M32 0 C60.64 1.04, 89.38 -0.55, 135.84 0 M135.84 0 C156.39 0.01, 168.57 11.14, 167.84 32 M135.84 0 C158.58 -1.77, 167.95 10.39, 167.84 32 M167.84 32 C167.78 92.01, 165.59 151.61, 167.84 184.13 M167.84 32 C169.05 72.37, 169.47 114.47, 167.84 184.13 M167.84 184.13 C167.25 205.95, 158.27 217.32, 135.84 216.13 M167.84 184.13 C166.85 203.49, 159.06 217.81, 135.84 216.13 M135.84 216.13 C110.03 215.85, 85.72 217.68, 32 216.13 M135.84 216.13 C104.86 215.96, 75.45 214.65, 32 216.13 M32 216.13 C10.82 216.98, 0.77 205.42, 0 184.13 M32 216.13 C11.07 216.07, -0.01 203.34, 0 184.13 M0 184.13 C1.05 142.49, -1.24 103.12, 0 32 M0 184.13 C1.54 132.09, 1.07 79.8, 0 32 M0 32 C1.35 12.01, 9.74 1.21, 32 0 M0 32 C-1.88 12.2, 12.44 -1.77, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(107.69441223144531 246.76953125) rotate(0 22.339981079101562 12.5)"><text x="22.339981079101562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(282.2609558105469 160.05859375) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C70.58 1.96, 109.46 0.77, 142.62 0 M32 0 C72.43 1, 114 1.23, 142.62 0 M142.62 0 C165.18 -1.54, 174.71 10.43, 174.62 32 M142.62 0 C166.13 -1.28, 173.04 11.57, 174.62 32 M174.62 32 C173.05 74.3, 175.64 115.28, 174.62 170.18 M174.62 32 C175.46 64, 176.3 96.12, 174.62 170.18 M174.62 170.18 C173.75 189.8, 165.59 203.64, 142.62 202.18 M174.62 170.18 C173.07 191.93, 164.41 200.28, 142.62 202.18 M142.62 202.18 C112.02 201.07, 80.01 202.28, 32 202.18 M142.62 202.18 C102.28 201.89, 62.17 201.44, 32 202.18 M32 202.18 C11.02 202.13, -0.01 189.67, 0 170.18 M32 202.18 C10.03 201.19, -0.66 191.97, 0 170.18 M0 170.18 C2.22 128.79, 0.95 91.13, 0 32 M0 170.18 C0.64 122.03, -0.5 73.14, 0 32 M0 32 C-1.63 12, 12.21 -1.54, 32 0 M0 32 C-1.91 10.43, 10.89 0.82, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(302.82154083251953 248.650390625) rotate(0 66.74996185302734 12.5)"><text x="66.74996185302734" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(585.7140808105472 162.91015625) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C95.02 0.23, 153.49 -0.8, 203.29 0 M32 0 C84.11 -1.18, 135.04 -0.53, 203.29 0 M203.29 0 C226.52 -1.11, 233.92 11.45, 235.29 32 M203.29 0 C224.59 -1.62, 234.73 9.98, 235.29 32 M235.29 32 C235.19 79.96, 237.23 124.04, 235.29 163.26 M235.29 32 C235.57 73.67, 236.83 117.79, 235.29 163.26 M235.29 163.26 C233.94 184.96, 225.02 193.61, 203.29 195.26 M235.29 163.26 C234.73 182.52, 226.17 195.15, 203.29 195.26 M203.29 195.26 C169.11 196.54, 131.01 194.86, 32 195.26 M203.29 195.26 C144.83 195.2, 86.02 194.3, 32 195.26 M32 195.26 C10.11 194.4, -0.58 184.99, 0 163.26 M32 195.26 C10.43 193.08, 2.14 185.64, 0 163.26 M0 163.26 C1.3 132.96, 1.9 103.89, 0 32 M0 163.26 C-0.21 115.76, 1.38 66.16, 0 32 M0 32 C-1.66 10.46, 10.86 0.71, 32 0 M0 32 C-1.79 9.01, 9.1 -1.87, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(602.0686874389653 235.541015625) rotate(0 101.289924621582 25)"><text x="101.28992462158203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="101.28992462158203" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(882.7765808105472 128.52734375) rotate(0 137.23242187499994 134.5)"><path d="M161.18 2.24 C175.39 2.71, 191.34 11.17, 204.32 18.18 C217.31 25.19, 229.12 33.59, 239.09 44.29 C249.06 54.99, 258.42 68.91, 264.15 82.4 C269.88 95.9, 272.58 110.65, 273.45 125.26 C274.33 139.88, 273.01 155.94, 269.42 170.1 C265.83 184.26, 260.3 198.12, 251.92 210.23 C243.53 222.34, 231.08 234.11, 219.1 242.75 C207.13 251.39, 194.02 257.63, 180.06 262.09 C166.09 266.55, 150.11 269.78, 135.31 269.53 C120.51 269.28, 105.38 265.47, 91.23 260.58 C77.08 255.68, 61.94 249.31, 50.39 240.14 C38.83 230.98, 29.66 218.02, 21.9 205.61 C14.15 193.19, 7.54 179.75, 3.86 165.66 C0.19 151.56, -1.44 135.45, -0.16 121.04 C1.12 106.63, 5.23 92.56, 11.54 79.21 C17.85 65.86, 27.45 51.65, 37.7 40.93 C47.94 30.21, 59.74 21.31, 73.03 14.89 C86.32 8.47, 101.45 4.26, 117.43 2.42 C133.41 0.58, 159.03 2.8, 168.9 3.86 C178.78 4.91, 177.11 6.55, 176.68 8.75 M134.82 -0.63 C148.82 -2.67, 165.3 2.56, 179.46 6.96 C193.62 11.36, 207.62 16.91, 219.78 25.75 C231.94 34.58, 244.25 47.72, 252.41 59.99 C260.57 72.25, 264.98 85.24, 268.73 99.31 C272.48 113.39, 275.72 129.67, 274.89 144.45 C274.06 159.23, 269.46 174.52, 263.74 187.97 C258.02 201.42, 250.58 214.35, 240.56 225.15 C230.53 235.94, 216.94 245.64, 203.61 252.75 C190.28 259.87, 174.87 265.57, 160.57 267.83 C146.26 270.09, 132.47 268.7, 117.78 266.32 C103.09 263.94, 85.77 260.01, 72.44 253.55 C59.11 247.09, 47.98 238.28, 37.78 227.56 C27.57 216.84, 17.57 202.78, 11.21 189.24 C4.85 175.7, 1.03 160.82, -0.38 146.34 C-1.78 131.86, -0.76 116.2, 2.77 102.36 C6.29 88.53, 12.92 75.45, 20.78 63.34 C28.65 51.22, 38.32 38.73, 49.95 29.66 C61.58 20.58, 76.57 14.04, 90.58 8.88 C104.59 3.72, 126.58 -0.16, 134.02 -1.32 C141.47 -2.49, 134.98 -0.47, 135.25 1.91" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(949.771067777812 237.92148168040933) rotate(0 70.19995880126953 25)"><text x="70.19995880126953" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="70.19995880126953" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Metadata DB</text></g><g stroke-linecap="round"><g transform="translate(214.95626831054688 251.567363967265) rotate(0 29.921875 -0.6869446232170731)"><path d="M0.73 -0.92 C10.64 -1.23, 49.86 -1.33, 59.9 -1.52 M-0.34 1.2 C9.38 1.07, 48.79 0.32, 58.98 -0.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(214.95626831054688 251.567363967265) rotate(0 29.921875 -0.6869446232170731)"><path d="M31.14 10.93 C38.93 7.16, 49.59 5.27, 58.98 -0.06 M31.14 10.93 C38 7.43, 44.57 5.15, 58.98 -0.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(214.95626831054688 251.567363967265) rotate(0 29.921875 -0.6869446232170731)"><path d="M30.59 -9.54 C38.61 -6.43, 49.46 -1.44, 58.98 -0.06 M30.59 -9.54 C37.44 -8.04, 44.15 -5.31, 58.98 -0.06" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(461.74533081054676 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M0.05 -0.14 C19.74 -1.02, 99.4 -5.37, 118.88 -6.19 M-1.38 -1.26 C18.19 -1.92, 98.4 -4.03, 118.53 -5.01" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(461.74533081054676 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M90.72 6.26 C100.61 4.07, 109.77 -3.26, 118.53 -5.01 M90.72 6.26 C99.91 2.34, 110.11 -0.19, 118.53 -5.01" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(461.74533081054676 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M89.99 -14.25 C99.98 -9.03, 109.41 -8.96, 118.53 -5.01 M89.99 -14.25 C99.42 -11.21, 109.87 -6.78, 118.53 -5.01" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(468.58908081054676 213.421875) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(826.3390808105472 244.81640625) rotate(0 23.2421875 0.875)"><path d="M-0.38 0.22 C7.28 0.49, 38.69 1.13, 46.48 1.36 M0.43 -0.15 C7.97 0.21, 38.46 1.49, 46.04 1.86" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(826.3390808105472 244.81640625) rotate(0 23.2421875 0.875)"><path d="M23.85 8.82 C33.02 6.14, 40.68 3.16, 46.04 1.86 M23.85 8.82 C30.02 6.48, 36.22 5.11, 46.04 1.86" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(826.3390808105472 244.81640625) rotate(0 23.2421875 0.875)"><path d="M24.57 -7.07 C33.41 -3.49, 40.79 -0.19, 46.04 1.86 M24.57 -7.07 C30.59 -5.12, 36.6 -2.19, 46.04 1.86" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1179.5617370605473 214.6640625) rotate(0 46.15995788574219 37.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text></g><g stroke-linecap="round" transform="translate(552.0187683105472 494.2265625) rotate(0 128.2890625 85.94921875)"><path d="M32 0 C88.87 1.52, 148.94 1.27, 224.58 0 M32 0 C75.97 -0.37, 121.07 -0.02, 224.58 0 M224.58 0 C245.05 -1.72, 258.22 12.12, 256.58 32 M224.58 0 C244.36 0.41, 257.03 8.76, 256.58 32 M256.58 32 C255.51 59.9, 254 90.86, 256.58 139.9 M256.58 32 C257.64 71.85, 257.95 110.82, 256.58 139.9 M256.58 139.9 C256.93 161.17, 245.9 170.05, 224.58 171.9 M256.58 139.9 C255.94 160.24, 245.25 172.35, 224.58 171.9 M224.58 171.9 C169.71 172.32, 112.67 174.69, 32 171.9 M224.58 171.9 C157.21 174.17, 88.03 174.1, 32 171.9 M32 171.9 C9.04 173.24, 1.54 159.7, 0 139.9 M32 171.9 C8.76 171.66, 0.22 162.05, 0 139.9 M0 139.9 C-0.85 114.65, -0.59 91.31, 0 32 M0 139.9 C0.88 102.75, 0.22 63.46, 0 32 M0 32 C-0.03 9.6, 10.92 -0.68, 32 0 M0 32 C-0.92 11.78, 9.78 1.04, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(595.3879089355472 567.67578125) rotate(0 84.919921875 12.5)"><text x="84.919921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Service</text></g><g stroke-linecap="round"><g transform="translate(452.37814331054676 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M0.48 -0.84 C21.38 20.71, 105.32 108.62, 126.02 130.5 M-0.73 1.33 C20.04 23.01, 104.85 106.82, 125.59 128.58" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.37814331054676 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M27.39 12.43 C16.36 9.5, 8.9 2.58, 0.48 -0.84 M27.39 12.43 C18.16 7.43, 10.7 4.72, 0.48 -0.84" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.37814331054676 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M12.56 26.62 C6.62 18.62, 4.4 6.7, 0.48 -0.84 M12.56 26.62 C8.07 16.93, 5.4 9.62, 0.48 -0.84" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.37814331054676 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M98.49 115.7 C106.78 121.78, 118.38 124.09, 125.59 128.58 M98.49 115.7 C106.91 118.85, 116.94 124.61, 125.59 128.58" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.37814331054676 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M113.11 101.3 C116.38 112.52, 122.82 119.91, 125.59 128.58 M113.11 101.3 C116.87 109.2, 122.16 119.63, 125.59 128.58" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(370.73751831054676 416.6015625) rotate(0 49.989952087402344 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket</text></g><g stroke-linecap="round" transform="translate(927.6554870605472 460.87109375) rotate(0 114.958984375 106.5625)"><path d="M145.14 4.78 C158.31 6.44, 173.37 13.02, 184.62 20.61 C195.87 28.2, 205.58 39.36, 212.65 50.32 C219.72 61.28, 224.64 73.66, 227.05 86.34 C229.47 99.03, 229.5 113.91, 227.14 126.42 C224.78 138.93, 220.11 150.62, 212.88 161.39 C205.65 172.16, 194.68 182.95, 183.78 191.03 C172.88 199.11, 160.76 206.24, 147.49 209.86 C134.22 213.49, 117.96 214.01, 104.13 212.78 C90.31 211.56, 76.84 208.18, 64.53 202.52 C52.22 196.86, 39.71 188.34, 30.28 178.83 C20.84 169.31, 13.09 157.45, 7.89 145.43 C2.69 133.4, -0.8 119.57, -0.92 106.69 C-1.04 93.81, 2.04 80.11, 7.18 68.15 C12.31 56.2, 20.71 44.28, 29.91 34.97 C39.11 25.65, 49.97 18.14, 62.38 12.28 C74.79 6.42, 89.06 0.69, 104.38 -0.19 C119.69 -1.08, 144.61 5.01, 154.25 6.97 C163.89 8.93, 162.69 9.86, 162.2 11.56 M151.51 6.92 C164.83 9.02, 180.02 16.09, 190.56 24.21 C201.11 32.33, 208.35 44.06, 214.78 55.62 C221.21 67.18, 227.36 81.01, 229.13 93.58 C230.9 106.15, 228.91 118.9, 225.39 131.07 C221.87 143.23, 215.94 156.06, 208.03 166.57 C200.11 177.08, 189.3 186.67, 177.88 194.13 C166.46 201.59, 153.11 208.34, 139.52 211.32 C125.93 214.3, 110 213.89, 96.36 212.01 C82.72 210.12, 69.65 206.61, 57.67 200 C45.69 193.4, 33.17 182.62, 24.48 172.36 C15.79 162.11, 9.54 150.55, 5.53 138.48 C1.51 126.4, -0.32 112.48, 0.38 99.92 C1.08 87.36, 4.13 74.61, 9.74 63.13 C15.34 51.65, 24.1 39.95, 34.03 31.04 C43.95 22.12, 56.25 14.85, 69.29 9.63 C82.33 4.42, 98.19 0.19, 112.28 -0.26 C126.37 -0.7, 147.07 5.69, 153.83 6.94 C160.59 8.18, 153.51 5.57, 152.83 7.22" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(990.7162468210765 530.0825273798085) rotate(0 52.109947204589844 37.5)"><text x="52.109947204589844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="52.109947204589844" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="52.109947204589844" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(819.6515808105472 547.2708021698891) rotate(0 52.173828125 -1.3912604599437373)"><path d="M-0.52 -1.03 C16.93 -1.47, 87.99 -1.65, 105.33 -1.91 M1.41 1.04 C18.72 0.21, 87.47 -3.21, 104.9 -3.57" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(819.6515808105472 547.2708021698891) rotate(0 52.173828125 -1.3912604599437373)"><path d="M77.11 7.73 C85.18 5.48, 98.21 -1.51, 104.9 -3.57 M77.11 7.73 C85.68 3.47, 95.44 0.72, 104.9 -3.57" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(819.6515808105472 547.2708021698891) rotate(0 52.173828125 -1.3912604599437373)"><path d="M76.35 -12.77 C84.81 -7.75, 98.11 -7.47, 104.9 -3.57 M76.35 -12.77 C85.2 -10.51, 95.2 -6.73, 104.9 -3.57" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(148.32736206054756 374.098469607231) rotate(0 195.37068498476026 109.31102694246601)"><path d="M0.98 0.87 C17.81 25.57, 35.41 111.01, 100.41 147.13 C165.41 183.26, 342.64 205.89, 390.98 217.63" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(148.32736206054756 374.098469607231) rotate(0 195.37068498476026 109.31102694246601)"><path d="M22.89 21.37 C18.9 14.94, 12.18 11.42, 0.98 0.87" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.32736206054756 374.098469607231) rotate(0 195.37068498476026 109.31102694246601)"><path d="M4.59 30.66 C5.37 21.69, 3.35 15.79, 0.98 0.87" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.32736206054756 374.098469607231) rotate(0 195.37068498476026 109.31102694246601)"><path d="M361.37 222.47 C370.47 219.64, 376.97 220.14, 390.98 217.63" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.32736206054756 374.098469607231) rotate(0 195.37068498476026 109.31102694246601)"><path d="M365.18 202.31 C373.13 204.68, 378.66 210.36, 390.98 217.63" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(58.33909711250749 533.3912842810632) rotate(0 108.58990478515625 25)"><text x="108.58990478515625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write/Receive</text><text x="108.58990478515625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Edits, Cursor Changes</text></g><g stroke-linecap="round"><g transform="translate(656.2827274813475 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M0.24 -0.99 C5.93 10.68, 21.3 71.02, 33.34 70.26 C45.39 69.5, 66.29 7.24, 72.5 -5.54 M-1.1 1.1 C4.48 12.86, 20.03 72.12, 32.24 71.23 C44.45 70.33, 65.83 8.59, 72.16 -4.26" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(656.2827274813475 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M70.76 25.71 C69.37 18.25, 69.55 13.11, 72.16 -4.26 M70.76 25.71 C71.13 17.53, 72.78 7.38, 72.16 -4.26" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(656.2827274813475 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M51.82 17.8 C54.86 12.14, 59.44 8.84, 72.16 -4.26 M51.82 17.8 C57.71 12.1, 64.95 4.29, 72.16 -4.26" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(614.6320495605472 762.7265625) rotate(0 72.75993347167969 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Ops</text></g><g transform="translate(814.5578308105472 496.53125) rotate(0 55.01994323730469 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Applied Ops</text></g><g stroke-linecap="round"><g transform="translate(943.0929870605472 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-1.11 -0.96 C-22.44 -1.18, -106.38 -1.07, -127.14 -1.4 M0.5 1.15 C-21.08 0.59, -107.23 -2.58, -128.29 -3.11" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(943.0929870605472 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-99.78 -12.47 C-111.86 -9.94, -119.42 -4.02, -128.29 -3.11 M-99.78 -12.47 C-106.09 -10.17, -113 -7.98, -128.29 -3.11" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(943.0929870605472 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-100.44 8.04 C-112.26 3.04, -119.58 1.43, -128.29 -3.11 M-100.44 8.04 C-106.61 5.52, -113.36 2.89, -128.29 -3.11" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(803.7227020263675 656.0625) rotate(0 79.00993347167969 25)"><text x="79.00993347167969" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">On Initialization</text><text x="79.00993347167969" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Read all Ops</text></g><g stroke-linecap="round"><g transform="translate(698.3312683105472 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M1.1 -0.78 C-5.19 -15.25, 0.76 -57.8, -38.17 -86.06 C-77.11 -114.33, -200.08 -156.33, -232.51 -170.38" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(698.3312683105472 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-202.52 -169.7 C-211.85 -169.46, -217.73 -169.02, -232.51 -170.38" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(698.3312683105472 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-209.97 -150.58 C-217.43 -155.52, -221.32 -160.2, -232.51 -170.38" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(680.1973648071292 393.0859375) rotate(0 81.23993682861328 25)"><text x="81.23993682861328" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Send all Applied </text><text x="81.23993682861328" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops on Connect</text></g><g stroke-linecap="round"><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M0.46 -0.03 C2.73 -13.2, 5.74 -77.57, 13.69 -78.56 C21.63 -79.55, 42.44 -18.17, 48.13 -5.97 M-0.75 -1.08 C1.36 -14.11, 4.83 -76.35, 12.85 -77.04 C20.87 -77.73, 41.52 -17.32, 47.36 -5.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M-6.52 -29.2 C-4.29 -19.9, -2.16 -11.29, 0.46 -0.03 M-6.52 -29.2 C-5.44 -22.92, -3.81 -18, 0.46 -0.03" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M13.87 -26.86 C9.81 -18.21, 5.68 -10.31, 0.46 -0.03 M13.87 -26.86 C10.72 -21.15, 8.12 -16.72, 0.46 -0.03" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M27.25 -27.5 C33.49 -20.37, 39.66 -13.89, 47.36 -5.24 M27.25 -27.5 C31.08 -22.59, 35.44 -19.11, 47.36 -5.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M46.26 -35.22 C46.69 -25.65, 47.01 -16.79, 47.36 -5.24 M46.26 -35.22 C46.12 -28.79, 46.53 -23.71, 47.36 -5.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(10 10) rotate(0 101.45991516113281 25)"><text x="101.45991516113281" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Received </text><text x="101.45991516113281" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops</text></g><g stroke-linecap="round" transform="translate(331.1276484211811 704.1002351273437) rotate(0 88.76647881088672 69.47098268956097)"><path d="M76.74 0.56 C87.79 -1.52, 100.81 1.14, 112.41 3.65 C124.02 6.16, 137.05 9.64, 146.38 15.63 C155.72 21.62, 163.15 31.01, 168.43 39.61 C173.7 48.2, 177.45 57.74, 178.02 67.18 C178.59 76.62, 176.35 87.62, 171.85 96.27 C167.35 104.91, 159.71 112.77, 151 119.05 C142.3 125.34, 130.92 130.56, 119.61 133.97 C108.29 137.39, 95.34 140.21, 83.11 139.54 C70.88 138.86, 56.96 134.48, 46.21 129.93 C35.46 125.39, 25.84 119.68, 18.63 112.26 C11.42 104.83, 5.96 94.67, 2.96 85.4 C-0.04 76.13, -1.26 65.87, 0.65 56.62 C2.57 47.37, 7.69 37.64, 14.44 29.9 C21.19 22.16, 30.34 15.25, 41.16 10.18 C51.97 5.11, 72.62 0.94, 79.31 -0.51 C86 -1.95, 81.1 0.33, 81.29 1.51 M50.67 6.28 C60.31 1.72, 73.87 0.81, 85.77 0.75 C97.68 0.69, 110.94 2.3, 122.09 5.95 C133.24 9.6, 144.06 15.98, 152.67 22.65 C161.27 29.31, 169.46 37.03, 173.74 45.91 C178.02 54.78, 179.38 66.56, 178.36 75.88 C177.35 85.21, 173.45 93.6, 167.67 101.86 C161.88 110.12, 153.17 119.81, 143.68 125.44 C134.18 131.08, 122.44 133.58, 110.71 135.67 C98.99 137.77, 85.61 139.62, 73.33 138.01 C61.06 136.41, 47.29 131.25, 37.05 126.03 C26.81 120.82, 17.89 114.82, 11.9 106.74 C5.91 98.66, 2.26 86.84, 1.11 77.56 C-0.03 68.27, 1.49 59.74, 5.05 51.03 C8.62 42.32, 15.1 32.87, 22.5 25.29 C29.91 17.71, 44.52 8.66, 49.49 5.55 C54.46 2.44, 51.66 5.48, 52.32 6.64" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(370.5668039700058 760.9478148614228) rotate(0 49.55994415283204 12.5)"><text x="49.55994415283203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Zookeeper</text></g><g stroke-linecap="round"><g transform="translate(553.9654210339771 662.7846777835493) rotate(0 -31.332422117934925 23.588589517551554)"><path d="M-0.35 0.24 C-10.76 8, -52.59 38.13, -62.79 46.04 M1.67 -0.69 C-8.88 7.22, -53.24 39.26, -63.8 46.98" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(553.9654210339771 662.7846777835493) rotate(0 -31.332422117934925 23.588589517551554)"><path d="M-17.07 25.14 C-12.01 18.2, -9.74 13.49, -0.35 0.24 M-17.07 25.14 C-10.62 17.1, -5.31 8.79, -0.35 0.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(553.9654210339771 662.7846777835493) rotate(0 -31.332422117934925 23.588589517551554)"><path d="M-29.17 8.57 C-20.89 6.18, -15.32 5.98, -0.35 0.24 M-29.17 8.57 C-18.65 6.27, -9.16 3.69, -0.35 0.24" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(553.9654210339771 662.7846777835493) rotate(0 -31.332422117934925 23.588589517551554)"><path d="M-47.02 22.11 C-51.31 28.63, -58.16 37.48, -63.8 46.98 M-47.02 22.11 C-52.5 31.21, -58.76 40.1, -63.8 46.98" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(553.9654210339771 662.7846777835493) rotate(0 -31.332422117934925 23.588589517551554)"><path d="M-34.96 38.72 C-42.46 40.68, -52.6 45, -63.8 46.98 M-34.96 38.72 C-44.49 42.06, -54.93 45.21, -63.8 46.98" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(316.69179701198925 653.6034886603557) rotate(0 93.76992797851562 12.5)"><text x="93.76992797851562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Query Hash Ranges</text></g><g transform="translate(1170.5527714911682 507.4458002805577) rotate(0 65.18994903564453 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentId</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  data</text></g></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Architecture with Consistent Hash</span></div></div></div></div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The downside of this approach is that in these scaling events we need to move a lot of state. Not only do we need to move websocket connections for displaced users (by disconnecting them and forcing them to reconnect to the right server), but we also need to ensure document operations are moved to the correct server.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">In an interview, we may be asked to expand on this further:</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Scaling complexity</strong></div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Need to track both old and new hash rings when adding servers</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Requests may need to be sent to multiple servers during transitions</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Server failures require quick redistribution of connections and hash ring updates</div></li>
</ul><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Connection state management challenges</strong></div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Need robust monitoring for server failures and connection issues</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Must implement client-side reconnection logic for server unavailability</div></li>
</ul><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><strong>Capacity planning requirements</strong></div><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Must ensure servers have sufficient resources for their connection load</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Need to monitor connection distribution to prevent server hotspots</div></li>
</ul><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="2-how-do-we-keep-storage-under-control">2) How do we keep storage under control?</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">With billions of documents, we need to be thoughtful about how we manage storage. By choosing OT vs CRDTs, we can already reduce the amount of storage we need by a factor. Still, if each document is 50kb, we're looking at 50TB of storage! Worse, if we have a document with millions of operations, each of these operations will need to be transferred and applied to each client that joins the document!</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Remember also that all <em>active</em> documents need to be held in memory in our <span class="MuiBox-root mui-1vu004u">Document Service</span>. We need to keep that space small in order to avoid being memory bottlenecked.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One of the most natural solutions here is we'll want to periodically snapshot/compact operations. The idea here is that we don't need all of the operations in our <span class="MuiBox-root mui-1vu004u">Document Operations DB</span> to be stored (exception being if we want to manage some sort of versionining), and we can collapse many operations into one to save on both processing and space.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Lots of options to pull this off!</div><div class="my-6 flex flex-col gap-4"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-nhbct3"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-guv1gb" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Good Solution: Offline Snapshot/Compact</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-2">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">One approach we can take is to introduce a new <span class="MuiBox-root mui-1vu004u">Compaction Service</span> which periodically reads operations out of the <span class="MuiBox-root mui-1vu004u">Document Operations DB</span> and writes a snapshot back to the DB collapsing those instructions. The exact schedule has lots of potential parameters: we may look for large documents, that haven't been recently compacted, and probably haven't been written recently.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Because this necessarily changes the operations that follow, we need to make sure that what we're writing isn't impacting a live document. This is a tricky distributed transaction that we need to pull off and, because we're using Cassandra for the <span class="MuiBox-root mui-1vu004u">Document Operations DB</span>, we only have row-level transactions to work with.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">To ensure document-level atomicity, we'll introduce a new <span class="MuiBox-root mui-1vu004u">documentVersionId</span> to the <span class="MuiBox-root mui-1vu004u">Document Metadata DB</span>. Before loading a document, we'll grab this <span class="MuiBox-root mui-1vu004u">documentVersionId</span> out of the <span class="MuiBox-root mui-1vu004u">Document Metadata DB</span> so we know which document operations to retrieve.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Whenever we want to change operations, we can write new operations and the <em>flip</em> the <span class="MuiBox-root mui-1vu004u">documentVersionId</span>. We'll make sure all <em>flips</em> go through the <span class="MuiBox-root mui-1vu004u">Document Service</span> so we don't have (yet another) race condition.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">The <span class="MuiBox-root mui-1vu004u">Compaction Service</span> can:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Read the document operations out for a given document out of the DB.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Compact these operations into as few operations as possible (probably a singular insert operation!).</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Write the resulting operations to a new <span class="MuiBox-root mui-1vu004u">documentVersionId</span>.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Tell the <span class="MuiBox-root mui-1vu004u">Document Service</span> to <em>flip</em> the <span class="MuiBox-root mui-1vu004u">documentVersionId</span>.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">If the <span class="MuiBox-root mui-1vu004u">Document Service</span> has a loaded document, it will discard the flip command to defer compaction which might corrupt existing operations.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1391.7768858626396 912.40663684838">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1391.7768858626396" height="912.40663684838" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(46.112518310546875 151.203125) rotate(0 83.921875 108.06640625)"><path d="M32 0 C62.06 0.55, 87.61 0.41, 135.84 0 M32 0 C55.82 1.87, 78.61 1.1, 135.84 0 M135.84 0 C155.53 -1.41, 168.41 10.8, 167.84 32 M135.84 0 C156.36 -2.29, 167.33 9.51, 167.84 32 M167.84 32 C167.43 75.68, 167.06 121.96, 167.84 184.13 M167.84 32 C169.09 85.66, 168.98 137.5, 167.84 184.13 M167.84 184.13 C168.34 203.64, 157.39 214.34, 135.84 216.13 M167.84 184.13 C166.44 205.47, 156.43 215.93, 135.84 216.13 M135.84 216.13 C97.09 218.42, 59.35 215.28, 32 216.13 M135.84 216.13 C109.54 215.73, 82.64 216.97, 32 216.13 M32 216.13 C10.25 217.97, -0.87 204.25, 0 184.13 M32 216.13 C9.41 215.86, -1.74 205.74, 0 184.13 M0 184.13 C0.98 133.35, 2.23 86.52, 0 32 M0 184.13 C1.79 132.51, 0.42 81.25, 0 32 M0 32 C0.44 8.82, 10.17 -0.28, 32 0 M0 32 C-0.03 10.26, 10.78 -1.89, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(107.69441223144531 246.76953125) rotate(0 22.339981079101562 12.5)"><text x="22.339981079101562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(282.2609558105469 160.05859375) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C70.06 -2.54, 109.32 0.92, 142.62 0 M32 0 C74.19 -0.83, 118.3 -0.06, 142.62 0 M142.62 0 C163.25 -2, 174.17 9.66, 174.62 32 M142.62 0 C163.75 -0.84, 175.03 10.82, 174.62 32 M174.62 32 C175.44 70.25, 173.44 106.8, 174.62 170.18 M174.62 32 C175.19 80.13, 175.05 129.2, 174.62 170.18 M174.62 170.18 C173.4 191.52, 163.31 202.01, 142.62 202.18 M174.62 170.18 C176.17 192.14, 164.72 201.51, 142.62 202.18 M142.62 202.18 C97.81 199.66, 54.89 201.83, 32 202.18 M142.62 202.18 C114.15 203.98, 85.66 202.46, 32 202.18 M32 202.18 C9.57 201.95, -1.51 191.75, 0 170.18 M32 202.18 C11.18 201.64, -1.62 192.23, 0 170.18 M0 170.18 C-0.53 139.15, 0.37 112.57, 0 32 M0 170.18 C1.58 130.69, 1.11 92.91, 0 32 M0 32 C-0.03 10.32, 10.76 -1.64, 32 0 M0 32 C-0.16 12.27, 12.08 -0.94, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(302.82154083251953 248.650390625) rotate(0 66.74996185302734 12.5)"><text x="66.74996185302734" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(585.714080810547 162.91015625) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C68.25 -0.35, 101.18 -2.91, 203.29 0 M32 0 C70.94 -1.11, 110.37 -0.61, 203.29 0 M203.29 0 C224.45 -0.73, 235.64 10.8, 235.29 32 M203.29 0 C223.89 -0.27, 236.81 11.8, 235.29 32 M235.29 32 C235.72 79.65, 233.17 126.88, 235.29 163.26 M235.29 32 C234.82 59.37, 235.11 86.65, 235.29 163.26 M235.29 163.26 C236.64 185.14, 225.29 194.68, 203.29 195.26 M235.29 163.26 C237.52 184.41, 223.25 194.22, 203.29 195.26 M203.29 195.26 C166.96 194.94, 134 195.1, 32 195.26 M203.29 195.26 C135.64 194.1, 68.34 194.34, 32 195.26 M32 195.26 C11.11 194.79, -1.41 185.22, 0 163.26 M32 195.26 C8.63 197.41, 0.46 185.47, 0 163.26 M0 163.26 C-1.51 133.98, -1.19 109.07, 0 32 M0 163.26 C0.31 135.85, 0.38 107.97, 0 32 M0 32 C-0.14 12.06, 11.9 -0.81, 32 0 M0 32 C0.5 9.3, 10.87 -0.34, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(602.0686874389651 235.541015625) rotate(0 101.28992462158203 25)"><text x="101.28992462158203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="101.28992462158203" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(882.776580810547 128.52734375) rotate(0 137.23242187499994 134.5)"><path d="M155.43 1.1 C169.61 0.98, 185.67 7.89, 199.01 14.56 C212.35 21.23, 225.06 30.72, 235.48 41.14 C245.9 51.56, 255.21 63.83, 261.56 77.09 C267.9 90.35, 271.89 106.08, 273.55 120.71 C275.22 135.33, 274.91 150.7, 271.56 164.84 C268.21 178.99, 261.25 193.24, 253.45 205.56 C245.65 217.89, 236.28 229.56, 224.75 238.77 C213.23 247.98, 198.46 255.78, 184.29 260.83 C170.13 265.88, 154.62 268.85, 139.75 269.07 C124.87 269.29, 109.04 266.61, 95.03 262.15 C81.02 257.7, 67.49 250.79, 55.68 242.35 C43.87 233.91, 32.56 223.41, 24.17 211.53 C15.78 199.66, 9.39 185.07, 5.35 171.1 C1.32 157.13, -0.86 142.4, -0.06 127.72 C0.73 113.03, 4.54 96.76, 10.14 82.97 C15.74 69.18, 23.72 55.8, 33.52 44.98 C43.33 34.15, 56.08 25.14, 68.96 18 C81.85 10.86, 95.55 4.87, 110.82 2.14 C126.1 -0.59, 151.83 1.21, 160.63 1.63 C169.43 2.04, 164.24 2.49, 163.63 4.64 M129.55 -0.12 C143.52 -3, 159.04 1.21, 173.07 5.42 C187.1 9.63, 201.26 16.84, 213.72 25.12 C226.18 33.39, 239.01 43.38, 247.84 55.05 C256.67 66.73, 262.16 81.43, 266.69 95.17 C271.22 108.9, 275.39 123.11, 275.01 137.44 C274.64 151.77, 269.64 167.7, 264.44 181.17 C259.23 194.64, 253.01 207.02, 243.79 218.27 C234.57 229.51, 221.8 240.78, 209.12 248.64 C196.43 256.49, 182.08 262.32, 167.67 265.38 C153.26 268.44, 137.45 268.33, 122.67 267 C107.88 265.66, 92.29 263.44, 78.97 257.37 C65.66 251.31, 53.4 241.05, 42.79 230.61 C32.18 220.17, 22.2 207.64, 15.32 194.74 C8.44 181.84, 3.4 167.28, 1.5 153.2 C-0.4 139.12, 1.36 124.57, 3.9 110.26 C6.44 95.94, 9.54 79.98, 16.74 67.3 C23.93 54.62, 35.66 43.64, 47.08 34.15 C58.49 24.67, 71.52 16.12, 85.2 10.39 C98.88 4.66, 121.92 1.21, 129.14 -0.25 C136.37 -1.71, 128.38 -0.74, 128.55 1.63" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(949.7710677778118 237.92148168040936) rotate(0 70.19995880126953 25.000000000000004)"><text x="70.19995880126953" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="70.19995880126953" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Metadata DB</text></g><g stroke-linecap="round"><g transform="translate(214.95626831054688 251.46683773028053) rotate(0 29.921875 -0.6366815047248338)"><path d="M-0.42 -1.2 C9.45 -1.52, 49.55 -1.79, 59.57 -1.88 M1.55 0.79 C11.22 0.61, 48.92 -0.42, 58.48 -0.65" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(214.95626831054688 251.46683773028053) rotate(0 29.921875 -0.6366815047248338)"><path d="M30.64 10.31 C37.77 6.36, 47.9 3.04, 58.48 -0.65 M30.64 10.31 C37.64 7.28, 45.96 5, 58.48 -0.65" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(214.95626831054688 251.46683773028053) rotate(0 29.921875 -0.6366815047248338)"><path d="M30.1 -10.16 C37.43 -7.39, 47.73 -4, 58.48 -0.65 M30.1 -10.16 C37.29 -7.79, 45.75 -4.67, 58.48 -0.65" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(461.745330810547 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M-0.27 -0.6 C19.41 -1.4, 97.93 -5.15, 117.64 -5.96 M1.79 1.7 C21.34 1.17, 97.38 -3.69, 116.63 -4.65" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(461.745330810547 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M89.08 7.21 C95.48 3.96, 103.05 1.35, 116.63 -4.65 M89.08 7.21 C98.23 4.09, 106.62 -0.55, 116.63 -4.65" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(461.745330810547 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M87.9 -13.28 C94.42 -11.11, 102.3 -8.29, 116.63 -4.65 M87.9 -13.28 C97.35 -10.11, 106.1 -8.46, 116.63 -4.65" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(468.589080810547 213.421875) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(826.339080810547 244.81640625) rotate(0 23.2421875 0.875)"><path d="M0.1 0.04 C7.82 0.35, 38.52 1.36, 46.31 1.69 M-0.52 -0.42 C7.13 0, 37.92 2.1, 45.79 2.35" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(826.339080810547 244.81640625) rotate(0 23.2421875 0.875)"><path d="M23.55 9.15 C30.11 6.83, 36.4 5.83, 45.79 2.35 M23.55 9.15 C31.46 7.11, 39.17 4.1, 45.79 2.35" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(826.339080810547 244.81640625) rotate(0 23.2421875 0.875)"><path d="M24.38 -6.74 C30.67 -4.43, 36.72 -0.8, 45.79 2.35 M24.38 -6.74 C32.05 -3.23, 39.47 -0.7, 45.79 2.35" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1179.5617370605469 214.6640625) rotate(0 97.95991516113276 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentVersionId</text></g><g stroke-linecap="round" transform="translate(552.018768310547 494.2265625) rotate(0 128.2890625 85.94921875)"><path d="M32 0 C84.63 -0.08, 134.29 -0.6, 224.58 0 M32 0 C100.61 0.49, 168.82 0.5, 224.58 0 M224.58 0 C244.69 0.01, 255.93 10.49, 256.58 32 M224.58 0 C247.46 0.63, 257.34 10, 256.58 32 M256.58 32 C255.59 72.97, 256.58 117.97, 256.58 139.9 M256.58 32 C256.05 60.49, 255.83 86.53, 256.58 139.9 M256.58 139.9 C255.48 161, 244.4 172.13, 224.58 171.9 M256.58 139.9 C257.09 160.69, 244.29 172.61, 224.58 171.9 M224.58 171.9 C184.65 170.45, 144.86 173.07, 32 171.9 M224.58 171.9 C171.05 170.88, 116.84 171.67, 32 171.9 M32 171.9 C10.64 171.55, 0.1 159.59, 0 139.9 M32 171.9 C10.5 173.5, 1.41 160.3, 0 139.9 M0 139.9 C0.35 107.12, 2.11 68.6, 0 32 M0 139.9 C-0.2 110.21, -0.28 79.75, 0 32 M0 32 C-1.09 8.95, 10.88 0.34, 32 0 M0 32 C-0.62 9.57, 11.89 -2.24, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(595.387908935547 567.67578125) rotate(0 84.919921875 12.5)"><text x="84.919921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Service</text></g><g stroke-linecap="round"><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M0.4 0.66 C21.17 22.3, 104.49 107.85, 125.31 129.24 M-0.84 -0.04 C19.73 21.78, 103.58 108.69, 124.51 130.32" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M27.4 13.74 C18.86 9.59, 6.6 4.93, 0.4 0.66 M27.4 13.74 C21.15 10.77, 15.81 7.96, 0.4 0.66" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M12.68 28.03 C9.5 18.7, 2.54 8.89, 0.4 0.66 M12.68 28.03 C9.48 22.22, 7.21 16.42, 0.4 0.66" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M97.54 117.17 C108.27 122.27, 115.41 127.04, 124.51 130.32 M97.54 117.17 C102.57 120.16, 108.48 122.81, 124.51 130.32" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M112.31 102.92 C117.65 113.19, 119.49 123.08, 124.51 130.32 M112.31 102.92 C114.27 108.74, 117.1 114.37, 124.51 130.32" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(370.7375183105469 416.6015625) rotate(0 49.989952087402344 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket</text></g><g stroke-linecap="round" transform="translate(927.655487060547 460.87109375) rotate(0 114.958984375 106.5625)"><path d="M121.14 -0.17 C134.5 -0.95, 149.43 4.7, 162.1 10.08 C174.77 15.46, 187.45 22.92, 197.13 32.12 C206.81 41.31, 214.74 53.6, 220.18 65.23 C225.62 76.85, 229.25 89.34, 229.75 101.85 C230.26 114.35, 227.71 128, 223.23 140.26 C218.75 152.52, 211.81 165.49, 202.89 175.41 C193.97 185.33, 181.71 193.66, 169.69 199.76 C157.68 205.85, 144.27 210.35, 130.78 212 C117.28 213.65, 102.4 212.76, 88.71 209.67 C75.03 206.58, 60.2 200.86, 48.67 193.47 C37.14 186.09, 27.13 175.87, 19.51 165.36 C11.9 154.85, 6.06 142.9, 2.98 130.4 C-0.11 117.89, -1.06 103.22, 0.99 90.34 C3.04 77.46, 8.24 64.13, 15.26 53.12 C22.29 42.11, 32.39 32.4, 43.12 24.27 C53.85 16.14, 66.03 8.28, 79.63 4.35 C93.23 0.43, 116.94 1.16, 124.7 0.71 C132.45 0.27, 126.44 -0.06, 126.15 1.68 M63.64 10.93 C74.69 3.84, 90.6 0.2, 104.36 -0.77 C118.13 -1.75, 132.79 1.49, 146.25 5.09 C159.71 8.7, 173.99 13.47, 185.11 20.88 C196.23 28.28, 205.83 38.55, 212.99 49.52 C220.15 60.49, 225.35 73.76, 228.08 86.71 C230.82 99.65, 232.21 114.59, 229.41 127.19 C226.62 139.78, 218.78 151.41, 211.31 162.27 C203.84 173.13, 195.4 184.5, 184.6 192.35 C173.8 200.2, 159.89 206.07, 146.51 209.37 C133.14 212.68, 118.27 213.64, 104.34 212.19 C90.41 210.75, 75.31 206.28, 62.95 200.69 C50.6 195.1, 39.46 188.03, 30.2 178.65 C20.94 169.27, 12.28 156.65, 7.38 144.4 C2.48 132.15, 0.94 118.01, 0.8 105.16 C0.65 92.31, 1.91 78.92, 6.53 67.28 C11.15 55.64, 18.96 44.67, 28.51 35.33 C38.05 25.98, 57.95 15.09, 63.81 11.2 C69.68 7.32, 62.69 10.57, 63.69 12.01" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(990.7162468210763 530.0825273798085) rotate(0 52.109947204589844 37.5)"><text x="52.109947204589844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="52.109947204589844" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="52.109947204589844" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(819.651580810547 547.2708021698872) rotate(0 52.173828125 -1.3912604599437373)"><path d="M-0.73 0 C16.57 -0.3, 86.31 -2.48, 103.96 -2.89 M1.08 -1.04 C18.18 -1.05, 85.52 -1.42, 102.81 -1.4" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(819.651580810547 547.2708021698872) rotate(0 52.173828125 -1.3912604599437373)"><path d="M74.65 8.93 C83.5 5.25, 92.07 4.03, 102.81 -1.4 M74.65 8.93 C84.8 5.55, 92.44 1.8, 102.81 -1.4" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(819.651580810547 547.2708021698872) rotate(0 52.173828125 -1.3912604599437373)"><path d="M74.59 -11.59 C83.27 -8.9, 91.86 -3.73, 102.81 -1.4 M74.59 -11.59 C84.83 -8.25, 92.49 -5.29, 102.81 -1.4" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M-0.39 -0.1 C19.08 23.16, 49.62 106.61, 116.04 139.56 C182.47 172.52, 351.02 187.88, 398.16 197.6" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M23.72 17.76 C17.78 14.76, 12.74 9.81, -0.39 -0.1" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M6.6 29.07 C4.75 23.43, 3.8 15.77, -0.39 -0.1" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M368.75 203.47 C375.6 203.52, 383.35 201.43, 398.16 197.6" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M371.85 183.19 C377.97 188.07, 384.97 190.82, 398.16 197.6" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(59.693598180727804 509.9091044716324) rotate(0 108.58990478515625 25)"><text x="108.58990478515625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write/Receive</text><text x="108.58990478515625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Edits, Cursor Changes</text></g><g stroke-linecap="round"><g transform="translate(656.2827274813473 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M0.4 -0.35 C6.06 11.47, 23.04 72.19, 34.8 71.24 C46.56 70.3, 65.01 6.75, 70.98 -6.03 M-0.85 -1.58 C4.69 10.41, 22.07 73.3, 34.46 72.73 C46.85 72.16, 67.53 7.84, 73.49 -5" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(656.2827274813473 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M72.8 24.99 C72.39 15.91, 73.07 1.75, 73.49 -5 M72.8 24.99 C73.41 16.91, 73.14 10.51, 73.49 -5" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(656.2827274813473 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M53.69 17.53 C60.32 11.13, 68.03 -0.29, 73.49 -5 M53.69 17.53 C59.1 11.34, 63.7 6.84, 73.49 -5" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(614.632049560547 762.7265625) rotate(0 72.75993347167969 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Ops</text></g><g transform="translate(814.557830810547 496.53125) rotate(0 55.01994323730469 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Applied Ops</text></g><g stroke-linecap="round"><g transform="translate(943.092987060547 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-1.12 0.05 C-22.09 -0.31, -105.57 -2.5, -126.56 -2.72 M0.5 -0.97 C-20.56 -1.12, -105.99 -1.11, -127.41 -1.46" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(943.092987060547 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-99.15 -11.52 C-105.9 -9.06, -113.67 -7.53, -127.41 -1.46 M-99.15 -11.52 C-110.33 -8.05, -121.17 -3.74, -127.41 -1.46" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(943.092987060547 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-99.3 9 C-105.92 6.53, -113.65 3.13, -127.41 -1.46 M-99.3 9 C-110.38 4.68, -121.16 1.2, -127.41 -1.46" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(803.7227020263673 656.0625) rotate(0 79.00993347167969 25)"><text x="79.00993347167969" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">On Initialization</text><text x="79.00993347167969" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Read all Ops</text></g><g stroke-linecap="round"><g transform="translate(698.331268310547 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-0.35 0.95 C-6.8 -13.2, 0.34 -56.8, -38.51 -85.47 C-77.37 -114.14, -200.98 -156.91, -233.5 -171.08" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(698.331268310547 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-203.51 -170.31 C-211.37 -171.06, -220.58 -171.76, -233.5 -171.08" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(698.331268310547 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-211.02 -151.21 C-216.43 -157.97, -223.27 -164.68, -233.5 -171.08" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(680.197364807129 393.0859375) rotate(0 81.23993682861328 25)"><text x="81.23993682861328" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Send all Applied </text><text x="81.23993682861328" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops on Connect</text></g><g stroke-linecap="round"><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M-0.52 -0.73 C1.66 -14.02, 4.86 -78, 12.82 -78.66 C20.77 -79.33, 41.3 -16.98, 47.23 -4.72 M1.4 1.5 C4 -11.09, 7.14 -76.39, 15.18 -77.2 C23.22 -78.01, 44.04 -15.5, 49.65 -3.33" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M-7.46 -29.92 C-6.47 -22.84, -3.56 -15.12, -0.52 -0.73 M-7.46 -29.92 C-5.94 -20.49, -3.96 -10.77, -0.52 -0.73" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M12.92 -27.55 C8.2 -21.22, 5.43 -14.16, -0.52 -0.73 M12.92 -27.55 C8.09 -18.91, 3.71 -9.93, -0.52 -0.73" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M29.83 -25.85 C34.35 -20.58, 40.86 -14.72, 49.65 -3.33 M29.83 -25.85 C35.35 -18.47, 41.34 -10.83, 49.65 -3.33" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M48.94 -33.32 C48.2 -26.05, 49.37 -18.1, 49.65 -3.33 M48.94 -33.32 C48.52 -23.66, 48.56 -13.69, 49.65 -3.33" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(10 10) rotate(0 101.45991516113281 25)"><text x="101.45991516113281" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Received </text><text x="101.45991516113281" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops</text></g><g stroke-linecap="round" transform="translate(270.5933103584872 727.8757861358799) rotate(0 88.76647881088672 69.47098268956097)"><path d="M98.88 -0.46 C110.59 -0.37, 124.15 4.97, 134.54 9.72 C144.94 14.47, 154.27 20.37, 161.27 28.06 C168.27 35.74, 174.2 46.61, 176.53 55.82 C178.87 65.04, 177.99 74.17, 175.27 83.34 C172.55 92.51, 167.47 103.15, 160.22 110.86 C152.97 118.57, 142.24 124.97, 131.76 129.59 C121.29 134.21, 109.23 137.61, 97.38 138.59 C85.53 139.57, 72.19 138.43, 60.66 135.46 C49.12 132.49, 36.9 127, 28.15 120.75 C19.4 114.5, 12.91 106.54, 8.15 97.96 C3.39 89.38, -0.26 78.78, -0.41 69.27 C-0.55 59.77, 2.29 49.38, 7.3 40.93 C12.3 32.47, 20.41 24.96, 29.62 18.53 C38.83 12.1, 50.17 5.2, 62.57 2.33 C74.97 -0.55, 96.12 1.1, 104.02 1.28 C111.91 1.45, 110.14 2.26, 109.95 3.36 M74.73 1.15 C85.87 -1.23, 99.29 -0.53, 111.04 1.59 C122.78 3.71, 135.94 7.99, 145.18 13.87 C154.43 19.75, 161.38 28.17, 166.5 36.87 C171.63 45.58, 175.04 56.56, 175.94 66.1 C176.84 75.65, 176.1 85.61, 171.9 94.14 C167.7 102.68, 159.1 110.79, 150.76 117.32 C142.42 123.86, 133.13 129.76, 121.86 133.35 C110.58 136.95, 95.54 138.98, 83.11 138.9 C70.68 138.81, 57.78 137.12, 47.26 132.84 C36.74 128.56, 27.52 120.55, 19.97 113.22 C12.42 105.9, 5.23 98.14, 1.95 88.88 C-1.33 79.63, -1.57 67.07, 0.3 57.67 C2.17 48.28, 6.73 40.41, 13.16 32.54 C19.59 24.66, 28.81 15.63, 38.86 10.44 C48.92 5.25, 67.43 2.54, 73.51 1.41 C79.59 0.27, 74.67 2.59, 75.33 3.63" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(310.0324659073119 784.723365869959) rotate(0 49.55994415283203 12.5)"><text x="49.55994415283203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Zookeeper</text></g><g stroke-linecap="round"><g transform="translate(560.43207129516 672.1413464529614) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-0.85 0.37 C-21.94 11.78, -105.58 56.98, -126.26 68.17 M0.91 -0.48 C-19.84 10.65, -103.03 55.66, -124.11 66.63" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.1413464529614) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-20.77 22.8 C-13.68 13.95, -6.01 8.9, -0.85 0.37 M-20.77 22.8 C-13.44 14.85, -8.08 7.43, -0.85 0.37" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.1413464529614) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-30.53 4.75 C-20.33 1.78, -9.52 2.54, -0.85 0.37 M-30.53 4.75 C-20.06 2.82, -11.41 1.5, -0.85 0.37" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.1413464529614) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-104.05 44.33 C-109.94 49.6, -115.16 58.96, -124.11 66.63 M-104.05 44.33 C-110.64 51.83, -118.8 59.53, -124.11 66.63" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.1413464529614) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-94.41 62.45 C-103.36 61.81, -111.69 65.34, -124.11 66.63 M-94.41 62.45 C-104.09 63.9, -115.51 65.48, -124.11 66.63" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(186.2789360980014 632.6680205367957) rotate(0 93.76992797851562 12.5)"><text x="93.76992797851562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Query Hash Ranges</text></g><g stroke-linecap="round" transform="translate(936.6077395124131 758.0430391257596) rotate(0 102.9233553635546 72.1817988613102)"><path d="M32 0 C62.73 -2.12, 93.6 0.49, 173.85 0 M32 0 C71.81 -0.86, 110.93 -0.07, 173.85 0 M173.85 0 C195.15 -0.35, 205.94 9.02, 205.85 32 M173.85 0 C195.02 1.6, 207.26 9.73, 205.85 32 M205.85 32 C205.08 59.77, 206.83 81.81, 205.85 112.36 M205.85 32 C206.04 54.5, 205.97 76.24, 205.85 112.36 M205.85 112.36 C204.75 131.98, 195.39 144.7, 173.85 144.36 M205.85 112.36 C205.23 132.6, 196.4 142.12, 173.85 144.36 M173.85 144.36 C143.43 143.19, 111.65 141.65, 32 144.36 M173.85 144.36 C140.79 143.55, 108.51 144.43, 32 144.36 M32 144.36 C10.65 144.15, -1.54 135.29, 0 112.36 M32 144.36 C9.52 142.57, -1.52 134.76, 0 112.36 M0 112.36 C1.16 95.82, 2.3 79.96, 0 32 M0 112.36 C-0.1 88.63, 0.37 64.41, 0 32 M0 32 C1.61 9.74, 11.52 0.03, 32 0 M0 32 C0.96 10.37, 12.43 1.74, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(945.0611775786044 805.2248379870698) rotate(0 94.46991729736328 25)"><text x="94.46991729736328" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Compaction/Cleanup</text><text x="94.46991729736328" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round"><g transform="translate(1001.4240486939976 753.136873966213) rotate(0 3.239567070997964 -38.72811925242149)"><path d="M0.47 -0.25 C1.54 -13.34, 4.25 -64.46, 5.3 -77.51 M-0.74 -1.43 C0.77 -13.79, 6.25 -63.27, 7.39 -76.01" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(1001.4240486939976 753.136873966213) rotate(0 3.239567070997964 -38.72811925242149)"><path d="M14.74 -46.92 C12.55 -54.91, 11.35 -58.56, 7.39 -76.01 M14.74 -46.92 C13.28 -53.14, 11.81 -59.82, 7.39 -76.01" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(1001.4240486939976 753.136873966213) rotate(0 3.239567070997964 -38.72811925242149)"><path d="M-5.67 -49 C-3.6 -56.64, -0.55 -59.85, 7.39 -76.01 M-5.67 -49 C-2.91 -54.76, -0.13 -61.01, 7.39 -76.01" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(1082.3820157669134 672.1851488337043) rotate(0 -0.04993552325242945 39.20562769352205)"><path d="M-1.18 -0.06 C-1.23 12.87, 0.03 64.25, 0.16 77.3 M0.4 -1.13 C0.18 11.92, -0.36 64.82, -0.65 78.26" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(1082.3820157669134 672.1851488337043) rotate(0 -0.04993552325242945 39.20562769352205)"><path d="M-10.48 49.91 C-7.3 60.06, -5.72 68.73, -0.65 78.26 M-10.48 49.91 C-7.62 57.21, -4.93 66.84, -0.65 78.26" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(1082.3820157669134 672.1851488337043) rotate(0 -0.04993552325242945 39.20562769352205)"><path d="M10.04 50.22 C6.26 60.06, 0.88 68.63, -0.65 78.26 M10.04 50.22 C7.03 57.4, 3.85 66.93, -0.65 78.26" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(933.2433336332841 766.3136101644341) rotate(0 -69.23248201921683 -48.637199647814896)"><path d="M0.26 -1.11 C-13.97 -5.86, -63.48 -12.48, -86.6 -28.54 C-109.72 -44.61, -129.85 -85.87, -138.48 -97.48 M-1.06 0.92 C-15.37 -3.63, -64.67 -10.89, -87.7 -27.09 C-110.74 -43.29, -130.85 -84.51, -139.25 -96.28" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(933.2433336332841 766.3136101644341) rotate(0 -69.23248201921683 -48.637199647814896)"><path d="M-115.75 -77.63 C-122.34 -81.84, -125.51 -85.13, -139.25 -96.28 M-115.75 -77.63 C-122.47 -82.4, -128.42 -88.76, -139.25 -96.28" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(933.2433336332841 766.3136101644341) rotate(0 -69.23248201921683 -48.637199647814896)"><path d="M-133.24 -66.89 C-136.29 -73.3, -135.93 -78.76, -139.25 -96.28 M-133.24 -66.89 C-135.02 -74.54, -136.04 -83.95, -139.25 -96.28" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(768.0356929293295 767.8491275044435) rotate(0 66.64994049072266 25)"><text x="66.64994049072266" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Flip Document</text><text x="66.64994049072266" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Version</text></g><g transform="translate(1185.857055540374 511.2179896296684) rotate(0 97.95991516113276 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentVersionId</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  metadata</text></g><g stroke-linecap="round"><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M0.06 -0.99 C22.49 -19.53, 111.99 -92.84, 134.55 -111.48 M-1.37 1.11 C20.89 -17.75, 110.83 -94.35, 133.55 -113.16" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M15.33 -26.81 C9.08 -19.23, 7.55 -10.14, 0.06 -0.99 M15.33 -26.81 C11.52 -20.35, 8.43 -12.78, 0.06 -0.99" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M28.36 -10.95 C18.24 -8.1, 12.82 -3.75, 0.06 -0.99 M28.36 -10.95 C21.13 -8.68, 14.66 -5.22, 0.06 -0.99" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M118.59 -87.16 C121.46 -95.08, 128.96 -101.47, 133.55 -113.16 M118.59 -87.16 C122.5 -93.96, 127.25 -99.82, 133.55 -113.16" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M105.38 -102.86 C112.17 -106.1, 123.62 -107.8, 133.55 -113.16 M105.38 -102.86 C112.75 -105.51, 120.93 -107.3, 133.55 -113.16" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Compaction Service</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-2">Challenges</h5></div></div></div></div></div></div><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation0 MuiAccordion-root MuiAccordion-rounded MuiAccordion-gutters mui-11r69q9"><div class="MuiButtonBase-root MuiAccordionSummary-root MuiAccordionSummary-gutters mui-3ujfba" tabindex="0" role="button" aria-expanded="false" aria-controls="panel1bh-content" id="panel1bh-header"><div class="MuiAccordionSummary-content MuiAccordionSummary-contentGutters mui-l0jafl"><p class="MuiTypography-root MuiTypography-body1 mui-h8owmt">Great Solution: Online Snapshot/Compact Operations</p></div><div class="MuiAccordionSummary-expandIconWrapper mui-awtdfi"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ExpandMoreIcon"><path d="M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg></div></div><div class="MuiCollapse-root MuiCollapse-vertical MuiCollapse-hidden mui-a0y2e3" style="min-height: 0px;"><div class="MuiCollapse-wrapper MuiCollapse-vertical mui-hboir5"><div class="MuiCollapse-wrapperInner MuiCollapse-vertical mui-8atqhb"><div aria-labelledby="panel1bh-header" id="panel1bh-content" role="region" class="MuiAccordion-region"><div class="MuiAccordionDetails-root mui-u7qq7e"><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="approach-3">Approach</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">A different approach we can take is to have our <span class="MuiBox-root mui-1vu004u">Document Service</span> periodically snapshot/compact operations. Since the <span class="MuiBox-root mui-1vu004u">Document Service</span> has exclusive ownership of a document when we're not scaling up the cluster, we can safely compact operations without worrying about coordination/consistency. In fact, a natural time to do this is when the document is idle and has no connections - something the document service will know about immediately. We also already have all of the existing document operations in memory at that time, making our job easier.</div><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">When the last client disconnects we can then:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Take all of the existing operations and offload them to a separate (low CPU nice) process for compaction.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Write the resulting operations to the DB under a new documentVersionId.</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0">Flip the <span class="MuiBox-root mui-1vu004u">documentVersionId</span> in the <span class="MuiBox-root mui-1vu004u">Document Metadata DB</span>.</div></li>
</ol><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag"><div class="MuiBox-root mui-10khgmf" style="cursor: pointer;"><div class="MuiGrid-root MuiGrid-container MuiGrid-direction-xs-column mui-1tdxmx0"><div class="MuiGrid-root MuiGrid-item mui-tolxbf"><div class="relative w-full"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall mui-wksd04" tabindex="0" type="button" aria-label="zoom-in"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-10dohqv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ZoomInIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"></path><path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"></path></svg><span class="MuiTouchRipple-root mui-w0pj6f"></span></button><span class="w-full h-full"><span class="block"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1391.7768858626396 876.8177515150019">
  <!-- svg-source:excalidraw -->
  <!-- payload-type:application/vnd.excalidraw+json --><!-- payload-version:2 -->
  <defs>
    <style class="style-fonts">
      
      
      
    </style>
    
  </defs>
  <rect x="0" y="0" width="1391.7768858626396" height="876.8177515150019" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(46.112518310546875 151.203125) rotate(0 83.921875 108.06640625)"><path d="M32 0 C57.73 0.06, 86.4 1.05, 135.84 0 M32 0 C61.45 -0.73, 90.74 0.14, 135.84 0 M135.84 0 C157.85 -1.65, 168.25 9.3, 167.84 32 M135.84 0 C154.89 -1.94, 166.14 9.7, 167.84 32 M167.84 32 C167.77 75.61, 168.63 119.44, 167.84 184.13 M167.84 32 C170.03 91.99, 169.77 151.93, 167.84 184.13 M167.84 184.13 C166.56 205.65, 157.29 217.75, 135.84 216.13 M167.84 184.13 C167.3 206.66, 154.91 214.94, 135.84 216.13 M135.84 216.13 C102.69 213.56, 70.23 216.96, 32 216.13 M135.84 216.13 C113.25 215.85, 89.41 216.01, 32 216.13 M32 216.13 C12.51 214.97, 1 204.76, 0 184.13 M32 216.13 C8.64 216.11, 1.13 204.14, 0 184.13 M0 184.13 C-0.36 126.22, -0.08 71.77, 0 32 M0 184.13 C0.21 123.83, 0.19 64.27, 0 32 M0 32 C0.64 10.49, 8.71 -0.7, 32 0 M0 32 C1.11 11.21, 10.07 -0.65, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(107.69441223144531 246.76953125) rotate(0 22.339981079101562 12.5)"><text x="22.339981079101562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">User</text></g><g stroke-linecap="round" transform="translate(282.2609558105469 160.05859375) rotate(0 87.310546875 101.091796875)"><path d="M32 0 C59.77 -1.96, 88.93 0.04, 142.62 0 M32 0 C61.5 -1.38, 90.53 -1.25, 142.62 0 M142.62 0 C161.97 -1.69, 173.14 9.83, 174.62 32 M142.62 0 C163.74 -1.79, 176.27 11.94, 174.62 32 M174.62 32 C177.88 71.06, 173.99 108.46, 174.62 170.18 M174.62 32 C174.84 72.47, 175.54 113.57, 174.62 170.18 M174.62 170.18 C174.15 192.55, 161.98 201.14, 142.62 202.18 M174.62 170.18 C175.14 190.89, 161.96 202.59, 142.62 202.18 M142.62 202.18 C117.13 203.73, 94.44 204.03, 32 202.18 M142.62 202.18 C111.58 201.65, 79.2 201.88, 32 202.18 M32 202.18 C8.91 202.16, 0.98 190.37, 0 170.18 M32 202.18 C12.23 201.58, 1.19 190.65, 0 170.18 M0 170.18 C2.19 142.98, -1.48 115.83, 0 32 M0 170.18 C-0.75 135.62, -2.05 100.88, 0 32 M0 32 C0.97 11.14, 10.15 -0.56, 32 0 M0 32 C-0.78 12.9, 11.46 1.86, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(302.82154083251953 248.650390625) rotate(0 66.74996185302734 12.5)"><text x="66.74996185302734" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">API Gateway</text></g><g stroke-linecap="round" transform="translate(585.714080810547 162.91015625) rotate(0 117.64453125000006 97.630859375)"><path d="M32 0 C66.21 -0.24, 102.88 0.61, 203.29 0 M32 0 C68.3 0.33, 105.85 0.75, 203.29 0 M203.29 0 C224.43 -1.56, 236.72 11.78, 235.29 32 M203.29 0 C223.94 2.27, 234.17 12.85, 235.29 32 M235.29 32 C233.83 83.86, 233.56 131.95, 235.29 163.26 M235.29 32 C235.13 73.08, 234.38 112.6, 235.29 163.26 M235.29 163.26 C235.74 184.05, 222.89 195.61, 203.29 195.26 M235.29 163.26 C233.36 186.19, 226.61 193.46, 203.29 195.26 M203.29 195.26 C146.62 195.3, 90.49 197.87, 32 195.26 M203.29 195.26 C161 194.64, 120.96 194.08, 32 195.26 M32 195.26 C12.02 194.74, 1.04 183.84, 0 163.26 M32 195.26 C8.42 194.71, -0.5 186.74, 0 163.26 M0 163.26 C0.18 120.43, 0.67 75.14, 0 32 M0 163.26 C1.77 125.25, 1.03 86.49, 0 32 M0 32 C-0.68 12.61, 11.36 1.62, 32 0 M0 32 C-1.05 10.84, 10.77 1.68, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(602.0686874389651 235.541015625) rotate(0 101.28992462158206 25)"><text x="101.28992462158203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Metadata</text><text x="101.28992462158203" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Service</text></g><g stroke-linecap="round" transform="translate(882.776580810547 128.52734375) rotate(0 137.23242187499994 134.5)"><path d="M150.37 -0.04 C164.67 -0.59, 180.87 5.96, 194.36 12.3 C207.86 18.65, 220.44 28.01, 231.34 38.05 C242.23 48.08, 252.61 59.76, 259.72 72.49 C266.83 85.22, 271.76 99.86, 273.99 114.45 C276.22 129.04, 276.14 145.52, 273.08 160.06 C270.02 174.6, 263.13 189.05, 255.64 201.68 C248.15 214.31, 239.12 226.43, 228.13 235.82 C217.14 245.22, 203.39 252.56, 189.7 258.05 C176.02 263.55, 160.66 267.8, 146 268.79 C131.35 269.78, 116.04 268.01, 101.78 263.99 C87.53 259.96, 72.98 252.79, 60.48 244.67 C47.98 236.55, 35.83 226.91, 26.8 215.27 C17.78 203.63, 10.76 188.87, 6.33 174.83 C1.89 160.8, -0.25 145.32, 0.2 131.06 C0.65 116.79, 4.08 102.72, 9.02 89.24 C13.95 75.75, 20.6 61.53, 29.81 50.14 C39.01 38.76, 51.55 28.78, 64.25 20.94 C76.95 13.11, 90.91 6.29, 106.02 3.14 C121.13 -0.01, 146.33 1.76, 154.91 2.04 C163.49 2.31, 157.86 2.86, 157.5 4.78 M137.47 -0.39 C151.57 -2.54, 168.17 1.82, 181.83 6.47 C195.49 11.13, 207.85 18.33, 219.44 27.53 C231.03 36.73, 242.83 49.71, 251.36 61.69 C259.9 73.66, 266.66 85.65, 270.64 99.38 C274.62 113.11, 276.28 129.41, 275.24 144.08 C274.2 158.76, 270.39 173.97, 264.38 187.44 C258.38 200.91, 249.65 214.15, 239.21 224.9 C228.78 235.64, 214.75 244.81, 201.77 251.89 C188.79 258.98, 175.78 264.9, 161.32 267.39 C146.86 269.89, 129.9 269, 115.03 266.87 C100.16 264.74, 85.05 261.19, 72.1 254.61 C59.15 248.03, 47.47 238.25, 37.32 227.37 C27.17 216.5, 17.31 202.66, 11.19 189.34 C5.07 176.03, 1.77 162, 0.61 147.47 C-0.56 132.94, 0.41 116.67, 4.17 102.16 C7.94 87.66, 15 72.55, 23.19 60.44 C31.38 48.34, 41.7 38.61, 53.29 29.56 C64.89 20.51, 78.73 11.07, 92.77 6.13 C106.81 1.2, 130.31 0.31, 137.53 -0.05 C144.76 -0.41, 136.48 1.69, 136.12 3.98" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(949.7710677778118 237.92148168040936) rotate(0 70.19995880126953 25)"><text x="70.19995880126953" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="70.19995880126953" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Metadata DB</text></g><g stroke-linecap="round"><g transform="translate(214.95626831054688 251.46683773028053) rotate(0 29.921875 -0.6366815047248338)"><path d="M-1.19 -1.01 C8.59 -1.17, 48.8 -1.58, 58.95 -1.78 M0.38 1.07 C10.52 1.14, 51.45 -0.1, 61.2 -0.51" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(214.95626831054688 251.46683773028053) rotate(0 29.921875 -0.6366815047248338)"><path d="M33.44 10.69 C40.72 5.9, 50.47 3.6, 61.2 -0.51 M33.44 10.69 C39.23 9.03, 45.21 6.51, 61.2 -0.51" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(214.95626831054688 251.46683773028053) rotate(0 29.921875 -0.6366815047248338)"><path d="M32.74 -9.77 C40.11 -8, 50.07 -3.74, 61.2 -0.51 M32.74 -9.77 C38.83 -6.88, 44.97 -4.86, 61.2 -0.51" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(461.745330810547 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M-0.89 -0.5 C18.91 -1.41, 97.71 -5.73, 117.63 -6.46 M0.85 -1.82 C20.59 -2.51, 97.05 -4.57, 116.62 -5.41" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(461.745330810547 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M88.8 5.8 C93.63 3.57, 98.5 2.94, 116.62 -5.41 M88.8 5.8 C98.23 2.49, 109.47 -3.44, 116.62 -5.41" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(461.745330810547 265.3392143026449) rotate(0 58.87109375 -2.7621410970089073)"><path d="M88.1 -14.71 C92.9 -12.82, 97.91 -9.33, 116.62 -5.41 M88.1 -14.71 C97.72 -10.74, 109.2 -9.38, 116.62 -5.41" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(468.589080810547 213.421875) rotate(0 47.73597717285156 10)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">POST /docs</text></g><g stroke-linecap="round"><g transform="translate(826.339080810547 244.81640625) rotate(0 23.2421875 0.875)"><path d="M0.39 0.31 C8.12 0.76, 38.68 1.96, 46.32 2.29 M-0.07 -0.01 C7.58 0.34, 38.17 1.36, 45.81 1.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(826.339080810547 244.81640625) rotate(0 23.2421875 0.875)"><path d="M23.7 8.83 C30.7 6.35, 37.56 4.07, 45.81 1.6 M23.7 8.83 C32.84 6.05, 41.44 3.13, 45.81 1.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(826.339080810547 244.81640625) rotate(0 23.2421875 0.875)"><path d="M24.23 -7.07 C31.02 -4.92, 37.72 -2.59, 45.81 1.6 M24.23 -7.07 C33.23 -3.58, 41.62 -0.22, 45.81 1.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(1179.5617370605469 214.6640625) rotate(0 97.95991516113276 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  id</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  title</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentVersionId</text></g><g stroke-linecap="round" transform="translate(552.018768310547 494.2265625) rotate(0 128.2890625 85.94921875)"><path d="M32 0 C85.94 2.65, 134.09 2.71, 224.58 0 M32 0 C87.64 0.5, 144.62 1.21, 224.58 0 M224.58 0 C245.44 1.04, 254.6 9.63, 256.58 32 M224.58 0 C246.43 -0.62, 254.58 11.07, 256.58 32 M256.58 32 C255.76 55.93, 257 79.58, 256.58 139.9 M256.58 32 C257.11 62.59, 256.68 93.99, 256.58 139.9 M256.58 139.9 C254.82 161.21, 246.89 170.75, 224.58 171.9 M256.58 139.9 C258.14 160.63, 247.11 171.03, 224.58 171.9 M224.58 171.9 C187.47 172.25, 144.83 173.06, 32 171.9 M224.58 171.9 C176.85 171.31, 127.5 171.05, 32 171.9 M32 171.9 C11.64 172.37, -0.52 160.67, 0 139.9 M32 171.9 C9.89 174.14, 0.8 163.1, 0 139.9 M0 139.9 C1.38 112.68, -0.17 86.72, 0 32 M0 139.9 C-0.14 114.76, 0.03 91.45, 0 32 M0 32 C-0.46 12.39, 9.11 0.37, 32 0 M0 32 C2.05 11.25, 9.07 -1.49, 32 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(595.387908935547 567.67578125) rotate(0 84.919921875 12.5)"><text x="84.919921875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document Service</text></g><g stroke-linecap="round"><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M1.06 -0.09 C21.85 21.75, 105.25 108.14, 125.78 129.86 M0.16 -1.19 C20.77 20.94, 104.13 109.14, 125.22 131.27" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M27.99 13.13 C17.58 9.51, 6.93 1.89, 1.06 -0.09 M27.99 13.13 C19.43 9.78, 10.35 4.65, 1.06 -0.09" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M13.19 27.34 C8.63 18.12, 3.69 5.01, 1.06 -0.09 M13.19 27.34 C9.19 19.48, 4.69 9.97, 1.06 -0.09" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M98.38 117.87 C108.44 124.05, 118.53 126.69, 125.22 131.27 M98.38 117.87 C106.45 122.32, 113.99 125.42, 125.22 131.27" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(452.378143310547 357.73828125) rotate(0 62.515924629730534 65.05859375)"><path d="M113.27 103.75 C117.45 115.5, 121.79 123.59, 125.22 131.27 M113.27 103.75 C116.75 112.68, 119.69 120.14, 125.22 131.27" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(370.7375183105469 416.6015625) rotate(0 49.989952087402344 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Websocket</text></g><g stroke-linecap="round" transform="translate(927.655487060547 460.87109375) rotate(0 114.958984375 106.5625)"><path d="M118.84 -0.94 C131.81 -2.16, 146.46 3.59, 159.08 8.59 C171.71 13.59, 184.51 20.33, 194.58 29.08 C204.65 37.82, 213.53 49.1, 219.49 61.03 C225.46 72.97, 229.67 87.7, 230.38 100.7 C231.1 113.69, 228.1 126.84, 223.78 139 C219.46 151.17, 213.02 163.78, 204.47 173.68 C195.92 183.58, 184.43 191.89, 172.48 198.4 C160.54 204.91, 146.57 210.63, 132.82 212.76 C119.06 214.89, 103.55 214.22, 89.96 211.19 C76.37 208.17, 62.71 201.68, 51.26 194.61 C39.8 187.53, 29.28 178.96, 21.22 168.76 C13.17 158.56, 6.38 145.83, 2.94 133.4 C-0.5 120.96, -1.12 107.17, 0.59 94.15 C2.3 81.14, 6.68 66.76, 13.22 55.32 C19.75 43.88, 29.07 33.67, 39.79 25.53 C50.5 17.39, 63.43 10.55, 77.51 6.49 C91.59 2.44, 115.32 1.61, 124.25 1.21 C133.18 0.8, 131.17 2.36, 131.11 4.05 M110.72 0.46 C123.96 -1.71, 138.53 0.91, 151.43 5.21 C164.34 9.5, 177.39 17.75, 188.16 26.24 C198.93 34.74, 209.41 45.2, 216.08 56.21 C222.75 67.21, 226.38 79.58, 228.18 92.27 C229.97 104.97, 229.92 119.92, 226.85 132.37 C223.79 144.82, 217.43 156.79, 209.77 166.99 C202.11 177.18, 192.22 186.17, 180.91 193.52 C169.6 200.87, 155.46 208.24, 141.91 211.09 C128.35 213.95, 113.25 212.59, 99.57 210.65 C85.88 208.71, 72.07 205.28, 59.8 199.45 C47.53 193.62, 35.14 185.52, 25.95 175.68 C16.76 165.84, 8.76 152.73, 4.68 140.4 C0.6 128.07, 0.77 114.72, 1.47 101.7 C2.18 88.68, 3.71 73.83, 8.9 62.25 C14.08 50.67, 22.72 41.31, 32.58 32.21 C42.43 23.12, 55.26 13.26, 68.02 7.68 C80.78 2.1, 102 -0.29, 109.12 -1.27 C116.24 -2.25, 110.59 -0.09, 110.72 1.8" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(990.7162468210763 530.0825273798085) rotate(0 52.109947204589844 37.5)"><text x="52.109947204589844" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Document </text><text x="52.109947204589844" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="52.109947204589844" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">DB</text></g><g stroke-linecap="round"><g transform="translate(819.651580810547 547.2708021698872) rotate(0 52.173828125 -1.3912604599437373)"><path d="M-0.28 0.62 C16.9 -0.11, 85.68 -2.79, 103.16 -3.41 M1.77 -0.1 C19.3 -0.76, 88.21 -1.89, 105.25 -2.2" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(819.651580810547 547.2708021698872) rotate(0 52.173828125 -1.3912604599437373)"><path d="M77.25 8.56 C86.76 3.36, 93.25 2.5, 105.25 -2.2 M77.25 8.56 C84.14 6.27, 93.49 1.86, 105.25 -2.2" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(819.651580810547 547.2708021698872) rotate(0 52.173828125 -1.3912604599437373)"><path d="M76.89 -11.96 C86.68 -10.88, 93.28 -5.47, 105.25 -2.2 M76.89 -11.96 C83.7 -8.65, 93.14 -7.46, 105.25 -2.2" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M-1.19 -0.62 C18.11 22.42, 49.19 105.78, 115.51 138.91 C181.82 172.04, 349.85 188.18, 396.72 198.16" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M22.96 17.18 C15.15 12.47, 8.97 5.36, -1.19 -0.62" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M5.87 28.53 C2.73 20.85, 1.28 10.6, -1.19 -0.62" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M367.27 203.87 C374.35 203.03, 382.99 199.27, 396.72 198.16" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(148.3273620605471 374.098469607231) rotate(0 198.88266259317987 98.97437362922369)"><path d="M370.49 183.6 C376.78 188.34, 384.53 190.18, 396.72 198.16" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(59.693598180727804 509.90910447163196) rotate(0 108.58990478515625 25)"><text x="108.58990478515625" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Write/Receive</text><text x="108.58990478515625" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Edits, Cursor Changes</text></g><g stroke-linecap="round"><g transform="translate(656.2827274813473 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M-1.04 0.21 C4.35 12.29, 20.34 73.28, 32.63 72.17 C44.93 71.06, 66.16 6.55, 72.73 -6.43 M0.61 -0.73 C6.35 11.05, 22.83 71.3, 34.82 70.48 C46.8 69.67, 66.23 6.93, 72.51 -5.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(656.2827274813473 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M71.66 24.39 C72.36 13.05, 73.67 6.77, 72.51 -5.6 M71.66 24.39 C72.2 17.63, 71.58 11.13, 72.51 -5.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(656.2827274813473 675.69921875) rotate(0 35.84644563870097 32.92556599300451)"><path d="M52.58 16.82 C59.42 8.09, 66.88 4.26, 72.51 -5.6 M52.58 16.82 C57.38 11.77, 60.99 6.95, 72.51 -5.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(614.632049560547 762.7265625) rotate(0 72.75993347167969 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Ops</text></g><g transform="translate(814.557830810547 496.53125) rotate(0 55.01994323730469 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Applied Ops</text></g><g stroke-linecap="round"><g transform="translate(943.092987060547 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M0.35 -0.19 C-20.85 -0.42, -104.95 -1.99, -126.21 -2.32 M-0.92 -1.34 C-22.33 -1.3, -105.67 -0.94, -126.88 -0.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(943.092987060547 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-98.73 -11.23 C-110.01 -6.24, -120.78 -3.85, -126.88 -0.85 M-98.73 -11.23 C-106.71 -8.59, -116.66 -5.08, -126.88 -0.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(943.092987060547 630.3359375) rotate(0 -63.373046875 -1.091796875)"><path d="M-98.64 9.29 C-109.79 6.35, -120.6 0.81, -126.88 -0.85 M-98.64 9.29 C-106.83 5.68, -116.81 2.94, -126.88 -0.85" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(803.7227020263673 656.0625) rotate(0 79.00993347167969 25)"><text x="79.00993347167969" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">On Initialization</text><text x="79.00993347167969" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Read all Ops</text></g><g stroke-linecap="round"><g transform="translate(698.331268310547 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-0.44 0.05 C-6.72 -14.47, 1.5 -58.8, -37.16 -87.27 C-75.81 -115.74, -199.56 -156.93, -232.37 -170.78" stroke="#1e1e1e" stroke-width="2.5" fill="none" stroke-dasharray="8 10"></path></g><g transform="translate(698.331268310547 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-202.38 -170.35 C-212.63 -168.77, -224.22 -169.76, -232.37 -170.78" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g><g transform="translate(698.331268310547 488.06640625) rotate(0 -116.486328125 -85.177734375)"><path d="M-209.67 -151.17 C-217.39 -156.17, -226.46 -163.77, -232.37 -170.78" stroke="#1e1e1e" stroke-width="2.5" fill="none"></path></g></g><mask></mask><g transform="translate(680.197364807129 393.0859375) rotate(0 81.23993682861328 25)"><text x="81.23993682861328" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Send all Applied </text><text x="81.23993682861328" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops on Connect</text></g><g stroke-linecap="round"><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M0.6 -0.43 C2.48 -13.4, 4.4 -77.68, 12.42 -78.54 C20.44 -79.39, 42.64 -17.78, 48.73 -5.55 M-0.55 -1.69 C1.6 -14.4, 6.44 -76.52, 14.58 -77.01 C22.71 -77.49, 42.43 -16.73, 48.27 -4.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M-6.92 -29.47 C-4.85 -19.88, -1.22 -5.75, 0.6 -0.43 M-6.92 -29.47 C-4.38 -22.79, -4.05 -15.61, 0.6 -0.43" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M13.51 -27.51 C7.58 -18.58, 3.21 -5.22, 0.6 -0.43 M13.51 -27.51 C11.08 -21.35, 6.46 -14.65, 0.6 -0.43" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M28.38 -27.06 C35.34 -20.11, 43.82 -8.56, 48.27 -4.6 M28.38 -27.06 C33.87 -21.94, 37.2 -16.35, 48.27 -4.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(116.58517456054688 145.33984375) rotate(0 24.068359375 -39.26171875)"><path d="M47.47 -34.59 C46.9 -24.59, 47.9 -10.09, 48.27 -4.6 M47.47 -34.59 C48.39 -27.69, 47.08 -20.28, 48.27 -4.6" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(10 10) rotate(0 101.45991516113281 25)"><text x="101.45991516113281" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Transform Received </text><text x="101.45991516113281" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Ops</text></g><g stroke-linecap="round" transform="translate(270.5933103584872 727.8757861358799) rotate(0 88.76647881088672 69.47098268956097)"><path d="M117.93 2.98 C129.17 4.84, 140.61 12.11, 149.56 18.81 C158.52 25.52, 167.17 34.34, 171.67 43.2 C176.18 52.07, 177.14 62.52, 176.6 72 C176.06 81.49, 173.48 91.66, 168.42 100.09 C163.36 108.52, 155.3 116.74, 146.23 122.57 C137.15 128.41, 125.53 132.37, 113.98 135.08 C102.43 137.79, 88.8 139.94, 76.92 138.84 C65.04 137.74, 52.96 133.53, 42.7 128.48 C32.45 123.43, 22.09 116.2, 15.38 108.54 C8.68 100.88, 4.5 91.83, 2.48 82.55 C0.45 73.27, 0.59 62.08, 3.24 52.87 C5.89 43.65, 11.06 34.67, 18.36 27.28 C25.67 19.9, 36.51 12.93, 47.06 8.56 C57.61 4.19, 69.17 1.5, 81.67 1.07 C94.17 0.63, 114.5 4.69, 122.04 5.95 C129.58 7.22, 127.5 7.57, 126.9 8.65 M86.14 0.28 C97.83 -1.07, 113.78 2.45, 124.87 5.93 C135.97 9.41, 144.96 14.14, 152.71 21.17 C160.46 28.21, 167.45 39.29, 171.39 48.15 C175.33 57.01, 177.35 65.38, 176.36 74.33 C175.38 83.28, 171.09 93.48, 165.48 101.85 C159.88 110.22, 152.31 118.79, 142.74 124.56 C133.17 130.34, 119.82 134.15, 108.05 136.49 C96.28 138.82, 84.04 140.36, 72.14 138.57 C60.24 136.78, 46.74 131.33, 36.66 125.74 C26.58 120.15, 17.49 112.84, 11.68 105.03 C5.87 97.22, 3.24 88.44, 1.78 78.88 C0.33 69.32, -0.47 57.06, 2.95 47.66 C6.36 38.25, 14.14 29.34, 22.26 22.48 C30.37 15.61, 40.6 10.44, 51.64 6.48 C62.69 2.52, 82.78 -0.47, 88.52 -1.27 C94.26 -2.08, 86.47 0.26, 86.06 1.65" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(310.0324659073119 784.723365869959) rotate(0 49.55994415283203 12.5)"><text x="49.55994415283203" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Zookeeper</text></g><g stroke-linecap="round"><g transform="translate(560.43207129516 672.141346452961) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M0.62 -0.45 C-20.57 10.73, -105.36 55.32, -126.37 66.76 M-0.51 -1.74 C-21.43 9.65, -103.3 56.79, -124.28 68.15" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.141346452961) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-19.52 21.78 C-12.81 11.54, -5.12 4.89, 0.62 -0.45 M-19.52 21.78 C-10.9 12.72, -3 4.22, 0.62 -0.45" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.141346452961) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-29.1 3.63 C-18.91 0.02, -7.7 0.04, 0.62 -0.45 M-29.1 3.63 C-16.64 1.79, -4.97 0.43, 0.62 -0.45" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.141346452961) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-104.7 45.41 C-112.72 51.92, -119.64 61.81, -124.28 68.15 M-104.7 45.41 C-111.52 53.67, -119.23 62.85, -124.28 68.15" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(560.43207129516 672.141346452961) rotate(0 -62.60013490500842 33.52347646795738)"><path d="M-94.67 63.31 C-106.33 63.29, -116.94 66.59, -124.28 68.15 M-94.67 63.31 C-105.5 64.44, -117.15 66.59, -124.28 68.15" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(186.2789360980014 632.6680205367957) rotate(0 93.76992797851562 12.5)"><text x="93.76992797851562" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Query Hash Ranges</text></g><g transform="translate(1185.857055540374 511.2179896296684) rotate(0 97.95991516113276 50)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Operations</text><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  timestamp</text><text x="0" y="50" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  documentVersionId</text><text x="0" y="75" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">  metadata</text></g><g stroke-linecap="round"><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M0.46 -1.09 C23.1 -20.09, 113.06 -94.33, 135.58 -112.92 M-0.76 0.96 C21.82 -17.38, 112.45 -92.96, 135.12 -111.7" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M15.62 -26.97 C9.83 -18.13, 6.41 -10.95, 0.46 -1.09 M15.62 -26.97 C10.57 -20.24, 7.87 -12.55, 0.46 -1.09" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M28.71 -11.17 C19.13 -6.68, 12.06 -3.9, 0.46 -1.09 M28.71 -11.17 C20.02 -8.78, 13.74 -5.43, 0.46 -1.09" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M119.99 -85.79 C122.15 -91.49, 127.17 -98.73, 135.12 -111.7 M119.99 -85.79 C123.08 -93.23, 128.69 -99.75, 135.12 -111.7" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(797.8946337156125 489.64339917272446) rotate(0 67.31620631440694 -56.155616867500726)"><path d="M106.88 -101.58 C112.84 -102.93, 121.51 -105.77, 135.12 -111.7 M106.88 -101.58 C113.61 -104.68, 122.82 -106.87, 135.12 -111.7" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask></svg></span></span></div></div><div class="MuiGrid-root MuiGrid-item mui-1wxaqej"><span class="MuiTypography-root MuiTypography-caption mui-17cupi8">Online Snapshot/Compact Operations</span></div></div></div></div><h5 class="MuiTypography-root MuiTypography-h6 mui-13de2kc" id="challenges-3">Challenges</h5><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Moving compaction into the document service risks increasing latency for document operations (especially at the tail P99), we need to make sure they're not hogging our CPUs unnecessarily. One option for this is to run them in a separate process with lower CPU priority.</div></div></div></div></div></div></div></div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="some-additional-deep-dives-you-might-consider">Some additional deep dives you might consider</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Google Docs is a beast with hundreds to thousands of engineers working on it, so we can't cover everything here. Here are some additional deep dives you might consider:</div><ol style="list-style: outside decimal;">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Read-Only Mode</strong>: Google Docs has a "read-only" mode where users can view documents without interfering with others. It's also considerably more scalable, millions of readers can be viewing the same document. How might we implement this?</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Versioning</strong>: Google Docs allows users to revert to previous versions of a document. How can we extend our snapshot/compact approach to support this?</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Memory</strong>: The memory usage of our <span class="MuiBox-root mui-1vu004u">Document Service</span> can be a bottleneck. How can we further optimize it?</div></li>
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><strong>Offline Mode</strong>: How might we expand our design if we want to allow our clients to operate in an offline mode? What additional considerations do we need to bring into our design?</div></li>
</ol><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="what-is-expected-at-each-level"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.hellointerview.com/blog/the-system-design-interview-what-is-expected-at-each-level" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">What is Expected at Each Level?</a></h2><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="mid-level">Mid-level</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">Personally, I probably wouldn't ask this question of a mid-level candidate. That's not to say you won't get it, but I wouldn't. With that out of the way, I'd be looking for a candidate who can create a high-level design and then think through (together with some assistance) some of the issues that you'll encounter in a high concurrency problem like this. I want to see evidence that you can think on your feet, spitball solutions, and have a small (but growing) toolbox of technologies and approaches that you can apply to this problem.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="senior">Senior</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For senior candidates, I would expect them to immediately start to grok some of the consistency and durability challenges in this problem. They may start with a very basic, inefficient solution but I expect them to be able to proactively identify bottlenecks and solve them. While I would not expect a candidate to necessarily know the distinction between OT and CRDT, I would expect them to be able to talk about database tradeoffs and limitations, and how they might impact our design. We might have time for an additional deep dive.</div><h3 class="MuiTypography-root MuiTypography-h4 mui-hkpafq" id="staff">Staff</h3><div class="MuiTypography-root MuiTypography-body1 mui-1p1f0ag">For staff engineers, I'm expecting a degree of mastery over the problem. I'd expect them to be loosely familiar with CRDTs (if they're not, they'll make it up somewhere else) but intimately familiar with scaling socket services, consistency tradeoffs, serialization problems, transactions, and more. I'd expect to get through the deep dives and probably tack on an extra one if we're not too deep in optimizations.</div><h2 class="MuiTypography-root MuiTypography-h3 mui-1rzqq5q" id="references">References</h2><ul class="MuiList-root MuiList-padding mui-sedpvs">
<li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding mui-ioa8ei"><div class="MuiBox-root mui-0"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover mui-pvpazu" href="https://www.canva.dev/blog/engineering/realtime-mouse-pointers/" target="_blank" rel="noopener noreferrer" style="color: rgb(99, 115, 129); cursor: pointer; font-weight: 600; text-decoration: underline;">Real-Time Mouse Pointers</a>: How Canva enables collaborative editing using WebRTC.</div></li>
</ul></div></div>